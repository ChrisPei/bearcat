<!DOCTYPE html><html><head><title>Coverage</title><script>

headings = [];

onload = function(){
  headings = document.querySelectorAll('h2');
};

onscroll = function(e){
  var heading = find(window.scrollY);
  if (!heading) return;
  var links = document.querySelectorAll('#menu a')
    , link;

  for (var i = 0, len = links.length; i < len; ++i) {
    link = links[i];
    link.className = link.getAttribute('href') == '#' + heading.id
      ? 'active'
      : '';
  }
};

function find(y) {
  var i = headings.length
    , heading;

  while (i--) {
    heading = headings[i];
    if (y >= heading.offsetTop) {
      return heading;
    }
  }
}
</script>
<style>

body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  color: #2C2C2C;
  border-top: 2px solid #ddd;
}

#coverage {
  padding: 60px;
}

h1 a {
  color: inherit;
  font-weight: inherit;
}

h1 a:hover {
  text-decoration: none;
}

.onload h1 {
  opacity: 1;
}

h2 {
  width: 80%;
  margin-top: 80px;
  margin-bottom: 0;
  font-weight: 100;
  letter-spacing: 1px;
  border-bottom: 1px solid #eee;
}

a {
  color: #8A6343;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

ul {
  margin-top: 20px;
  padding: 0 15px;
  width: 100%;
}

ul li {
  float: left;
  width: 40%;
  margin-top: 5px;
  margin-right: 60px;
  list-style: none;
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  font-size: 12px;
}

ul::after {
  content: '.';
  height: 0;
  display: block;
  visibility: hidden;
  clear: both;
}

code {
  font: 12px monaco, monospace;
}

pre {
  margin: 30px;
  padding: 30px;
  border: 1px solid #eee;
  border-bottom-color: #ddd;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 0 10px #eee;
  -moz-box-shadow: inset 0 0 10px #eee;
  box-shadow: inset 0 0 10px #eee;
  overflow-x: auto;
}

img {
  margin: 30px;
  padding: 1px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  -moz-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  max-width: 100%;
}

footer {
  background: #eee;
  width: 100%;
  padding: 50px 0;
  text-align: right;
  border-top: 1px solid #ddd;
}

footer span {
  display: block;
  margin-right: 30px;
  color: #888;
  font-size: 12px;
}

#menu {
  position: fixed;
  font-size: 12px;
  overflow-y: auto;
  top: 0;
  right: 0;
  margin: 0;
  height: 100%;
  padding: 15px 0;
  text-align: right;
  border-left: 1px solid #eee;
  -moz-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-font-smoothing: antialiased;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGYAAABmCAMAAAAOARRQAAABelBMVEUjJSU6OzshIyM5OjoqKy02NjgsLS01NTYjJCUzNTUgISMlJSc0NTUvMDA6PDwlJyg1NjYoKis2NjYrLS02ODkpKyw0NDYrLC04ODovLzA4Ojo0NDUtLy86OjwjIyU4OTosLS82ODgtLS8hIyQvMTEnKCooKSsrKy0qLCwkJSUnKCkrLCwpKiwwMjIxMzMqLC0tLS0pKissLC00NTYwMDIwMTQpKysoKSovMDEtLzA2OTkxMzUrKywvLy8qKyszNTY5OzsqKiw6OjswMDExNDUoKiozNDUvMDIyNDY1Njg2Njk5OTozMzU0NjY4ODkiIyUiIyQ4OTkuMDEmKCowMjQwMTErLS4qKywwMTMhIiMpKiopKy0tLjAkJScxNDQvLzExNDYyNDQmKCk5OTslJig5OjskJSYxMzQrLS8gISIwMTIoKCk1NTUlJSUnJygwMDA4ODgiIiMhISI8PDw6Ojo5OTkpKSojIyQ7OzsyMjIpKSssLCw6Ozw1NjlrfLakAAAg2UlEQVR42jR6i3ea6rYvPgANIAhVXh8WvkQlioUiFlFcBtAmoiRNdzxqu9p0J7vrdK29zuPeex77nnvO/35n1r1ndHRktI0jTOacv/l7lCBK5UqVpOha/YxmWK7BC4TQFKVXrbYsnimqxuuMVlOQ0XltWjUdCwRJ1M+tC1KudOs9q6+da2adUewG0SC0SwELfHtgDds93VEuydEbl3QMWeNoYkR7b/0x1ZRobGI3mLwzAhePqTAwhg6aogjNsGy7/jwQ4rkdqe7CWLxF8k9LfMVFyRS7VJqtkrW8Vt/bkR8FZJao16ipknbC3Yw2lM7laO6HBEOadEZ2tpf65c4v8e3u7FyU6qbiNNyCuzXZ6pawgnwgmrpTT/Q7w2EZmiIJ0dzWDI7mhQ80IfRnMu2kzA5r5r1pIFoia+/d93HRYp1GV8TbrkWoU/+jdI0Ff6yGwTjT1Hn8J+8m1rKpGiYPuNiHnMtNMIv+zpsk84MYTNW1/+DpwXLvckdOCMYowVNPREe0QlM8xRHXXFhcNDzupwsSmb5pH+0t0RP2Qk+QtI7F1Qm6JRC6ZPBtPq/dq/kH+jxtCljn9TIpW6rQIgmSVyj6lPICIw4N/taka41PFUInth0je9+jO6Kt1G4/a7V2LEgG02B0pHVuCZrgltSKMuIl5SyufUv9mYuQi+mFgzbBEtFo2g+Dh4sSTrLNu8JPh00sQydpb00tqXBvqRN7Q7kqzcnIxCGnvZt/WmJacoOEO6Dcn8Qre03pOCSQxbMOXUuDNx9SxuLz4W1I18gvjViQ67zV0rxdWL8Te/TQkuo8STS41DR48W7L6YP2uWIqiUV8rd6Gbf/rnegKZeG8TpAM6afhGze9JAOxbLjsnUXEbrZ9vLYd7MT32cPF5mKKxmjy7huaoD9n62GOxni3iIJwv0IzZAZjdZkUtolCNLVfYZNaquFjGszVVf+J0vrz4CawoKdHnOzb0NMH7CDBOybfYNJ4rfeMyFNjkFYVTzMFs87rnPGXLUOeNKRVc0LnU7/UIgelzsy3CMuth0YfvnY0wsD3vODUL3eJcKqHQpm8yM3XZQWJxO6Un9iYloyyLpOwN2obHy6W6gbpcb44XmyC+mg+itAcaprGcrwZCqMj/GmtKn0zPvpTz/Cv1dw21XwP3cRupg3H3MF/S71eTKj1YrdwKdc2Mw0fRmb2sFf8lW3aU6JbIZSEPqvXvjM7G/aApyXlXeqKfMq0g/Su3rUGJPSPrtGElgknrZM3xUXqsAP6zMCNVn5u8aJnSNpJv2uru7t2jfRziW2+GuhqfldUNbPk71olwo+46ePUo1U3WKk/e5YK07F/wGRgcpODmQnIlVeHCWBE4puBi2jq28UKpqiN1/4UOrGz59TNYrrQHtd+11sG40BGD+pXdelNqGOg4NXe8W4eacJV/NS9/2Umtym6WQqveqR9xdCMElpxnbkalM4Vf9uaEcWZaKdyibEIjWKxJZPN95niCL3GiaXyssIrHxoLkqkzLCXULN46/f2h3tQJgyip+Tk9EAjJ9aJshq7t8X45aowSKspMSvPf7r9R8yxNptIaHS5ozuEm6luPDApugyNP8OaqiQ4BjaequXA54SLC83eHIY2r+CZp4409Xqw8Aa2oI7XkCrQi+in0w5AqF/kLNrcUz+qkl/lAobY1jSnx5OJNhyXIz3qfNFlXc0TKaglNwdWkWYt9QQ1Kr6W8zue21iNrdJk+N5oCr2O9nEtWKC7IS5J/zdDEYrmnAYfg6agCy+qcgz7ZofeDc4PbUWSvkshWuAc7OjiUyLkj+RAtdlwXJcjxdpkTTHDhK8lBCi8+JtvDVL1W6elmOM++YS0LuSlaP1oUvAeiW3cFnvTr8EbTz1tsSMYdGeZe40sRWu5uAfj7q+ZoKv2FNQ0p5XY1lmlcigHZqTPpabufEVrNuNPi165w3uCVQJHyJqmSJ7ZHnguqwtCmwViIJijj04ba2JNYtB+yORf5gg1/9t9iw4vUpeqiunSAbf+IBdj/b+iG2qrHvuNP0Vd/+ThVZT/lrvHYjjgDbbyxaqgHNM2uhxa1GW3UedZYhMMwM4mQhltouK+IV4NdbIQNM+8Yv311RZk9kT4tiYR4LkyFcuPpdcjuhUuFqBAWRZa11lcZ3gEBlXywsNhrt+plISZP5DlsV9l4EgY6J3yZPTUcMrgaWAT3oI79eSbGEbcJpr6BD8kyDiVt+G0/hXosQN4NFXKlfWIfsIs0BHODVok1/IGnKFHJYIquh8Xo+2+bkQNTGgWmN/fZ0Y33LSj6lr1GyV7mWIKg7ZTRZPGuhF/zjRNcQ1UPtSYgnWQxSs0yrVhwNDcdGMNSNe2JT3WuzbAM3HykyAajS3Uphf6STKEqxLas9EnmnhA/lyj9Uj+JoY7SVgVmGLl46Rm2u98sbkap2lzAdKBG4r6LgulQOSSjQv1GWdQ0jtDUK/mAaqM1Uqjpu4k3Rvfvxv7YTxLSK+wN3E5jVIzmF23uZ7hiH/sVP49D7tvoKp4S8b1LuvRlivVB/algbhcFITYVXvDpLzpDfplR2uD5V4XJFxpjmIpLc9Y5sB2TpBRix7Bme6GZIq+06v3XzNeTcA4obQIKxrnT4C2JpOqD92dbmSX8MGazly5EsZVMvSU1f4RZwyu8iQXbVdeLlZrjuTT1jrY1uk5c7iZ7RsvhhluqAkq4JpVQAg7RJFtSu+xgJ8Pv6O1j5DkLxT8mkbfyRW5DrQmG7hiDIjCgBsADbjuof6YHLGeV6a5Q1Smx9joUXPpdaaDx97A/Wq00oJkdR7ZYuQRfS533JtxO1erduqWOYIt3wh0wpbLuCNIYkwxbswbikCUu2CDCS+Q+7rgVtfRcm+SOcdKPRlZ/rE7wNVUEE39KTS5uvUKN1PUnkloPkyzhyGQ8qkouEjJ3H/VXdqG6asSRiw3ecMlBvDDt8dDhBHXMwZ2Cajzjr7/76T+IavqPYvz6r7//E/3X3+N//h/0QozbjPgPiir69P/8X3/9F/yv8b/827/++98WItPu5/Hvwd8YPf5bp/2/lX/T/+Of/0MJ/lYTa+L/Ef+d9vN/3/2T6P/+jyTzu/evf6U7vxN7B6pJkRtAF6jUr8I+P8RsP/ptGhfqFk+pQ/DgAy6NJtRYJdXmp4gK7WLqLKJ+MaKhGjOojvL+SnIWrkpy0SLHDe4QuyNzaEA15mLMCcmE8Em+4HdOihW4/ZWuppJEmzeAwcDtv7MuLc9y2V5atvxXNe3S4DUMt5/Qy2LM9kSYKiVWBuKlfp4nxTntpuW03JbIlkiRvBXmT23g1I2OYe6IizUHPIq6zm6mbfsbteKmi/sg9J+ocQBMctGFO7iljo8TPN+z3jxw4do+ZwfqoR9dkNTKHyM305GpTkfhcHexVkPVGEbUOjuo9f0UMPHBFlGEx0SLvJvVRKTwW7PSew5oPme+E42+frJa9cGt2njS3dK5kIif2eYbhuSEQXEqMVfUjhGIuin0G0/W5ezJyJQy3SpMLai4M0JUWb5u1k9tny5bd1pPwYBpQuDCXZl62xg4CdVEAtflXHs6JKmP/pH6mOl796Lgopj0o8d5kKh00hxG3OSdEE/QBo9Hgr8JJqAeLDwJohG5j/DGh61Rc/+tf22/8kEnxHNCEjo0ElvvGfESZkqmz2BDcKV1H1buSkhkdg7p1IMGs2s17nYjpblrWuE2K9WEO/hcRp5e9oOF/QBmOaDtgil+oaU6szPrdwW65fOB0KUTsVUn7LFU7J8e6cxJIl9+FHw5MQMzuQJ+4oxMH3iW/5GK+hWuG0T+gTLs+fAjdtUd58TmIUq04EeyRCYCjkldow234aIgR5bqwrtZosZ+6YEqAmDqatJ9lWasz4IquKALPtd92hGI3Z2BdzzZue+REl1Om4DIWD+RrtUTOJLI+S0jHowXXdAxsGLSd40zYNuEUlOGhrwL6c7tcOtUOvpJCP7QBQS19H+GvZn05ewjlVLz+IGKoC9TyfQjLMBNmXCuqqtTdOSukZW48B0HqgSTCBrBnlFvF4CG2Su7yFzqmJFURK3UmTT3ru050r0ptUpMilYnBJWfl2Bv6kPlUuE1kxxpdzui9AubsR2N2boVSu81OulAwBqoSr1LZ0LLYOomyZHmjqnXlP72s8LnDouEJjtodBvdHaG1jMySYO7crWd90MpCRyCG14vb5IE7Arupw/y/RcCm/Tm3zK6zYj8PYNaGldiUfkB/LHWcmf2lVM+mwyU27a0qq2tscrQ/vzBjN26DnntIrOyGizzXK35yKQdYnUABkyN4saz3WD/viF+eCcsXnIajdWYJWaYHRstIis9CS+tqnFGmz2j5uzfr3Z4prqgK4XOT/PyftvjZqIm8lhkfxJ7Ol3CJF1piYBGAG8wtAk56Drw1YwmOpcz+NdfkSpSLplRXLXHL0Rquj6YW/gabqgK7Dgr6NwtH0B/AN7XrN+MVJ6AmXmUuqmQulrNNYPmH0RoDogydOKLo/QbfYNARSQQKISRCzRXU+q9WWJFL3LZW6u34CkeG97xC0NNGaJ0bvK6SnZS3zPskr5EtuCgjMWR5o2x5BqhKmDWJPRe7JMEOyRb5uUKlHaGVtq5ivSOaSliSXp9SQm2qk8MRJh10MAp9QQ2H5t59J8rjiwSZtoIfMGjlLPVNdYl/LBR0AO6WLGDmkLkIPRE45Y9MftdAK/yNu1Hn6tzOQTesgQ+8fSzB19wO91vCnO23vOWQdwJ63SJrYjdfKFW6W281PKs2k8iT9ai1cgJ4sa3xqdvmtxR8/+D1B8AKc2u+6JftryRhMWSQtoSBgIyyQGyxcnELuAasXN12oSriU4RMz1DD6RL0TSV+om7i1Yt+jEE/jnawM8cX/UhN4nkiv/w9eALrzNhXuQfOzFL0Fi6SjF7/4Qn8rLYBoa85cvgAnkCEBP+HPbEnquVXCZsMS/yzYw2Vru60P/+nJPYKkzZFjmbykzUoEqV836T5q3fP/L383dF82tx18/AZgZczMAgyeWYKmSZIqtHL+e+O4ZRcq9VI3g/qPeCoiK4pcgEqdbS0S/Be54sbVQOuJVPNBblIghzeasNu7h/g+Sz1IdhI5lCwq1nUb3Ji4OCIcqQZqtqJ5w7rXrg/DA9IgVmEGhDgGecEwnCTHffXcXs0V3OCEVzYDKS1vp/oX+ng+6XVU86UjA6FMO2RXOOOrqY1GgPvrAk9HV/BXtCu5RuwF8qgdGDLsBcui4E33ymdBip1X8uKyhIWT8qNRDsXz+gvO9UiEC0d8RG4Tf2x8H4slljgHtCBcxHLTWOYJm5H/fCPCzOgf9qgOUxTRZ0Pc6ha5yLuLVT9ntvIa6gacE99mCovdUumTQdRP4RPsS9129eEe2uSvvGh0bV4Y3QPPhPZMqhZWSMa5R0Hc1SGO4IVOQc0FrirlibTVfKRrYkD8kz3b+X65/QkUNaZdrdl3mCap0Hf3YcCw/LiouJYNbqz88UqeDYv93yO7vvXtgl4XCyAO4ODkY6W+83+LZU//p3/zXNGGrUKClCiOnL27iJZbNWDF02XXAOeFlB7IaADoMH1Yqr+UP9biyZDEa/iJt4MDeIz6GKTdLVBfWGVtRN4fdT2rgReX8UXwF2zOrradm4J0nyTgdPnai3RvzpZvCKDUqjOwD/QA6EDaMCLewX6QWYVnHY1sx1bd8ovYnPm1ZvPH+rE20lWjOCnZ66/xDt0QAl15FjfBcZp+i9OU0RNPQ0t3x2pSNWo8eiYudwsnuP1Hq6iH1LJCJynkYsfgJ0p3pF6SoQk2l+jqE8CPk+ziGJRSKjs+W5AO185umPdkYzlK4wl7TC9NxyyDP7ZoyYVoXiuS6SjnInlLWrwz1i8bGTKXX0AVQWkSfIlglW3zRJRJ8bg5VgE6ZEnqNu9B++0GNQvDQJvFize4ESNKBJP+8vA3LM4AX5SIBq08Mob+7QMTCZx4nwP/64+4BnlZC+8WtlP/CXw6t1PwMwkJ3jhP1FiXLhDF/3I6FGUzO2DSi9ABxKyyL9paZxSEz40ZCPQToDAJu1959k7QdbVxgB4icsu2s4zsTPJhcEDo+N1GX4zSk/wriRh8AqwL62972i9HJHd1ydaLXVzvKvOfGGw5RVcUVMiKXFH4APdkQU/dc5BX0YfKTNZYXCW9mb8bc8mufoQP6BbdQmT99ZjoYfr/go4TgQX9IDgztim7wyFeGMfbNaeqj8Dzs38pgcqwSv2hbqB3oSGKWKy+sesY7p57wAHldqE6NDudk/W7s/zjrK4rZFlFvaGxnSZdHbc1y47qDN6xkoK8O3bfr2j41dlJZ71rB4dlDqapPFa8N6xBrprUdtenUCHwxKNhw1uuTBh+9uU45k4REpQABN2bAO9DSLqoIL26gNroWgup5pUMxHUNSq4Gyz47vBPvilpo5f9OYI2ddAqTqmnxXERxQJ3UK8fHbVE9HagHi3+tqNRoNsArdmAxHA5LwtQo9ZAaNKUTljnokljo2x8scqVpEEIPc01fPCdHOCg0DeWBz8D5TVAAfx8aRH5X2ZYNI3ebKDZdeJ+oBDAxmRqJ30Eh2/DaeAy5diVNMpEDmXiPDsGTzBLXy8eVDdJoIafgx/gxMyQi454QrW56nCyeELgSuNNEmYkflF+t3CZQOVRWjKhIuCclmQSlAXT3+4JGG75B4t/5hQ+ldMP4LsAW6z3XmU6IJJwpnGVnsgUZhoY1fZlwTR8wSU7xRejf2uCx9Z5trVTRRJP9KnEb134dEieil6eCOGWgboI7xsqsqM99jfJLTePjygKlH2CVxxsse9QRzTBFjD/Kjqitr/CCTBt/SJ6nLxz7cKP9pFqBpp0lN5y+adKNsZjrPuroemZauH9aTTFD3EKHW8S55XBLFQAt1jgxTQCTwxmx/JyfsZDN1RroN3VaxpSenpIX7K+ZbL8VdlQDcI4Cbzg3QJLa9yVqNxUelu+EtxLVqeekaAvSJkO6sSVqbUajxqhKshNpvZqoeApF0k/0P0ikkwUcbdwc4A1ejN7Oo0O15kG7hTMoK3hZRBCX7YYeLW0wvcXx/18n/u37yLgzBYVBUvORGli+sfRcX/74uD6P4hq+7xu54TlWJLFzT63uwUDwuEDdOjJQqx7JV+ZjaEAPi7t0MMrR4Q8Rkf18uxD6RK0RKh0hL8YU+DeL97i4pa5ZSyAfXKwZRS/8gXcxdZXm62RBDj8U3sN8x95b5PpPs/mCBKYvpaA50pN5Ct/499AFTtwQ5vgeSh+NHrKIi4NVpwM/XzRaNfJD856lPE6M21zWPguFsH7jbLVyEDfRmt4VwrhCJ5VTYmcSPfGgO5clfN+vbaDZ7sakU5+2vZ2WCDY031NxJarVytfDDVtiafcTGO2rJ/taoL3zChN2qmjxofczTOYQPPVQPh0JVtYgdUQINcSiNEEy58UdYXX1MpWUCEBx7LbcGtAm8XWRQTVOaoV3ySri4RShhs/B/0m4jX6OAwXOvcA09bNSG4czEGv/Wey6V/jbTCNTW6awXdNTcA1GsPe1E9fZdGl7R0vyoVpIdJtfC6d32NNErrvq/R+d65VG+YOwRXppXxOCYyGNSf1K3x6VxAW/vtz4EC1SgCOSPdN62sLsoIzuDfg8GwZAbquVO8HIuFP/ToVoeUB7nnwMF35a1wK1tI6fkrqFKhQdeJpwyls0pIy8AZde3/6LUUbFaYJthyUJSU/kqDXTLQElnn0Jr4B2RVghNrmNmoEn7pXIeshPguXVsvwoTdmClq49JJU3LWhHyWTrJL9bRP6VKv3tZoA/th77p5Jw++OEENvyvWy/pNeExiDUVQaXIRGh8xySZTI36yueFaSXo1uJY0RnXYgEOoWWOJHeaVuX/bGNhHsh2yinznl/++NJcE9j6fBPRcBdq9hb8awNw8U7Bl6GM7x69EDOIIbX/npZ++amlHR9L/35mE/2Ss4gb0xCcY4VyTFLRE796vHysLAamqcyO+aFQyJIDBNslbH2/MrAvZiSEIedc/cqjmv4fbda2pXbv+F5a2szSsdkm9noiNURXt8edUhGUF6fSZWd1IJaXKFwD+49R6eCXD4Bkef7j9tRtNMVgW8BhRz/Qpy1TmeYk0doyjZoJSbePOReVHgkFsCFuQJ+Lgc4BxeAsK/cOiNDRmdNw0ctYhn/nQ498dYI5znzGLoJi1rav7Cn88rL3wLePVtDK5gl77Tki3gHEsIAQ2+IKgarj7Y8W1IQzV5V9N+0TjLqbg68WfKcOmBCOj3JkwJhVIkwDhc+JorXuZEPMEh0vvH3x7iqf+VAwXgd4diZiaJD1zHL9Snx6Wfg4IugreyhabQkcir+y5XgDtdx3Avs7lkeeCBwDvZoTUCXx5QrZkcEqWfYEiEYRs/EphmRALSNGR1Iclgdr5VFoELpzF4++f35w3/j0t5ucW3n2ch4PQCLuUXupsPRR7UA5FjSKrMtPcKAZJfagO4lGE7FH3YKMjorpK0ZxAv+i2JkJhtAMWWWFej4RhPR/cJ3DxwocCvXDi4SGZU4cu+K32XndiFWgopAl+0GApcwf1XvymJcFs39jExIBO4yUjU9MExBLQYc9H+W7+IgdESPRpciT+rKZPebVtaVq+1GYO/5xTAL3HASjNTGIgMvdjWbgc7JvdE1zIFpuC0U9ESiZyzBixzxWxj4Kwh8My34q+FK3KNLtmsA1qyrmKSNQOXCPUZd+ONelBTvFoUI/CYsqa/RhtKiyMf2CgSFqEPk59Y3uqnlZ8gFpswfSYyko23yVZYxzKGxGm49Zqxg1l8oz5Ra9XaRwHkuxepmgyhm0SoNy2KlbcEqK+9QqS9PNx9Ihm9U7gsR55SSJ1FBDNnkuWKxIZ0SDpXuOGwZdoUbOMDPHP4vBAgz2VlSEJAHZGJVbYIg7l/FO5KfIVvxC8pPPxMGcNMoevFDeStt2iqztE10n2TA4dgJH76YS9HDhKHD3iCx6ieFX84BAI3QQnngh76f5ruPQVbr5qZmck/5UjDc26lfrOvUBWy0Ogl8bCoOkMOns81TnC3cuUS9KW8+9A+fe3XYZOFUPG1u5epSSmDLw0s5s2F0W30ANeo+zJkJQz9SPZgzwYpEoktofhGVfmLOAB20boCbW1QWq/NpET/hnMecw/uSyAH4NJc3ECOU4nnkK1fj3S/i5dwb3R7k00AqQQUwt7Ie1qV0aY/VQX0J8hLPy7eBNXMHYZYDNxHZ2Qh6AuXJxq+AeRec/Q+JLhZV6hpXwQEzw7bf5v9uUf2vpq3qlhmy0IIGTkwYdCfSAFmqbdo+3XvDTDjFJde0mbeQLcn2n31xaAqJ0ixO/CLsT4I4G4DoncVTgRGNBtsCcjISWT+oeXZ4Iedw/8OsJI1aPnNKLX/60VvcZb94uasRxCkqlPQ11u1Sa2hHvB80WQENxVyzjns0/PiEByyil21Te6oisk3mNCEMrhouCFO3yEZTHHOCMy9eb/4Tmi8cVf3Lf7P53SY2hX3PSN033As3ETIMLHWumWEO9JXHA2y2SIBlIPpLGG2qvNsCIlIr+B1SWAqRKm2w6Blf7U+zCSBwJrfHG5i8J5Gax/cVonMlon7aHJX/gSvucIncRP93XCqkv7D8IFKFsLiBgHqUpXhE3pYjEcV1dk/JD9zFVCfEaQIVX8Jmfz7IIofcBKQ4OaG+C3xC2veX9CD+iAFXDNaGg9eTVxvkbJRJlW4Nk9Wk13kn696jWppRDe/8pDrYMO9ZyxZ98ReKSz9kWKLLyk2zCZgAniCkLJVX3n1M9DYbomyahWiv/KixRIV9hj/oFz87I+HLznbPTjpa+D+bZQnMuRsljTpv90vQUt/pK7jCFnA30B/jtroSF2/m/gpWn1aQs5WeA6ghzF8SdqWI20fghdSeDOCSCmLgTkfaGgGDmw7nHFkRzGtag57IHS2na06I+gzEphXo1w/Zx2BM/jKL2nZoFjHggtFQjYi8nSVRSXIE58RPbBObXk7uuIL9+rs/5Zo7suJInEUxgsiZZAWS25iBtpEiZeBgDtghEoAE0sjcayNq85M4tbu/LF5h51335PsGzQ09O875+vUS89lkWMyNOFoip2PuyWyMP/iU2XIZdfCCJNDjebDoBLQdpy7QQZC7s9c0wjHJervQNDu2jWzBW5MSAJMr7bP+Iv92BkS/GGgzjEn7MF1IRKFwwzbjbS4/slGOmhx9cZrFu7HSEefojNv3r0UaKfKOWzXsq1zEugbzlMDFsacRJJI/iJlK3vtkZ+PLZIVMFlKA32wbq2Kd5T0uCLZ1CPkAfCdzkz2EYscjDcZq2AWfziN2covN4kXE1lQXPPLTNM1xx3tbiepcO/t3SWm4w87qfh99SL0ZnY+LKFPLPeXVM2mIIoVWt+9Nk0I7nY4O79iGYqxZ8RVz289an6NVdJWnSKZvJQCAuHNiVaDxPAFoH392t9wot5t0/qmU95eEWNbU2udUW5sN9JVqcYlvAIfLeYC33oUzzxZgSktsv21mA7Uly1FA5VnoJFh6N244Wmv3YJGFv/TCPryaw+ZORlpZjQdq/2DYXr3EZskfed0G61P09ipTKmlTQ1067Rg5+PAk5FlQ9e0SWbGf2B/08kqymOTMVOznsALHHNFH4LFRKl2F/NOiYFl9khNHnSu9Ak5sq26Ynl/i2fdTle29Y1ugqmR5Yj4YT9pvslFyYCbw0mNFr5rVQm1LvkG27QMq9ph3t8fmn6r6SQ4oSbr5tz+J1kIawGzDxb6VYOvvWhobDTXfBeNv3b4aNm5XUinsCGqG2q/45m3+LoCOsddFceYhRx1Tsss9PLdPfJdErFMjYd3gddjiP0+XQjcRadZP6bwNLySvunFf20Czy6JqdEW2a96KxdYdOryBv1BjbuUq2yCHeh+6sk7fGmmPi50pe/1l5TyPe5oHW9oPnhPswLyf2TFDdCyYlhwBCstv5C1HwlW7xWoGT9XZt4qVj5WryLPLLD6h/5cMLEjWzgCeAIKNsLak92aBqBsHl4AJwl2N4jfvbSkBExGimv0nFvv09uDScQbjx+w4kPQjgjlW+g9ws9VEJvI2k8N6XxVu0uIwovgTFdunG24gBtaDi+y1YLQwZ8mwbip5fVlO3k0n0AEr/ETbtu8Vjkm+nNSiEb7X/3fMjBL5A8PdgG+/FnbexbFFExmEfetXAnisEKy5z44WVPpQZjSy/jzeGn4yDRsFGqhh87QPaDBWhlo37IFbe/C0xynS91d2tP/AJoJS0sVF6iwAAAAAElFTkSuQmCC");
}

#menu::after {
  display: block;
  content: '';
  padding-top: 80px;
}

#logo {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(255,255,255,.1);
  font-size: 11px;
  display: block;
  width: 20px;
  height: 20px;
  line-height: 20px;
  text-align: center;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  border-radius: 20px;
  -webkit-box-shadow: 0 0 3px rgba(0,0,0,.2);
  -moz-box-shadow: 0 0 3px rgba(0,0,0,.2);
  box-shadow: 0 0 3px rgba(0,0,0,.2);
  color: inherit;
}

#menu li a {
  display: block;
  color: white;
  padding: 0 35px 0 25px;
  -webkit-transition: background 300ms;
  -moz-transition: background 300ms;
}

#menu li {
  position: relative;
  list-style: none;
}

#menu a:hover,
#menu a.active {
  text-decoration: none;
  background: rgba(255,255,255,.1);
}

#menu li:hover .cov {
  opacity: 1;
}

#menu li .dirname {
  opacity: .60;
  padding-right: 2px;
}

#menu li .basename {
  opacity: 1;
}

#menu .cov {
  background: rgba(0,0,0,.4);
  position: absolute;
  top: 0;
  right: 8px;
  font-size: 9px;
  opacity: .6;
  text-align: left;
  width: 17px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  border-radius: 10px;
  padding: 2px 3px;
  text-align: center;
}

#stats:nth-child(2n) {
  display: inline-block;
  margin-top: 15px;
  border: 1px solid #eee;
  padding: 10px;
  -webkit-box-shadow: inset 0 0 2px #eee;
  -moz-box-shadow: inset 0 0 2px #eee;
  box-shadow: inset 0 0 2px #eee;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

#stats div {
  float: left;
  padding: 0 5px;
}

#stats::after {
  display: block;
  content: '';
  clear: both;
}

#stats .sloc::after {
  content: ' SLOC';
  color: #b6b6b6;
}

#stats .percentage::after {
  content: ' coverage';
  color: #b6b6b6;
}

#stats .hits,
#stats .misses {
  display: none;
}

.high {
  color: #00d4b4;
}
.medium {
  color: #e87d0d;
}
.low {
  color: #d4081a;
}
.terrible {
  color: #d4081a;
  font-weight: bold;
}

table {
  width: 80%;
  margin-top: 10px;
  border-collapse: collapse;
  border: 1px solid #cbcbcb;
  color: #363636;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
}

table thead {
  display: none;
}

table td.line,
table td.hits {
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  color: #949494;
}

table td.hits {
  width: 10px;
  padding: 2px 5px;
  color: rgba(0,0,0,.2);
  background: #f0f0f0;
}

tr.miss td.line,
tr.miss td.hits {
  background: #e6c3c7;
}

tr.miss td {
  background: #f8d5d8;
}

td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monaco, monospace;
}

code .comment { color: #ddd }
code .init { color: #2F6FAD }
code .string { color: #5890AD }
code .keyword { color: #8A6343 }
code .number { color: #2F6FAD }
</style></head><body><div id="coverage"><h1 id="overview">Coverage</h1><div id="menu"><li><a href="#overview">overview</a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/advisor.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/</span><span class="basename">advisor.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/aspect.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/</span><span class="basename">aspect.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/autoproxy/autoProxyCreator.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/autoproxy/</span><span class="basename">autoProxyCreator.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/advisedSupport.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/</span><span class="basename">advisedSupport.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/dynamicAopProxy.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/</span><span class="basename">dynamicAopProxy.js</span></a></li><li><span class="cov high">92</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/dynamicMetaProxy.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/</span><span class="basename">dynamicMetaProxy.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/proxyFactory.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/</span><span class="basename">proxyFactory.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/pointcut.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/</span><span class="basename">pointcut.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/targetSource.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/</span><span class="basename">targetSource.js</span></a></li><li><span class="cov high">99</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/beanFactory.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/</span><span class="basename">beanFactory.js</span></a></li><li><span class="cov terrible">23</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/moduleFactory.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/</span><span class="basename">moduleFactory.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/singletonBeanFactory.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/</span><span class="basename">singletonBeanFactory.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanDefinition.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/</span><span class="basename">beanDefinition.js</span></a></li><li><span class="cov high">79</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanDefinitionVisitor.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/</span><span class="basename">beanDefinitionVisitor.js</span></a></li><li><span class="cov terrible">16</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanModule.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/</span><span class="basename">beanModule.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanWrapper.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/</span><span class="basename">beanWrapper.js</span></a></li><li><span class="cov high">98</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/placeHolderConfigurer.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/</span><span class="basename">placeHolderConfigurer.js</span></a></li><li><span class="cov high">95</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/placeHolderResolver.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/</span><span class="basename">placeHolderResolver.js</span></a></li><li><span class="cov high">80</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/bearcat.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/</span><span class="basename">bearcat.js</span></a></li><li><span class="cov medium">74</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/context/applicationContext.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/context/</span><span class="basename">applicationContext.js</span></a></li><li><span class="cov high">93</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/index.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/</span><span class="basename">index.js</span></a></li><li><span class="cov low">47</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/max.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/</span><span class="basename">max.js</span></a></li><li><span class="cov low">47</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/min.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/</span><span class="basename">min.js</span></a></li><li><span class="cov high">90</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/notNull.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/</span><span class="basename">notNull.js</span></a></li><li><span class="cov medium">70</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/null.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/</span><span class="basename">null.js</span></a></li><li><span class="cov medium">53</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/pattern.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/</span><span class="basename">pattern.js</span></a></li><li><span class="cov low">45</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/size.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/</span><span class="basename">size.js</span></a></li><li><span class="cov high">98</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelAttribute.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/</span><span class="basename">modelAttribute.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelConstraint.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/</span><span class="basename">modelConstraint.js</span></a></li><li><span class="cov high">91</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelDefinition.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/</span><span class="basename">modelDefinition.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelFilter.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/</span><span class="basename">modelFilter.js</span></a></li><li><span class="cov high">95</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelKeyMapResolver.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/</span><span class="basename">modelKeyMapResolver.js</span></a></li><li><span class="cov medium">68</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelProxy.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/</span><span class="basename">modelProxy.js</span></a></li><li><span class="cov low">29</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/asyncScriptLoader.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/</span><span class="basename">asyncScriptLoader.js</span></a></li><li><span class="cov medium">50</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/bootStrapLoader.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/</span><span class="basename">bootStrapLoader.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/configLoader.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/</span><span class="basename">configLoader.js</span></a></li><li><span class="cov high">96</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/metaLoader.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/</span><span class="basename">metaLoader.js</span></a></li><li><span class="cov high">96</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/propertiesLoader.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/</span><span class="basename">propertiesLoader.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/resourceLoader.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/</span><span class="basename">resourceLoader.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/aopUtil.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">aopUtil.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/beanUtil.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">beanUtil.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/constant.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">constant.js</span></a></li><li><span class="cov high">90</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/fileUtil.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">fileUtil.js</span></a></li><li><span class="cov high">94</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/metaUtil.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">metaUtil.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/modelUtil.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">modelUtil.js</span></a></li><li><span class="cov terrible">17</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/requestUtil.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">requestUtil.js</span></a></li><li><span class="cov high">82</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/requireUtil.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">requireUtil.js</span></a></li><li><span class="cov terrible">6</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/scriptUtil.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">scriptUtil.js</span></a></li><li><span class="cov high">97</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/utils.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">utils.js</span></a></li><li><span class="cov high">100</span><a href="#/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/validatorUtil.js"><span class="dirname">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/</span><span class="basename">validatorUtil.js</span></a></li><a id="logo" href="http://visionmedia.github.io/mocha/">m</a></div><div id="stats" class="high"><div class="percentage">82%</div><div class="sloc">3556</div><div class="hits">2932</div><div class="misses">624</div></div><div id="files"><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/advisor.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/advisor.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">39</div><div class="hits">39</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat Advisor</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Pointcut = require('./pointcut');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * Advisor constructor function.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var Advisor = function() {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">181</td><td class="source">	this.pointcut = null;</td></tr><tr class="hit"><td class="line">23</td><td class="hits">181</td><td class="source">	this.beanName = null;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">181</td><td class="source">	this.runtime = null;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">181</td><td class="source">	this.advice = null;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">181</td><td class="source">	this.order = null;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">181</td><td class="source">	this.bean = null;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * Advisor set pointcut.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @param  {Object} pointcut pointcut object</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">Advisor.prototype.setPointcut = function(pointcut) {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">181</td><td class="source">	if (!pointcut) {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">180</td><td class="source">	var p = new Pointcut();</td></tr><tr class="hit"><td class="line">42</td><td class="hits">180</td><td class="source">	p.setExpression(pointcut);</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">180</td><td class="source">	this.pointcut = p;</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * Advisor get pointcut.</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @return  {Object} pointcut object</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">Advisor.prototype.getPointcut = function() {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">900</td><td class="source">	return this.pointcut;</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * Advisor set advice function name.</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @param  {String} advice advice function name</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">Advisor.prototype.setAdvice = function(advice) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">180</td><td class="source">	this.advice = advice;</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * Advisor get advice function name.</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * @return  {String} advice function name</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">Advisor.prototype.getAdvice = function() {</td></tr><tr class="hit"><td class="line">74</td><td class="hits">26</td><td class="source">	return this.advice;</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * Advisor set bean name.</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @param  {String} beanName bean name</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">Advisor.prototype.setBeanName = function(beanName) {</td></tr><tr class="hit"><td class="line">84</td><td class="hits">181</td><td class="source">	this.beanName = beanName;</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * Advisor get bean name.</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> * @return  {String} bean name</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">Advisor.prototype.getBeanName = function() {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">1</td><td class="source">	return this.beanName;</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> * Advisor set aspect bean.</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> * @param  {Object} bean aspect bean</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">Advisor.prototype.setBean = function(bean) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">360</td><td class="source">	this.bean = bean;</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * Advisor get aspect bean.</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> * @return  {Object} aspect bean</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">113</td><td class="hits">1</td><td class="source">Advisor.prototype.getBean = function() {</td></tr><tr class="hit"><td class="line">114</td><td class="hits">26</td><td class="source">	return this.bean;</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> * Advisor set advisor chain order.</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @param  {Number} order order number</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">123</td><td class="hits">1</td><td class="source">Advisor.prototype.setOrder = function(order) {</td></tr><tr class="hit"><td class="line">124</td><td class="hits">180</td><td class="source">	this.order = order;</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> * Advisor get advisor chain order.</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * @return  {Number} order number</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">133</td><td class="hits">1</td><td class="source">Advisor.prototype.getOrder = function() {</td></tr><tr class="hit"><td class="line">134</td><td class="hits">812</td><td class="source">	return this.order;</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * Advisor set if advisor is runtime.</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * @param  {Boolean} runtime runtime true|false</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">143</td><td class="hits">1</td><td class="source">Advisor.prototype.setRuntime = function(runtime) {</td></tr><tr class="hit"><td class="line">144</td><td class="hits">180</td><td class="source">	this.runtime = runtime;</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> * Advisor get if advisor is runtime.</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> * @return  {Boolean} runtime true|false</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">153</td><td class="hits">1</td><td class="source">Advisor.prototype.isRuntime = function() {</td></tr><tr class="hit"><td class="line">154</td><td class="hits">22</td><td class="source">	return this.runtime;</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> * Advisor do parse pointcut,advice.</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">162</td><td class="hits">1</td><td class="source">Advisor.prototype.parse = function() {</td></tr><tr class="hit"><td class="line">163</td><td class="hits">180</td><td class="source">	this.pointcut.parse();</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">166</td><td class="hits">1</td><td class="source">module.exports = Advisor;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/aspect.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/aspect.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">22</div><div class="hits">22</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat Aspect</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * Aspect constructor function.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var Aspect = function() {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">22</td><td class="source">	this.advisors = [];</td></tr><tr class="hit"><td class="line">21</td><td class="hits">22</td><td class="source">	this.beanName = null;</td></tr><tr class="hit"><td class="line">22</td><td class="hits">22</td><td class="source">	this.beanDefinition = null;</td></tr><tr class="hit"><td class="line">23</td><td class="hits">22</td><td class="source">	this.bean = null;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * Aspect add advisor.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @param  {Object} advisor advisor object</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">Aspect.prototype.addAdvisor = function(advisor) {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">180</td><td class="source">	this.advisors.push(advisor);</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * Aspect get advisors.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @return  {Array} advisors</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">Aspect.prototype.getAdvisors = function() {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">40</td><td class="source">	return this.advisors;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * Aspect set beanDefinition.</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @param  {Object} beanDefinition beanDefinition object</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">Aspect.prototype.setBeanDefinition = function(beanDefinition) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">22</td><td class="source">	this.beanDefinition = beanDefinition;</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * Aspect get beanDefinition.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @return  {Object} beanDefinition object</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">Aspect.prototype.getBeanDefinition = function() {</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">	return this.beanDefinition;</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * Aspect set beanName.</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">72</td><td class="hits">1</td><td class="source">Aspect.prototype.setBeanName = function(beanName) {</td></tr><tr class="hit"><td class="line">73</td><td class="hits">21</td><td class="source">	this.beanName = beanName;</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * Aspect get beanName.</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @return  {String} beanName</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">82</td><td class="hits">1</td><td class="source">Aspect.prototype.getBeanName = function() {</td></tr><tr class="hit"><td class="line">83</td><td class="hits">40</td><td class="source">	return this.beanName;</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> * Aspect set aspect bean.</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> * @param  {Object} bean aspect bean object</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">Aspect.prototype.setBean = function(bean) {</td></tr><tr class="hit"><td class="line">93</td><td class="hits">41</td><td class="source">	this.bean = bean;</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> * Aspect get aspect bean.</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> * @return  {Object} aspect bean object</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">102</td><td class="hits">1</td><td class="source">Aspect.prototype.getBean = function() {</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">	return this.bean;</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">106</td><td class="hits">1</td><td class="source">module.exports = Aspect;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/autoproxy/autoProxyCreator.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/autoproxy/autoProxyCreator.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">70</div><div class="hits">70</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat AutoProxyCreator</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var ProxyFactory = require('../framework/proxyFactory');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var TargetSource = require('../targetSource');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var AopUtil = require('../../util/aopUtil');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * AutoProxyCreator constructor function.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * it is a beanPostProcessor</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">var AutoProxyCreator = function() {</td></tr><tr class="hit"><td class="line">25</td><td class="hits">61</td><td class="source">	this.beanFactory = null;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * AutoProxyCreator beanPostProcessor before filter wrap bean if necessary.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject bean object</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @return {Object} bean object</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.before = function(beanObject, beanName) {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">159</td><td class="source">	return beanObject;</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * AutoProxyCreator beanPostProcessor after filter wrap bean if necessary.</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * it may return target proxy object if necessary</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject bean object</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @return {Object} bean object</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.after = function(beanObject, beanName) {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">159</td><td class="source">	return this.wrapIfNecessary(beanObject, beanName);</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * AutoProxyCreator set beanFactory.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @param  {Object} beanFactory beanFactory object</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.setBeanFactory = function(beanFactory) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">61</td><td class="source">	this.beanFactory = beanFactory;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * AutoProxyCreator get beanFactory.</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @return  {Object} beanFactory object</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.getBeanFactory = function() {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">20</td><td class="source">	return this.beanFactory;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * AutoProxyCreator wrap bean if necessary.</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject bean object</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @return {Object} bean object</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.wrapIfNecessary = function(beanObject, beanName) {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">159</td><td class="source">	var beanDefinition = this.beanFactory.getBeanDefinition(beanName);</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">	// class do not need to be proxied</td></tr><tr class="hit"><td class="line">84</td><td class="hits">159</td><td class="source">	if (!beanDefinition.needProxy()) {</td></tr><tr class="hit"><td class="line">85</td><td class="hits">20</td><td class="source">		return beanObject;</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">	// aspect beanObject do not need to proxy</td></tr><tr class="hit"><td class="line">89</td><td class="hits">139</td><td class="source">	if (beanDefinition.isAspect()) {</td></tr><tr class="hit"><td class="line">90</td><td class="hits">20</td><td class="source">		return beanObject;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">119</td><td class="source">	var advisors = this.getAdvisorsForBean(beanObject, beanName);</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">95</td><td class="hits">119</td><td class="source">	if (Utils.checkArray(advisors) &amp;&amp; advisors.length) {</td></tr><tr class="hit"><td class="line">96</td><td class="hits">20</td><td class="source">		var proxy = this.createProxy(beanObject, beanName, advisors, new TargetSource(beanName, beanObject));</td></tr><tr class="hit"><td class="line">97</td><td class="hits">20</td><td class="source">		return proxy;</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">100</td><td class="hits">99</td><td class="source">	return beanObject;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * AutoProxyCreator create proxy object with specific advisors and targetSource.</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject bean object</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * @param  {Array}  advisors advisors list</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> * @param  {Object} targetSource targetSource object</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> * @return {Object} bean proxy object</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">113</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.createProxy = function(beanObject, beanName, advisors, targetSource) {</td></tr><tr class="hit"><td class="line">114</td><td class="hits">20</td><td class="source">	var proxyFactory = new ProxyFactory();</td></tr><tr class="hit"><td class="line">115</td><td class="hits">20</td><td class="source">	proxyFactory.setBeanFactory(this.getBeanFactory());</td></tr><tr class="hit"><td class="line">116</td><td class="hits">20</td><td class="source">	proxyFactory.setTarget(targetSource);</td></tr><tr class="hit"><td class="line">117</td><td class="hits">20</td><td class="source">	var methods = AopUtil.getMethodsFromObject(beanObject);</td></tr><tr class="hit"><td class="line">118</td><td class="hits">20</td><td class="source">	proxyFactory.setInterfaces(methods);</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">120</td><td class="hits">20</td><td class="source">	for (var i = 0; i &lt; advisors.length; i++) {</td></tr><tr class="hit"><td class="line">121</td><td class="hits">180</td><td class="source">		proxyFactory.addAdvisor(advisors[i]);</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">124</td><td class="hits">20</td><td class="source">	return proxyFactory.getProxy();</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> * AutoProxyCreator get advisors for bean.</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject bean object</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> * @return {Array}  advisors list</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">135</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.getAdvisorsForBean = function(beanObject, beanName) {</td></tr><tr class="hit"><td class="line">136</td><td class="hits">119</td><td class="source">	return this.findEligibleAdvisors(beanObject, beanName);</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * AutoProxyCreator find eligible advisors.</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject bean object</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> * @return {Array}  advisors list</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">147</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.findEligibleAdvisors = function(beanObject, beanName) {</td></tr><tr class="hit"><td class="line">148</td><td class="hits">119</td><td class="source">	var candidateAdvisors = this.findCandidateAdvisors(beanObject, beanName);</td></tr><tr class="hit"><td class="line">149</td><td class="hits">119</td><td class="source">	return this.findAdvisorsThatCanApply(beanObject, beanName, candidateAdvisors);</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source"> * AutoProxyCreator find all candidate advisors for bean.</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject bean object</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> * @return {Array}  advisors list</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">160</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.findCandidateAdvisors = function(beanObject, beanName) {</td></tr><tr class="hit"><td class="line">161</td><td class="hits">119</td><td class="source">	var aspects = this.beanFactory.getAspects();</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">163</td><td class="hits">119</td><td class="source">	var candidateAdvisors = [];</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">165</td><td class="hits">119</td><td class="source">	for (var i = 0; i &lt; aspects.length; i++) {</td></tr><tr class="hit"><td class="line">166</td><td class="hits">40</td><td class="source">		var aspect = aspects[i];</td></tr><tr class="hit"><td class="line">167</td><td class="hits">40</td><td class="source">		var beanName = aspect.getBeanName();</td></tr><tr class="hit"><td class="line">168</td><td class="hits">40</td><td class="source">		var aspectBean = this.beanFactory.getBean(beanName);</td></tr><tr class="hit"><td class="line">169</td><td class="hits">40</td><td class="source">		aspect.setBean(aspectBean);</td></tr><tr class="hit"><td class="line">170</td><td class="hits">40</td><td class="source">		var advisors = aspect.getAdvisors();</td></tr><tr class="hit"><td class="line">171</td><td class="hits">40</td><td class="source">		for (var j = 0; j &lt; advisors.length; j++) {</td></tr><tr class="hit"><td class="line">172</td><td class="hits">360</td><td class="source">			var advisor = advisors[j];</td></tr><tr class="hit"><td class="line">173</td><td class="hits">360</td><td class="source">			advisor.setBean(aspectBean);</td></tr><tr class="hit"><td class="line">174</td><td class="hits">360</td><td class="source">			candidateAdvisors.push(advisor);</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">178</td><td class="hits">119</td><td class="source">	return candidateAdvisors;</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> * AutoProxyCreator find all candidate advisors appliable for bean.</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject bean object</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> * @param  {Array}  candidateAdvisors</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> * @return {Array}  advisors list</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">190</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.findAdvisorsThatCanApply = function(beanObject, beanName, candidateAdvisors) {</td></tr><tr class="hit"><td class="line">191</td><td class="hits">119</td><td class="source">	var advisors = [];</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">193</td><td class="hits">119</td><td class="source">	for (var i = 0; i &lt; candidateAdvisors.length; i++) {</td></tr><tr class="hit"><td class="line">194</td><td class="hits">360</td><td class="source">		var advisor = candidateAdvisors[i];</td></tr><tr class="hit"><td class="line">195</td><td class="hits">360</td><td class="source">		if (this.canApply(advisor, beanObject, beanName)) {</td></tr><tr class="hit"><td class="line">196</td><td class="hits">180</td><td class="source">			advisors.push(advisor);</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">200</td><td class="hits">119</td><td class="source">	advisors = AopUtil.sortAdvisorsByOrder(advisors);</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">202</td><td class="hits">119</td><td class="source">	return advisors;</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source"> * AutoProxyCreator check whether an advisor can be applied to the specific bean.</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> * @param  {Object}  advisor</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source"> * @param  {Object}  beanObject</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> * @param  {String}  beanName</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> * @return {Boolean} true|false</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">214</td><td class="hits">1</td><td class="source">AutoProxyCreator.prototype.canApply = function(advisor, beanObject, beanName) {</td></tr><tr class="hit"><td class="line">215</td><td class="hits">360</td><td class="source">	var methods = AopUtil.getMethodsFromObject(beanObject);</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">217</td><td class="hits">360</td><td class="source">	var pointcut = advisor.getPointcut();</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">219</td><td class="hits">360</td><td class="source">	for (var i = 0; i &lt; methods.length; i++) {</td></tr><tr class="hit"><td class="line">220</td><td class="hits">940</td><td class="source">		var targetMethod = beanName + '.' + methods[i];</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">222</td><td class="hits">940</td><td class="source">		if (pointcut.match(targetMethod)) {</td></tr><tr class="hit"><td class="line">223</td><td class="hits">180</td><td class="source">			return true;</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">227</td><td class="hits">180</td><td class="source">	return false;</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">230</td><td class="hits">1</td><td class="source">module.exports = AutoProxyCreator;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/advisedSupport.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/advisedSupport.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">50</div><div class="hits">50</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat AdvisedSupport</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> * AdvisedSupport constructor function.</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var AdvisedSupport = function() {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">21</td><td class="source">	this.advisors = [];</td></tr><tr class="hit"><td class="line">21</td><td class="hits">21</td><td class="source">	this.interfaces = [];</td></tr><tr class="hit"><td class="line">22</td><td class="hits">21</td><td class="source">	this.methodCache = {};</td></tr><tr class="hit"><td class="line">23</td><td class="hits">21</td><td class="source">	this.beanFactory = null;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">21</td><td class="source">	this.targetSource = null;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">21</td><td class="source">	this.advisorChainFactory = null;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * set target.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param  {Object} target target object</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.setTarget = function(target) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">21</td><td class="source">	this.setTargetSource(target);</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * set target source.</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @param  {Object} targetSource object</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.setTargetSource = function(targetSource) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">21</td><td class="source">	this.targetSource = targetSource;</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * get target source.</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @return  {Object} targetSource object</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.getTargetSource = function() {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">20</td><td class="source">	return this.targetSource;</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * set proxy interfaces.</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @param  {Array} interfaces proxy interfaces</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">64</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.setInterfaces = function(interfaces) {</td></tr><tr class="hit"><td class="line">65</td><td class="hits">21</td><td class="source">	for (var i = 0; i &lt; interfaces.length; i++) {</td></tr><tr class="hit"><td class="line">66</td><td class="hits">212</td><td class="source">		this.addInterface(interfaces[i]);</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * add proxy interface.</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * @param  {String} interface proxy interface</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.addInterface = function(interface) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">212</td><td class="source">	this.interfaces.push(interface);</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * get proxy interfaces.</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * @return  {Array} proxy interfaces</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.getInterfaces = function() {</td></tr><tr class="hit"><td class="line">87</td><td class="hits">20</td><td class="source">	return this.interfaces;</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * get advisors.</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> * @return  {Array} advisors</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">96</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.getAdvisors = function() {</td></tr><tr class="hit"><td class="line">97</td><td class="hits">60</td><td class="source">	return this.advisors;</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * add advisor.</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> * @param  {Object} advisor</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">106</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.addAdvisor = function(advisor) {</td></tr><tr class="hit"><td class="line">107</td><td class="hits">180</td><td class="source">	this.advisors.push(advisor);</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> * get beanFactory.</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> * @return  {Object} beanFactory object</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">116</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.getBeanFactory = function() {</td></tr><tr class="hit"><td class="line">117</td><td class="hits">20</td><td class="source">	return this.beanFactory;</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> * set beanFactory.</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> * @param  {Object} beanFactory beanFactory object</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">126</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.setBeanFactory = function(beanFactory) {</td></tr><tr class="hit"><td class="line">127</td><td class="hits">20</td><td class="source">	this.beanFactory = beanFactory;</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> * get interception advisors for bean.</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> * @param   {String} method</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> * @param   {String} beanName</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> * @param   {String} adviceType</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> * @return  {Object} interception advisors</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">139</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.getInterceptionAdvice = function(method, beanName, adviceType) {</td></tr><tr class="hit"><td class="line">140</td><td class="hits">60</td><td class="source">	var cacheKey = method + &quot;_&quot; + adviceType;</td></tr><tr class="hit"><td class="line">141</td><td class="hits">60</td><td class="source">	var cached = this.methodCache[cacheKey];</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">143</td><td class="hits">60</td><td class="source">	if (!cached) {</td></tr><tr class="hit"><td class="line">144</td><td class="hits">60</td><td class="source">		cached = this.doGetInterceptionAdvice(method, beanName, adviceType);</td></tr><tr class="hit"><td class="line">145</td><td class="hits">60</td><td class="source">		this.methodCache[cacheKey] = cached;</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">148</td><td class="hits">60</td><td class="source">	return cached;</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source"> * do get interception advisors for bean.</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> * @param   {String} method</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> * @param   {String} beanName</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> * @param   {String} adviceType</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> * @return  {Object} interception advisors</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">160</td><td class="hits">1</td><td class="source">AdvisedSupport.prototype.doGetInterceptionAdvice = function(method, beanName, adviceType) {</td></tr><tr class="hit"><td class="line">161</td><td class="hits">60</td><td class="source">	var interceptorList = [];</td></tr><tr class="hit"><td class="line">162</td><td class="hits">60</td><td class="source">	var advisors = this.getAdvisors();</td></tr><tr class="hit"><td class="line">163</td><td class="hits">60</td><td class="source">	var targetMethod = beanName + '.' + method;</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">165</td><td class="hits">60</td><td class="source">	for (var i = 0; i &lt; advisors.length; i++) {</td></tr><tr class="hit"><td class="line">166</td><td class="hits">540</td><td class="source">		var advisor = advisors[i];</td></tr><tr class="hit"><td class="line">167</td><td class="hits">540</td><td class="source">		var pointcut = advisor.getPointcut();</td></tr><tr class="hit"><td class="line">168</td><td class="hits">540</td><td class="source">		if (pointcut.getAdviceType() !== adviceType) {</td></tr><tr class="hit"><td class="line">169</td><td class="hits">360</td><td class="source">			continue;</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">172</td><td class="hits">180</td><td class="source">		if (pointcut.match(targetMethod)) {</td></tr><tr class="hit"><td class="line">173</td><td class="hits">26</td><td class="source">			interceptorList.push(advisor);</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">177</td><td class="hits">60</td><td class="source">	interceptorList.sort(Utils.compareByOrder);</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">179</td><td class="hits">60</td><td class="source">	return interceptorList;</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">182</td><td class="hits">1</td><td class="source">module.exports = AdvisedSupport;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/dynamicAopProxy.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/dynamicAopProxy.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">114</div><div class="hits">114</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat DynamicAopProxy</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'DynamicAopProxy');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Constant = require('../../util/constant');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * DynamicAopProxy constructor function.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @param  {Object} advised advisedSupport object</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">var DynamicAopProxy = function(advised) {</td></tr><tr class="hit"><td class="line">25</td><td class="hits">21</td><td class="source">	this.advised = advised;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">21</td><td class="source">	this.dyInit();</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * DynamicAopProxy init function.</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * it will add proxy interfaces to DynamicAopProxy prototype, and proxy to invoke function</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">DynamicAopProxy.prototype.dyInit = function() {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">21</td><td class="source">	if (!this.advised) {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">		logger.error('DynamicAopProxy init error no advised');</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">20</td><td class="source">	var interfaces = this.advised.getInterfaces();</td></tr><tr class="hit"><td class="line">42</td><td class="hits">20</td><td class="source">	var self = this;</td></tr><tr class="hit"><td class="line">43</td><td class="hits">20</td><td class="source">	for (var i = 0; i &lt; interfaces.length; i++) {</td></tr><tr class="hit"><td class="line">44</td><td class="hits">210</td><td class="source">		(function(interface) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">210</td><td class="source">			if (checkFuncName(interface)) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">10</td><td class="source">				logger.error('init error proxy method interface %j the same as DynamicAopProxy, rename this name to another.', interface)</td></tr><tr class="hit"><td class="line">47</td><td class="hits">10</td><td class="source">				return;</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">			};</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">50</td><td class="hits">200</td><td class="source">			self[interface] = function() {</td></tr><tr class="hit"><td class="line">51</td><td class="hits">20</td><td class="source">				arguments = Array.prototype.slice.apply(arguments);</td></tr><tr class="hit"><td class="line">52</td><td class="hits">20</td><td class="source">				return self.dyInvoke(interface, arguments);</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">		})(interfaces[i]);</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * DynamicAopProxy proxy invoke function.</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * all target proxy function invoke will delegate to this function</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @param  {String} method proxy method name</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * @param  {Array}  args proxy method invoke arguments</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">67</td><td class="hits">1</td><td class="source">DynamicAopProxy.prototype.dyInvoke = function(method, args) {</td></tr><tr class="hit"><td class="line">68</td><td class="hits">20</td><td class="source">	var self = this;</td></tr><tr class="hit"><td class="line">69</td><td class="hits">20</td><td class="source">	var invokeCb = args.pop();</td></tr><tr class="hit"><td class="line">70</td><td class="hits">20</td><td class="source">	var flag = false;</td></tr><tr class="hit"><td class="line">71</td><td class="hits">20</td><td class="source">	if (!Utils.checkFunction(invokeCb)) {</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">		// aop target args last must be next function</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">		// if (invokeCb) {</td></tr><tr class="hit"><td class="line">74</td><td class="hits">8</td><td class="source">		args.push(invokeCb);</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">		// }</td></tr><tr class="hit"><td class="line">76</td><td class="hits">8</td><td class="source">		invokeCb = function() {};</td></tr><tr class="hit"><td class="line">77</td><td class="hits">8</td><td class="source">		flag = true;</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">80</td><td class="hits">20</td><td class="source">	var targetSource = this.advised.getTargetSource();</td></tr><tr class="hit"><td class="line">81</td><td class="hits">20</td><td class="source">	var beanName = targetSource.getBeanName();</td></tr><tr class="hit"><td class="line">82</td><td class="hits">20</td><td class="source">	var target = targetSource.getTarget();</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">20</td><td class="source">	var adviseType = Constant.AOP_ADVICE_BEFORE;</td></tr><tr class="hit"><td class="line">85</td><td class="hits">20</td><td class="source">	var beforeAdvisors = this.advised.getInterceptionAdvice(method, beanName, adviseType);</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">87</td><td class="hits">20</td><td class="source">	adviseType = Constant.AOP_ADVICE_AROUND;</td></tr><tr class="hit"><td class="line">88</td><td class="hits">20</td><td class="source">	var aroundAdvisors = this.advised.getInterceptionAdvice(method, beanName, adviseType);</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">90</td><td class="hits">20</td><td class="source">	var needAround = false;</td></tr><tr class="hit"><td class="line">91</td><td class="hits">20</td><td class="source">	if (Utils.checkArray(aroundAdvisors) &amp;&amp; aroundAdvisors.length) {</td></tr><tr class="hit"><td class="line">92</td><td class="hits">4</td><td class="source">		needAround = true;</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">95</td><td class="hits">20</td><td class="source">	adviseType = Constant.AOP_ADVICE_AFTER;</td></tr><tr class="hit"><td class="line">96</td><td class="hits">20</td><td class="source">	var afterAdvisors = this.advised.getInterceptionAdvice(method, beanName, adviseType);</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">98</td><td class="hits">20</td><td class="source">	var needAfter = false;</td></tr><tr class="hit"><td class="line">99</td><td class="hits">20</td><td class="source">	if (Utils.checkArray(afterAdvisors) &amp;&amp; afterAdvisors.length) {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">4</td><td class="source">		needAfter = true;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">103</td><td class="hits">20</td><td class="source">	return this.doInvokeAdvisorsBefore(method, args, beforeAdvisors, function(err) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">20</td><td class="source">		if (err) {</td></tr><tr class="hit"><td class="line">105</td><td class="hits">2</td><td class="source">			return invokeCb(err);</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">108</td><td class="hits">18</td><td class="source">		if (needAround) {</td></tr><tr class="hit"><td class="line">109</td><td class="hits">4</td><td class="source">			self.doInvokeAdvisorsAround(target, method, args, aroundAdvisors, function() {</td></tr><tr class="hit"><td class="line">110</td><td class="hits">4</td><td class="source">				arguments = Array.prototype.slice.apply(arguments);</td></tr><tr class="hit"><td class="line">111</td><td class="hits">4</td><td class="source">				invokeCb.apply(null, arguments);</td></tr><tr class="hit"><td class="line">112</td><td class="hits">4</td><td class="source">				self.doInvokeAdvisorsAfter(method, arguments, afterAdvisors, function() {});</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">			});</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">		} else {</td></tr><tr class="hit"><td class="line">115</td><td class="hits">14</td><td class="source">			var next = function() {</td></tr><tr class="hit"><td class="line">116</td><td class="hits">6</td><td class="source">				arguments = Array.prototype.slice.apply(arguments);</td></tr><tr class="hit"><td class="line">117</td><td class="hits">6</td><td class="source">				invokeCb.apply(null, arguments);</td></tr><tr class="hit"><td class="line">118</td><td class="hits">6</td><td class="source">				self.doInvokeAdvisorsAfter(method, arguments, afterAdvisors, function() {});</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">121</td><td class="hits">14</td><td class="source">			if (!flag) {</td></tr><tr class="hit"><td class="line">122</td><td class="hits">6</td><td class="source">				args.push(next);</td></tr><tr class="hit"><td class="line">123</td><td class="hits">6</td><td class="source">				return target[method].apply(target, args);</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">			} else {</td></tr><tr class="hit"><td class="line">125</td><td class="hits">8</td><td class="source">				var r = target[method].apply(target, args);</td></tr><tr class="hit"><td class="line">126</td><td class="hits">8</td><td class="source">				if (needAfter) {</td></tr><tr class="hit"><td class="line">127</td><td class="hits">2</td><td class="source">					self.doInvokeAdvisorsAfter(method, r, afterAdvisors, function() {});</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">130</td><td class="hits">8</td><td class="source">				return r;</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * DynamicAopProxy do invoke before advisors chain.</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> * @param  {String}   method proxy method name</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * @param  {Array}    args proxy method invoke arguments</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> * @param  {Object}   advisors target advisors</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> * @param  {Function} cb callback function</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">146</td><td class="hits">1</td><td class="source">DynamicAopProxy.prototype.doInvokeAdvisorsBefore = function(method, args, advisors, cb) {</td></tr><tr class="hit"><td class="line">147</td><td class="hits">20</td><td class="source">	var index = 0;</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">149</td><td class="hits">20</td><td class="source">	args = Array.prototype.slice.apply(args);</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">151</td><td class="hits">20</td><td class="source">	if (!advisors || !Utils.checkArray(advisors) || !advisors.length) {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">12</td><td class="source">		return cb();</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">155</td><td class="hits">8</td><td class="source">	var next = function(err) {</td></tr><tr class="hit"><td class="line">156</td><td class="hits">26</td><td class="source">		if (err || index &gt;= advisors.length) {</td></tr><tr class="hit"><td class="line">157</td><td class="hits">8</td><td class="source">			return cb(err);</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">160</td><td class="hits">18</td><td class="source">		var advisor = advisors[index++];</td></tr><tr class="hit"><td class="line">161</td><td class="hits">18</td><td class="source">		var advise = advisor.getAdvice();</td></tr><tr class="hit"><td class="line">162</td><td class="hits">18</td><td class="source">		var aspectBean = advisor.getBean();</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">164</td><td class="hits">18</td><td class="source">		var _next = function(err) {</td></tr><tr class="hit"><td class="line">165</td><td class="hits">18</td><td class="source">			next(err);</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">		};</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">168</td><td class="hits">18</td><td class="source">		if (advisor.isRuntime()) {</td></tr><tr class="hit"><td class="line">169</td><td class="hits">2</td><td class="source">			args.push(_next);</td></tr><tr class="hit"><td class="line">170</td><td class="hits">2</td><td class="source">			aspectBean[advise].apply(aspectBean, args);</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">		} else {</td></tr><tr class="hit"><td class="line">172</td><td class="hits">16</td><td class="source">			aspectBean[advise](_next);</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">176</td><td class="hits">8</td><td class="source">	next();</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> * DynamicAopProxy do invoke around advisors chain.</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> * @param  {Object}   target target object</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> * @param  {String}   method proxy method name</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> * @param  {Array}    args proxy method invoke arguments</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> * @param  {Object}   advisors target advisors</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> * @param  {Function} cb callback function</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">190</td><td class="hits">1</td><td class="source">DynamicAopProxy.prototype.doInvokeAdvisorsAround = function(target, method, args, advisors, cb) {</td></tr><tr class="hit"><td class="line">191</td><td class="hits">4</td><td class="source">	var advisor = advisors[0];</td></tr><tr class="hit"><td class="line">192</td><td class="hits">4</td><td class="source">	var advise = advisor.getAdvice();</td></tr><tr class="hit"><td class="line">193</td><td class="hits">4</td><td class="source">	var aspectBean = advisor.getBean();</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">	// if (Utils.checkObject(args)) {</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">	// 	args = Array.prototype.slice.apply(args);</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">	// }</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">199</td><td class="hits">4</td><td class="source">	if (advisor.isRuntime()) {</td></tr><tr class="hit"><td class="line">200</td><td class="hits">2</td><td class="source">		args.unshift(method);</td></tr><tr class="hit"><td class="line">201</td><td class="hits">2</td><td class="source">		args.unshift(target);</td></tr><tr class="hit"><td class="line">202</td><td class="hits">2</td><td class="source">		args.push(cb);</td></tr><tr class="hit"><td class="line">203</td><td class="hits">2</td><td class="source">		aspectBean[advise].apply(aspectBean, args);</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">205</td><td class="hits">2</td><td class="source">		aspectBean[advise](target, method, cb);</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> * DynamicAopProxy do invoke after advisors chain.</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> * @param  {String}   method proxy method name</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> * @param  {Array}    args proxy method invoke arguments</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> * @param  {Object}   advisors target advisors</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> * @param  {Function} cb callback function</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">219</td><td class="hits">1</td><td class="source">DynamicAopProxy.prototype.doInvokeAdvisorsAfter = function(method, args, advisors, cb) {</td></tr><tr class="hit"><td class="line">220</td><td class="hits">12</td><td class="source">	var index = 0;</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">222</td><td class="hits">12</td><td class="source">	if (!advisors || !Utils.checkArray(advisors) || !advisors.length) {</td></tr><tr class="hit"><td class="line">223</td><td class="hits">8</td><td class="source">		return cb();</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">	// if (Utils.checkObject(args)) {</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">	// 	args = Array.prototype.slice.apply(args);</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">	// } else </td></tr><tr class="hit"><td class="line">229</td><td class="hits">4</td><td class="source">	if (!Utils.checkArray(args)) {</td></tr><tr class="hit"><td class="line">230</td><td class="hits">2</td><td class="source">		args = [args];</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">233</td><td class="hits">4</td><td class="source">	var next = function(err) {</td></tr><tr class="hit"><td class="line">234</td><td class="hits">8</td><td class="source">		if (err || index &gt;= advisors.length) {</td></tr><tr class="hit"><td class="line">235</td><td class="hits">4</td><td class="source">			return cb(err);</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">238</td><td class="hits">4</td><td class="source">		var advisor = advisors[index++];</td></tr><tr class="hit"><td class="line">239</td><td class="hits">4</td><td class="source">		var advise = advisor.getAdvice();</td></tr><tr class="hit"><td class="line">240</td><td class="hits">4</td><td class="source">		var aspectBean = advisor.getBean();</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">242</td><td class="hits">4</td><td class="source">		var _next = function(err) {</td></tr><tr class="hit"><td class="line">243</td><td class="hits">4</td><td class="source">			next(err);</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">		};</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">246</td><td class="hits">4</td><td class="source">		args.push(_next);</td></tr><tr class="hit"><td class="line">247</td><td class="hits">4</td><td class="source">		aspectBean[advise].apply(aspectBean, args);</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">250</td><td class="hits">4</td><td class="source">	next();</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">253</td><td class="hits">1</td><td class="source">var names = [&quot;dyInit&quot;, &quot;dyInvoke&quot;, &quot;doInvokeAdvisorsBefore&quot;,</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source">	&quot;doInvokeAdvisorsAround&quot;, &quot;doInvokeAdvisorsAfter&quot;</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source">];</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">257</td><td class="hits">1</td><td class="source">var checkFuncName = function(name) {</td></tr><tr class="hit"><td class="line">258</td><td class="hits">210</td><td class="source">	for (var i = 0; i &lt; names.length; i++) {</td></tr><tr class="hit"><td class="line">259</td><td class="hits">1010</td><td class="source">		if (name === names[i]) {</td></tr><tr class="hit"><td class="line">260</td><td class="hits">10</td><td class="source">			return true;</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">264</td><td class="hits">200</td><td class="source">	return false;</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">267</td><td class="hits">1</td><td class="source">module.exports = DynamicAopProxy;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/dynamicMetaProxy.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/dynamicMetaProxy.js</h2><div id="stats" class="high"><div class="percentage">92%</div><div class="sloc">42</div><div class="hits">39</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat DynamicMetaProxy</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'DynamicMetaProxy');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * DynamicMetaProxy constructor function.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * this proxy will be used in bearcat.getBeanByMeta()</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * getBeanByMeta will first return a dynamicMetaProxy,</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * when target bean invoked, it will call getBean to get the target object</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">var DynamicMetaProxy = function() {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">373</td><td class="source">	this.args = null;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">373</td><td class="source">	this.target = null;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">373</td><td class="source">	this.beanFactory = null;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">373</td><td class="source">	this.beanDefinition = null;</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * DynamicMetaProxy init function.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">DynamicMetaProxy.prototype._dyInit = function() {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">373</td><td class="source">	var beanDefinition = this.beanDefinition;</td></tr><tr class="hit"><td class="line">39</td><td class="hits">373</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">		logger.error('init error no beanDefinition.');</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">372</td><td class="source">	var self = this;</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">372</td><td class="source">	var func = beanDefinition.getFunc();</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">372</td><td class="source">	if (Utils.checkFunction(func)) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">372</td><td class="source">		var proto = func.prototype;</td></tr><tr class="hit"><td class="line">50</td><td class="hits">372</td><td class="source">		for (interface in proto) {</td></tr><tr class="hit"><td class="line">51</td><td class="hits">372</td><td class="source">			if (Utils.checkFunction(proto[interface])) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">371</td><td class="source">				(function(method) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">371</td><td class="source">					if (checkFuncName(method)) {</td></tr><tr class="miss"><td class="line">54</td><td class="hits">0</td><td class="source">						logger.error('init error proxy method interface %j the same as DynamicMetaProxy, rename this name to another.', method)</td></tr><tr class="miss"><td class="line">55</td><td class="hits">0</td><td class="source">						return;</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">					};</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">371</td><td class="source">					self[method] = function() {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">4</td><td class="source">						return self._dyInvoke(method, arguments);</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">					};</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">				})(interface);</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * DynamicMetaProxy proxy invoke function.</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * @param  {String} method proxy method name</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @param  {Array}  args target invoke arguments</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">DynamicMetaProxy.prototype._dyInvoke = function(method, args) {</td></tr><tr class="hit"><td class="line">75</td><td class="hits">5</td><td class="source">	var targetBean = this._getBean();</td></tr><tr class="hit"><td class="line">76</td><td class="hits">5</td><td class="source">	if (Utils.checkFunction(targetBean[method])) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">4</td><td class="source">		return targetBean[method].apply(targetBean, args);</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">		logger.error('invoke error no such method %s in the target bean', method);</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * DynamicMetaProxy get target bean through beanFactory.</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * @return  {Object}  target bean</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">DynamicMetaProxy.prototype._getBean = function() {</td></tr><tr class="hit"><td class="line">90</td><td class="hits">5</td><td class="source">	var args = this.args;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">92</td><td class="hits">5</td><td class="source">	var beanFactory = this.beanFactory;</td></tr><tr class="hit"><td class="line">93</td><td class="hits">5</td><td class="source">	if (!this.target) {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">4</td><td class="source">		this.target = beanFactory.getBean.apply(beanFactory, args);</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">5</td><td class="source">	return this.target;</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">var names = [&quot;_dyInit&quot;, &quot;_dyInvoke&quot;, &quot;_getBean&quot;];</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">102</td><td class="hits">1</td><td class="source">var checkFuncName = function(name) {</td></tr><tr class="hit"><td class="line">103</td><td class="hits">371</td><td class="source">	for (var i = 0; i &lt; names.length; i++) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">1113</td><td class="source">		if (name === names[i]) {</td></tr><tr class="miss"><td class="line">105</td><td class="hits">0</td><td class="source">			return true;</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">109</td><td class="hits">371</td><td class="source">	return false;</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">module.exports = DynamicMetaProxy;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/proxyFactory.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/framework/proxyFactory.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">18</div><div class="hits">18</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat DynamicAopProxy</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var RequireUtil = require('../../util/requireUtil');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var DynamicAopProxy = require('./dynamicAopProxy');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var AdvisedSupport = require('./advisedSupport');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var Util = RequireUtil.requireUtil();</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * ProxyFactory constructor function.</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @param  {Object} target target object</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @param  {Array}  interfaces proxy interfaces</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">var ProxyFactory = function(target, interfaces) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">21</td><td class="source">	this.beanFactory = null;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">21</td><td class="source">	AdvisedSupport.call(this);</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">21</td><td class="source">	if (target) {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">		this.setTarget(target);</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">21</td><td class="source">	if (Utils.checkArray(interfaces)) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">		this.setInterfaces(interfaces);</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">Util.inherits(ProxyFactory, AdvisedSupport);</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * ProxyFactory get dynamic proxy.</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @return  {Object} dynamic proxy object</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">ProxyFactory.prototype.getProxy = function() {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">20</td><td class="source">	var beanFactory = this.getBeanFactory();</td></tr><tr class="hit"><td class="line">50</td><td class="hits">20</td><td class="source">	var proxyObject = new DynamicAopProxy(this);</td></tr><tr class="hit"><td class="line">51</td><td class="hits">20</td><td class="source">	return proxyObject;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">module.exports = ProxyFactory;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/pointcut.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/pointcut.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">29</div><div class="hits">29</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat Pointcut</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * Pointcut constructor function.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var Pointcut = function() {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">181</td><td class="source">	this.expression = null;</td></tr><tr class="hit"><td class="line">23</td><td class="hits">181</td><td class="source">	this.adviceType = null;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">181</td><td class="source">	this.targetExpression = null;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * Pointcut set expression.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @param  {String} expression pointcut expression</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">Pointcut.prototype.setExpression = function(expression) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">180</td><td class="source">	this.expression = expression;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * Pointcut get expression.</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @param  {String} pointcut expression</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">Pointcut.prototype.getExpression = function() {</td></tr><tr class="hit"><td class="line">44</td><td class="hits">181</td><td class="source">	return this.expression;</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * Pointcut set adviceType: before, after, around.</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @param  {String} adviceType</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">Pointcut.prototype.setAdviceType = function(adviceType) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">180</td><td class="source">	this.adviceType = adviceType;</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * Pointcut get adviceType: before, after, around.</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @param  {String} adviceType</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">Pointcut.prototype.getAdviceType = function() {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">540</td><td class="source">	return this.adviceType;</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * Pointcut set target pointcut expression.</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * @param  {String} target pointcut expression</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">Pointcut.prototype.setTargetExpression = function(targetExpression) {</td></tr><tr class="hit"><td class="line">74</td><td class="hits">180</td><td class="source">	this.targetExpression = new RegExp(targetExpression);</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * Pointcut get target pointcut expression.</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @return  {String} target pointcut expression</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">Pointcut.prototype.getTargetExpression = function() {</td></tr><tr class="hit"><td class="line">84</td><td class="hits">1120</td><td class="source">	return this.targetExpression;</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * Pointcut parse pointcut expression.</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">Pointcut.prototype.parse = function() {</td></tr><tr class="hit"><td class="line">93</td><td class="hits">181</td><td class="source">	var expression = this.getExpression();</td></tr><tr class="hit"><td class="line">94</td><td class="hits">181</td><td class="source">	if (!expression) {</td></tr><tr class="hit"><td class="line">95</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">98</td><td class="hits">180</td><td class="source">	var r = expression.split(':');</td></tr><tr class="hit"><td class="line">99</td><td class="hits">180</td><td class="source">	if (Utils.checkArray(r) &amp;&amp; r.length === 2) {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">180</td><td class="source">		this.setAdviceType(r[0]);</td></tr><tr class="hit"><td class="line">101</td><td class="hits">180</td><td class="source">		this.setTargetExpression(r[1]);</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * Pointcut check whether pointcut match targetMethod.</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * @param  {String} targetMethod target method name</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">111</td><td class="hits">1</td><td class="source">Pointcut.prototype.match = function(targetMethod) {</td></tr><tr class="hit"><td class="line">112</td><td class="hits">1120</td><td class="source">	var targetExpression = this.getTargetExpression();</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">114</td><td class="hits">1120</td><td class="source">	return targetMethod.match(targetExpression);</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">117</td><td class="hits">1</td><td class="source">module.exports = Pointcut;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/targetSource.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/aop/targetSource.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">13</div><div class="hits">13</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat TargetSource</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * TargetSource constructor function.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * @param  {Object} target target object</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var TargetSource = function(beanName, target) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">21</td><td class="source">	this.beanName = beanName;</td></tr><tr class="hit"><td class="line">23</td><td class="hits">21</td><td class="source">	this.target = target;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * TargetSource set beanName.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">TargetSource.prototype.setBeanName = function(beanName) {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">	this.beanName = beanName;</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * TargetSource get beanName.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @return  {String} beanName</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">TargetSource.prototype.getBeanName = function() {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">20</td><td class="source">	return this.beanName;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * TargetSource set target.</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @param  {Object} target target object</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">TargetSource.prototype.setTarget = function(target) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">	this.target = target;</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * TargetSource get target.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @return  {Object} target object</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">TargetSource.prototype.getTarget = function() {</td></tr><tr class="hit"><td class="line">63</td><td class="hits">20</td><td class="source">	return this.target;</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">TargetSource.prototype.releaseTarget = function() {</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">module.exports = TargetSource;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/beanFactory.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/beanFactory.js</h2><div id="stats" class="high"><div class="percentage">99%</div><div class="sloc">420</div><div class="hits">416</div><div class="misses">4</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat BeanFactory</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'BeanFactory');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var DynamicMetaProxy = require('../aop/framework/dynamicMetaProxy');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var SingletonBeanFactory = require('./singletonBeanFactory');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var ModelConstraint = require('../model/modelConstraint');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var ModelDefinition = require('../model/modelDefinition');</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var BeanDefinition = require('./support/beanDefinition');</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var ValidatorUtil = require('../util/validatorUtil');</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var ModelFilter = require('../model/modelFilter');</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var ModelProxy = require('../model/modelProxy');</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var ModelUtil = require('../util/modelUtil');</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">var Constant = require('../util/constant');</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">var BeanUtil = require('../util/beanUtil');</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">var AopUtil = require('../util/aopUtil');</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">var Aspect = require('../aop/aspect');</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * BeanFactory constructor function.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">var BeanFactory = function() {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">65</td><td class="source">	this.aspects = [];</td></tr><tr class="hit"><td class="line">37</td><td class="hits">65</td><td class="source">	this.modelMap = {};</td></tr><tr class="hit"><td class="line">38</td><td class="hits">65</td><td class="source">	this.initCbMap = {};</td></tr><tr class="hit"><td class="line">39</td><td class="hits">65</td><td class="source">	this.beanCurMap = {};</td></tr><tr class="hit"><td class="line">40</td><td class="hits">65</td><td class="source">	this.constraints = {};</td></tr><tr class="hit"><td class="line">41</td><td class="hits">65</td><td class="source">	this.tableModelMap = {};</td></tr><tr class="hit"><td class="line">42</td><td class="hits">65</td><td class="source">	this.beanFunctions = {};</td></tr><tr class="hit"><td class="line">43</td><td class="hits">65</td><td class="source">	this.beanDefinitions = {};</td></tr><tr class="hit"><td class="line">44</td><td class="hits">65</td><td class="source">	this.beanPostProcessors = [];</td></tr><tr class="hit"><td class="line">45</td><td class="hits">65</td><td class="source">	this.singletonBeanFactory = new SingletonBeanFactory(this);</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * BeanFactory get bean instance through BeanFactory IoC container.</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @return {Object} bean object</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getBean = function(beanName) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">324</td><td class="source">	if (this.beanCurMap[beanName]) {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">		logger.error(&quot;circle reference beanName &quot; + beanName + &quot; is in creating&quot;);</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">61</td><td class="hits">323</td><td class="source">	this.beanCurMap[beanName] = true;</td></tr><tr class="hit"><td class="line">62</td><td class="hits">323</td><td class="source">	var beanObject = this.doGetBean.apply(this, arguments);</td></tr><tr class="hit"><td class="line">63</td><td class="hits">323</td><td class="source">	delete this.beanCurMap[beanName];</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">323</td><td class="source">	return beanObject;</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> * BeanFactory get bean proxy through BeanFactory IoC container for lazy init bean.</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * when invoke bean proxy, proxy will invoke getBean to get the target bean</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * @return {Object} bean proxy object</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getBeanProxy = function(beanName) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">373</td><td class="source">	return this.doGetBeanProxy.apply(this, arguments);</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * BeanFactory get model through BeanFactory IoC container.</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * @param  {String} modelId</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * @return {Object} model proxy object</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">87</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getModelProxy = function(modelId) {</td></tr><tr class="hit"><td class="line">88</td><td class="hits">5</td><td class="source">	return this.doGetModelProxy(modelId);</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> * BeanFactory get constraint through BeanFactory IoC container.</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> * @param  {String} cid</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> * @return {Object} constraint bean object</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">98</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getConstraint = function(cid) {</td></tr><tr class="hit"><td class="line">99</td><td class="hits">24</td><td class="source">	return this.doGetConstraint(cid);</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> * BeanFactory do get bean instance through BeanFactory IoC container.</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * @return {Object} bean object</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">109</td><td class="hits">1</td><td class="source">BeanFactory.prototype.doGetBean = function(beanName) {</td></tr><tr class="hit"><td class="line">110</td><td class="hits">323</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">112</td><td class="hits">323</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">113</td><td class="hits">3</td><td class="source">		logger.error('BeanFactory beanDefinition null for %j', beanName);</td></tr><tr class="hit"><td class="line">114</td><td class="hits">3</td><td class="source">		return null;</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">117</td><td class="hits">320</td><td class="source">	if (beanDefinition.isAbstract()) {</td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">		logger.warn('abstract bean can not get bean instance, you can use bearcat.getFunction to get constructor function of the bean');</td></tr><tr class="hit"><td class="line">119</td><td class="hits">1</td><td class="source">		return this.getBeanFunction(beanName);</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">122</td><td class="hits">319</td><td class="source">	if (beanDefinition.hasParentBean()) {</td></tr><tr class="hit"><td class="line">123</td><td class="hits">2</td><td class="source">		beanDefinition = this.setParentBean(beanName);</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">	// if (beanDefinition.isLazyInit()) {</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">	// 	return this.getBeanProxy.apply(this, arguments);</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">	// }</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">130</td><td class="hits">319</td><td class="source">	if (beanDefinition.isSingleton()) {</td></tr><tr class="hit"><td class="line">131</td><td class="hits">305</td><td class="source">		return this.singletonBeanFactory.getSingleton.apply(this.singletonBeanFactory, arguments);</td></tr><tr class="hit"><td class="line">132</td><td class="hits">14</td><td class="source">	} else if (beanDefinition.isPrototype()) {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">14</td><td class="source">		return this.createBean.apply(this, arguments);</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * BeanFactory do get bean proxy through BeanFactory IoC container.</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> * @return {Object} bean proxy object</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">144</td><td class="hits">1</td><td class="source">BeanFactory.prototype.doGetBeanProxy = function(beanName) {</td></tr><tr class="hit"><td class="line">145</td><td class="hits">373</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">147</td><td class="hits">373</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">148</td><td class="hits">1</td><td class="source">		logger.error('BeanFactory beanDefinition null for %j', beanName);</td></tr><tr class="hit"><td class="line">149</td><td class="hits">1</td><td class="source">		return null;</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">152</td><td class="hits">372</td><td class="source">	var dynamicMetaProxy = new DynamicMetaProxy();</td></tr><tr class="hit"><td class="line">153</td><td class="hits">372</td><td class="source">	dynamicMetaProxy['beanDefinition'] = beanDefinition;</td></tr><tr class="hit"><td class="line">154</td><td class="hits">372</td><td class="source">	dynamicMetaProxy['beanFactory'] = this;</td></tr><tr class="hit"><td class="line">155</td><td class="hits">372</td><td class="source">	dynamicMetaProxy['args'] = arguments;</td></tr><tr class="hit"><td class="line">156</td><td class="hits">372</td><td class="source">	dynamicMetaProxy._dyInit();</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">158</td><td class="hits">372</td><td class="source">	return dynamicMetaProxy;</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source"> * BeanFactory do get model through BeanFactory IoC container.</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> * @param  {String} modelId</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> * @return {Object} model proxy</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">168</td><td class="hits">1</td><td class="source">BeanFactory.prototype.doGetModelProxy = function(modelId) {</td></tr><tr class="hit"><td class="line">169</td><td class="hits">5</td><td class="source">	var modelDefinition = this.getModelDefinition(modelId);</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">171</td><td class="hits">5</td><td class="source">	if (!modelDefinition) {</td></tr><tr class="hit"><td class="line">172</td><td class="hits">2</td><td class="source">		logger.error('BeanFactory modelDefinition null for %j', modelId);</td></tr><tr class="hit"><td class="line">173</td><td class="hits">2</td><td class="source">		return null;</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">176</td><td class="hits">3</td><td class="source">	var beanName = modelDefinition.getId();</td></tr><tr class="hit"><td class="line">177</td><td class="hits">3</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">179</td><td class="hits">3</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="miss"><td class="line">180</td><td class="hits">0</td><td class="source">		logger.error('BeanFactory beanDefinition null for %j', modelId);</td></tr><tr class="miss"><td class="line">181</td><td class="hits">0</td><td class="source">		return null;</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">184</td><td class="hits">3</td><td class="source">	var modelFilter = new ModelFilter();</td></tr><tr class="hit"><td class="line">185</td><td class="hits">3</td><td class="source">	modelFilter.setModelDefinition(modelDefinition);</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">187</td><td class="hits">3</td><td class="source">	var modelProxy = new ModelProxy();</td></tr><tr class="hit"><td class="line">188</td><td class="hits">3</td><td class="source">	var modelBean = this.getBean(beanName);</td></tr><tr class="hit"><td class="line">189</td><td class="hits">3</td><td class="source">	var modelFields = modelDefinition.getFields();</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">191</td><td class="hits">3</td><td class="source">	for (var key in modelFields) {</td></tr><tr class="hit"><td class="line">192</td><td class="hits">16</td><td class="source">		var modelField = modelFields[key];</td></tr><tr class="hit"><td class="line">193</td><td class="hits">16</td><td class="source">		var modelDefault = modelField.getDefault();</td></tr><tr class="hit"><td class="line">194</td><td class="hits">16</td><td class="source">		var modelFieldType = modelField.getType();</td></tr><tr class="hit"><td class="line">195</td><td class="hits">16</td><td class="source">		if (Utils.isNotNull(modelDefault)) {</td></tr><tr class="hit"><td class="line">196</td><td class="hits">2</td><td class="source">			if (modelFieldType === Constant.TYPE_NUMBER) {</td></tr><tr class="miss"><td class="line">197</td><td class="hits">0</td><td class="source">				modelDefault = parseInt(modelDefault);</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">			}</td></tr><tr class="hit"><td class="line">199</td><td class="hits">2</td><td class="source">			modelBean[key] = modelDefault;</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">203</td><td class="hits">3</td><td class="source">	modelFilter.setModel(modelBean);</td></tr><tr class="hit"><td class="line">204</td><td class="hits">3</td><td class="source">	modelProxy['model'] = modelBean;</td></tr><tr class="hit"><td class="line">205</td><td class="hits">3</td><td class="source">	modelProxy['beanFactory'] = this;</td></tr><tr class="hit"><td class="line">206</td><td class="hits">3</td><td class="source">	modelProxy['modelFilter'] = modelFilter;</td></tr><tr class="hit"><td class="line">207</td><td class="hits">3</td><td class="source">	modelProxy['beanDefinition'] = beanDefinition;</td></tr><tr class="hit"><td class="line">208</td><td class="hits">3</td><td class="source">	modelProxy['modelDefinition'] = modelDefinition;</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">210</td><td class="hits">3</td><td class="source">	modelProxy._modelInit();</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">212</td><td class="hits">3</td><td class="source">	return modelProxy;</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> * BeanFactory do get constraint through BeanFactory IoC container.</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> * @param  {String} cid</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> * @return {Object} constraint bean object</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">222</td><td class="hits">1</td><td class="source">BeanFactory.prototype.doGetConstraint = function(cid) {</td></tr><tr class="hit"><td class="line">223</td><td class="hits">24</td><td class="source">	var constraintDefinition = this.getConstraintDefinition(cid);</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">225</td><td class="hits">24</td><td class="source">	if (!constraintDefinition) {</td></tr><tr class="hit"><td class="line">226</td><td class="hits">6</td><td class="source">		logger.error('BeanFactory constraintDefinition null for %j', cid);</td></tr><tr class="hit"><td class="line">227</td><td class="hits">6</td><td class="source">		return null;</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">230</td><td class="hits">18</td><td class="source">	var beanName = constraintDefinition.getId();</td></tr><tr class="hit"><td class="line">231</td><td class="hits">18</td><td class="source">	return this.getBean(beanName);</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source"> * BeanFactory create bean instance through BeanFactory IoC container.</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> * @return {Object} bean object</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">241</td><td class="hits">1</td><td class="source">BeanFactory.prototype.createBean = function(beanName) {</td></tr><tr class="hit"><td class="line">242</td><td class="hits">163</td><td class="source">	var beanObject = this.doCreateBean.apply(this, arguments);</td></tr><tr class="hit"><td class="line">243</td><td class="hits">163</td><td class="source">	beanObject = this.initBean(beanObject, beanName, this.getInitCb(beanName));</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">245</td><td class="hits">163</td><td class="source">	return beanObject;</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> * BeanFactory do create bean instance through BeanFactory IoC container.</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> * @return {Object} bean object</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">255</td><td class="hits">1</td><td class="source">BeanFactory.prototype.doCreateBean = function(beanName) {</td></tr><tr class="hit"><td class="line">256</td><td class="hits">165</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">258</td><td class="hits">165</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">259</td><td class="hits">1</td><td class="source">		return null;</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">262</td><td class="hits">164</td><td class="source">	if (beanDefinition.hasFactoryBean()) {</td></tr><tr class="hit"><td class="line">263</td><td class="hits">3</td><td class="source">		return this.getBeanFromFactoryBean.apply(this, arguments);</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">266</td><td class="hits">161</td><td class="source">	var argsOn = beanDefinition.getArgsOn();</td></tr><tr class="hit"><td class="line">267</td><td class="hits">161</td><td class="source">	var propsOn = beanDefinition.getPropsOn();</td></tr><tr class="hit"><td class="line">268</td><td class="hits">161</td><td class="source">	var func = this.getBeanFunction(beanName);</td></tr><tr class="hit"><td class="line">269</td><td class="hits">161</td><td class="source">	if (!func) {</td></tr><tr class="hit"><td class="line">270</td><td class="hits">1</td><td class="source">		return null;</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">273</td><td class="hits">160</td><td class="source">	var dependsBeans = this.getDependsBeanValues(argsOn, arguments);</td></tr><tr class="hit"><td class="line">274</td><td class="hits">160</td><td class="source">	var dependsApplyArgs = this.getDependsApplyArgs(dependsBeans);</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">276</td><td class="hits">160</td><td class="source">	var beanObject = Object.create(func.prototype);</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">278</td><td class="hits">160</td><td class="source">	func.apply(beanObject, dependsApplyArgs);</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">280</td><td class="hits">160</td><td class="source">	dependsBeans = this.getDependsBeanValues(propsOn);</td></tr><tr class="hit"><td class="line">281</td><td class="hits">160</td><td class="source">	if (Utils.checkArray(dependsBeans)) {</td></tr><tr class="hit"><td class="line">282</td><td class="hits">160</td><td class="source">		for (var i = 0; i &lt; dependsBeans.length; i++) {</td></tr><tr class="hit"><td class="line">283</td><td class="hits">34</td><td class="source">			var wbean = dependsBeans[i];</td></tr><tr class="hit"><td class="line">284</td><td class="hits">34</td><td class="source">			var name = wbean.getName();</td></tr><tr class="hit"><td class="line">285</td><td class="hits">34</td><td class="source">			if (wbean.getDependType() === Constant.DEPEND_TYPE_BEAN) {</td></tr><tr class="hit"><td class="line">286</td><td class="hits">23</td><td class="source">				beanObject[name] = wbean.getBean();</td></tr><tr class="hit"><td class="line">287</td><td class="hits">11</td><td class="source">			} else if (wbean.getDependType() === Constant.DEPEND_TYPE_VALUE) {</td></tr><tr class="hit"><td class="line">288</td><td class="hits">10</td><td class="source">				beanObject[name] = wbean.getValue();</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source">			// no this case</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source">			// else if (wbean.getDependType() === Constant.DEPEND_TYPE_VAR) {</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">			// beanObject[name] = wbean.getValueOnce();</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source">			// } </td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">			else {</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source">				// Constant.DEPEND_TYPE_ERROR</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">300</td><td class="hits">160</td><td class="source">	return beanObject;</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source"> * BeanFactory init bean with init method.</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source"> * @param  {Object}   beanObject</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source"> * @param  {Function} cb async init callback function</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">311</td><td class="hits">1</td><td class="source">BeanFactory.prototype.initBean = function(beanObject, beanName, cb) {</td></tr><tr class="hit"><td class="line">312</td><td class="hits">164</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr class="hit"><td class="line">313</td><td class="hits">164</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">314</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">317</td><td class="hits">163</td><td class="source">	beanObject = this.applyBeanPostProcessorsBeforeInitialization(beanObject, beanName);</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">319</td><td class="hits">163</td><td class="source">	this.invokeInitMethods(beanObject, beanName, cb);</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">321</td><td class="hits">163</td><td class="source">	beanObject = this.applyBeanPostProcessorsAfterInitialization(beanObject, beanName);</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">323</td><td class="hits">163</td><td class="source">	return beanObject;</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source"> * BeanFactory invoke init method.</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source"> * @param  {Object}   beanObject</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source"> * @param  {Function} cb async init callback function</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">334</td><td class="hits">1</td><td class="source">BeanFactory.prototype.invokeInitMethods = function(beanObject, beanName, cb) {</td></tr><tr class="hit"><td class="line">335</td><td class="hits">164</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr class="hit"><td class="line">336</td><td class="hits">164</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">337</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">340</td><td class="hits">163</td><td class="source">	if (beanDefinition.hasInitMethod()) {</td></tr><tr class="hit"><td class="line">341</td><td class="hits">5</td><td class="source">		var initMethodName = beanDefinition.getInitMethodName();</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source">		// run init method</td></tr><tr class="hit"><td class="line">344</td><td class="hits">5</td><td class="source">		var initMethod = beanObject[initMethodName];</td></tr><tr class="hit"><td class="line">345</td><td class="hits">5</td><td class="source">		if (Utils.checkFunction(initMethod)) {</td></tr><tr class="hit"><td class="line">346</td><td class="hits">5</td><td class="source">			initMethod.call(beanObject, cb);</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source"> * BeanFactory get bean instance from factoryBean's factory method.</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source"> * @return {Object} bean object</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">358</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getBeanFromFactoryBean = function(beanName) {</td></tr><tr class="hit"><td class="line">359</td><td class="hits">3</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">361</td><td class="hits">3</td><td class="source">	var factoryBeanName = beanDefinition.getFactoryBeanName();</td></tr><tr class="hit"><td class="line">362</td><td class="hits">3</td><td class="source">	var factoryMethodName = beanDefinition.getFactoryMethodName();</td></tr><tr class="hit"><td class="line">363</td><td class="hits">3</td><td class="source">	var factoryArgsOn = beanDefinition.getFactoryArgsOn();</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">365</td><td class="hits">3</td><td class="source">	var factoryBean = this.getBean(factoryBeanName);</td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">367</td><td class="hits">3</td><td class="source">	if (!factoryBean) {</td></tr><tr class="hit"><td class="line">368</td><td class="hits">2</td><td class="source">		return null;</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">371</td><td class="hits">1</td><td class="source">	var factoryMethod = factoryBean[factoryMethodName];</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">373</td><td class="hits">1</td><td class="source">	var dependsBeans = this.getDependsBeanValues(factoryArgsOn, arguments);</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">375</td><td class="hits">1</td><td class="source">	var dependsApplyArgs = this.getDependsApplyArgs(dependsBeans);</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">377</td><td class="hits">1</td><td class="source">	var beanObject = factoryMethod.apply(factoryBean, dependsApplyArgs);</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">379</td><td class="hits">1</td><td class="source">	return beanObject;</td></tr><tr><td class="line">380</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source"> * BeanFactory get denpended beans or values.</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source"> * @param  {Array} dependsOn</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source"> * @param  {Array} args arguments</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source"> * @return {Array} depended bean value list</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">390</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getDependsBeanValues = function(dependsOn, args) {</td></tr><tr class="hit"><td class="line">391</td><td class="hits">321</td><td class="source">	var r = [];</td></tr><tr class="hit"><td class="line">392</td><td class="hits">321</td><td class="source">	if (!Utils.checkArray(dependsOn)) {</td></tr><tr class="hit"><td class="line">393</td><td class="hits">1</td><td class="source">		return r;</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">396</td><td class="hits">320</td><td class="source">	var s = 1;</td></tr><tr class="hit"><td class="line">397</td><td class="hits">320</td><td class="source">	for (var i = 0; i &lt; dependsOn.length; i++) {</td></tr><tr class="hit"><td class="line">398</td><td class="hits">52</td><td class="source">		var wbean = dependsOn[i];</td></tr><tr class="hit"><td class="line">399</td><td class="hits">52</td><td class="source">		var beanName = wbean.getRef();</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">401</td><td class="hits">52</td><td class="source">		if (wbean.getDependType() === Constant.DEPEND_TYPE_BEAN) {</td></tr><tr class="hit"><td class="line">402</td><td class="hits">35</td><td class="source">			var bean = this.getBean(beanName);</td></tr><tr class="hit"><td class="line">403</td><td class="hits">35</td><td class="source">			if (bean) {</td></tr><tr class="hit"><td class="line">404</td><td class="hits">34</td><td class="source">				wbean.setBean(bean);</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">408</td><td class="hits">52</td><td class="source">		if (wbean.getDependType() === Constant.DEPEND_TYPE_VAR) {</td></tr><tr class="hit"><td class="line">409</td><td class="hits">2</td><td class="source">			var value = args[s++];</td></tr><tr class="hit"><td class="line">410</td><td class="hits">2</td><td class="source">			wbean.setValue(value);</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">413</td><td class="hits">52</td><td class="source">		r.push(wbean);</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">416</td><td class="hits">320</td><td class="source">	return r;</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source"> * BeanFactory get depended apply arguments.</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source"> * @param  {Array} dependsOn</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source"> * @return {Array} depended bean apply list</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">426</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getDependsApplyArgs = function(dependsOn) {</td></tr><tr class="hit"><td class="line">427</td><td class="hits">163</td><td class="source">	var r = [];</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">429</td><td class="hits">163</td><td class="source">	if (!Utils.checkArray(dependsOn)) {</td></tr><tr class="hit"><td class="line">430</td><td class="hits">1</td><td class="source">		return r;</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">433</td><td class="hits">162</td><td class="source">	for (var i = 0; i &lt; dependsOn.length; i++) {</td></tr><tr class="hit"><td class="line">434</td><td class="hits">19</td><td class="source">		var wbean = dependsOn[i];</td></tr><tr class="hit"><td class="line">435</td><td class="hits">19</td><td class="source">		if (wbean.getDependType() === Constant.DEPEND_TYPE_BEAN) {</td></tr><tr class="hit"><td class="line">436</td><td class="hits">12</td><td class="source">			r.push(wbean.getBean());</td></tr><tr class="hit"><td class="line">437</td><td class="hits">7</td><td class="source">		} else if (wbean.getDependType() === Constant.DEPEND_TYPE_VALUE) {</td></tr><tr class="hit"><td class="line">438</td><td class="hits">4</td><td class="source">			r.push(wbean.getValue());</td></tr><tr class="hit"><td class="line">439</td><td class="hits">3</td><td class="source">		} else if (wbean.getDependType() === Constant.DEPEND_TYPE_VAR) {</td></tr><tr class="hit"><td class="line">440</td><td class="hits">2</td><td class="source">			r.push(wbean.getValueOnce());</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source">		} else {</td></tr><tr><td class="line">442</td><td class="hits"></td><td class="source">			// DEPEND_TYPE_ERROR</td></tr><tr class="hit"><td class="line">443</td><td class="hits">1</td><td class="source">			logger.error(&quot;getDependsApplyArgs depends args type error %j&quot;, wbean);</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">447</td><td class="hits">162</td><td class="source">	return r;</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source"> * BeanFactory set parent bean.</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source"> * @return {Object} beanDefinition</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">456</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">457</td><td class="hits">1</td><td class="source">BeanFactory.prototype.setParentBean = function(beanName) {</td></tr><tr class="hit"><td class="line">458</td><td class="hits">5</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr class="hit"><td class="line">459</td><td class="hits">5</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">460</td><td class="hits">1</td><td class="source">		return null;</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">463</td><td class="hits">4</td><td class="source">	var parentName = beanDefinition.getParentName();</td></tr><tr class="hit"><td class="line">464</td><td class="hits">4</td><td class="source">	var parentBeanDefintion = this.getBeanDefinition(parentName);</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">466</td><td class="hits">4</td><td class="source">	var func = this.getBeanFunction(beanName);</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">468</td><td class="hits">4</td><td class="source">	var parentFunc = this.getBeanFunction(parentName);</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">470</td><td class="hits">4</td><td class="source">	if (parentFunc) {</td></tr><tr class="hit"><td class="line">471</td><td class="hits">4</td><td class="source">		var proto = parentFunc.prototype;</td></tr><tr class="hit"><td class="line">472</td><td class="hits">4</td><td class="source">		for (var key in proto) {</td></tr><tr class="hit"><td class="line">473</td><td class="hits">6</td><td class="source">			if (!func.prototype[key]) {</td></tr><tr class="hit"><td class="line">474</td><td class="hits">2</td><td class="source">				func.prototype[key] = proto[key];</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">479</td><td class="hits">4</td><td class="source">	if (parentBeanDefintion) {</td></tr><tr class="hit"><td class="line">480</td><td class="hits">4</td><td class="source">		beanDefinition.setParentBean(parentBeanDefintion);</td></tr><tr class="hit"><td class="line">481</td><td class="hits">4</td><td class="source">		beanDefinition.setArgsOn(parentBeanDefintion.getArgs());</td></tr><tr class="hit"><td class="line">482</td><td class="hits">4</td><td class="source">		beanDefinition.setPropsOn(parentBeanDefintion.getProps());</td></tr><tr class="hit"><td class="line">483</td><td class="hits">4</td><td class="source">		beanDefinition.setFactoryArgsOn(parentBeanDefintion.getFactoryArgs());</td></tr><tr><td class="line">484</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">485</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">486</td><td class="hits">4</td><td class="source">	return beanDefinition;</td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">490</td><td class="hits"></td><td class="source"> * BeanFactory register beans through metaObjects into BeanFactory.</td></tr><tr><td class="line">491</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source"> * @param  {Object} metaObjects</td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">494</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">495</td><td class="hits">1</td><td class="source">BeanFactory.prototype.registerBeans = function(metaObjects) {</td></tr><tr class="hit"><td class="line">496</td><td class="hits">420</td><td class="source">	for (var beanName in metaObjects) {</td></tr><tr class="hit"><td class="line">497</td><td class="hits">536</td><td class="source">		this.registerBean(beanName, metaObjects[beanName]);</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">502</td><td class="hits"></td><td class="source"> * BeanFactory register bean through metaObject into BeanFactory.</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">505</td><td class="hits"></td><td class="source"> * @param  {Object} metaObjects</td></tr><tr><td class="line">506</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">507</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">508</td><td class="hits">1</td><td class="source">BeanFactory.prototype.registerBean = function(beanName, metaObject) {</td></tr><tr class="hit"><td class="line">509</td><td class="hits">536</td><td class="source">	var func = metaObject.func;</td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">511</td><td class="hits">536</td><td class="source">	var validateResult = ValidatorUtil.metaValidator(metaObject);</td></tr><tr class="hit"><td class="line">512</td><td class="hits">536</td><td class="source">	if (validateResult !== true) {</td></tr><tr class="hit"><td class="line">513</td><td class="hits">1</td><td class="source">		logger.error(&quot;registryBean %j metaObject %j validate error %s&quot;, beanName, metaObject, validateResult.stack);</td></tr><tr class="hit"><td class="line">514</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">517</td><td class="hits">535</td><td class="source">	var mid = metaObject.mid;</td></tr><tr class="hit"><td class="line">518</td><td class="hits">535</td><td class="source">	if (mid) {</td></tr><tr><td class="line">519</td><td class="hits"></td><td class="source">		// register bearcat model</td></tr><tr class="hit"><td class="line">520</td><td class="hits">14</td><td class="source">		this.registerModel(beanName, mid, metaObject);</td></tr><tr><td class="line">521</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">522</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">523</td><td class="hits">535</td><td class="source">	var cid = metaObject.cid;</td></tr><tr class="hit"><td class="line">524</td><td class="hits">535</td><td class="source">	if (cid) {</td></tr><tr><td class="line">525</td><td class="hits"></td><td class="source">		// register bearcat constraint</td></tr><tr class="hit"><td class="line">526</td><td class="hits">358</td><td class="source">		this.registerConstraint(beanName, cid, metaObject);</td></tr><tr><td class="line">527</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">528</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">529</td><td class="hits">535</td><td class="source">	if (func &amp;&amp; Utils.checkFunction(func) &amp;&amp; !this.getBeanFunction(beanName)) {</td></tr><tr class="hit"><td class="line">530</td><td class="hits">528</td><td class="source">		this.setBeanFunction(beanName, func);</td></tr><tr><td class="line">531</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">532</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">533</td><td class="hits">535</td><td class="source">	var order = metaObject.order;</td></tr><tr class="hit"><td class="line">534</td><td class="hits">535</td><td class="source">	var parentName = metaObject.parent;</td></tr><tr class="hit"><td class="line">535</td><td class="hits">535</td><td class="source">	var initMethodName = metaObject.init;</td></tr><tr class="hit"><td class="line">536</td><td class="hits">535</td><td class="source">	var destroyMethodName = metaObject.destroy;</td></tr><tr class="hit"><td class="line">537</td><td class="hits">535</td><td class="source">	var factoryBeanName = metaObject.factoryBean;</td></tr><tr class="hit"><td class="line">538</td><td class="hits">535</td><td class="source">	var factoryMethodName = metaObject.factoryMethod;</td></tr><tr class="hit"><td class="line">539</td><td class="hits">535</td><td class="source">	var scope = metaObject.scope || Constant.SCOPE_DEFAULT;</td></tr><tr class="hit"><td class="line">540</td><td class="hits">535</td><td class="source">	var args = metaObject.args || Constant.ARGS_DEFAULT;</td></tr><tr class="hit"><td class="line">541</td><td class="hits">535</td><td class="source">	var props = metaObject.props || Constant.PROPS_DEFAULT;</td></tr><tr class="hit"><td class="line">542</td><td class="hits">535</td><td class="source">	var factoryArgsOn = metaObject.factoryArgs || Constant.ARGS_DEFAULT;</td></tr><tr class="hit"><td class="line">543</td><td class="hits">535</td><td class="source">	var asyncInit = metaObject.async || Constant.ASYNC_INIT_DEFAULT;</td></tr><tr class="hit"><td class="line">544</td><td class="hits">535</td><td class="source">	var lazyInit = metaObject.lazy || Constant.LAZY_INIT_DEFAULT;</td></tr><tr class="hit"><td class="line">545</td><td class="hits">535</td><td class="source">	var abstract = metaObject.abstract || Constant.ABSTRACT_DEFAULT;</td></tr><tr class="hit"><td class="line">546</td><td class="hits">535</td><td class="source">	var proxy = metaObject.proxy;</td></tr><tr class="hit"><td class="line">547</td><td class="hits">535</td><td class="source">	if (!Utils.isNotNull(proxy)) {</td></tr><tr class="hit"><td class="line">548</td><td class="hits">515</td><td class="source">		proxy = Constant.PROXY_DEFAULT;</td></tr><tr><td class="line">549</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">550</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">551</td><td class="hits">535</td><td class="source">	var aop = metaObject.aop;</td></tr><tr><td class="line">552</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">553</td><td class="hits">535</td><td class="source">	var beanDefinition = null;</td></tr><tr class="hit"><td class="line">554</td><td class="hits">535</td><td class="source">	beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr class="hit"><td class="line">555</td><td class="hits">535</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">556</td><td class="hits">528</td><td class="source">		beanDefinition = new BeanDefinition();</td></tr><tr><td class="line">557</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">558</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source">	// model scope should be prototype</td></tr><tr class="hit"><td class="line">560</td><td class="hits">535</td><td class="source">	if (mid) {</td></tr><tr class="hit"><td class="line">561</td><td class="hits">14</td><td class="source">		scope = Constant.SCOPE_PROTOTYPE;</td></tr><tr><td class="line">562</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">564</td><td class="hits">535</td><td class="source">	beanDefinition.setFunc(func);</td></tr><tr class="hit"><td class="line">565</td><td class="hits">535</td><td class="source">	beanDefinition.setOrder(order);</td></tr><tr class="hit"><td class="line">566</td><td class="hits">535</td><td class="source">	beanDefinition.setScope(scope);</td></tr><tr class="hit"><td class="line">567</td><td class="hits">535</td><td class="source">	beanDefinition.setProxy(proxy);</td></tr><tr class="hit"><td class="line">568</td><td class="hits">535</td><td class="source">	beanDefinition.setBeanName(beanName);</td></tr><tr class="hit"><td class="line">569</td><td class="hits">535</td><td class="source">	beanDefinition.setLazyInit(lazyInit);</td></tr><tr class="hit"><td class="line">570</td><td class="hits">535</td><td class="source">	beanDefinition.setAbstract(abstract);</td></tr><tr class="hit"><td class="line">571</td><td class="hits">535</td><td class="source">	beanDefinition.setAsyncInit(asyncInit);</td></tr><tr class="hit"><td class="line">572</td><td class="hits">535</td><td class="source">	beanDefinition.setParentName(parentName);</td></tr><tr class="hit"><td class="line">573</td><td class="hits">535</td><td class="source">	beanDefinition.setInitMethodName(initMethodName);</td></tr><tr class="hit"><td class="line">574</td><td class="hits">535</td><td class="source">	beanDefinition.setFactoryBeanName(factoryBeanName);</td></tr><tr class="hit"><td class="line">575</td><td class="hits">535</td><td class="source">	beanDefinition.setFactoryMethodName(factoryMethodName);</td></tr><tr class="hit"><td class="line">576</td><td class="hits">535</td><td class="source">	beanDefinition.setDestroyMethodName(destroyMethodName);</td></tr><tr class="hit"><td class="line">577</td><td class="hits">535</td><td class="source">	beanDefinition.setArgsOn(BeanUtil.buildBeanWrapper(args));</td></tr><tr class="hit"><td class="line">578</td><td class="hits">535</td><td class="source">	beanDefinition.setPropsOn(BeanUtil.buildBeanWrapper(props));</td></tr><tr class="hit"><td class="line">579</td><td class="hits">535</td><td class="source">	beanDefinition.setFactoryArgsOn(BeanUtil.buildBeanWrapper(factoryArgsOn));</td></tr><tr><td class="line">580</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">581</td><td class="hits">535</td><td class="source">	if (aop &amp;&amp; Utils.checkArray(aop)) {</td></tr><tr class="hit"><td class="line">582</td><td class="hits">20</td><td class="source">		var aspect = AopUtil.buildAspect(aop, beanDefinition);</td></tr><tr class="hit"><td class="line">583</td><td class="hits">20</td><td class="source">		this.aspects.push(aspect);</td></tr><tr class="hit"><td class="line">584</td><td class="hits">20</td><td class="source">		beanDefinition.setAspect(true);</td></tr><tr><td class="line">585</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">586</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">587</td><td class="hits">535</td><td class="source">	this.beanDefinitions[beanName] = beanDefinition;</td></tr><tr><td class="line">588</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">589</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">590</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">591</td><td class="hits"></td><td class="source"> * BeanFactory register model through metaObject into BeanFactory.</td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">593</td><td class="hits"></td><td class="source"> * @param  {String} beanName bean id</td></tr><tr><td class="line">594</td><td class="hits"></td><td class="source"> * @param  {String} modelId  model id</td></tr><tr><td class="line">595</td><td class="hits"></td><td class="source"> * @param  {Object} metaObject</td></tr><tr><td class="line">596</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">597</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">598</td><td class="hits">1</td><td class="source">BeanFactory.prototype.registerModel = function(beanName, modelId, metaObject) {</td></tr><tr class="hit"><td class="line">599</td><td class="hits">14</td><td class="source">	var modelDefinition = null;</td></tr><tr class="hit"><td class="line">600</td><td class="hits">14</td><td class="source">	modelDefinition = this.getModelDefinition(modelId);</td></tr><tr class="hit"><td class="line">601</td><td class="hits">14</td><td class="source">	if (!modelDefinition) {</td></tr><tr class="hit"><td class="line">602</td><td class="hits">14</td><td class="source">		modelDefinition = new ModelDefinition();</td></tr><tr><td class="line">603</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">604</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">605</td><td class="hits">14</td><td class="source">	var table = metaObject.table;</td></tr><tr class="hit"><td class="line">606</td><td class="hits">14</td><td class="source">	var prefix = metaObject.prefix;</td></tr><tr class="hit"><td class="line">607</td><td class="hits">14</td><td class="source">	var attributes = metaObject.attributes;</td></tr><tr><td class="line">608</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">609</td><td class="hits">14</td><td class="source">	var resolvedAttributes = ModelUtil.buildModelAttribute(attributes, this);</td></tr><tr><td class="line">610</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">611</td><td class="hits">14</td><td class="source">	modelDefinition.setId(beanName);</td></tr><tr class="hit"><td class="line">612</td><td class="hits">14</td><td class="source">	modelDefinition.setMid(modelId);</td></tr><tr class="hit"><td class="line">613</td><td class="hits">14</td><td class="source">	modelDefinition.setTable(table);</td></tr><tr class="hit"><td class="line">614</td><td class="hits">14</td><td class="source">	modelDefinition.setPrefix(prefix);</td></tr><tr class="hit"><td class="line">615</td><td class="hits">14</td><td class="source">	modelDefinition.setFields(resolvedAttributes['fields']);</td></tr><tr class="hit"><td class="line">616</td><td class="hits">14</td><td class="source">	modelDefinition.setBalance(resolvedAttributes['balance']);</td></tr><tr class="hit"><td class="line">617</td><td class="hits">14</td><td class="source">	modelDefinition.setRefFields(resolvedAttributes['refFields']);</td></tr><tr class="hit"><td class="line">618</td><td class="hits">14</td><td class="source">	modelDefinition.setOneToMany(resolvedAttributes['oneToMany']);</td></tr><tr><td class="line">619</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">620</td><td class="hits">14</td><td class="source">	if (Utils.isNotNull(table)) {</td></tr><tr class="hit"><td class="line">621</td><td class="hits">8</td><td class="source">		this.setTableModelMap(table, modelDefinition);</td></tr><tr><td class="line">622</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">623</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">624</td><td class="hits">14</td><td class="source">	this.modelMap[modelId] = modelDefinition;</td></tr><tr><td class="line">625</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">626</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">627</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">628</td><td class="hits"></td><td class="source"> * BeanFactory register constraint through metaObject into BeanFactory.</td></tr><tr><td class="line">629</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">630</td><td class="hits"></td><td class="source"> * @param  {String} beanName bean id</td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source"> * @param  {String} cid      constraint id</td></tr><tr><td class="line">632</td><td class="hits"></td><td class="source"> * @param  {Object} metaObject</td></tr><tr><td class="line">633</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">634</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">635</td><td class="hits">1</td><td class="source">BeanFactory.prototype.registerConstraint = function(beanName, cid, metaObject) {</td></tr><tr class="hit"><td class="line">636</td><td class="hits">358</td><td class="source">	var constraintDefinition = null;</td></tr><tr class="hit"><td class="line">637</td><td class="hits">358</td><td class="source">	constraintDefinition = this.getConstraintDefinition(cid);</td></tr><tr class="hit"><td class="line">638</td><td class="hits">358</td><td class="source">	if (!constraintDefinition) {</td></tr><tr class="hit"><td class="line">639</td><td class="hits">356</td><td class="source">		constraintDefinition = new ModelConstraint();</td></tr><tr><td class="line">640</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">641</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">642</td><td class="hits">358</td><td class="source">	var message = metaObject.message;</td></tr><tr class="hit"><td class="line">643</td><td class="hits">358</td><td class="source">	var constraint = metaObject.constraint;</td></tr><tr><td class="line">644</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">645</td><td class="hits">358</td><td class="source">	constraintDefinition.setId(beanName);</td></tr><tr class="hit"><td class="line">646</td><td class="hits">358</td><td class="source">	constraintDefinition.setCid(cid);</td></tr><tr class="hit"><td class="line">647</td><td class="hits">358</td><td class="source">	constraintDefinition.setConstraint(constraint);</td></tr><tr><td class="line">648</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">649</td><td class="hits">358</td><td class="source">	this.constraints[cid] = constraintDefinition;</td></tr><tr><td class="line">650</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">651</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">652</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">653</td><td class="hits"></td><td class="source"> * BeanFactory instantiating singletion beans in advance.</td></tr><tr><td class="line">654</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">655</td><td class="hits"></td><td class="source"> * @param  {Function} cb callback function</td></tr><tr><td class="line">656</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">657</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">658</td><td class="hits">1</td><td class="source">BeanFactory.prototype.preInstantiateSingletons = function(cb) {</td></tr><tr class="hit"><td class="line">659</td><td class="hits">61</td><td class="source">	var beanDefinitionOrderList = BeanUtil.sortBeanDefinitions(this.beanDefinitions, this);</td></tr><tr class="hit"><td class="line">660</td><td class="hits">61</td><td class="source">	var self = this;</td></tr><tr><td class="line">661</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">662</td><td class="hits">61</td><td class="source">	var index = 0;</td></tr><tr class="hit"><td class="line">663</td><td class="hits">61</td><td class="source">	var next = function(err) {</td></tr><tr class="hit"><td class="line">664</td><td class="hits">210</td><td class="source">		if (err || index &gt;= beanDefinitionOrderList.length) {</td></tr><tr class="hit"><td class="line">665</td><td class="hits">61</td><td class="source">			return cb(err);</td></tr><tr><td class="line">666</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">667</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">668</td><td class="hits">149</td><td class="source">		var beanDefinition = beanDefinitionOrderList[index++];</td></tr><tr class="hit"><td class="line">669</td><td class="hits">149</td><td class="source">		var beanName = beanDefinition.getBeanName();</td></tr><tr><td class="line">670</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">671</td><td class="hits">149</td><td class="source">		if (beanDefinition.isAsyncInit()) {</td></tr><tr class="hit"><td class="line">672</td><td class="hits">2</td><td class="source">			if (!self.singletonBeanFactory.containsSingleton(beanName)) {</td></tr><tr class="hit"><td class="line">673</td><td class="hits">1</td><td class="source">				var initCb = function() {</td></tr><tr class="hit"><td class="line">674</td><td class="hits">1</td><td class="source">					next();</td></tr><tr><td class="line">675</td><td class="hits"></td><td class="source">				}</td></tr><tr class="hit"><td class="line">676</td><td class="hits">1</td><td class="source">				self.setInitCb(beanName, initCb);</td></tr><tr class="hit"><td class="line">677</td><td class="hits">1</td><td class="source">				self.getBean(beanName);</td></tr><tr><td class="line">678</td><td class="hits"></td><td class="source">			} else {</td></tr><tr class="hit"><td class="line">679</td><td class="hits">1</td><td class="source">				self.getBean(beanName);</td></tr><tr class="hit"><td class="line">680</td><td class="hits">1</td><td class="source">				next()</td></tr><tr><td class="line">681</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">682</td><td class="hits"></td><td class="source">		} else {</td></tr><tr class="hit"><td class="line">683</td><td class="hits">147</td><td class="source">			var initCb = function() {}</td></tr><tr class="hit"><td class="line">684</td><td class="hits">147</td><td class="source">			self.setInitCb(beanName, initCb);</td></tr><tr class="hit"><td class="line">685</td><td class="hits">147</td><td class="source">			self.getBean(beanName);</td></tr><tr class="hit"><td class="line">686</td><td class="hits">147</td><td class="source">			next();</td></tr><tr><td class="line">687</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">688</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">689</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">690</td><td class="hits">61</td><td class="source">	next();</td></tr><tr><td class="line">691</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">692</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">693</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">694</td><td class="hits"></td><td class="source"> * BeanFactory add beanPostProcessor to BeanFactory.</td></tr><tr><td class="line">695</td><td class="hits"></td><td class="source"> * @param  {Object} beanPostProcessor</td></tr><tr><td class="line">696</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">697</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">698</td><td class="hits">1</td><td class="source">BeanFactory.prototype.addBeanPostProcessor = function(beanPostProcessor) {</td></tr><tr class="hit"><td class="line">699</td><td class="hits">61</td><td class="source">	this.beanPostProcessors.push(beanPostProcessor);</td></tr><tr><td class="line">700</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">701</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">702</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source"> * BeanFactory get beanPostProcessors.</td></tr><tr><td class="line">704</td><td class="hits"></td><td class="source"> * @return {Object} beanPostProcessors</td></tr><tr><td class="line">705</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">706</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">707</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getBeanPostProcessors = function() {</td></tr><tr class="hit"><td class="line">708</td><td class="hits">326</td><td class="source">	return this.beanPostProcessors;</td></tr><tr><td class="line">709</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">710</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">711</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">712</td><td class="hits"></td><td class="source"> * BeanFactory apply beanPostBeforeProcessors.</td></tr><tr><td class="line">713</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject</td></tr><tr><td class="line">714</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">715</td><td class="hits"></td><td class="source"> * @return {Object} beanObject</td></tr><tr><td class="line">716</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">717</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">718</td><td class="hits">1</td><td class="source">BeanFactory.prototype.applyBeanPostProcessorsBeforeInitialization = function(beanObject, beanName) {</td></tr><tr class="hit"><td class="line">719</td><td class="hits">163</td><td class="source">	var result = beanObject;</td></tr><tr><td class="line">720</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">721</td><td class="hits">163</td><td class="source">	var beanPostProcessors = this.getBeanPostProcessors();</td></tr><tr class="hit"><td class="line">722</td><td class="hits">163</td><td class="source">	for (var i = 0; i &lt; beanPostProcessors.length; i++) {</td></tr><tr class="hit"><td class="line">723</td><td class="hits">159</td><td class="source">		var beanProcessor = beanPostProcessors[i];</td></tr><tr class="hit"><td class="line">724</td><td class="hits">159</td><td class="source">		result = beanProcessor.before(result, beanName);</td></tr><tr class="hit"><td class="line">725</td><td class="hits">159</td><td class="source">		if (!result) {</td></tr><tr class="hit"><td class="line">726</td><td class="hits">2</td><td class="source">			return result;</td></tr><tr><td class="line">727</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">728</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">729</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">730</td><td class="hits">161</td><td class="source">	return result;</td></tr><tr><td class="line">731</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">732</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">733</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">734</td><td class="hits"></td><td class="source"> * BeanFactory apply beanPostAfterProcessors.</td></tr><tr><td class="line">735</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject</td></tr><tr><td class="line">736</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">737</td><td class="hits"></td><td class="source"> * @return {Object} beanObject</td></tr><tr><td class="line">738</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">739</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">740</td><td class="hits">1</td><td class="source">BeanFactory.prototype.applyBeanPostProcessorsAfterInitialization = function(beanObject, beanName) {</td></tr><tr class="hit"><td class="line">741</td><td class="hits">163</td><td class="source">	var result = beanObject;</td></tr><tr><td class="line">742</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">743</td><td class="hits">163</td><td class="source">	var beanPostProcessors = this.getBeanPostProcessors();</td></tr><tr class="hit"><td class="line">744</td><td class="hits">163</td><td class="source">	for (var i = 0; i &lt; beanPostProcessors.length; i++) {</td></tr><tr class="hit"><td class="line">745</td><td class="hits">159</td><td class="source">		var beanProcessor = beanPostProcessors[i];</td></tr><tr class="hit"><td class="line">746</td><td class="hits">159</td><td class="source">		result = beanProcessor.after(result, beanName);</td></tr><tr class="hit"><td class="line">747</td><td class="hits">159</td><td class="source">		if (!result) {</td></tr><tr class="hit"><td class="line">748</td><td class="hits">2</td><td class="source">			return result;</td></tr><tr><td class="line">749</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">750</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">751</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">752</td><td class="hits">161</td><td class="source">	return result;</td></tr><tr><td class="line">753</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">754</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">755</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">756</td><td class="hits"></td><td class="source"> * BeanFactory destroy singletons.</td></tr><tr><td class="line">757</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">758</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">759</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">760</td><td class="hits">1</td><td class="source">BeanFactory.prototype.destroySingletons = function() {</td></tr><tr class="hit"><td class="line">761</td><td class="hits">12</td><td class="source">	var singletonNames = this.singletonBeanFactory.getSingletonNames();</td></tr><tr><td class="line">762</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">763</td><td class="hits">12</td><td class="source">	for (var i = 0; i &lt; singletonNames.length; i++) {</td></tr><tr class="hit"><td class="line">764</td><td class="hits">13</td><td class="source">		this.destroySingleton(singletonNames[i]);</td></tr><tr><td class="line">765</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">766</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">767</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">768</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">769</td><td class="hits"></td><td class="source"> * BeanFactory destroy BeanFactory.</td></tr><tr><td class="line">770</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">771</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">772</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">773</td><td class="hits">1</td><td class="source">BeanFactory.prototype.destroyBeanFactory = function() {</td></tr><tr class="hit"><td class="line">774</td><td class="hits">12</td><td class="source">	this.initCbMap = null;</td></tr><tr class="hit"><td class="line">775</td><td class="hits">12</td><td class="source">	this.beanCurMap = null;</td></tr><tr class="hit"><td class="line">776</td><td class="hits">12</td><td class="source">	this.beanFunctions = null;</td></tr><tr class="hit"><td class="line">777</td><td class="hits">12</td><td class="source">	this.beanDefinitions = null;</td></tr><tr class="hit"><td class="line">778</td><td class="hits">12</td><td class="source">	this.singletonBeanFactory = null;</td></tr><tr><td class="line">779</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">780</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">781</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">782</td><td class="hits"></td><td class="source"> * BeanFactory destroy singleton.</td></tr><tr><td class="line">783</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">784</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">785</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">786</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">787</td><td class="hits">1</td><td class="source">BeanFactory.prototype.destroySingleton = function(beanName) {</td></tr><tr class="hit"><td class="line">788</td><td class="hits">14</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr class="hit"><td class="line">789</td><td class="hits">14</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">790</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">791</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">792</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">793</td><td class="hits">13</td><td class="source">	var beanObject = this.getBean(beanName);</td></tr><tr><td class="line">794</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">795</td><td class="hits">13</td><td class="source">	this.destroyBean(beanName, beanObject);</td></tr><tr><td class="line">796</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">797</td><td class="hits">13</td><td class="source">	this.singletonBeanFactory.removeSingleton(beanName);</td></tr><tr><td class="line">798</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">799</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">800</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">801</td><td class="hits"></td><td class="source"> * BeanFactory destroy bean.</td></tr><tr><td class="line">802</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">803</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">804</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject</td></tr><tr><td class="line">805</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">806</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">807</td><td class="hits">1</td><td class="source">BeanFactory.prototype.destroyBean = function(beanName, beanObject) {</td></tr><tr class="hit"><td class="line">808</td><td class="hits">14</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr class="hit"><td class="line">809</td><td class="hits">14</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">810</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">811</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">812</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">813</td><td class="hits">13</td><td class="source">	var destroyMethodName = beanDefinition.getDestroyMethodName();</td></tr><tr><td class="line">814</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">815</td><td class="hits">13</td><td class="source">	var destroyMethod = beanObject[destroyMethodName];</td></tr><tr class="hit"><td class="line">816</td><td class="hits">13</td><td class="source">	if (Utils.checkFunction(destroyMethod)) {</td></tr><tr class="hit"><td class="line">817</td><td class="hits">1</td><td class="source">		destroyMethod.call(beanObject);</td></tr><tr><td class="line">818</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">819</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">820</td><td class="hits">13</td><td class="source">	this.removeFunction(beanName);</td></tr><tr class="hit"><td class="line">821</td><td class="hits">13</td><td class="source">	this.removeBeanDefinition(beanName);</td></tr><tr><td class="line">822</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">823</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">824</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">825</td><td class="hits"></td><td class="source"> * BeanFactory check bean is a singleton or not.</td></tr><tr><td class="line">826</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">827</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">828</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">829</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">830</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">831</td><td class="hits">1</td><td class="source">BeanFactory.prototype.isSingleton = function(beanName) {</td></tr><tr class="hit"><td class="line">832</td><td class="hits">2</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr class="hit"><td class="line">833</td><td class="hits">2</td><td class="source">	if (beanDefinition) {</td></tr><tr class="hit"><td class="line">834</td><td class="hits">1</td><td class="source">		return beanDefinition.isSingleton();</td></tr><tr><td class="line">835</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">836</td><td class="hits">1</td><td class="source">		return false;</td></tr><tr><td class="line">837</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">838</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">839</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">840</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">841</td><td class="hits"></td><td class="source"> * BeanFactory check bean is a prototype or not.</td></tr><tr><td class="line">842</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">843</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">844</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">845</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">846</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">847</td><td class="hits">1</td><td class="source">BeanFactory.prototype.isPrototype = function(beanName) {</td></tr><tr class="hit"><td class="line">848</td><td class="hits">2</td><td class="source">	var beanDefinition = this.getBeanDefinition(beanName);</td></tr><tr class="hit"><td class="line">849</td><td class="hits">2</td><td class="source">	if (beanDefinition) {</td></tr><tr class="hit"><td class="line">850</td><td class="hits">1</td><td class="source">		return beanDefinition.isPrototype();</td></tr><tr><td class="line">851</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">852</td><td class="hits">1</td><td class="source">		return false;</td></tr><tr><td class="line">853</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">854</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">855</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">856</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">857</td><td class="hits"></td><td class="source"> * BeanFactory check BeanFactory contains bean or not.</td></tr><tr><td class="line">858</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">859</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">860</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">861</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">862</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">863</td><td class="hits">1</td><td class="source">BeanFactory.prototype.containsBean = function(beanName) {</td></tr><tr class="hit"><td class="line">864</td><td class="hits">1</td><td class="source">	return !!this.getBeanFunction(beanName) &amp;&amp; !!this.getBeanDefinition(beanName);</td></tr><tr><td class="line">865</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">866</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">867</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">868</td><td class="hits"></td><td class="source"> * BeanFactory get bean contructor function.</td></tr><tr><td class="line">869</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">870</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">871</td><td class="hits"></td><td class="source"> * @return {Function} bean constructor function</td></tr><tr><td class="line">872</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">873</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">874</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getBeanFunction = function(beanName) {</td></tr><tr class="hit"><td class="line">875</td><td class="hits">711</td><td class="source">	return this.beanFunctions[beanName];</td></tr><tr><td class="line">876</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">877</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">878</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">879</td><td class="hits"></td><td class="source"> * BeanFactory set bean contructor function.</td></tr><tr><td class="line">880</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">881</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">882</td><td class="hits"></td><td class="source"> * @param  {Function} func bean constructor function</td></tr><tr><td class="line">883</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">884</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">885</td><td class="hits">1</td><td class="source">BeanFactory.prototype.setBeanFunction = function(beanName, func) {</td></tr><tr class="hit"><td class="line">886</td><td class="hits">528</td><td class="source">	this.beanFunctions[beanName] = func;</td></tr><tr><td class="line">887</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">888</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">889</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">890</td><td class="hits"></td><td class="source"> * BeanFactory remove bean contructor function from BeanFactory.</td></tr><tr><td class="line">891</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">892</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">893</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">894</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">895</td><td class="hits">1</td><td class="source">BeanFactory.prototype.removeFunction = function(beanName) {</td></tr><tr class="hit"><td class="line">896</td><td class="hits">13</td><td class="source">	delete this.beanFunctions[beanName];</td></tr><tr><td class="line">897</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">898</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">899</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">900</td><td class="hits"></td><td class="source"> * BeanFactory get init method.</td></tr><tr><td class="line">901</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">902</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">903</td><td class="hits"></td><td class="source"> * @return {Function} bean init method</td></tr><tr><td class="line">904</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">905</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">906</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getInitCb = function(beanName) {</td></tr><tr class="hit"><td class="line">907</td><td class="hits">163</td><td class="source">	if (!this.initCbMap[beanName]) {</td></tr><tr class="hit"><td class="line">908</td><td class="hits">27</td><td class="source">		this.initCbMap[beanName] = Constant.INIT_CB_DEFAULT;</td></tr><tr><td class="line">909</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">910</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">911</td><td class="hits">163</td><td class="source">	return this.initCbMap[beanName];</td></tr><tr><td class="line">912</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">913</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">914</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">915</td><td class="hits"></td><td class="source"> * BeanFactory set init method.</td></tr><tr><td class="line">916</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">917</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">918</td><td class="hits"></td><td class="source"> * @param  {Function} initCb bean init method</td></tr><tr><td class="line">919</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">920</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">921</td><td class="hits">1</td><td class="source">BeanFactory.prototype.setInitCb = function(beanName, initCb) {</td></tr><tr class="hit"><td class="line">922</td><td class="hits">148</td><td class="source">	this.initCbMap[beanName] = initCb;</td></tr><tr><td class="line">923</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">924</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">925</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">926</td><td class="hits"></td><td class="source"> * BeanFactory get beanDefinition.</td></tr><tr><td class="line">927</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">928</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">929</td><td class="hits"></td><td class="source"> * @return {Object} beanDefinition</td></tr><tr><td class="line">930</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">931</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">932</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getBeanDefinition = function(beanName) {</td></tr><tr class="hit"><td class="line">933</td><td class="hits">2309</td><td class="source">	return this.beanDefinitions[beanName];</td></tr><tr><td class="line">934</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">935</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">936</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">937</td><td class="hits"></td><td class="source"> * BeanFactory get beanDefinitions.</td></tr><tr><td class="line">938</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">939</td><td class="hits"></td><td class="source"> * @return {Object} beanDefinitions</td></tr><tr><td class="line">940</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">941</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">942</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getBeanDefinitions = function() {</td></tr><tr class="hit"><td class="line">943</td><td class="hits">2</td><td class="source">	return this.beanDefinitions;</td></tr><tr><td class="line">944</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">945</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">946</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">947</td><td class="hits"></td><td class="source"> * BeanFactory remove beanDefinition from BeanFactory.</td></tr><tr><td class="line">948</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">949</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">950</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">951</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">952</td><td class="hits">1</td><td class="source">BeanFactory.prototype.removeBeanDefinition = function(beanName) {</td></tr><tr class="hit"><td class="line">953</td><td class="hits">14</td><td class="source">	delete this.beanDefinitions[beanName];</td></tr><tr><td class="line">954</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">955</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">956</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">957</td><td class="hits"></td><td class="source"> * BeanFactory check BeanFactory contains beanName beanDefinition or not.</td></tr><tr><td class="line">958</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">959</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">960</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">961</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">962</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">963</td><td class="hits">1</td><td class="source">BeanFactory.prototype.containsBeanDefinition = function(beanName) {</td></tr><tr class="hit"><td class="line">964</td><td class="hits">2</td><td class="source">	return !!this.getBeanDefinition(beanName);</td></tr><tr><td class="line">965</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">966</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">967</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">968</td><td class="hits"></td><td class="source"> * BeanFactory get aspects.</td></tr><tr><td class="line">969</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">970</td><td class="hits"></td><td class="source"> * @return {Array} aspects</td></tr><tr><td class="line">971</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">972</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">973</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getAspects = function() {</td></tr><tr class="hit"><td class="line">974</td><td class="hits">119</td><td class="source">	return this.aspects;</td></tr><tr><td class="line">975</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">976</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">977</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">978</td><td class="hits"></td><td class="source"> * BeanFactory get modelDefinition.</td></tr><tr><td class="line">979</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">980</td><td class="hits"></td><td class="source"> * @param  {String} modelId</td></tr><tr><td class="line">981</td><td class="hits"></td><td class="source"> * @return {Object} modelDefinition</td></tr><tr><td class="line">982</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">983</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">984</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getModelDefinition = function(modelId) {</td></tr><tr class="hit"><td class="line">985</td><td class="hits">33</td><td class="source">	return this.modelMap[modelId];</td></tr><tr><td class="line">986</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">987</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">988</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">989</td><td class="hits"></td><td class="source"> * BeanFactory get modelDefinitions.</td></tr><tr><td class="line">990</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">991</td><td class="hits"></td><td class="source"> * @return {Object} modelDefinition map</td></tr><tr><td class="line">992</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">993</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">994</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getModelDefinitions = function() {</td></tr><tr class="hit"><td class="line">995</td><td class="hits">66</td><td class="source">	return this.modelMap;</td></tr><tr><td class="line">996</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">997</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">998</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">999</td><td class="hits"></td><td class="source"> * BeanFactory get getConstraintDefinition.</td></tr><tr><td class="line">1000</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1001</td><td class="hits"></td><td class="source"> * @param  {String} cid</td></tr><tr><td class="line">1002</td><td class="hits"></td><td class="source"> * @return {Object} getConstraintDefinition</td></tr><tr><td class="line">1003</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1004</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1005</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getConstraintDefinition = function(cid) {</td></tr><tr class="hit"><td class="line">1006</td><td class="hits">400</td><td class="source">	return this.constraints[cid];</td></tr><tr><td class="line">1007</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1008</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1009</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1010</td><td class="hits"></td><td class="source"> * BeanFactory set table model map.</td></tr><tr><td class="line">1011</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1012</td><td class="hits"></td><td class="source"> * @param  {String} table name</td></tr><tr><td class="line">1013</td><td class="hits"></td><td class="source"> * @param  {Object} modelDefinition</td></tr><tr><td class="line">1014</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1015</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1016</td><td class="hits">1</td><td class="source">BeanFactory.prototype.setTableModelMap = function(table, modelDefinition) {</td></tr><tr class="hit"><td class="line">1017</td><td class="hits">8</td><td class="source">	this.tableModelMap[table] = modelDefinition;</td></tr><tr><td class="line">1018</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1019</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1020</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1021</td><td class="hits"></td><td class="source"> * BeanFactory get modelDefinition by table.</td></tr><tr><td class="line">1022</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1023</td><td class="hits"></td><td class="source"> * @param   {String} table name</td></tr><tr><td class="line">1024</td><td class="hits"></td><td class="source"> * @return  {Object} modelDefinition</td></tr><tr><td class="line">1025</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1026</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1027</td><td class="hits">1</td><td class="source">BeanFactory.prototype.getModelDefinitionByTable = function(table) {</td></tr><tr class="miss"><td class="line">1028</td><td class="hits">0</td><td class="source">	return this.tableModelMap[table];</td></tr><tr><td class="line">1029</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1030</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1031</td><td class="hits">1</td><td class="source">module.exports = BeanFactory;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/moduleFactory.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/moduleFactory.js</h2><div id="stats" class="terrible"><div class="percentage">23%</div><div class="sloc">21</div><div class="hits">5</div><div class="misses">16</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'ModuleFactory');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var ModuleFactory = function() {</td></tr><tr class="miss"><td class="line">4</td><td class="hits">0</td><td class="source">	this.factoryMap = {};</td></tr><tr class="miss"><td class="line">5</td><td class="hits">0</td><td class="source">	this.moduleMap = {};</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">ModuleFactory.prototype.define = function(id, factory) {</td></tr><tr class="miss"><td class="line">9</td><td class="hits">0</td><td class="source">	if (this.factoryMap[id]) {</td></tr><tr class="miss"><td class="line">10</td><td class="hits">0</td><td class="source">		logger.warn('module %s has been registered ...', id);</td></tr><tr class="miss"><td class="line">11</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">14</td><td class="hits">0</td><td class="source">	this.factoryMap[id] = factory;</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">ModuleFactory.prototype.require = function(id) {</td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">	if (!this.moduleMap[id]) {</td></tr><tr class="miss"><td class="line">19</td><td class="hits">0</td><td class="source">		var exports = {};</td></tr><tr class="miss"><td class="line">20</td><td class="hits">0</td><td class="source">		var factory = this.factoryMap[id];</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">22</td><td class="hits">0</td><td class="source">		if (!factory) {</td></tr><tr class="miss"><td class="line">23</td><td class="hits">0</td><td class="source">			logger.warn('require file %s not exists ...', id);</td></tr><tr class="miss"><td class="line">24</td><td class="hits">0</td><td class="source">			return;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">27</td><td class="hits">0</td><td class="source">		var module = {</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">			exports: {}</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">31</td><td class="hits">0</td><td class="source">		factory(module.exports, module);</td></tr><tr class="miss"><td class="line">32</td><td class="hits">0</td><td class="source">		this.moduleMap[id] = module.exports;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">35</td><td class="hits">0</td><td class="source">	return this.moduleMap[id];</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">module.exports = ModuleFactory;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/singletonBeanFactory.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/singletonBeanFactory.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">24</div><div class="hits">24</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat SingletonBeanFactory</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'SingletonBeanFactory');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * SingletonBeanFactory constructor function.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var SingletonBeanFactory = function(beanFactory) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">66</td><td class="source">	this.beanFactory = beanFactory;</td></tr><tr class="hit"><td class="line">23</td><td class="hits">66</td><td class="source">	this.singletonObjects = {};</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * SingletonBeanFactory add singleton to SingletonBeanFactory.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @param  {Object} beanObject</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">SingletonBeanFactory.prototype.addSingleton = function(beanName, beanObject) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">149</td><td class="source">	this.singletonObjects[beanName] = beanObject;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * SingletonBeanFactory check SingletonBeanFactory contains singleton or not.</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">SingletonBeanFactory.prototype.containsSingleton = function(beanName) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">3</td><td class="source">	return !!this.singletonObjects[beanName];</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * SingletonBeanFactory get singleton from SingletonBeanFactory.</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @return {Object} singletonObject</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">SingletonBeanFactory.prototype.getSingleton = function(beanName) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">305</td><td class="source">	var beanFactory = this.beanFactory;</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">305</td><td class="source">	var bean = this.singletonObjects[beanName];</td></tr><tr class="hit"><td class="line">59</td><td class="hits">305</td><td class="source">	if (bean) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">156</td><td class="source">		return bean;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">149</td><td class="source">		bean = beanFactory.createBean.apply(beanFactory, arguments);</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">149</td><td class="source">	this.addSingleton(beanName, bean);</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">67</td><td class="hits">149</td><td class="source">	return bean;</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * SingletonBeanFactory get all singleton names from SingletonBeanFactory.</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">75</td><td class="hits">1</td><td class="source">SingletonBeanFactory.prototype.getSingletonNames = function() {</td></tr><tr class="hit"><td class="line">76</td><td class="hits">12</td><td class="source">	var r = [];</td></tr><tr class="hit"><td class="line">77</td><td class="hits">12</td><td class="source">	for (var name in this.singletonObjects) {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">13</td><td class="source">		r.push(name);</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">81</td><td class="hits">12</td><td class="source">	return r;</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * SingletonBeanFactory remove singleton from SingletonBeanFactory.</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">90</td><td class="hits">1</td><td class="source">SingletonBeanFactory.prototype.removeSingleton = function(beanName) {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">13</td><td class="source">	delete this.singletonObjects[beanName];</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">94</td><td class="hits">1</td><td class="source">module.exports = SingletonBeanFactory;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanDefinition.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanDefinition.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">174</div><div class="hits">174</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat BeanDefinition</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Constant = require('../../util/constant');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var BeanUtils = require('../../util/beanUtil');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * BeanDefinition constructor function.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var BeanDefinition = function() {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">533</td><td class="source">	this.argsOn = [];</td></tr><tr class="hit"><td class="line">25</td><td class="hits">533</td><td class="source">	this.propsOn = [];</td></tr><tr class="hit"><td class="line">26</td><td class="hits">533</td><td class="source">	this.func = null;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">533</td><td class="source">	this.order = null;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">533</td><td class="source">	this.proxy = true;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">533</td><td class="source">	this.aspect = false;</td></tr><tr class="hit"><td class="line">30</td><td class="hits">533</td><td class="source">	this.abstract = false;</td></tr><tr class="hit"><td class="line">31</td><td class="hits">533</td><td class="source">	this.lazyInit = false;</td></tr><tr class="hit"><td class="line">32</td><td class="hits">533</td><td class="source">	this.asyncInit = false;</td></tr><tr class="hit"><td class="line">33</td><td class="hits">533</td><td class="source">	this.parentName = null;</td></tr><tr class="hit"><td class="line">34</td><td class="hits">533</td><td class="source">	this.parentBean = null;</td></tr><tr class="hit"><td class="line">35</td><td class="hits">533</td><td class="source">	this.beanName = null;</td></tr><tr class="hit"><td class="line">36</td><td class="hits">533</td><td class="source">	this.factoryArgsOn = {};</td></tr><tr class="hit"><td class="line">37</td><td class="hits">533</td><td class="source">	this.factoryBeanName = null;</td></tr><tr class="hit"><td class="line">38</td><td class="hits">533</td><td class="source">	this.factoryMethodName = null;</td></tr><tr class="hit"><td class="line">39</td><td class="hits">533</td><td class="source">	this.initMethodName = null;</td></tr><tr class="hit"><td class="line">40</td><td class="hits">533</td><td class="source">	this.destroyMethodName = null;</td></tr><tr class="hit"><td class="line">41</td><td class="hits">533</td><td class="source">	this.scope = Constant.SCOPE_DEFAULT;</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * BeanDefinition get parentName.</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * @return  {String} parentName</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">50</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getParentName = function() {</td></tr><tr class="hit"><td class="line">51</td><td class="hits">488</td><td class="source">	return this.parentName;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * BeanDefinition set parentName.</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @param  {String} parentName</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setParentName = function(parentName) {</td></tr><tr class="hit"><td class="line">61</td><td class="hits">535</td><td class="source">	if (!parentName) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">531</td><td class="source">		return;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">64</td><td class="hits">4</td><td class="source">	this.parentName = parentName;</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * BeanDefinition check whether has parent bean.</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.hasParentBean = function() {</td></tr><tr class="hit"><td class="line">74</td><td class="hits">468</td><td class="source">	return this.getParentName() &amp;&amp; !this.getParentBean();</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * BeanDefinition get parent bean.</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @return  {Object} parent bean</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getParentBean = function() {</td></tr><tr class="hit"><td class="line">84</td><td class="hits">8</td><td class="source">	return this.parentBean;</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * BeanDefinition set parent bean.</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> * @param  {Object} parentBean parent bean</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setParentBean = function(parentBean) {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">6</td><td class="source">	if (!parentBean) {</td></tr><tr class="hit"><td class="line">95</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">97</td><td class="hits">5</td><td class="source">	this.parentBean = parentBean;</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * BeanDefinition get beanName.</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> * @return  {String} beanName</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">106</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getBeanName = function() {</td></tr><tr class="hit"><td class="line">107</td><td class="hits">172</td><td class="source">	return this.beanName;</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> * BeanDefinition set beanName.</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">116</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setBeanName = function(beanName) {</td></tr><tr class="hit"><td class="line">117</td><td class="hits">538</td><td class="source">	if (!beanName) {</td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">120</td><td class="hits">537</td><td class="source">	return this.beanName = beanName;</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> * BeanDefinition get factoryBeanName.</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> * @return  {String} factoryBeanName</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">129</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getFactoryBeanName = function() {</td></tr><tr class="hit"><td class="line">130</td><td class="hits">4</td><td class="source">	if (this.factoryBeanName) {</td></tr><tr class="hit"><td class="line">131</td><td class="hits">3</td><td class="source">		return this.factoryBeanName;</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">1</td><td class="source">		if (this.parentBean) {</td></tr><tr class="hit"><td class="line">134</td><td class="hits">1</td><td class="source">			return this.parentBean.factoryBeanName;</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * BeanDefinition set factoryBeanName.</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> * @param  {String} factoryBeanName</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">145</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setFactoryBeanName = function(factoryBeanName) {</td></tr><tr class="hit"><td class="line">146</td><td class="hits">536</td><td class="source">	if (!factoryBeanName) {</td></tr><tr class="hit"><td class="line">147</td><td class="hits">533</td><td class="source">		return;</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">149</td><td class="hits">3</td><td class="source">	this.factoryBeanName = factoryBeanName;</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source"> * BeanDefinition get factoryMethodName.</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> * @return  {String} factoryMethodName</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">158</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getFactoryMethodName = function() {</td></tr><tr class="hit"><td class="line">159</td><td class="hits">4</td><td class="source">	if (this.factoryMethodName) {</td></tr><tr class="hit"><td class="line">160</td><td class="hits">3</td><td class="source">		return this.factoryMethodName;</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">162</td><td class="hits">1</td><td class="source">		if (this.parentBean) {</td></tr><tr class="hit"><td class="line">163</td><td class="hits">1</td><td class="source">			return this.parentBean.factoryMethodName;</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> * BeanDefinition set factoryMethodName.</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> * @param  {String} factoryMethodName</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">174</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setFactoryMethodName = function(factoryMethodName) {</td></tr><tr class="hit"><td class="line">175</td><td class="hits">536</td><td class="source">	if (!factoryMethodName) {</td></tr><tr class="hit"><td class="line">176</td><td class="hits">533</td><td class="source">		return;</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">178</td><td class="hits">3</td><td class="source">	this.factoryMethodName = factoryMethodName;</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> * BeanDefinition get bean scope: singleton(default), prototype.</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> * @return  {String} scope</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">187</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getScope = function() {</td></tr><tr class="hit"><td class="line">188</td><td class="hits">1</td><td class="source">	return this.scope;</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> * BeanDefinition set bean scope: singleton(default), prototype.</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> * @param  {String} scope</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">197</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setScope = function(scope) {</td></tr><tr class="hit"><td class="line">198</td><td class="hits">537</td><td class="source">	if (!scope) {</td></tr><tr class="hit"><td class="line">199</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">201</td><td class="hits">536</td><td class="source">	this.scope = scope;</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source"> * BeanDefinition check whether is abstract.</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">210</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.isAbstract = function() {</td></tr><tr class="hit"><td class="line">211</td><td class="hits">470</td><td class="source">	return this.abstract;</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> * BeanDefinition set abstract.</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> * @param  {Boolean} lazyInit true|false</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">220</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setAbstract = function(abstract) {</td></tr><tr class="hit"><td class="line">221</td><td class="hits">535</td><td class="source">	if (Utils.isNotNull(abstract)) {</td></tr><tr class="hit"><td class="line">222</td><td class="hits">535</td><td class="source">		this.abstract = abstract;</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source"> * BeanDefinition check whether is lazyInit.</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">232</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.isLazyInit = function() {</td></tr><tr class="hit"><td class="line">233</td><td class="hits">517</td><td class="source">	if (this.lazyInit) {</td></tr><tr class="hit"><td class="line">234</td><td class="hits">366</td><td class="source">		return this.lazyInit;</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">236</td><td class="hits">151</td><td class="source">		if (this.parentBean) {</td></tr><tr class="hit"><td class="line">237</td><td class="hits">1</td><td class="source">			return this.parentBean.lazyInit;</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> * BeanDefinition  set lazyInit.</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> * @param  {Boolean} lazyInit true|false</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">248</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setLazyInit = function(lazyInit) {</td></tr><tr class="hit"><td class="line">249</td><td class="hits">536</td><td class="source">	if (Utils.isNotNull(lazyInit)) {</td></tr><tr class="hit"><td class="line">250</td><td class="hits">536</td><td class="source">		this.lazyInit = lazyInit;</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source"> * BeanDefinition check whether need to be proxied or not.</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">260</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.needProxy = function() {</td></tr><tr class="hit"><td class="line">261</td><td class="hits">160</td><td class="source">	return this.proxy;</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source"> * BeanDefinition set bean need proxy or not.</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source"> * @param  {Boolean} proxy true|false</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">270</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setProxy = function(proxy) {</td></tr><tr class="hit"><td class="line">271</td><td class="hits">536</td><td class="source">	if (Utils.isNotNull(proxy)) {</td></tr><tr class="hit"><td class="line">272</td><td class="hits">536</td><td class="source">		this.proxy = proxy;</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source"> * BeanDefinition check whether is asyncInit.</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">282</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.isAsyncInit = function() {</td></tr><tr class="hit"><td class="line">283</td><td class="hits">149</td><td class="source">	if (this.asyncInit) {</td></tr><tr class="hit"><td class="line">284</td><td class="hits">2</td><td class="source">		return this.asyncInit;</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">286</td><td class="hits">147</td><td class="source">		if (this.parentBean) {</td></tr><tr class="hit"><td class="line">287</td><td class="hits">2</td><td class="source">			return this.parentBean.asyncInit;</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source"> * BeanDefinition set bean asyncInit or not.</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source"> * @param  {Boolean} asyncInit true|false</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">298</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setAsyncInit = function(asyncInit) {</td></tr><tr class="hit"><td class="line">299</td><td class="hits">535</td><td class="source">	if (Utils.isNotNull(asyncInit)) {</td></tr><tr class="hit"><td class="line">300</td><td class="hits">535</td><td class="source">		this.asyncInit = asyncInit;</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source"> * BeanDefinition set bean an aspect or not.</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> * @param  {Boolean} aspect true|false</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">310</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setAspect = function(aspect) {</td></tr><tr class="hit"><td class="line">311</td><td class="hits">20</td><td class="source">	if (Utils.isNotNull(aspect)) {</td></tr><tr class="hit"><td class="line">312</td><td class="hits">20</td><td class="source">		this.aspect = aspect;</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> * BeanDefinition check whether is a aspect.</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source"> * an aspect do not need to be proxied</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">323</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.isAspect = function() {</td></tr><tr class="hit"><td class="line">324</td><td class="hits">445</td><td class="source">	if (this.aspect) {</td></tr><tr class="hit"><td class="line">325</td><td class="hits">80</td><td class="source">		return this.aspect;</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">327</td><td class="hits">365</td><td class="source">		if (this.parentBean) {</td></tr><tr class="hit"><td class="line">328</td><td class="hits">7</td><td class="source">			return this.parentBean.aspect;</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source"> * BeanDefinition get bean props settings.</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source"> * @return  {Array} props settings</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">339</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getProps = function() {</td></tr><tr class="hit"><td class="line">340</td><td class="hits">20</td><td class="source">	return this.propsOn;</td></tr><tr><td class="line">341</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source"> * BeanDefinition get bean props settings.</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source"> * @return  {Array} props settings</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">349</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getPropsOn = function() {</td></tr><tr class="hit"><td class="line">350</td><td class="hits">163</td><td class="source">	return this.propsOn;</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source"> * BeanDefinition set bean props settings.</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source"> * @param  {Array} propsOn props settings</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">359</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setPropsOn = function(propsOn) {</td></tr><tr class="hit"><td class="line">360</td><td class="hits">539</td><td class="source">	if (!propsOn || !Utils.checkArray(propsOn) || !propsOn.length) {</td></tr><tr class="hit"><td class="line">361</td><td class="hits">513</td><td class="source">		return;</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">363</td><td class="hits">26</td><td class="source">	this.updateSettingsOn(this, Constant.SETTINGS_PROPS_ON, propsOn);</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source"> * BeanDefinition get bean args settings.</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source"> * @return  {Array} args settings</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">372</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getArgs = function() {</td></tr><tr class="hit"><td class="line">373</td><td class="hits">20</td><td class="source">	return this.argsOn;</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source"> * BeanDefinition get bean args settings.</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">379</td><td class="hits"></td><td class="source"> * @return  {Array} args settings</td></tr><tr><td class="line">380</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">382</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getArgsOn = function() {</td></tr><tr class="hit"><td class="line">383</td><td class="hits">161</td><td class="source">	return this.argsOn;</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source"> * BeanDefinition set bean args settings.</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> * @param  {Array} argsOn args settings</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">392</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setArgsOn = function(argsOn) {</td></tr><tr class="hit"><td class="line">393</td><td class="hits">539</td><td class="source">	if (!argsOn || !Utils.checkArray(argsOn) || !argsOn.length) {</td></tr><tr class="hit"><td class="line">394</td><td class="hits">523</td><td class="source">		return;</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">396</td><td class="hits">16</td><td class="source">	this.updateSettingsOn(this, Constant.SETTINGS_ARGS_ON, argsOn);</td></tr><tr><td class="line">397</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source"> * BeanDefinition get bean factory args settings.</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source"> * @return  {Array} factory args settings</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">405</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getFactoryArgs = function() {</td></tr><tr class="hit"><td class="line">406</td><td class="hits">4</td><td class="source">	return this.factoryArgsOn;</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source"> * BeanDefinition get bean factory args settings.</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source"> * @return  {Array} factory args settings</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">415</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getFactoryArgsOn = function() {</td></tr><tr class="hit"><td class="line">416</td><td class="hits">3</td><td class="source">	return this.factoryArgsOn;</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source"> * BeanDefinition set factory args settings.</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source"> * @param  {Array} factoryArgsOn factory args settings</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">425</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setFactoryArgsOn = function(factoryArgsOn) {</td></tr><tr class="hit"><td class="line">426</td><td class="hits">540</td><td class="source">	if (!factoryArgsOn || !Utils.checkArray(factoryArgsOn) || !factoryArgsOn.length) {</td></tr><tr class="hit"><td class="line">427</td><td class="hits">539</td><td class="source">		return;</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">429</td><td class="hits">1</td><td class="source">	this.updateSettingsOn(this, Constant.SETTINGS_FACTORY_ARGS_ON, factoryArgsOn);</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">433</td><td class="hits"></td><td class="source"> * BeanDefinition get bean init method name.</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source"> * @return  {String} bean init method name</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">438</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getInitMethodName = function() {</td></tr><tr class="hit"><td class="line">439</td><td class="hits">6</td><td class="source">	if (this.initMethodName) {</td></tr><tr class="hit"><td class="line">440</td><td class="hits">5</td><td class="source">		return this.initMethodName;</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">442</td><td class="hits">1</td><td class="source">		if (this.parentBean) {</td></tr><tr class="hit"><td class="line">443</td><td class="hits">1</td><td class="source">			return this.parentBean.initMethodName;</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source"> * BeanDefinition set bean init method name.</td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source"> * @param  {String} initMethodName bean init method name</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">454</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setInitMethodName = function(initMethodName) {</td></tr><tr class="hit"><td class="line">455</td><td class="hits">536</td><td class="source">	if (!initMethodName) {</td></tr><tr class="hit"><td class="line">456</td><td class="hits">530</td><td class="source">		return;</td></tr><tr><td class="line">457</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">458</td><td class="hits">6</td><td class="source">	this.initMethodName = initMethodName;</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source"> * BeanDefinition get bean destroy method name.</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source"> * @return  {String} bean destroy method name</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">467</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getDestroyMethodName = function() {</td></tr><tr class="hit"><td class="line">468</td><td class="hits">14</td><td class="source">	if (this.destroyMethodName) {</td></tr><tr class="hit"><td class="line">469</td><td class="hits">1</td><td class="source">		return this.destroyMethodName;</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">471</td><td class="hits">13</td><td class="source">		if (this.parentBean) {</td></tr><tr class="hit"><td class="line">472</td><td class="hits">1</td><td class="source">			return this.parentBean.destroyMethodName;</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source"> * BeanDefinition set bean destroy method name.</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source"> * @param  {String} destroyMethodName bean destroy method name</td></tr><tr><td class="line">481</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">483</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setDestroyMethodName = function(destroyMethodName) {</td></tr><tr class="hit"><td class="line">484</td><td class="hits">536</td><td class="source">	if (!destroyMethodName) {</td></tr><tr class="hit"><td class="line">485</td><td class="hits">534</td><td class="source">		return;</td></tr><tr><td class="line">486</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">487</td><td class="hits">2</td><td class="source">	this.destroyMethodName = destroyMethodName;</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">490</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">491</td><td class="hits"></td><td class="source"> * BeanDefinition get bean constructor function.</td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source"> * @return  {Function} bean constructor function</td></tr><tr><td class="line">494</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">495</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">496</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getFunc = function() {</td></tr><tr class="hit"><td class="line">497</td><td class="hits">375</td><td class="source">	return this.func;</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source"> * BeanDefinition set bean constructor function.</td></tr><tr><td class="line">502</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source"> * @param  {Function} func bean constructor function</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">505</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">506</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setFunc = function(func) {</td></tr><tr class="hit"><td class="line">507</td><td class="hits">535</td><td class="source">	if (!this.func) {</td></tr><tr class="hit"><td class="line">508</td><td class="hits">528</td><td class="source">		this.func = func;</td></tr><tr><td class="line">509</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">512</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">513</td><td class="hits"></td><td class="source"> * BeanDefinition get bean order.</td></tr><tr><td class="line">514</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source"> * @return  {Number} bean order</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">517</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">518</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.getOrder = function() {</td></tr><tr class="hit"><td class="line">519</td><td class="hits">130</td><td class="source">	if (this.order || this.order == 0) {</td></tr><tr class="hit"><td class="line">520</td><td class="hits">27</td><td class="source">		return this.order;</td></tr><tr><td class="line">521</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">522</td><td class="hits">103</td><td class="source">		if (this.parentBean) {</td></tr><tr class="hit"><td class="line">523</td><td class="hits">4</td><td class="source">			return this.parentBean.order;</td></tr><tr><td class="line">524</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">525</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">526</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">527</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">528</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">529</td><td class="hits"></td><td class="source"> * BeanDefinition set bean order.</td></tr><tr><td class="line">530</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">531</td><td class="hits"></td><td class="source"> * @param  {Number} order bean order</td></tr><tr><td class="line">532</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">533</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">534</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.setOrder = function(order) {</td></tr><tr class="hit"><td class="line">535</td><td class="hits">535</td><td class="source">	if (Utils.isNotNull(order)) {</td></tr><tr class="hit"><td class="line">536</td><td class="hits">8</td><td class="source">		this.order = order;</td></tr><tr><td class="line">537</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">538</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">539</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">540</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">541</td><td class="hits"></td><td class="source"> * BeanDefinition check bean whether is singleton or not.</td></tr><tr><td class="line">542</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">543</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">544</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">545</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">546</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.isSingleton = function() {</td></tr><tr class="hit"><td class="line">547</td><td class="hits">862</td><td class="source">	return this.scope === Constant.SCOPE_SINGLETON;</td></tr><tr><td class="line">548</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">549</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">550</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">551</td><td class="hits"></td><td class="source"> * BeanDefinition check bean whether is prototype or not.</td></tr><tr><td class="line">552</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">553</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">554</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">555</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">556</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.isPrototype = function() {</td></tr><tr class="hit"><td class="line">557</td><td class="hits">16</td><td class="source">	return this.scope === Constant.SCOPE_PROTOTYPE;</td></tr><tr><td class="line">558</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">560</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">561</td><td class="hits"></td><td class="source"> * BeanDefinition check bean whether has factoryBean or not.</td></tr><tr><td class="line">562</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">564</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">565</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">566</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.hasFactoryBean = function() {</td></tr><tr class="hit"><td class="line">567</td><td class="hits">164</td><td class="source">	return Utils.isNotNull(this.factoryBeanName) &amp;&amp; Utils.isNotNull(this.factoryMethodName);</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">569</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">570</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">571</td><td class="hits"></td><td class="source"> * BeanDefinition check bean whether has initMethod or not.</td></tr><tr><td class="line">572</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">573</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">574</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">575</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">576</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.hasInitMethod = function() {</td></tr><tr class="hit"><td class="line">577</td><td class="hits">163</td><td class="source">	return Utils.isNotNull(this.initMethodName);</td></tr><tr><td class="line">578</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">579</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">580</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source"> * BeanDefinition check bean whether has parent or not.</td></tr><tr><td class="line">582</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">583</td><td class="hits"></td><td class="source"> * @return  {Boolean} true|false</td></tr><tr><td class="line">584</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">585</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">586</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.hasParent = function() {</td></tr><tr class="hit"><td class="line">587</td><td class="hits">1</td><td class="source">	return Utils.isNotNull(this.parentName);</td></tr><tr><td class="line">588</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">589</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">590</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">591</td><td class="hits"></td><td class="source"> * BeanDefinition update settings.</td></tr><tr><td class="line">592</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">593</td><td class="hits"></td><td class="source"> * @param  {Object} beanDefinition</td></tr><tr><td class="line">594</td><td class="hits"></td><td class="source"> * @param  {String} key key: propsOn, argsOn, factoryArgsOn</td></tr><tr><td class="line">595</td><td class="hits"></td><td class="source"> * @param  {Array}  settingsOn settings</td></tr><tr><td class="line">596</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">597</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">598</td><td class="hits">1</td><td class="source">BeanDefinition.prototype.updateSettingsOn = function(BeanDefinition, key, settingsOn) {</td></tr><tr class="hit"><td class="line">599</td><td class="hits">43</td><td class="source">	var settings = BeanDefinition[key];</td></tr><tr><td class="line">600</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">601</td><td class="hits">43</td><td class="source">	var settingsMap = BeanUtils.getBeanSettingsMap(settings);</td></tr><tr class="hit"><td class="line">602</td><td class="hits">43</td><td class="source">	var settingsOnMap = BeanUtils.getBeanSettingsMap(settingsOn);</td></tr><tr><td class="line">603</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">604</td><td class="hits">43</td><td class="source">	for (var name in settingsOnMap) {</td></tr><tr class="hit"><td class="line">605</td><td class="hits">71</td><td class="source">		if (!settingsMap[name]) {</td></tr><tr class="hit"><td class="line">606</td><td class="hits">60</td><td class="source">			settingsMap[name] = settingsOnMap[name];</td></tr><tr><td class="line">607</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">608</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">609</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">610</td><td class="hits">43</td><td class="source">	BeanDefinition[key] = BeanUtils.getBeanSettingsArray(settingsMap);</td></tr><tr><td class="line">611</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">612</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">613</td><td class="hits">1</td><td class="source">module.exports = BeanDefinition;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanDefinitionVisitor.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanDefinitionVisitor.js</h2><div id="stats" class="high"><div class="percentage">79%</div><div class="sloc">44</div><div class="hits">35</div><div class="misses">9</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat BeanDefinitionVisitor</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'BeanDefinitionVisitor');</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Constant = require('../../util/constant');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * BeanDefinitionVisitor constructor function.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var BeanDefinitionVisitor = function(valueResolver) {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">3</td><td class="source">	this.valueResolver = valueResolver;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * BeanDefinitionVisitor set valueResolver.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @param  {Object} valueResolver</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">BeanDefinitionVisitor.prototype.setValueResolver = function(valueResolver) {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">	this.valueResolver = valueResolver;</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * BeanDefinitionVisitor get valueResolver.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @return  {Object} valueResolver</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">BeanDefinitionVisitor.prototype.getValueResolver = function() {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">10</td><td class="source">	return this.valueResolver;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * BeanDefinitionVisitor resolve string value.</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @param  {String} strVal string value</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">BeanDefinitionVisitor.prototype.resolveStringValue = function(strVal) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">11</td><td class="source">	if (!this.valueResolver) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">		logger.error('No StringValueResolver specified');</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">10</td><td class="source">	var resolvedValue = this.getValueResolver().resolveStringValue(strVal);</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">10</td><td class="source">	return resolvedValue;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * BeanDefinitionVisitor visit beanDefinition.</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @param  {Object} beanDefinition</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">BeanDefinitionVisitor.prototype.visitBeanDefinition = function(beanDefinition) {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">16</td><td class="source">	this.visitParentName(beanDefinition);</td></tr><tr class="hit"><td class="line">71</td><td class="hits">16</td><td class="source">	this.visitPropertyValues(beanDefinition);</td></tr><tr class="hit"><td class="line">72</td><td class="hits">16</td><td class="source">	this.visitArgumentsValues(beanDefinition);</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * BeanDefinitionVisitor visit parentName in beanDefinition.</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @param  {Object} beanDefinition</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">BeanDefinitionVisitor.prototype.visitParentName = function(beanDefinition) {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">16</td><td class="source">	var parentName = beanDefinition.getParentName();</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">16</td><td class="source">	if (Utils.isNotNull(parentName)) {</td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">		var resolvedName = this.resolveStringValue(parentName);</td></tr><tr class="miss"><td class="line">86</td><td class="hits">0</td><td class="source">		if (parentName !== resolvedName &amp;&amp; Utils.isNotNull(resolvedName)) {</td></tr><tr class="miss"><td class="line">87</td><td class="hits">0</td><td class="source">			beanDefinition.setParentName(resolvedName);</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> * BeanDefinitionVisitor visit properties values in beanDefinition.</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> * @param  {Object} beanDefinition</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">98</td><td class="hits">1</td><td class="source">BeanDefinitionVisitor.prototype.visitPropertyValues = function(beanDefinition) {</td></tr><tr class="hit"><td class="line">99</td><td class="hits">16</td><td class="source">	var props = beanDefinition.getProps();</td></tr><tr class="hit"><td class="line">100</td><td class="hits">16</td><td class="source">	for (var i = 0; i &lt; props.length; i++) {</td></tr><tr class="hit"><td class="line">101</td><td class="hits">10</td><td class="source">		var wbean = props[i];</td></tr><tr class="hit"><td class="line">102</td><td class="hits">10</td><td class="source">		if (wbean.getDependType() === Constant.DEPEND_TYPE_VALUE) {</td></tr><tr class="hit"><td class="line">103</td><td class="hits">10</td><td class="source">			var value = wbean.getValue();</td></tr><tr class="hit"><td class="line">104</td><td class="hits">10</td><td class="source">			var resolvedValue = this.resolveStringValue(value);</td></tr><tr class="hit"><td class="line">105</td><td class="hits">10</td><td class="source">			if (value !== resolvedValue &amp;&amp; Utils.isNotNull(resolvedValue)) {</td></tr><tr class="hit"><td class="line">106</td><td class="hits">5</td><td class="source">				wbean.setValue(resolvedValue);</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> * BeanDefinitionVisitor visit argument values in beanDefinition.</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * @param  {Object} beanDefinition</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">BeanDefinitionVisitor.prototype.visitArgumentsValues = function(beanDefinition) {</td></tr><tr class="hit"><td class="line">119</td><td class="hits">16</td><td class="source">	var args = beanDefinition.getArgs();</td></tr><tr class="hit"><td class="line">120</td><td class="hits">16</td><td class="source">	for (var i = 0; i &lt; args.length; i++) {</td></tr><tr class="miss"><td class="line">121</td><td class="hits">0</td><td class="source">		var wbean = args[i];</td></tr><tr class="miss"><td class="line">122</td><td class="hits">0</td><td class="source">		if (wbean.getDependType() === Constant.DEPEND_TYPE_VALUE) {</td></tr><tr class="miss"><td class="line">123</td><td class="hits">0</td><td class="source">			var value = wbean.getValue();</td></tr><tr class="miss"><td class="line">124</td><td class="hits">0</td><td class="source">			var resolvedValue = this.resolveStringValue(value);</td></tr><tr class="miss"><td class="line">125</td><td class="hits">0</td><td class="source">			if (value !== resolvedValue &amp;&amp; Utils.isNotNull(resolvedValue)) {</td></tr><tr class="miss"><td class="line">126</td><td class="hits">0</td><td class="source">				wbean.setValue(resolvedValue);</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">132</td><td class="hits">1</td><td class="source">module.exports = BeanDefinitionVisitor;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanModule.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanModule.js</h2><div id="stats" class="terrible"><div class="percentage">16%</div><div class="sloc">125</div><div class="hits">21</div><div class="misses">104</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat BeanModule</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * modified from seajs module.js</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;, http://seajs.org</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var RequestUtil = require('../../util/requestUtil');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var anonymousMeta;</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var fetchingList = {};</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var fetchedList = {};</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var callbackList = {};</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">var STATUS = {</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">	// 0 - init</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">	INIT: 0,</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">	// 1 - The `module.uri` is being fetched</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">	FETCHING: 1,</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">	// 2 - The meta data has been saved to cachedMods</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">	SAVED: 2,</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">	// 3 - The `module.dependencies` are being loaded</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">	LOADING: 3,</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">	// 4 - The module are ready to execute</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">	LOADED: 4,</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">	// 5 - 404</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">	ERROR: 5</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * BeanModule constructor function.</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @param  {String}  uri</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @param  {Array}   dependencies</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @param  {Object}  loader reference</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">var BeanModule = function(uri, deps, loader) {</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">	this.uri = uri;</td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">	this.dependencies = deps || [];</td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="source">	this.deps = {};</td></tr><tr class="miss"><td class="line">51</td><td class="hits">0</td><td class="source">	this.remain = 0;</td></tr><tr class="miss"><td class="line">52</td><td class="hits">0</td><td class="source">	this.entries = [];</td></tr><tr class="miss"><td class="line">53</td><td class="hits">0</td><td class="source">	this.history = {};</td></tr><tr class="miss"><td class="line">54</td><td class="hits">0</td><td class="source">	this.loader = loader;</td></tr><tr class="miss"><td class="line">55</td><td class="hits">0</td><td class="source">	this.callback = null;</td></tr><tr class="miss"><td class="line">56</td><td class="hits">0</td><td class="source">	this.status = STATUS.INIT;</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * BeanModule resolve dependencies uri.</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">64</td><td class="hits">1</td><td class="source">BeanModule.prototype.resolve = function() {</td></tr><tr class="miss"><td class="line">65</td><td class="hits">0</td><td class="source">	var mod = this</td></tr><tr class="miss"><td class="line">66</td><td class="hits">0</td><td class="source">	var ids = mod.dependencies</td></tr><tr class="miss"><td class="line">67</td><td class="hits">0</td><td class="source">	var uris = []</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">69</td><td class="hits">0</td><td class="source">	var loader = this.getLoader();</td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">	var len = ids.length;</td></tr><tr class="miss"><td class="line">71</td><td class="hits">0</td><td class="source">	for (var i = 0; i &lt; len; i++) {</td></tr><tr class="miss"><td class="line">72</td><td class="hits">0</td><td class="source">		uris[i] = loader.resolve(ids[i], mod.uri);</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">75</td><td class="hits">0</td><td class="source">	return uris</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * BeanModule pass entry node into dependencies.</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">BeanModule.prototype.pass = function() {</td></tr><tr class="miss"><td class="line">84</td><td class="hits">0</td><td class="source">	var mod = this</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">86</td><td class="hits">0</td><td class="source">	var len = mod.dependencies.length</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">	// mod.entries changes dynamiclly</td></tr><tr class="miss"><td class="line">89</td><td class="hits">0</td><td class="source">	for (var i = 0; i &lt; mod.entries.length; i++) {</td></tr><tr class="miss"><td class="line">90</td><td class="hits">0</td><td class="source">		var entry = mod.entries[i];</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">92</td><td class="hits">0</td><td class="source">		var count = 0</td></tr><tr class="miss"><td class="line">93</td><td class="hits">0</td><td class="source">		for (var j = 0; j &lt; len; j++) {</td></tr><tr class="miss"><td class="line">94</td><td class="hits">0</td><td class="source">			var m = mod.deps[mod.dependencies[j]]</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">				// If the module is unload and unused in the entry, pass entry to it</td></tr><tr class="miss"><td class="line">96</td><td class="hits">0</td><td class="source">			if (m.status &lt; STATUS.LOADED &amp;&amp; !entry.history.hasOwnProperty(m.uri)) {</td></tr><tr class="miss"><td class="line">97</td><td class="hits">0</td><td class="source">				entry.history[m.uri] = true</td></tr><tr class="miss"><td class="line">98</td><td class="hits">0</td><td class="source">				count++</td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">				m.entries.push(entry)</td></tr><tr class="miss"><td class="line">100</td><td class="hits">0</td><td class="source">				if (m.status === STATUS.LOADING) {</td></tr><tr class="miss"><td class="line">101</td><td class="hits">0</td><td class="source">					m.pass()</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">		// If has passed the entry to it's dependencies, modify the entry's count and del it in the module</td></tr><tr class="miss"><td class="line">106</td><td class="hits">0</td><td class="source">		if (count &gt; 0) {</td></tr><tr class="miss"><td class="line">107</td><td class="hits">0</td><td class="source">			entry.remain += count - 1</td></tr><tr class="miss"><td class="line">108</td><td class="hits">0</td><td class="source">			mod.entries.shift()</td></tr><tr class="miss"><td class="line">109</td><td class="hits">0</td><td class="source">			i--</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * BeanModule load script files.</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">119</td><td class="hits">1</td><td class="source">BeanModule.prototype.load = function() {</td></tr><tr class="miss"><td class="line">120</td><td class="hits">0</td><td class="source">	var mod = this;</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">122</td><td class="hits">0</td><td class="source">	if (this.status &gt;= STATUS.LOADING) {</td></tr><tr class="miss"><td class="line">123</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">126</td><td class="hits">0</td><td class="source">	var loader = this.getLoader();</td></tr><tr class="miss"><td class="line">127</td><td class="hits">0</td><td class="source">	mod.status = STATUS.LOADING;</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">129</td><td class="hits">0</td><td class="source">	var uris = mod.resolve();</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">131</td><td class="hits">0</td><td class="source">	for (var i = 0, len = uris.length; i &lt; len; i++) {</td></tr><tr class="miss"><td class="line">132</td><td class="hits">0</td><td class="source">		mod.deps[mod.dependencies[i]] = loader.get(uris[i])</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">	// Pass entry to it's dependencies</td></tr><tr class="miss"><td class="line">136</td><td class="hits">0</td><td class="source">	mod.pass();</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">	// If module has entries not be passed, call onload</td></tr><tr class="miss"><td class="line">139</td><td class="hits">0</td><td class="source">	if (mod.entries.length) {</td></tr><tr class="miss"><td class="line">140</td><td class="hits">0</td><td class="source">		mod.onload()</td></tr><tr class="miss"><td class="line">141</td><td class="hits">0</td><td class="source">		return</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">	// Begin parallel loading</td></tr><tr class="miss"><td class="line">145</td><td class="hits">0</td><td class="source">	var requestCache = {};</td></tr><tr class="miss"><td class="line">146</td><td class="hits">0</td><td class="source">	var m;</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">148</td><td class="hits">0</td><td class="source">	for (i = 0; i &lt; len; i++) {</td></tr><tr class="miss"><td class="line">149</td><td class="hits">0</td><td class="source">		m = loader.get(uris[i]);</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">151</td><td class="hits">0</td><td class="source">		if (m.status &lt; STATUS.FETCHING) {</td></tr><tr class="miss"><td class="line">152</td><td class="hits">0</td><td class="source">			m.fetch(requestCache)</td></tr><tr class="miss"><td class="line">153</td><td class="hits">0</td><td class="source">		} else if (m.status === STATUS.SAVED) {</td></tr><tr class="miss"><td class="line">154</td><td class="hits">0</td><td class="source">			m.load()</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">	// Send all requests at last to avoid cache bug in IE6-9. Issues#808</td></tr><tr class="miss"><td class="line">159</td><td class="hits">0</td><td class="source">	for (var requestUri in requestCache) {</td></tr><tr class="miss"><td class="line">160</td><td class="hits">0</td><td class="source">		if (requestCache.hasOwnProperty(requestUri)) {</td></tr><tr class="miss"><td class="line">161</td><td class="hits">0</td><td class="source">			requestCache[requestUri]()</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> * BeanModule onload script file event callback.</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">171</td><td class="hits">1</td><td class="source">BeanModule.prototype.onload = function() {</td></tr><tr class="miss"><td class="line">172</td><td class="hits">0</td><td class="source">	var mod = this</td></tr><tr class="miss"><td class="line">173</td><td class="hits">0</td><td class="source">	mod.status = STATUS.LOADED</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">	// When sometimes cached in IE, exec will occur before onload, make sure len is an number</td></tr><tr class="miss"><td class="line">176</td><td class="hits">0</td><td class="source">	var len = (mod.entries || []).length;</td></tr><tr class="miss"><td class="line">177</td><td class="hits">0</td><td class="source">	for (var i = 0; i &lt; len; i++) {</td></tr><tr class="miss"><td class="line">178</td><td class="hits">0</td><td class="source">		var entry = mod.entries[i]</td></tr><tr class="miss"><td class="line">179</td><td class="hits">0</td><td class="source">		if (--entry.remain === 0) {</td></tr><tr class="miss"><td class="line">180</td><td class="hits">0</td><td class="source">			entry.callback()</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">184</td><td class="hits">0</td><td class="source">	delete mod.entries</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> * BeanModule error callback.</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">192</td><td class="hits">1</td><td class="source">BeanModule.prototype.error = function() {</td></tr><tr class="miss"><td class="line">193</td><td class="hits">0</td><td class="source">	var mod = this</td></tr><tr class="miss"><td class="line">194</td><td class="hits">0</td><td class="source">	mod.onload()</td></tr><tr class="miss"><td class="line">195</td><td class="hits">0</td><td class="source">	mod.status = STATUS.ERROR</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> * BeanModule fetch script files using async &lt;script&gt; or from webworker.</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> * @param  {Object}  request cache</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">204</td><td class="hits">1</td><td class="source">BeanModule.prototype.fetch = function(requestCache) {</td></tr><tr class="miss"><td class="line">205</td><td class="hits">0</td><td class="source">	var mod = this</td></tr><tr class="miss"><td class="line">206</td><td class="hits">0</td><td class="source">	var uri = mod.uri</td></tr><tr class="miss"><td class="line">207</td><td class="hits">0</td><td class="source">	console.log('do fetch ' + uri);</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">209</td><td class="hits">0</td><td class="source">	var loader = this.getLoader();</td></tr><tr class="miss"><td class="line">210</td><td class="hits">0</td><td class="source">	mod.status = STATUS.FETCHING</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">	// Emit `fetch` event for plugins such as combo plugin</td></tr><tr class="miss"><td class="line">213</td><td class="hits">0</td><td class="source">	var emitData = {</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">		uri: uri</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">217</td><td class="hits">0</td><td class="source">	var requestUri = emitData.requestUri || uri</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">	// Empty uri or have been fetched</td></tr><tr class="miss"><td class="line">220</td><td class="hits">0</td><td class="source">	if (!requestUri || fetchedList.hasOwnProperty(requestUri)) {</td></tr><tr class="miss"><td class="line">221</td><td class="hits">0</td><td class="source">		mod.load()</td></tr><tr class="miss"><td class="line">222</td><td class="hits">0</td><td class="source">		return</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">225</td><td class="hits">0</td><td class="source">	if (fetchingList.hasOwnProperty(requestUri)) {</td></tr><tr class="miss"><td class="line">226</td><td class="hits">0</td><td class="source">		callbackList[requestUri].push(mod)</td></tr><tr class="miss"><td class="line">227</td><td class="hits">0</td><td class="source">		return</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">230</td><td class="hits">0</td><td class="source">	fetchingList[requestUri] = true</td></tr><tr class="miss"><td class="line">231</td><td class="hits">0</td><td class="source">	callbackList[requestUri] = [mod]</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">	// Emit `request` event for plugins such as text plugin</td></tr><tr class="miss"><td class="line">234</td><td class="hits">0</td><td class="source">	emitData = {</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">		uri: uri,</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">		requestUri: requestUri,</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">		onRequest: onRequest,</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">		// charset: Utils.checkFunction(data.charset) ? data.charset(requestUri) || 'utf-8' : data.charset,</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">		// crossorigin: Utils.checkFunction(data.crossorigin) ? data.crossorigin(requestUri) : data.crossorigin</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">		charset: 'utf-8',</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">		crossorigin: false</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">244</td><td class="hits">0</td><td class="source">	if (!emitData.requested) {</td></tr><tr class="miss"><td class="line">245</td><td class="hits">0</td><td class="source">		requestCache ?</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">			requestCache[emitData.requestUri] = sendRequest :</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">			sendRequest()</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">250</td><td class="hits">0</td><td class="source">	function sendRequest() {</td></tr><tr class="miss"><td class="line">251</td><td class="hits">0</td><td class="source">		RequestUtil.request(emitData.requestUri, emitData.onRequest, emitData.charset, emitData.crossorigin)</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">254</td><td class="hits">0</td><td class="source">	function onRequest(error) {</td></tr><tr class="miss"><td class="line">255</td><td class="hits">0</td><td class="source">		delete fetchingList[requestUri]</td></tr><tr class="miss"><td class="line">256</td><td class="hits">0</td><td class="source">		fetchedList[requestUri] = true</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">		// Save meta data of anonymous module</td></tr><tr class="miss"><td class="line">259</td><td class="hits">0</td><td class="source">		if (anonymousMeta) {</td></tr><tr class="miss"><td class="line">260</td><td class="hits">0</td><td class="source">			loader.save(uri, anonymousMeta)</td></tr><tr class="miss"><td class="line">261</td><td class="hits">0</td><td class="source">			anonymousMeta = null</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">		// Call callbacks</td></tr><tr class="miss"><td class="line">265</td><td class="hits">0</td><td class="source">		var m, mods = callbackList[requestUri]</td></tr><tr class="miss"><td class="line">266</td><td class="hits">0</td><td class="source">		delete callbackList[requestUri]</td></tr><tr class="miss"><td class="line">267</td><td class="hits">0</td><td class="source">		while ((m = mods.shift())) {</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">			// When 404 occurs, the params error will be true</td></tr><tr class="miss"><td class="line">269</td><td class="hits">0</td><td class="source">			if (error === true) {</td></tr><tr class="miss"><td class="line">270</td><td class="hits">0</td><td class="source">				m.error()</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">			} else {</td></tr><tr class="miss"><td class="line">272</td><td class="hits">0</td><td class="source">				m.load()</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source"> * BeanModule add entry.</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> * @param  {Object}  entry node</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">284</td><td class="hits">1</td><td class="source">BeanModule.prototype.addEntry = function(entry) {</td></tr><tr class="miss"><td class="line">285</td><td class="hits">0</td><td class="source">	this.entries.push(entry);</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source"> * BeanModule set remain number to be loaded.</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source"> * @param  {Number}  remain number</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">294</td><td class="hits">1</td><td class="source">BeanModule.prototype.setRemain = function(remain) {</td></tr><tr class="miss"><td class="line">295</td><td class="hits">0</td><td class="source">	this.remain = remain;</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> * BeanModule set loader.</td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source"> * @param  {Object}  loader reference</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">304</td><td class="hits">1</td><td class="source">BeanModule.prototype.setLoader = function(loader) {</td></tr><tr class="miss"><td class="line">305</td><td class="hits">0</td><td class="source">	this.loader = loader;</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source"> * BeanModule get loader.</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source"> * @return  {Object}  loader reference</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">314</td><td class="hits">1</td><td class="source">BeanModule.prototype.getLoader = function() {</td></tr><tr class="miss"><td class="line">315</td><td class="hits">0</td><td class="source">	return this.loader;</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">318</td><td class="hits">1</td><td class="source">BeanModule.STATUS = STATUS;</td></tr><tr class="hit"><td class="line">319</td><td class="hits">1</td><td class="source">BeanModule.anonymousMeta = anonymousMeta;</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">321</td><td class="hits">1</td><td class="source">module.exports = BeanModule;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanWrapper.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/beanWrapper.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">51</div><div class="hits">51</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat BeanWrapper</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'BeanWrapper');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Constant = require('../../util/constant');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * BeanWrapper constructor function.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">var BeanWrapper = function() {</td></tr><tr class="hit"><td class="line">25</td><td class="hits">81</td><td class="source">	this.name = null;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">81</td><td class="source">	this.type = null;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">81</td><td class="source">	this.value = null;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">81</td><td class="source">	this.ref = null;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">81</td><td class="source">	this.role = null; // DEPENDS_ARGS, DEPENDS_PROPS</td></tr><tr class="hit"><td class="line">30</td><td class="hits">81</td><td class="source">	this.bean = null; // bean dependency inject instance</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * BeanWrapper get depend type.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @return  {String} depend type</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.getDependType = function() {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">193</td><td class="source">	return this.role;</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * BeanWrapper get name.</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @return  {String} name</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.getName = function() {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">124</td><td class="source">	return this.name;</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * BeanWrapper set name.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @param  {String} name</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.setName = function(name) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">77</td><td class="source">	this.name = name;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * BeanWrapper get type.</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @return  {String} type</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.getType = function() {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">3</td><td class="source">	return this.type;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * BeanWrapper set type.</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * @param  {String} type</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.setType = function(type) {</td></tr><tr class="hit"><td class="line">80</td><td class="hits">10</td><td class="source">	this.type = type;</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * BeanWrapper get value.</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * @return  {String} value</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.getValue = function() {</td></tr><tr class="hit"><td class="line">90</td><td class="hits">27</td><td class="source">	return this.value;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> * BeanWrapper set value.</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * @param  {String} value</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.setValue = function(value) {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">30</td><td class="source">	this.value = value;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * BeanWrapper get value once.</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * prototype bean may share DEPEND_TYPE_VAR value</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * @return  {String} value</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">111</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.getValueOnce = function() {</td></tr><tr class="hit"><td class="line">112</td><td class="hits">2</td><td class="source">	var value = this.value;</td></tr><tr class="hit"><td class="line">113</td><td class="hits">2</td><td class="source">	this.value = null;</td></tr><tr class="hit"><td class="line">114</td><td class="hits">2</td><td class="source">	return value;</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> * BeanWrapper get ref bean.</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @return  {String} ref bean</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">123</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.getRef = function() {</td></tr><tr class="hit"><td class="line">124</td><td class="hits">54</td><td class="source">	return this.ref;</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> * BeanWrapper set ref bean.</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * @param  {String} ref reference bean</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">133</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.setRef = function(ref) {</td></tr><tr class="hit"><td class="line">134</td><td class="hits">42</td><td class="source">	this.ref = ref;</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * BeanWrapper get role.</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * @return  {String} role</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">143</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.getRole = function() {</td></tr><tr class="hit"><td class="line">144</td><td class="hits">10</td><td class="source">	return this.role;</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> * BeanWrapper set role.</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">152</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.setRole = function() {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">79</td><td class="source">	var role = Constant.DEPEND_TYPE_ERROR;</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">155</td><td class="hits">79</td><td class="source">	if (!this.name) {</td></tr><tr class="hit"><td class="line">156</td><td class="hits">3</td><td class="source">		role = Constant.DEPEND_TYPE_ERROR;</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">159</td><td class="hits">79</td><td class="source">	if (this.ref) {</td></tr><tr class="hit"><td class="line">160</td><td class="hits">42</td><td class="source">		role = Constant.DEPEND_TYPE_BEAN;</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">163</td><td class="hits">79</td><td class="source">	if (this.value) {</td></tr><tr class="hit"><td class="line">164</td><td class="hits">23</td><td class="source">		role = Constant.DEPEND_TYPE_VALUE;</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">167</td><td class="hits">79</td><td class="source">	if (this.type) {</td></tr><tr class="hit"><td class="line">168</td><td class="hits">10</td><td class="source">		if (Utils.checkType(this.type)) {</td></tr><tr class="hit"><td class="line">169</td><td class="hits">8</td><td class="source">			role = Constant.DEPEND_TYPE_VAR;</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">173</td><td class="hits">79</td><td class="source">	this.role = role;</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source"> * BeanWrapper get bean.</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> * @return  {Object} bean</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">182</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.getBean = function() {</td></tr><tr class="hit"><td class="line">183</td><td class="hits">35</td><td class="source">	return this.bean;</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> * BeanWrapper set bean.</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> * @param  {Object} bean</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">192</td><td class="hits">1</td><td class="source">BeanWrapper.prototype.setBean = function(bean) {</td></tr><tr class="hit"><td class="line">193</td><td class="hits">34</td><td class="source">	this.bean = bean;</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">196</td><td class="hits">1</td><td class="source">module.exports = BeanWrapper;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/placeHolderConfigurer.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/placeHolderConfigurer.js</h2><div id="stats" class="high"><div class="percentage">98%</div><div class="sloc">58</div><div class="hits">57</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat PlaceHolderConfigurer</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var PropertiesLoader = require('../../resource/propertiesLoader');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var BeanDefinitionVisitor = require('./beanDefinitionVisitor');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var PlaceHolderResolver = require('./placeHolderResolver');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var Constant = require('../../util/constant');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var DEFAULT_LOAD_PATH = process.cwd() + &quot;/config&quot;;</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var Root;</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">(function() {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">	Root = this;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}());</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer constructor function.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">var PlaceHolderConfigurer = function() {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">62</td><td class="source">	this.beanName = null;</td></tr><tr class="hit"><td class="line">34</td><td class="hits">62</td><td class="source">	this.env = Constant.DEFAULT_ENV;</td></tr><tr class="hit"><td class="line">35</td><td class="hits">62</td><td class="source">	this.cpath = DEFAULT_LOAD_PATH;</td></tr><tr class="hit"><td class="line">36</td><td class="hits">62</td><td class="source">	this.properties = {};</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer post process beanFactory.</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @param  {Object} beanFactory</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.postProcessBeanFactory = function(beanFactory) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">66</td><td class="source">	this.loadProperties();</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">66</td><td class="source">	this.processProperties(beanFactory);</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer load properties by env.</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.loadProperties = function() {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">66</td><td class="source">	var properties = null;</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">59</td><td class="hits">66</td><td class="source">	if (Root.__bearcatData__ &amp;&amp; Root.__bearcatData__.configData) {</td></tr><tr class="miss"><td class="line">60</td><td class="hits">0</td><td class="source">		properties = Root.__bearcatData__.configData;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">66</td><td class="source">		properties = this.getPropertiesLoader().loadProperties(this.getConfigPath(), this.getEnv());</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">66</td><td class="source">	this.mergeProperties(properties);</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer merge properties.</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @param  {Object} properties</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.mergeProperties = function(properties) {</td></tr><tr class="hit"><td class="line">75</td><td class="hits">66</td><td class="source">	for (var key in properties) {</td></tr><tr class="hit"><td class="line">76</td><td class="hits">18</td><td class="source">		if (Utils.isNotNull(properties[key])) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">18</td><td class="source">			this.properties[key] = properties[key];</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer process properties.</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * @param  {Object} beanFactory</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.processProperties = function(beanFactory) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">66</td><td class="source">	var properties = this.getProperties();</td></tr><tr class="hit"><td class="line">90</td><td class="hits">66</td><td class="source">	if (Utils.checkObjectEmpty(properties)) {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">64</td><td class="source">		return;</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">94</td><td class="hits">2</td><td class="source">	var valueResolver = new PlaceHolderResolver(properties);</td></tr><tr class="hit"><td class="line">95</td><td class="hits">2</td><td class="source">	this.doProcessProperties(beanFactory, valueResolver);</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer do process properties.</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * @param  {Object} beanFactory</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> * @param  {Object} valueResolver</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">105</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.doProcessProperties = function(beanFactory, valueResolver) {</td></tr><tr class="hit"><td class="line">106</td><td class="hits">2</td><td class="source">	var visitor = new BeanDefinitionVisitor(valueResolver);</td></tr><tr class="hit"><td class="line">107</td><td class="hits">2</td><td class="source">	var beanDefinitions = beanFactory.getBeanDefinitions();</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">109</td><td class="hits">2</td><td class="source">	for (var beanName in beanDefinitions) {</td></tr><tr class="hit"><td class="line">110</td><td class="hits">16</td><td class="source">		var bd = beanDefinitions[beanName];</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">112</td><td class="hits">16</td><td class="source">		visitor.visitBeanDefinition(bd);</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer get properties loader.</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> * @return  {Object} properties loader</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">122</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.getPropertiesLoader = function() {</td></tr><tr class="hit"><td class="line">123</td><td class="hits">66</td><td class="source">	return new PropertiesLoader();</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer set beanName.</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">132</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.setBeanName = function(beanName) {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">1</td><td class="source">	this.beanName = beanName;</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer get beanName.</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> * @return  {String} beanName</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">142</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.getBeanName = function() {</td></tr><tr class="hit"><td class="line">143</td><td class="hits">1</td><td class="source">	return this.beanName;</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer set env.</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> * @param  {String} env</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">152</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.setEnv = function(env) {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">61</td><td class="source">	this.env = env;</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer get env.</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> * @return  {String} env</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">162</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.getEnv = function() {</td></tr><tr class="hit"><td class="line">163</td><td class="hits">66</td><td class="source">	return this.env;</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer set configuration path.</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> * @param  {String} cpath configuration path</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">172</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.setConfigPath = function(cpath) {</td></tr><tr class="hit"><td class="line">173</td><td class="hits">61</td><td class="source">	this.cpath = cpath;</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer get configuration path.</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> * @return  {String} cpath configuration path</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">182</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.getConfigPath = function() {</td></tr><tr class="hit"><td class="line">183</td><td class="hits">66</td><td class="source">	return this.cpath;</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer set properties.</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> * @param  {Array} properties</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">192</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.setProperties = function(properties) {</td></tr><tr class="hit"><td class="line">193</td><td class="hits">1</td><td class="source">	this.properties = properties;</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> * PlaceHolderConfigurer get properties.</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> * @return  {Array} properties</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">202</td><td class="hits">1</td><td class="source">PlaceHolderConfigurer.prototype.getProperties = function() {</td></tr><tr class="hit"><td class="line">203</td><td class="hits">66</td><td class="source">	return this.properties;</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">206</td><td class="hits">1</td><td class="source">module.exports = PlaceHolderConfigurer;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/placeHolderResolver.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/beans/support/placeHolderResolver.js</h2><div id="stats" class="high"><div class="percentage">95%</div><div class="sloc">44</div><div class="hits">42</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat PlaceHolderResolver</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var DEFAULT_PLACEHOLDER_PREFIX = &quot;${&quot;;</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var DEFAULT_PLACEHOLDER_SUFFIX = &quot;}&quot;;</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var DEFAULT_VALUE_SEPARATOR = &quot;:&quot;;</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * PlaceHolderResolver constructor function.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @param  {Array} properties</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">var PlaceHolderResolver = function(properties) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">3</td><td class="source">	this.placeholderPrefix = DEFAULT_PLACEHOLDER_PREFIX;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">3</td><td class="source">	this.placeholderSuffix = DEFAULT_PLACEHOLDER_SUFFIX;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">3</td><td class="source">	this.valueSeparator = DEFAULT_VALUE_SEPARATOR;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">3</td><td class="source">	this.properties = properties;</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * PlaceHolderResolver resolve string value.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @param  {String} strVal string value</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">PlaceHolderResolver.prototype.resolveStringValue = function(strVal) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">14</td><td class="source">	if (!Utils.checkString(strVal)) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">6</td><td class="source">		return null;</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">8</td><td class="source">	var resolvedValue = this.doReplace(strVal);</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">8</td><td class="source">	if (!Utils.isNotNull(resolvedValue)) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">2</td><td class="source">		resolvedValue = strVal;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">8</td><td class="source">	return resolvedValue;</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * PlaceHolderResolver set properties.</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * @param  {Array} properties</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">PlaceHolderResolver.prototype.setProperties = function(properties) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">2</td><td class="source">	this.properties = properties;</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * PlaceHolderResolver get properties.</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * @return  {Array} properties</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">PlaceHolderResolver.prototype.getProperties = function() {</td></tr><tr class="hit"><td class="line">69</td><td class="hits">11</td><td class="source">	return this.properties;</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * PlaceHolderResolver replace string value.</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * @param  {String} strVal string value</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">78</td><td class="hits">1</td><td class="source">PlaceHolderResolver.prototype.doReplace = function(strVal) {</td></tr><tr class="hit"><td class="line">79</td><td class="hits">11</td><td class="source">	var properties = this.getProperties();</td></tr><tr class="hit"><td class="line">80</td><td class="hits">11</td><td class="source">	if (!strVal || !properties) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">4</td><td class="source">		return null;</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">7</td><td class="source">	var ptn = /\$\{(.*?)\}/g;</td></tr><tr class="hit"><td class="line">85</td><td class="hits">7</td><td class="source">	var m, placeHolder, res = '',</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">		lastIndex = 0,</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">		head;</td></tr><tr class="hit"><td class="line">88</td><td class="hits">7</td><td class="source">	var flag = true;</td></tr><tr class="hit"><td class="line">89</td><td class="hits">7</td><td class="source">	var count = 0;</td></tr><tr class="hit"><td class="line">90</td><td class="hits">7</td><td class="source">	while ((m = ptn.exec(strVal))) {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">6</td><td class="source">		placeHolder = m[1];</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">6</td><td class="source">		head = strVal.substring(lastIndex, m.index);</td></tr><tr class="hit"><td class="line">94</td><td class="hits">6</td><td class="source">		if (head.length) {</td></tr><tr class="miss"><td class="line">95</td><td class="hits">0</td><td class="source">			res += head;</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">		}</td></tr><tr class="hit"><td class="line">97</td><td class="hits">6</td><td class="source">		lastIndex = ptn.lastIndex;</td></tr><tr class="hit"><td class="line">98</td><td class="hits">6</td><td class="source">		if (count == 0 &amp;&amp; !head.length) {</td></tr><tr class="hit"><td class="line">99</td><td class="hits">6</td><td class="source">			res = properties[placeHolder];</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">		} else {</td></tr><tr class="miss"><td class="line">101</td><td class="hits">0</td><td class="source">			res += properties[placeHolder];</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">		}</td></tr><tr class="hit"><td class="line">103</td><td class="hits">6</td><td class="source">		flag = false;</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">106</td><td class="hits">7</td><td class="source">	if (lastIndex &lt; strVal.length) {</td></tr><tr class="hit"><td class="line">107</td><td class="hits">2</td><td class="source">		res += strVal.substring(lastIndex);</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">7</td><td class="source">	if (flag) {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">1</td><td class="source">		return null;</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">113</td><td class="hits">6</td><td class="source">	return res;</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">116</td><td class="hits">1</td><td class="source">module.exports = PlaceHolderResolver;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/bearcat.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/bearcat.js</h2><div id="stats" class="high"><div class="percentage">80%</div><div class="sloc">147</div><div class="hits">118</div><div class="misses">29</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat App</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'app');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var ApplicationContext = require('./context/applicationContext');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var EventEmitter = require('events').EventEmitter;</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var BeanFactory = require('./beans/beanFactory');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var Package = require('../package.json');</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var Utils = require('./util/utils');</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var Root;</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">(function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">	Root = this;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">}());</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * Application states</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">var STATE_NEW = 1; // app new</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">var STATE_INITED = 2; // app has inited</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">var STATE_START = 3; // app start</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">var STATE_STARTED = 4; // app has started</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * Bearcat app object.</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">var Bearcat = {</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">	opts: null,</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">	configLocations: null,</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">	applicationContext: null,</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">	state: STATE_NEW,</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">	startTime: null,</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">	version: Package.version</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">Bearcat['__proto__'] = EventEmitter.prototype;</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * Bearcat createApp constructor function.</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @param  {Array}  configLocations context path array</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @param  {Object} opts</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * @param  {String} opts.NODE_ENV                    setup env</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * @param  {String} opts.BEARCAT_ENV                 setup env</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @param  {String} opts.NODE_CPATH                  setup config path</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @param  {String} opts.BEARCAT_CPATH               setup config path</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * @param  {String} opts.BEARCAT_HPATH               setup hot reload path(s), usually it is the scan source directory(app by default)</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @param  {String} opts.BEARCAT_LOGGER              setup 'off' to turn off bearcat logger configuration</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @param  {String} opts.BEARCAT_HOT                 setup 'on' to turn on bearcat hot code reload</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @param  {String} opts.BEARCAT_ANNOTATION          setup 'off' to turn off bearcat $ based annotation</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @param  {String} opts.BEARCAT_GLOBAL  	         setup bearcat to be global object</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * @param  {String} opts.BEARCAT_FUNCTION_STRING  	 setup bearcat to use func.toString for $ based annotation</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * @return {Object} bearcat object</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">Bearcat.createApp = function(configLocations, opts) {</td></tr><tr class="hit"><td class="line">69</td><td class="hits">11</td><td class="source">	if (this.state &gt;= STATE_INITED) {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">		Bearcat.stop();</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">11</td><td class="source">	if (!Utils.checkArray(configLocations) &amp;&amp; Utils.checkObject(configLocations)) {</td></tr><tr class="hit"><td class="line">74</td><td class="hits">2</td><td class="source">		opts = configLocations;</td></tr><tr class="hit"><td class="line">75</td><td class="hits">2</td><td class="source">		configLocations = [];</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">78</td><td class="hits">11</td><td class="source">	this.opts = opts || {};</td></tr><tr class="hit"><td class="line">79</td><td class="hits">11</td><td class="source">	this.configLocations = configLocations || [];</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">81</td><td class="hits">11</td><td class="source">	if (this.opts['BEARCAT_GLOBAL']) {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">1</td><td class="source">		Root.bearcat = Bearcat;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">11</td><td class="source">	if (!Utils.checkObject(this.opts)) {</td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">		logger.warn('Bearcat createApp opts must be object...');</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">89</td><td class="hits">11</td><td class="source">	this.applicationContext = new ApplicationContext(this.configLocations, this.opts);</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">91</td><td class="hits">11</td><td class="source">	this.state = STATE_INITED;</td></tr><tr class="hit"><td class="line">92</td><td class="hits">11</td><td class="source">	return Bearcat;</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> * Bearcat start app.</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> * @param  {Function} cb start callback function</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">101</td><td class="hits">1</td><td class="source">Bearcat.start = function(cb) {</td></tr><tr class="hit"><td class="line">102</td><td class="hits">8</td><td class="source">	if (!Utils.checkFunction(cb)) {</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">		cb = function() {}</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">106</td><td class="hits">8</td><td class="source">	if (this.state &gt; STATE_INITED) {</td></tr><tr class="hit"><td class="line">107</td><td class="hits">1</td><td class="source">		logger.warn('Bearcat has already start, run bearcat.stop to start again.');</td></tr><tr class="hit"><td class="line">108</td><td class="hits">1</td><td class="source">		return cb();</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">111</td><td class="hits">7</td><td class="source">	if (this.state &lt; STATE_INITED) {</td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">		logger.warn('Bearcat does not inited, run bearcat.createApp to init.');</td></tr><tr class="hit"><td class="line">113</td><td class="hits">1</td><td class="source">		return cb();</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">116</td><td class="hits">6</td><td class="source">	this.state = STATE_START;</td></tr><tr class="hit"><td class="line">117</td><td class="hits">6</td><td class="source">	this.startTime = Date.now();</td></tr><tr class="hit"><td class="line">118</td><td class="hits">6</td><td class="source">	var self = this;</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">120</td><td class="hits">6</td><td class="source">	var env = &quot;&quot;;</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">122</td><td class="hits">6</td><td class="source">	if (Utils.checkBrowser()) {</td></tr><tr class="miss"><td class="line">123</td><td class="hits">0</td><td class="source">		env = 'browser';</td></tr><tr class="miss"><td class="line">124</td><td class="hits">0</td><td class="source">		this.applicationContext.setEnv(env);</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">127</td><td class="hits">6</td><td class="source">	if (Utils.checkCocos2dJsb()) {</td></tr><tr class="miss"><td class="line">128</td><td class="hits">0</td><td class="source">		env = 'cocos2djsb';</td></tr><tr class="miss"><td class="line">129</td><td class="hits">0</td><td class="source">		this.applicationContext.setEnv(env);</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">132</td><td class="hits">6</td><td class="source">	this.applicationContext.on('finishRefresh', function() {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">6</td><td class="source">		self.state = STATE_STARTED;</td></tr><tr class="hit"><td class="line">134</td><td class="hits">6</td><td class="source">		env = self.applicationContext.getEnv();</td></tr><tr class="hit"><td class="line">135</td><td class="hits">6</td><td class="source">		logger.info('Bearcat startup in %s with %s ms', env, Date.now() - self.startTime);</td></tr><tr class="hit"><td class="line">136</td><td class="hits">6</td><td class="source">		cb();</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">139</td><td class="hits">6</td><td class="source">	this.applicationContext.on('reload', function() {</td></tr><tr class="miss"><td class="line">140</td><td class="hits">0</td><td class="source">		self.emit('reload');</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">143</td><td class="hits">6</td><td class="source">	this.applicationContext.refresh();</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> * Bearcat stop app.</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> * it will stop internal applicationContext, destroy all singletonBeans</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">152</td><td class="hits">1</td><td class="source">Bearcat.stop = function() {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">13</td><td class="source">	if (this.applicationContext) {</td></tr><tr class="hit"><td class="line">154</td><td class="hits">11</td><td class="source">		this.applicationContext.destroy();</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">156</td><td class="hits">13</td><td class="source">	this.applicationContext = null;</td></tr><tr class="hit"><td class="line">157</td><td class="hits">13</td><td class="source">	this.configLocations = null;</td></tr><tr class="hit"><td class="line">158</td><td class="hits">13</td><td class="source">	this.startTime = null;</td></tr><tr class="hit"><td class="line">159</td><td class="hits">13</td><td class="source">	this.state = STATE_NEW;</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> * Bearcat get beanFactory instance.</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> * @return  {Object} beanFactory instance</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">168</td><td class="hits">1</td><td class="source">Bearcat.getBeanFactory = function() {</td></tr><tr class="hit"><td class="line">169</td><td class="hits">2</td><td class="source">	if (this.state &lt;= STATE_INITED) {</td></tr><tr class="hit"><td class="line">170</td><td class="hits">1</td><td class="source">		logger.warn('Bearcat application is not running now for %s', &quot;getBeanFactory&quot;);</td></tr><tr class="hit"><td class="line">171</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">174</td><td class="hits">1</td><td class="source">	return this.applicationContext.getBeanFactory();</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> * Bearcat get applicationContext.</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> * @return  {Object} applicationContext</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">183</td><td class="hits">1</td><td class="source">Bearcat.getApplicationContext = function() {</td></tr><tr class="hit"><td class="line">184</td><td class="hits">2</td><td class="source">	if (this.state &lt;= STATE_INITED) {</td></tr><tr class="hit"><td class="line">185</td><td class="hits">1</td><td class="source">		logger.warn('Bearcat application is not running now for %s', &quot;getApplicationContext&quot;);</td></tr><tr class="hit"><td class="line">186</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">189</td><td class="hits">1</td><td class="source">	return this.applicationContext;</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> * Bearcat get bean from IoC container through meta argument.</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> *	  bearcat.getBeanByMeta({</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> *		 id: &quot;car&quot;,</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> *		 func: Car // Car is a function constructor</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> *	  });</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> * @param  {Object} meta meta object</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">205</td><td class="hits">1</td><td class="source">Bearcat.getBeanByMeta = function(meta) {</td></tr><tr class="hit"><td class="line">206</td><td class="hits">2</td><td class="source">	if (this.state &lt;= STATE_INITED) {</td></tr><tr class="hit"><td class="line">207</td><td class="hits">1</td><td class="source">		logger.warn('Bearcat application is not running now for %s %j', &quot;getBeanByMeta&quot;, meta);</td></tr><tr class="hit"><td class="line">208</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">211</td><td class="hits">1</td><td class="source">	return this.applicationContext.getBeanByMeta(meta);</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> * Bearcat get bean from IoC container through $ annotation function.</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> *	  bearcat.getBeanByFunc(function() {</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source"> *		 this.$id = &quot;car&quot;;</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> *		 this.$scope = &quot;prototype&quot;;</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> *	  });</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source"> * @param  {Function} func $ annotation function</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">227</td><td class="hits">1</td><td class="source">Bearcat.getBeanByFunc = function(func) {</td></tr><tr class="hit"><td class="line">228</td><td class="hits">2</td><td class="source">	if (this.state &lt;= STATE_INITED) {</td></tr><tr class="hit"><td class="line">229</td><td class="hits">1</td><td class="source">		logger.warn('Bearcat application is not running now for %s', &quot;getBeanByFunc&quot;);</td></tr><tr class="hit"><td class="line">230</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">233</td><td class="hits">1</td><td class="source">	return this.applicationContext.getBeanByFunc(func);</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source"> * Bearcat add async loading beans, this just add beans needed to be loaded to bearcat.</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> *	  bearcat.use(['car']);</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source"> *	  bearcat.use('car');</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> * @param  {Array|String} async loading beans id</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">247</td><td class="hits">1</td><td class="source">Bearcat.use = function(ids) {</td></tr><tr class="miss"><td class="line">248</td><td class="hits">0</td><td class="source">	if (Utils.checkArray(ids)) {</td></tr><tr class="miss"><td class="line">249</td><td class="hits">0</td><td class="source">		return this.applicationContext.use(ids);</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">252</td><td class="hits">0</td><td class="source">	if (Utils.checkString(ids)) {</td></tr><tr class="miss"><td class="line">253</td><td class="hits">0</td><td class="source">		return this.applicationContext.use([ids]);</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source"> * Bearcat async loading beans.</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source"> *	  bearcat.async(['car'], function(car) {</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> *		  // car is ready</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source"> *	  });</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> * @param  {Array|String} async loading beans id</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source"> * @return {Function}     callback with loaded bean instances</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">270</td><td class="hits">1</td><td class="source">Bearcat.async = function(ids, cb) {</td></tr><tr class="miss"><td class="line">271</td><td class="hits">0</td><td class="source">	if (Utils.checkArray(ids)) {</td></tr><tr class="miss"><td class="line">272</td><td class="hits">0</td><td class="source">		return this.applicationContext.async(ids, cb);</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">275</td><td class="hits">0</td><td class="source">	if (Utils.checkString(ids)) {</td></tr><tr class="miss"><td class="line">276</td><td class="hits">0</td><td class="source">		return this.applicationContext.async([ids], cb);</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> * Bearcat add module(bean) to IoC container through $ annotation function.</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source"> *	  bearcat.module(function() {</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source"> *		 this.$id = &quot;car&quot;;</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source"> *		 this.$scope = &quot;prototype&quot;;</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source"> *	  });</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source"> * @param  {Function} func $ annotation function</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">293</td><td class="hits">1</td><td class="source">Bearcat.module = function(func, context) {</td></tr><tr class="miss"><td class="line">294</td><td class="hits">0</td><td class="source">	if (this.state &lt; STATE_STARTED) {</td></tr><tr class="miss"><td class="line">295</td><td class="hits">0</td><td class="source">		return this.applicationContext.module(func, context);</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="miss"><td class="line">297</td><td class="hits">0</td><td class="source">		return this.getBean(func);</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source"> * Bearcat define module(bean).</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source"> *    bearcat.define('car', function(exports, module) {</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> *	     module.exports = function() {</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source"> *	         console.log('run car...')</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source"> *       }</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source"> *    }, typeof module !== 'undefined' ? module : {});</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source"> * @param  {String}   id</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source"> * @param  {Function} factory function</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source"> * @param  {object}   context object</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">317</td><td class="hits">1</td><td class="source">Bearcat.define = function(id, factory, context) {</td></tr><tr class="miss"><td class="line">318</td><td class="hits">0</td><td class="source">	return this.applicationContext.define(id, factory, context);</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source"> * Bearcat add module(bean) to IoC container through $ annotation function.</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source"> *	  var Car = bearcat.require('car');</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source"> * @param  {String} id</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">331</td><td class="hits">1</td><td class="source">Bearcat.require = function(id) {</td></tr><tr class="miss"><td class="line">332</td><td class="hits">0</td><td class="source">	return this.applicationContext.require(id);</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source"> * Bearcat get bean from IoC container through beanName or meta argument.</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">341</td><td class="hits"></td><td class="source"> *	  // through beanName</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source"> *	  var car = bearcat.getBean(&quot;car&quot;);</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source"> *	  // through meta</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source"> *	  var car = bearcat.getBean({</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source"> *		 id: &quot;car&quot;,</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source"> *		 func: Car // Car is a function constructor</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source"> *	  });</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source"> *	  // through $ annotation func</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source"> *	  var car = bearcat.getBean(function() {</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source"> *		 this.$id = &quot;car&quot;;</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source"> *		 this.$scope = &quot;prototype&quot;;</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source"> *	  });</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source"> * @return {Object} bean</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">360</td><td class="hits">1</td><td class="source">Bearcat.getBean = function(beanName) {</td></tr><tr class="hit"><td class="line">361</td><td class="hits">8</td><td class="source">	if (this.state &lt;= STATE_INITED) {</td></tr><tr class="hit"><td class="line">362</td><td class="hits">1</td><td class="source">		logger.warn('Bearcat application is not running now for %s %s state: %d', &quot;getBean&quot;, beanName, this.state);</td></tr><tr class="hit"><td class="line">363</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">366</td><td class="hits">7</td><td class="source">	var firstarg = beanName;</td></tr><tr class="hit"><td class="line">367</td><td class="hits">7</td><td class="source">	var func = &quot;&quot;;</td></tr><tr class="hit"><td class="line">368</td><td class="hits">7</td><td class="source">	if (Utils.checkObject(firstarg)) {</td></tr><tr class="hit"><td class="line">369</td><td class="hits">1</td><td class="source">		func = &quot;getBeanByMeta&quot;;</td></tr><tr class="hit"><td class="line">370</td><td class="hits">6</td><td class="source">	} else if (Utils.checkFunction(firstarg)) {</td></tr><tr class="hit"><td class="line">371</td><td class="hits">3</td><td class="source">		func = &quot;getBeanByFunc&quot;;</td></tr><tr class="hit"><td class="line">372</td><td class="hits">3</td><td class="source">	} else if (Utils.checkString(firstarg)) {</td></tr><tr class="hit"><td class="line">373</td><td class="hits">2</td><td class="source">		func = &quot;getBean&quot;;</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">375</td><td class="hits">1</td><td class="source">		logger.error('Bearcat application unsupported getBean arguments for %s', beanName);</td></tr><tr class="hit"><td class="line">376</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">379</td><td class="hits">6</td><td class="source">	return this.applicationContext[func].apply(this.applicationContext, arguments);</td></tr><tr><td class="line">380</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source"> * Bearcat get bean constructor function from IoC container through beanName.</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> *	  // through beanName</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> *	  var Car = bearcat.getFunction(&quot;car&quot;);</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> * @return {Function} bean constructor function</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">396</td><td class="hits">1</td><td class="source">Bearcat.getFunction = function(beanName) {</td></tr><tr class="hit"><td class="line">397</td><td class="hits">2</td><td class="source">	if (this.state &lt;= STATE_INITED) {</td></tr><tr class="hit"><td class="line">398</td><td class="hits">1</td><td class="source">		logger.warn('Bearcat application is not running now for %s %s state: %d', &quot;getFunction&quot;, beanName, this.state);</td></tr><tr class="hit"><td class="line">399</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">402</td><td class="hits">1</td><td class="source">	return this.applicationContext.getBeanFunction(beanName);</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source"> * Bearcat get bean constructor function from IoC container through beanName, the same as bearcat.getFunction.</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> *	  // through beanName</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source"> *	  var Car = bearcat.getClass(&quot;car&quot;);</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source"> * @return {Function} bean constructor function</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">419</td><td class="hits">1</td><td class="source">Bearcat.getClass = function(beanName) {</td></tr><tr class="miss"><td class="line">420</td><td class="hits">0</td><td class="source">	return Bearcat.getFunction(beanName);</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source"> * Bearcat shim to enable function inherits.</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source"> *	  bearcat.extend(&quot;bus&quot;, &quot;car&quot;);</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source"> * @param  {String}   		beanName</td></tr><tr><td class="line">433</td><td class="hits"></td><td class="source"> * @param  {String|Array}   superBeanName or superBeanName array</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">436</td><td class="hits">1</td><td class="source">Bearcat.extend = function(beanName, superBeanName) {</td></tr><tr class="miss"><td class="line">437</td><td class="hits">0</td><td class="source">	if (!beanName || !superBeanName) {</td></tr><tr class="miss"><td class="line">438</td><td class="hits">0</td><td class="source">		logger.error('[bearcat.extend] beanName or superBeanName can not be null');</td></tr><tr class="miss"><td class="line">439</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">442</td><td class="hits">0</td><td class="source">	this.applicationContext.extendBean(beanName, superBeanName);</td></tr><tr><td class="line">443</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source"> * Bearcat call function used for inherits to call super constructor function.</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source"> *	  bearcat.call(&quot;car&quot;, this);</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source"> * @param  {Object}   context</td></tr><tr><td class="line">456</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">457</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">458</td><td class="hits">1</td><td class="source">Bearcat.call = function(beanName, context) {</td></tr><tr class="miss"><td class="line">459</td><td class="hits">0</td><td class="source">	var beanFunction = Bearcat.getFunction(beanName);</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">461</td><td class="hits">0</td><td class="source">	if (!beanFunction) {</td></tr><tr class="miss"><td class="line">462</td><td class="hits">0</td><td class="source">		logger.error('[bearcat.call] bean function %s not exist', beanName);</td></tr><tr class="miss"><td class="line">463</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">466</td><td class="hits">0</td><td class="source">	var args = Array.prototype.slice.call(arguments, 2);</td></tr><tr class="miss"><td class="line">467</td><td class="hits">0</td><td class="source">	beanFunction.apply(context, args);</td></tr><tr><td class="line">468</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source"> * Bearcat get model from bearcat through modelId.</td></tr><tr><td class="line">472</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source"> *	  // through modelId</td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source"> *	  var carModel = bearcat.getModel(&quot;car&quot;);</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source"> * @param  {String}   modelId</td></tr><tr><td class="line">481</td><td class="hits"></td><td class="source"> * @return {Object}   model</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">483</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">484</td><td class="hits">1</td><td class="source">Bearcat.getModel = function(modelId) {</td></tr><tr class="hit"><td class="line">485</td><td class="hits">6</td><td class="source">	if (this.state &lt;= STATE_INITED) {</td></tr><tr class="hit"><td class="line">486</td><td class="hits">2</td><td class="source">		logger.warn('Bearcat application is not running now for %s %s state: %d', &quot;getModel&quot;, modelId, this.state);</td></tr><tr class="hit"><td class="line">487</td><td class="hits">2</td><td class="source">		return;</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">490</td><td class="hits">4</td><td class="source">	return this.applicationContext.getModel(modelId);</td></tr><tr><td class="line">491</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">494</td><td class="hits"></td><td class="source"> * Bearcat convenient function for using in MVC route mapping.</td></tr><tr><td class="line">495</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">496</td><td class="hits"></td><td class="source"> * Examples:</td></tr><tr><td class="line">497</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source"> *	  // express</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source"> *	  var app = express();</td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source"> *	  app.get('/', bearcat.getRoute('bearController', 'index'));</td></tr><tr><td class="line">502</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">505</td><td class="hits"></td><td class="source"> * @param  {String} fnName routeName</td></tr><tr><td class="line">506</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">507</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">508</td><td class="hits">1</td><td class="source">Bearcat.getRoute = function(beanName, fnName) {</td></tr><tr class="hit"><td class="line">509</td><td class="hits">3</td><td class="source">	if (this.state !== STATE_STARTED) {</td></tr><tr class="hit"><td class="line">510</td><td class="hits">2</td><td class="source">		return;</td></tr><tr><td class="line">511</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">512</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">513</td><td class="hits">1</td><td class="source">	var bean = this.getBean(beanName);</td></tr><tr class="hit"><td class="line">514</td><td class="hits">1</td><td class="source">	return bean[fnName].bind(bean);</td></tr><tr><td class="line">515</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">517</td><td class="hits">1</td><td class="source">module.exports = Bearcat;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/context/applicationContext.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/context/applicationContext.js</h2><div id="stats" class="medium"><div class="percentage">74%</div><div class="sloc">481</div><div class="hits">358</div><div class="misses">123</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ApplicationContext</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'ApplicationContext');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var PlaceHolderConfigurer = require('../beans/support/placeHolderConfigurer');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var AutoProxyCreator = require('../aop/autoproxy/autoProxyCreator');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var ModelKeyMapResolver = require('../model/modelKeyMapResolver');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var AsyncScriptLoader = require('../resource/asyncScriptLoader');</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var BootStrapLoader = require('../resource/bootStrapLoader');</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var ResourceLoader = require('../resource/resourceLoader');</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var defaultConstraints = require('../model/constraints');</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var ModuleFactory = require('../beans/moduleFactory');</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var BeanFactory = require('../beans/beanFactory');</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">var EventEmitter = require('events').EventEmitter;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">var RequireUtil = require('../util/requireUtil');</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">var Constant = require('../util/constant');</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">var FileUtil = require('../util/fileUtil');</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">var MetaUtil = require('../util/metaUtil');</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">var Path = RequireUtil.requirePath();</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">var Util = RequireUtil.requireUtil();</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">var DEFAULT_BASE = &quot;&quot;;</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">var DEFAULT_LOAD_PATH = &quot;&quot;;</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">var DEFAULT_HOT_RELOAD_PATH = &quot;&quot;;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">var Root;</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">(function() {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">	Root = this;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">}());</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * ApplicationContext constructor function.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @param  {Array} configLocations configuration paths</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">47</td><td class="hits">1</td><td class="source">var ApplicationContext = function(configLocations, opts) {</td></tr><tr class="hit"><td class="line">48</td><td class="hits">64</td><td class="source">	this.opts = opts || {};</td></tr><tr class="hit"><td class="line">49</td><td class="hits">64</td><td class="source">	this.configLocations = configLocations;</td></tr><tr class="hit"><td class="line">50</td><td class="hits">64</td><td class="source">	this.loadBeans = [];</td></tr><tr class="hit"><td class="line">51</td><td class="hits">64</td><td class="source">	this.active = false;</td></tr><tr class="hit"><td class="line">52</td><td class="hits">64</td><td class="source">	this.reloadMap = {};</td></tr><tr class="hit"><td class="line">53</td><td class="hits">64</td><td class="source">	this.beanFactory = null;</td></tr><tr class="hit"><td class="line">54</td><td class="hits">64</td><td class="source">	this.startUpDate = null;</td></tr><tr class="hit"><td class="line">55</td><td class="hits">64</td><td class="source">	this.extendBeanMap = {};</td></tr><tr class="hit"><td class="line">56</td><td class="hits">64</td><td class="source">	this.extendedBeanMap = {};</td></tr><tr class="hit"><td class="line">57</td><td class="hits">64</td><td class="source">	this.extendBeanCurMap = {};</td></tr><tr class="hit"><td class="line">58</td><td class="hits">64</td><td class="source">	this.moduleFactory = null;</td></tr><tr class="hit"><td class="line">59</td><td class="hits">64</td><td class="source">	this.resourceLoader = null;</td></tr><tr class="hit"><td class="line">60</td><td class="hits">64</td><td class="source">	this.bootStrapLoader = null;</td></tr><tr class="hit"><td class="line">61</td><td class="hits">64</td><td class="source">	this.asyncScriptLoader = null;</td></tr><tr class="hit"><td class="line">62</td><td class="hits">64</td><td class="source">	this.cpath = DEFAULT_LOAD_PATH;</td></tr><tr class="hit"><td class="line">63</td><td class="hits">64</td><td class="source">	this.hpath = DEFAULT_HOT_RELOAD_PATH;</td></tr><tr class="hit"><td class="line">64</td><td class="hits">64</td><td class="source">	this.env = Constant.DEFAULT_ENV;</td></tr><tr class="hit"><td class="line">65</td><td class="hits">64</td><td class="source">	this.base = DEFAULT_BASE;</td></tr><tr class="hit"><td class="line">66</td><td class="hits">64</td><td class="source">	this.beanFactoryPostProcessors = [];</td></tr><tr class="hit"><td class="line">67</td><td class="hits">64</td><td class="source">	EventEmitter.call(this);</td></tr><tr class="hit"><td class="line">68</td><td class="hits">64</td><td class="source">	this.init();</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">module.exports = ApplicationContext;</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">Util.inherits(ApplicationContext, EventEmitter);</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * ApplicationContext init.</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.init = function() {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">64</td><td class="source">	if (this.hasBeanFactory()) {</td></tr><tr class="miss"><td class="line">82</td><td class="hits">0</td><td class="source">		this.destroyBeans();</td></tr><tr class="miss"><td class="line">83</td><td class="hits">0</td><td class="source">		this.closeBeanFactory();</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">86</td><td class="hits">64</td><td class="source">	DEFAULT_BASE = process.cwd();</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">64</td><td class="source">	if (this.configLocations.length) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">61</td><td class="source">		var contextPath = this.configLocations[0];</td></tr><tr class="hit"><td class="line">90</td><td class="hits">61</td><td class="source">		DEFAULT_BASE = Path.dirname(contextPath);</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">64</td><td class="source">	DEFAULT_LOAD_PATH = DEFAULT_BASE + &quot;/config&quot;;</td></tr><tr class="hit"><td class="line">94</td><td class="hits">64</td><td class="source">	DEFAULT_HOT_RELOAD_PATH = DEFAULT_BASE + &quot;/app&quot;; // equal to scan path</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">96</td><td class="hits">64</td><td class="source">	this.cpath = DEFAULT_LOAD_PATH;</td></tr><tr class="hit"><td class="line">97</td><td class="hits">64</td><td class="source">	this.hpath = DEFAULT_HOT_RELOAD_PATH;</td></tr><tr class="hit"><td class="line">98</td><td class="hits">64</td><td class="source">	this.base = DEFAULT_BASE;</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">100</td><td class="hits">64</td><td class="source">	this.createBeanFactory();</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * ApplicationContext set container startUpDate.</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * @param  {Number} startUpDate</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">109</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.setStartupDate = function(startUpDate) {</td></tr><tr class="hit"><td class="line">110</td><td class="hits">1</td><td class="source">	this.startUpDate = startUpDate;</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * ApplicationContext get container startUpDate.</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> * @return  {Number} startUpDate</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">119</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getStartupDate = function() {</td></tr><tr class="hit"><td class="line">120</td><td class="hits">1</td><td class="source">	return this.startUpDate;</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> * ApplicationContext get resourceLoader.</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> * @return  {Object} resourceLoader</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">129</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getResourceLoader = function() {</td></tr><tr class="hit"><td class="line">130</td><td class="hits">61</td><td class="source">	this.resourceLoader = new ResourceLoader();</td></tr><tr class="hit"><td class="line">131</td><td class="hits">61</td><td class="source">	return this.resourceLoader;</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> * ApplicationContext get asyncScriptLoader.</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * @return  {Object} asyncScriptLoader</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">140</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getAsyncScriptLoader = function() {</td></tr><tr class="miss"><td class="line">141</td><td class="hits">0</td><td class="source">	if (this.asyncScriptLoader) {</td></tr><tr class="miss"><td class="line">142</td><td class="hits">0</td><td class="source">		return this.asyncScriptLoader;</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">145</td><td class="hits">0</td><td class="source">	this.asyncScriptLoader = new AsyncScriptLoader();</td></tr><tr class="miss"><td class="line">146</td><td class="hits">0</td><td class="source">	this.asyncScriptLoader.setApplicationContext(this);</td></tr><tr class="miss"><td class="line">147</td><td class="hits">0</td><td class="source">	return this.asyncScriptLoader;</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> * ApplicationContext get bootStrapLoader.</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source"> * @return  {Object} bootStrapLoader</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">156</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getBootStrapLoader = function() {</td></tr><tr class="miss"><td class="line">157</td><td class="hits">0</td><td class="source">	if (this.bootStrapLoader) {</td></tr><tr class="miss"><td class="line">158</td><td class="hits">0</td><td class="source">		return this.bootStrapLoader;</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">161</td><td class="hits">0</td><td class="source">	this.bootStrapLoader = new BootStrapLoader();</td></tr><tr class="miss"><td class="line">162</td><td class="hits">0</td><td class="source">	return this.bootStrapLoader;</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source"> * ApplicationContext get metaObjects resource from contextPath.</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> * @param   {String} cpath contextPath</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> * @return  {Object} metaObjects</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">172</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getResource = function(cpath) {</td></tr><tr class="hit"><td class="line">173</td><td class="hits">61</td><td class="source">	if (Root.__bearcatData__ &amp;&amp; Root.__bearcatData__.metas) {</td></tr><tr class="miss"><td class="line">174</td><td class="hits">0</td><td class="source">		return Root.__bearcatData__.metas;</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">177</td><td class="hits">61</td><td class="source">	return this.resourceLoader.load(cpath);</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> * ApplicationContext get contextPath locations.</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> * @return  {Array} contextPath locations</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">186</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getConfigLocations = function() {</td></tr><tr class="hit"><td class="line">187</td><td class="hits">61</td><td class="source">	return this.configLocations;</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> * ApplicationContext add beanFactoryPostProcessor.</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> * @param  {Object} beanFactoryPostProcessor</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">196</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.addBeanFactoryPostProcessor = function(beanFactoryPostProcessor) {</td></tr><tr class="hit"><td class="line">197</td><td class="hits">122</td><td class="source">	this.beanFactoryPostProcessors.push(beanFactoryPostProcessor);</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> * ApplicationContext get beanFactoryPostProcessors.</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> * @return  {Array} beanFactoryPostProcessors</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">206</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getBeanFactoryProcessors = function() {</td></tr><tr class="hit"><td class="line">207</td><td class="hits">420</td><td class="source">	return this.beanFactoryPostProcessors;</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> * ApplicationContext do refresh actions.</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> * refresh beanFactory, preIntialize singleton Beans</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> * @param  {Function} cb callback function</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">217</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.refresh = function(cb) {</td></tr><tr class="hit"><td class="line">218</td><td class="hits">61</td><td class="source">	var self = this;</td></tr><tr class="hit"><td class="line">219</td><td class="hits">61</td><td class="source">	cb = cb || function() {};</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">	// Prepare context for refresh</td></tr><tr class="hit"><td class="line">222</td><td class="hits">61</td><td class="source">	self.prepareRefresh();</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">	// Refresh internal beanFactory</td></tr><tr class="hit"><td class="line">225</td><td class="hits">61</td><td class="source">	self.refreshBeanFactory();</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">	// Extend beans</td></tr><tr class="hit"><td class="line">228</td><td class="hits">61</td><td class="source">	self.doExtendBeans();</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source">	// Try Async loading for dependencies</td></tr><tr class="hit"><td class="line">231</td><td class="hits">61</td><td class="source">	self.tryAsyncLoading(function() {</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">		// Try loading from bearcat-bootstrap.js for dependencies</td></tr><tr class="hit"><td class="line">234</td><td class="hits">61</td><td class="source">		self.tryBootStrapLoading();</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">		// Prepare beanFactory for this context</td></tr><tr class="hit"><td class="line">237</td><td class="hits">61</td><td class="source">		self.prepareBeanFactory();</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">239</td><td class="hits">61</td><td class="source">		self.postProcessBeanFactory();</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">		// Invoke factory processors registered as beans in the context.</td></tr><tr class="hit"><td class="line">242</td><td class="hits">61</td><td class="source">		self.invokeBeanFactoryPostProcessors();</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">		// Register bean processors that intercept bean creation.</td></tr><tr class="hit"><td class="line">245</td><td class="hits">61</td><td class="source">		self.registerBeanPostProcessors();</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">		// Instantiate all remaining (non-lazy-init) singletons</td></tr><tr class="hit"><td class="line">248</td><td class="hits">61</td><td class="source">		self.finishBeanFactoryIntialization(function() {</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source">			// Last step: publish corresponding event.</td></tr><tr class="hit"><td class="line">251</td><td class="hits">61</td><td class="source">			self.finishRefresh();</td></tr><tr class="hit"><td class="line">252</td><td class="hits">61</td><td class="source">			cb();</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source">		});</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source"> * ApplicationContext prepareRefresh.</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source"> * init startUpDate, active status</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source"> * get resourceLoader and load context paths</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">264</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.prepareRefresh = function() {</td></tr><tr class="hit"><td class="line">265</td><td class="hits">61</td><td class="source">	this.startUpDate = Date.now();</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">267</td><td class="hits">61</td><td class="source">	this.active = true;</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">269</td><td class="hits">61</td><td class="source">	var opts = this.opts;</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">271</td><td class="hits">61</td><td class="source">	if (opts['NODE_ENV']) {</td></tr><tr class="miss"><td class="line">272</td><td class="hits">0</td><td class="source">		process.env.NODE_ENV = opts['NODE_ENV'];</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">275</td><td class="hits">61</td><td class="source">	if (opts['BEARCAT_ENV']) {</td></tr><tr class="miss"><td class="line">276</td><td class="hits">0</td><td class="source">		process.env.BEARCAT_ENV = opts['BEARCAT_ENV'];</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">279</td><td class="hits">61</td><td class="source">	if (opts['NODE_CPATH']) {</td></tr><tr class="miss"><td class="line">280</td><td class="hits">0</td><td class="source">		process.env.NODE_CPATH = opts['NODE_CPATH'];</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">283</td><td class="hits">61</td><td class="source">	if (opts['BEARCAT_CPATH']) {</td></tr><tr class="miss"><td class="line">284</td><td class="hits">0</td><td class="source">		process.env.BEARCAT_CPATH = opts['BEARCAT_CPATH'];</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">287</td><td class="hits">61</td><td class="source">	if (opts['BEARCAT_LOGGER'] &amp;&amp; opts['BEARCAT_LOGGER'] === 'off') {</td></tr><tr class="hit"><td class="line">288</td><td class="hits">1</td><td class="source">		process.env.BEARCAT_LOGGER = 'off';</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">291</td><td class="hits">61</td><td class="source">	if (opts['BEARCAT_HOT'] &amp;&amp; opts['BEARCAT_HOT'] === 'on') {</td></tr><tr class="hit"><td class="line">292</td><td class="hits">1</td><td class="source">		process.env.BEARCAT_HOT = 'on';</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">295</td><td class="hits">61</td><td class="source">	if (opts['BEARCAT_ANNOTATION'] &amp;&amp; opts['BEARCAT_ANNOTATION'] === 'off') {</td></tr><tr class="miss"><td class="line">296</td><td class="hits">0</td><td class="source">		process.env.BEARCAT_ANNOTATION = 'off';</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">299</td><td class="hits">61</td><td class="source">	if (opts['BEARCAT_FUNCTION_STRING']) {</td></tr><tr class="miss"><td class="line">300</td><td class="hits">0</td><td class="source">		process.env.BEARCAT_FUNCTION_STRING = true;</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">303</td><td class="hits">61</td><td class="source">	this.getResourceLoader();</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">305</td><td class="hits">61</td><td class="source">	this.beanFactoryPostProcessors = [];</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">307</td><td class="hits">61</td><td class="source">	var args = Utils.parseArgs(process.argv);</td></tr><tr class="hit"><td class="line">308</td><td class="hits">61</td><td class="source">	var env = this.getEnv();</td></tr><tr class="hit"><td class="line">309</td><td class="hits">61</td><td class="source">	env = args.env || args['--env'] || process.env.NODE_ENV || process.env.BEARCAT_ENV || env || Constant.DEFAULT_ENV;</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">311</td><td class="hits">61</td><td class="source">	this.setEnv(env);</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">313</td><td class="hits">61</td><td class="source">	var cpath = this.getConfigPath();</td></tr><tr class="hit"><td class="line">314</td><td class="hits">61</td><td class="source">	cpath = args.cpath || args['--cpath'] || process.env.NODE_CPATH || process.env.BEARCAT_CPATH || cpath;</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">316</td><td class="hits">61</td><td class="source">	this.setConfigPath(cpath);</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">318</td><td class="hits">61</td><td class="source">	if (Utils.checkBrowser()) {</td></tr><tr class="miss"><td class="line">319</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">322</td><td class="hits">61</td><td class="source">	MetaUtil.cleanUp();</td></tr><tr class="hit"><td class="line">323</td><td class="hits">61</td><td class="source">	var base = this.getBase();</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">325</td><td class="hits">61</td><td class="source">	if (process.env.BEARCAT_LOGGER !== 'off') {</td></tr><tr class="hit"><td class="line">326</td><td class="hits">5</td><td class="source">		var originLoggerConfigPath = Path.join(cpath, Constant.LOGPATH);</td></tr><tr class="hit"><td class="line">327</td><td class="hits">5</td><td class="source">		var presentLoggerConfigPath = Path.join(cpath, env, Constant.LOGPATH);</td></tr><tr class="hit"><td class="line">328</td><td class="hits">5</td><td class="source">		if (FileUtil.existsSync(originLoggerConfigPath)) {</td></tr><tr class="miss"><td class="line">329</td><td class="hits">0</td><td class="source">			require('pomelo-logger').configure(originLoggerConfigPath, {</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source">				base: base</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source">			});</td></tr><tr class="hit"><td class="line">332</td><td class="hits">5</td><td class="source">		} else if (FileUtil.existsSync(presentLoggerConfigPath)) {</td></tr><tr class="miss"><td class="line">333</td><td class="hits">0</td><td class="source">			require('pomelo-logger').configure(presentLoggerConfigPath, {</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source">				base: base</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source">			});</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source">		} else {</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source">			// logger.error('logger file path configuration is error.');</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">341</td><td class="hits">61</td><td class="source">	var hpath = this.getHotPath();</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">	// BEARCAT_HPATH can be array</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source">	// process.env.BEARCAT_HPATH will JSON.stringify this value</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source">	// so do not use process.env.BEARCAT_HPATH</td></tr><tr class="hit"><td class="line">345</td><td class="hits">61</td><td class="source">	hpath = args.hpath || args['--hpath'] || opts['BEARCAT_HPATH'] || hpath;</td></tr><tr class="hit"><td class="line">346</td><td class="hits">61</td><td class="source">	this.setHotPath(hpath);</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">348</td><td class="hits">61</td><td class="source">	if (process.env.BEARCAT_HOT === 'on') {</td></tr><tr class="hit"><td class="line">349</td><td class="hits">27</td><td class="source">		this.hotReloadFileWatch(hpath);</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source"> * ApplicationContext refreshBeanFactory.</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source"> * reload beanFactory with refresh metaObjects</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">359</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.refreshBeanFactory = function() {</td></tr><tr class="hit"><td class="line">360</td><td class="hits">61</td><td class="source">	this.configLocations = this.getConfigLocations();</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">362</td><td class="hits">61</td><td class="source">	this.loadDefaultConstraints();</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">364</td><td class="hits">61</td><td class="source">	var len = this.configLocations.length;</td></tr><tr class="hit"><td class="line">365</td><td class="hits">61</td><td class="source">	for (var i = 0; i &lt; len; i++) {</td></tr><tr class="hit"><td class="line">366</td><td class="hits">61</td><td class="source">		this.beanFactory.registerBeans(this.getResource(this.configLocations[i]));</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">369</td><td class="hits">61</td><td class="source">	if (!len) {</td></tr><tr class="miss"><td class="line">370</td><td class="hits">0</td><td class="source">		this.beanFactory.registerBeans(this.getResource());</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">373</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source"> * ApplicationContext try async loading script files when in the frontend.</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">379</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.tryAsyncLoading = function(cb) {</td></tr><tr class="hit"><td class="line">380</td><td class="hits">61</td><td class="source">	if (!Utils.checkBrowser() || Utils.checkCocos2dJsb()) {</td></tr><tr class="hit"><td class="line">381</td><td class="hits">61</td><td class="source">		return cb();</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">384</td><td class="hits">0</td><td class="source">	var loadBeans = this.loadBeans;</td></tr><tr class="miss"><td class="line">385</td><td class="hits">0</td><td class="source">	if (!loadBeans || !loadBeans.length) {</td></tr><tr class="miss"><td class="line">386</td><td class="hits">0</td><td class="source">		return cb();</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">389</td><td class="hits">0</td><td class="source">	return this.doAsyncLoading(cb);</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> * ApplicationContext internal do async loading script files when in the frontend.</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">397</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.doAsyncLoading = function(cb) {</td></tr><tr class="miss"><td class="line">398</td><td class="hits">0</td><td class="source">	var loadBeans = this.loadBeans;</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">400</td><td class="hits">0</td><td class="source">	var asyncScriptLoader = this.getAsyncScriptLoader();</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">402</td><td class="hits">0</td><td class="source">	return asyncScriptLoader.load(loadBeans, cb);</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source"> * ApplicationContext try loading script files from bearcat-bootstrap.js when in cocos2d-js jsb env.</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">410</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.tryBootStrapLoading = function() {</td></tr><tr class="hit"><td class="line">411</td><td class="hits">61</td><td class="source">	if (!Utils.checkCocos2dJsb()) {</td></tr><tr class="hit"><td class="line">412</td><td class="hits">61</td><td class="source">		return;</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">415</td><td class="hits">0</td><td class="source">	if (Root.__bearcatData__ &amp;&amp; Root.__bearcatData__.idPaths) {</td></tr><tr class="miss"><td class="line">416</td><td class="hits">0</td><td class="source">		idPaths = Root.__bearcatData__.idPaths;</td></tr><tr class="miss"><td class="line">417</td><td class="hits">0</td><td class="source">		var bootStrapLoader = this.getBootStrapLoader();</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">419</td><td class="hits">0</td><td class="source">		return bootStrapLoader.load(idPaths);</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source"> * ApplicationContext prepareBeanFactory.</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> * register default beans into beanFactory</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">429</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.prepareBeanFactory = function() {</td></tr><tr class="hit"><td class="line">430</td><td class="hits">61</td><td class="source">	var placeHolderConfigurer = new PlaceHolderConfigurer();</td></tr><tr class="hit"><td class="line">431</td><td class="hits">61</td><td class="source">	if (Utils.isNotNull(this.env)) {</td></tr><tr class="hit"><td class="line">432</td><td class="hits">61</td><td class="source">		placeHolderConfigurer.setEnv(this.env);</td></tr><tr><td class="line">433</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">435</td><td class="hits">61</td><td class="source">	if (Utils.isNotNull(this.cpath)) {</td></tr><tr class="hit"><td class="line">436</td><td class="hits">61</td><td class="source">		placeHolderConfigurer.setConfigPath(this.cpath);</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">438</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">439</td><td class="hits">61</td><td class="source">	var modelKeyMapResolver = new ModelKeyMapResolver();</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">441</td><td class="hits">61</td><td class="source">	this.addBeanFactoryPostProcessor(placeHolderConfigurer);</td></tr><tr class="hit"><td class="line">442</td><td class="hits">61</td><td class="source">	this.addBeanFactoryPostProcessor(modelKeyMapResolver);</td></tr><tr><td class="line">443</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source"> * ApplicationContext registerBeanMeta.</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source"> * register metaObject</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source"> * @param  {Object} metaObject</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">453</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.registerBeanMeta = function(meta) {</td></tr><tr class="hit"><td class="line">454</td><td class="hits">360</td><td class="source">	var id = meta['id'];</td></tr><tr class="hit"><td class="line">455</td><td class="hits">360</td><td class="source">	if (!id) {</td></tr><tr class="hit"><td class="line">456</td><td class="hits">1</td><td class="source">		logger.error('ApplicationContext registerBean error meta no id.');</td></tr><tr class="hit"><td class="line">457</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">460</td><td class="hits">359</td><td class="source">	var metaObject = {};</td></tr><tr class="hit"><td class="line">461</td><td class="hits">359</td><td class="source">	metaObject[id] = meta;</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">463</td><td class="hits">359</td><td class="source">	this.beanFactory.registerBeans(metaObject);</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source"> * ApplicationContext load default constraints.</td></tr><tr><td class="line">468</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">471</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.loadDefaultConstraints = function() {</td></tr><tr class="hit"><td class="line">472</td><td class="hits">61</td><td class="source">	for (var key in defaultConstraints) {</td></tr><tr class="hit"><td class="line">473</td><td class="hits">366</td><td class="source">		this.getBeanByFunc(defaultConstraints[key]);</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source"> * ApplicationContext hotReloadFileWatch.</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source"> * @param  {String} hpath hot reload path</td></tr><tr><td class="line">481</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">483</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.hotReloadFileWatch = function(hpath) {</td></tr><tr class="hit"><td class="line">484</td><td class="hits">27</td><td class="source">	var self = this;</td></tr><tr class="hit"><td class="line">485</td><td class="hits">27</td><td class="source">	var watcher = require('chokidar').watch(hpath, {</td></tr><tr><td class="line">486</td><td class="hits"></td><td class="source">		ignored: /[\/\\]\./,</td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source">		ignoreInitial: true</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">490</td><td class="hits">27</td><td class="source">	if (!watcher) {</td></tr><tr class="miss"><td class="line">491</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">492</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">494</td><td class="hits">27</td><td class="source">	logger.info('bearcat hot reload watch %j', hpath);</td></tr><tr class="hit"><td class="line">495</td><td class="hits">27</td><td class="source">	watcher.on('all', function(event, path) {</td></tr><tr class="hit"><td class="line">496</td><td class="hits">2</td><td class="source">		if (event != 'change' &amp;&amp; event != 'add') {</td></tr><tr class="miss"><td class="line">497</td><td class="hits">0</td><td class="source">			return;</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">500</td><td class="hits">2</td><td class="source">		var filename = path;</td></tr><tr class="hit"><td class="line">501</td><td class="hits">2</td><td class="source">		if (!Utils.checkString(filename)) {</td></tr><tr class="miss"><td class="line">502</td><td class="hits">0</td><td class="source">			return;</td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">505</td><td class="hits">2</td><td class="source">		var id = Utils.getFileName(filename, '.js'.length);</td></tr><tr><td class="line">506</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">507</td><td class="hits">2</td><td class="source">		if (!Utils.checkFileType(filename, '.js') || !Utils.isFile(filename)) {</td></tr><tr class="miss"><td class="line">508</td><td class="hits">0</td><td class="source">			return;</td></tr><tr><td class="line">509</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">510</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">511</td><td class="hits">2</td><td class="source">		var pid = process.pid;</td></tr><tr class="hit"><td class="line">512</td><td class="hits">2</td><td class="source">		var s = Math.floor(Math.random(0, 1) * 5);</td></tr><tr class="hit"><td class="line">513</td><td class="hits">2</td><td class="source">		var m = Math.floor(Math.random(0, 1) * 10);</td></tr><tr class="hit"><td class="line">514</td><td class="hits">2</td><td class="source">		var p = Math.floor(Math.random(0, 1) * 100);</td></tr><tr class="hit"><td class="line">515</td><td class="hits">2</td><td class="source">		var t = s * 1000 + p * (pid % 100) + p + s * m;</td></tr><tr><td class="line">516</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">517</td><td class="hits">2</td><td class="source">		var doHotReload = function() {</td></tr><tr class="hit"><td class="line">518</td><td class="hits">2</td><td class="source">			logger.info('%s changed, bearcat start hot reloading %d ...', filename, t);</td></tr><tr class="hit"><td class="line">519</td><td class="hits">2</td><td class="source">			var meta = Utils.myRequireHot(filename);</td></tr><tr class="hit"><td class="line">520</td><td class="hits">2</td><td class="source">			if (!meta) {</td></tr><tr class="miss"><td class="line">521</td><td class="hits">0</td><td class="source">				return;</td></tr><tr><td class="line">522</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">523</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">524</td><td class="hits">2</td><td class="source">			if (Utils.checkFunction(meta)) {</td></tr><tr class="hit"><td class="line">525</td><td class="hits">1</td><td class="source">				meta = MetaUtil.resolveFuncAnnotation(meta, null, true);</td></tr><tr><td class="line">526</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">527</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">528</td><td class="hits">2</td><td class="source">			if (Utils.checkObject(meta)) {</td></tr><tr class="hit"><td class="line">529</td><td class="hits">2</td><td class="source">				id = meta['id'];</td></tr><tr class="hit"><td class="line">530</td><td class="hits">2</td><td class="source">				var func = meta['func'];</td></tr><tr><td class="line">531</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">532</td><td class="hits">2</td><td class="source">				if (event == 'add') {</td></tr><tr><td class="line">533</td><td class="hits"></td><td class="source">					// dynamic add file</td></tr><tr class="miss"><td class="line">534</td><td class="hits">0</td><td class="source">					logger.info('bearcat reload add bean %s', id);</td></tr><tr class="miss"><td class="line">535</td><td class="hits">0</td><td class="source">					self.registerBeanMeta(meta);</td></tr><tr><td class="line">536</td><td class="hits"></td><td class="source">				} else {</td></tr><tr class="hit"><td class="line">537</td><td class="hits">2</td><td class="source">					if (id &amp;&amp; Utils.checkFunction(func)) {</td></tr><tr class="hit"><td class="line">538</td><td class="hits">2</td><td class="source">						var beanFactory = self.getBeanFactory();</td></tr><tr class="hit"><td class="line">539</td><td class="hits">2</td><td class="source">						var beanFunc = beanFactory.getBeanFunction(id);</td></tr><tr><td class="line">540</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">541</td><td class="hits">2</td><td class="source">						self.doHotAddAttributes(meta, id);</td></tr><tr class="hit"><td class="line">542</td><td class="hits">2</td><td class="source">						if (beanFunc) {</td></tr><tr class="hit"><td class="line">543</td><td class="hits">2</td><td class="source">							var proto = func.prototype;</td></tr><tr><td class="line">544</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">545</td><td class="hits">2</td><td class="source">							logger.info('bearcat reload update bean %s', id);</td></tr><tr class="hit"><td class="line">546</td><td class="hits">2</td><td class="source">							for (var key in proto) {</td></tr><tr><td class="line">547</td><td class="hits"></td><td class="source">								// logger.info('bearcat reload update prototype %s:%s', id, key);</td></tr><tr class="hit"><td class="line">548</td><td class="hits">3</td><td class="source">								beanFunc.prototype[key] = proto[key];</td></tr><tr><td class="line">549</td><td class="hits"></td><td class="source">							}</td></tr><tr><td class="line">550</td><td class="hits"></td><td class="source">						}</td></tr><tr><td class="line">551</td><td class="hits"></td><td class="source">					}</td></tr><tr><td class="line">552</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">553</td><td class="hits"></td><td class="source">			}</td></tr><tr class="hit"><td class="line">554</td><td class="hits">2</td><td class="source">			self.emit('reload');</td></tr><tr class="hit"><td class="line">555</td><td class="hits">2</td><td class="source">			logger.info('bearcat hot reloading done ...');</td></tr><tr><td class="line">556</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">557</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">558</td><td class="hits">2</td><td class="source">		setTimeout(doHotReload, t);</td></tr><tr><td class="line">559</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">560</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">561</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">562</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">563</td><td class="hits"></td><td class="source"> * ApplicationContext do hot add attributes.</td></tr><tr><td class="line">564</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">565</td><td class="hits"></td><td class="source"> * @param  {Object} hot reload new metaObject</td></tr><tr><td class="line">566</td><td class="hits"></td><td class="source"> * @param  {String} hot reload bean name</td></tr><tr><td class="line">567</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">568</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">569</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.doHotAddAttributes = function(metaObject, beanName) {</td></tr><tr class="hit"><td class="line">570</td><td class="hits">2</td><td class="source">	var beanFactory = this.getBeanFactory();</td></tr><tr class="hit"><td class="line">571</td><td class="hits">2</td><td class="source">	var beanFunc = beanFactory.getBeanFunction(beanName);</td></tr><tr class="hit"><td class="line">572</td><td class="hits">2</td><td class="source">	var beanDefinition = beanFactory.getBeanDefinition(beanName);</td></tr><tr><td class="line">573</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">574</td><td class="hits">2</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="miss"><td class="line">575</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">576</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">577</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">578</td><td class="hits">2</td><td class="source">	var beanPrototype = beanFunc.prototype;</td></tr><tr class="hit"><td class="line">579</td><td class="hits">2</td><td class="source">	var propsOn = beanDefinition.getPropsOn();</td></tr><tr class="hit"><td class="line">580</td><td class="hits">2</td><td class="source">	var props = metaObject.props;</td></tr><tr><td class="line">581</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">582</td><td class="hits">2</td><td class="source">	if (!Utils.checkArray(props)) {</td></tr><tr class="hit"><td class="line">583</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">584</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">585</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">586</td><td class="hits">1</td><td class="source">	for (var i = 0; i &lt; props.length; i++) {</td></tr><tr class="hit"><td class="line">587</td><td class="hits">3</td><td class="source">		(function(w) {</td></tr><tr class="hit"><td class="line">588</td><td class="hits">3</td><td class="source">			var name = w.name;</td></tr><tr class="hit"><td class="line">589</td><td class="hits">3</td><td class="source">			var flag = 1;</td></tr><tr><td class="line">590</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">591</td><td class="hits">3</td><td class="source">			for (j = 0; j &lt; propsOn.length; j++) {</td></tr><tr class="miss"><td class="line">592</td><td class="hits">0</td><td class="source">				var p = propsOn[j];</td></tr><tr class="miss"><td class="line">593</td><td class="hits">0</td><td class="source">				if (name === p.getName()) {</td></tr><tr class="miss"><td class="line">594</td><td class="hits">0</td><td class="source">					flag = 0;</td></tr><tr class="miss"><td class="line">595</td><td class="hits">0</td><td class="source">					break;</td></tr><tr><td class="line">596</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">597</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">598</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">599</td><td class="hits"></td><td class="source">			// new prop attribute</td></tr><tr class="hit"><td class="line">600</td><td class="hits">3</td><td class="source">			if (flag) {</td></tr><tr class="hit"><td class="line">601</td><td class="hits">3</td><td class="source">				var value = w.value;</td></tr><tr class="hit"><td class="line">602</td><td class="hits">3</td><td class="source">				var ref = w.ref;</td></tr><tr class="hit"><td class="line">603</td><td class="hits">3</td><td class="source">				var key = &quot;&quot;;</td></tr><tr class="hit"><td class="line">604</td><td class="hits">3</td><td class="source">				if (ref) {</td></tr><tr class="hit"><td class="line">605</td><td class="hits">2</td><td class="source">					key = Constant.DEFINE_GETTER_PREFIX + name;</td></tr><tr><td class="line">606</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">607</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">608</td><td class="hits">3</td><td class="source">				logger.info('hot reload add attribute %s to %s', name, beanName);</td></tr><tr class="hit"><td class="line">609</td><td class="hits">3</td><td class="source">				beanPrototype.__defineGetter__(name, function() {</td></tr><tr class="hit"><td class="line">610</td><td class="hits">2</td><td class="source">					if (value) {</td></tr><tr class="miss"><td class="line">611</td><td class="hits">0</td><td class="source">						return value;</td></tr><tr><td class="line">612</td><td class="hits"></td><td class="source">					}</td></tr><tr><td class="line">613</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">614</td><td class="hits">2</td><td class="source">					if (ref) {</td></tr><tr class="hit"><td class="line">615</td><td class="hits">2</td><td class="source">						if (!this[key]) {</td></tr><tr class="hit"><td class="line">616</td><td class="hits">2</td><td class="source">							this[key] = beanFactory.getBean(ref);</td></tr><tr><td class="line">617</td><td class="hits"></td><td class="source">						}</td></tr><tr><td class="line">618</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">619</td><td class="hits">2</td><td class="source">						return this[key];</td></tr><tr><td class="line">620</td><td class="hits"></td><td class="source">					}</td></tr><tr><td class="line">621</td><td class="hits"></td><td class="source">				});</td></tr><tr><td class="line">622</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">623</td><td class="hits"></td><td class="source">		})(props[i]);</td></tr><tr><td class="line">624</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">625</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">626</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">627</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.postProcessBeanFactory = function() {</td></tr><tr><td class="line">628</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">629</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">630</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">631</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">632</td><td class="hits"></td><td class="source"> * ApplicationContext register bean post processors.</td></tr><tr><td class="line">633</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">634</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">635</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">636</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.registerBeanPostProcessors = function() {</td></tr><tr class="hit"><td class="line">637</td><td class="hits">61</td><td class="source">	var autoProxyCreator = new AutoProxyCreator();</td></tr><tr class="hit"><td class="line">638</td><td class="hits">61</td><td class="source">	autoProxyCreator.setBeanFactory(this.getBeanFactory());</td></tr><tr class="hit"><td class="line">639</td><td class="hits">61</td><td class="source">	this.beanFactory.addBeanPostProcessor(autoProxyCreator);</td></tr><tr><td class="line">640</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">641</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">642</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">643</td><td class="hits"></td><td class="source"> * ApplicationContext invoke bean factory post processors.</td></tr><tr><td class="line">644</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">645</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">646</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">647</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.invokeBeanFactoryPostProcessors = function() {</td></tr><tr class="hit"><td class="line">648</td><td class="hits">420</td><td class="source">	var beanFactory = this.getBeanFactory();</td></tr><tr class="hit"><td class="line">649</td><td class="hits">420</td><td class="source">	var postProcessors = this.getBeanFactoryProcessors();</td></tr><tr class="hit"><td class="line">650</td><td class="hits">420</td><td class="source">	for (var i = 0; i &lt; postProcessors.length; i++) {</td></tr><tr class="hit"><td class="line">651</td><td class="hits">132</td><td class="source">		var postProcessor = postProcessors[i];</td></tr><tr class="hit"><td class="line">652</td><td class="hits">132</td><td class="source">		postProcessor.postProcessBeanFactory(beanFactory);</td></tr><tr><td class="line">653</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">654</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">655</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">656</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">657</td><td class="hits"></td><td class="source"> * ApplicationContext finish beanFactory singleton beans intialization.</td></tr><tr><td class="line">658</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">659</td><td class="hits"></td><td class="source"> * @param  {Function} cb callback function</td></tr><tr><td class="line">660</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">661</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">662</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.finishBeanFactoryIntialization = function(cb) {</td></tr><tr class="hit"><td class="line">663</td><td class="hits">61</td><td class="source">	this.beanFactory.preInstantiateSingletons(cb);</td></tr><tr><td class="line">664</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">665</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">666</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">667</td><td class="hits"></td><td class="source"> * ApplicationContext finish refresh event emit.</td></tr><tr><td class="line">668</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">669</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">670</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">671</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.finishRefresh = function() {</td></tr><tr class="hit"><td class="line">672</td><td class="hits">61</td><td class="source">	var self = this;</td></tr><tr class="hit"><td class="line">673</td><td class="hits">61</td><td class="source">	this.emit('finishRefresh');</td></tr><tr><td class="line">674</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">675</td><td class="hits">61</td><td class="source">	if (process.browser) {</td></tr><tr class="miss"><td class="line">676</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">677</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">678</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">679</td><td class="hits">61</td><td class="source">	var listeners = process.listeners('SIGTERM');</td></tr><tr class="hit"><td class="line">680</td><td class="hits">61</td><td class="source">	if (listeners &amp;&amp; listeners.length) {</td></tr><tr class="hit"><td class="line">681</td><td class="hits">60</td><td class="source">		return;</td></tr><tr><td class="line">682</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">683</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">684</td><td class="hits">1</td><td class="source">	var destroyFlag = false;</td></tr><tr class="hit"><td class="line">685</td><td class="hits">1</td><td class="source">	var doDestroy = function() {</td></tr><tr class="miss"><td class="line">686</td><td class="hits">0</td><td class="source">		if (destroyFlag) {</td></tr><tr class="miss"><td class="line">687</td><td class="hits">0</td><td class="source">			return;</td></tr><tr><td class="line">688</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">689</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">690</td><td class="hits">0</td><td class="source">		destroyFlag = true;</td></tr><tr class="miss"><td class="line">691</td><td class="hits">0</td><td class="source">		logger.info('Bearcat starts destroying...');</td></tr><tr class="miss"><td class="line">692</td><td class="hits">0</td><td class="source">		self.destroy();</td></tr><tr class="miss"><td class="line">693</td><td class="hits">0</td><td class="source">		process.exit();</td></tr><tr><td class="line">694</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">695</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">696</td><td class="hits">1</td><td class="source">	process.on('SIGINT', doDestroy);</td></tr><tr class="hit"><td class="line">697</td><td class="hits">1</td><td class="source">	process.on('SIGTERM', doDestroy);</td></tr><tr class="hit"><td class="line">698</td><td class="hits">1</td><td class="source">	process.on('SIGHUP', doDestroy);</td></tr><tr><td class="line">699</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">700</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">701</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">702</td><td class="hits"></td><td class="source"> * ApplicationContext cancel refresh.</td></tr><tr><td class="line">703</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">704</td><td class="hits"></td><td class="source"> * @api publish</td></tr><tr><td class="line">705</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">706</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.cancelRefresh = function() {</td></tr><tr class="hit"><td class="line">707</td><td class="hits">1</td><td class="source">	this.active = false;</td></tr><tr><td class="line">708</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">709</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">710</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.registerShutdownHook = function() {</td></tr><tr><td class="line">711</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">712</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">713</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">714</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">715</td><td class="hits"></td><td class="source"> * ApplicationContext destroy.</td></tr><tr><td class="line">716</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">717</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">718</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">719</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.destroy = function() {</td></tr><tr class="hit"><td class="line">720</td><td class="hits">12</td><td class="source">	this.close();</td></tr><tr><td class="line">721</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">722</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">723</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">724</td><td class="hits"></td><td class="source"> * ApplicationContext close.</td></tr><tr><td class="line">725</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">726</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">727</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">728</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.close = function() {</td></tr><tr class="hit"><td class="line">729</td><td class="hits">12</td><td class="source">	this.doClose();</td></tr><tr><td class="line">730</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">731</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">732</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">733</td><td class="hits"></td><td class="source"> * ApplicationContext do close.</td></tr><tr><td class="line">734</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">735</td><td class="hits"></td><td class="source"> * destroyBeans, closeBeanFactory, free resourceLoader, etc..</td></tr><tr><td class="line">736</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">737</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">738</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.doClose = function() {</td></tr><tr class="hit"><td class="line">739</td><td class="hits">12</td><td class="source">	this.configLocations = null;</td></tr><tr class="hit"><td class="line">740</td><td class="hits">12</td><td class="source">	this.startUpDate = null;</td></tr><tr class="hit"><td class="line">741</td><td class="hits">12</td><td class="source">	this.active = false;</td></tr><tr class="hit"><td class="line">742</td><td class="hits">12</td><td class="source">	if (this.hasBeanFactory()) {</td></tr><tr class="hit"><td class="line">743</td><td class="hits">12</td><td class="source">		this.destroyBeans();</td></tr><tr class="hit"><td class="line">744</td><td class="hits">12</td><td class="source">		this.closeBeanFactory();</td></tr><tr><td class="line">745</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">746</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">747</td><td class="hits">12</td><td class="source">	MetaUtil.cleanUp();</td></tr><tr class="hit"><td class="line">748</td><td class="hits">12</td><td class="source">	this.beanFactory = null;</td></tr><tr class="hit"><td class="line">749</td><td class="hits">12</td><td class="source">	this.resourceLoader = null;</td></tr><tr class="hit"><td class="line">750</td><td class="hits">12</td><td class="source">	this.beanFactoryPostProcessors = [];</td></tr><tr class="hit"><td class="line">751</td><td class="hits">12</td><td class="source">	this.cpath = DEFAULT_LOAD_PATH;</td></tr><tr class="hit"><td class="line">752</td><td class="hits">12</td><td class="source">	this.env = Constant.DEFAULT_ENV;</td></tr><tr class="hit"><td class="line">753</td><td class="hits">12</td><td class="source">	this.emit('destroyed');</td></tr><tr><td class="line">754</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">755</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">756</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">757</td><td class="hits"></td><td class="source"> * ApplicationContext destroyBeans.</td></tr><tr><td class="line">758</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">759</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">760</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">761</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.destroyBeans = function() {</td></tr><tr class="hit"><td class="line">762</td><td class="hits">12</td><td class="source">	this.getBeanFactory().destroySingletons();</td></tr><tr><td class="line">763</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">764</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">765</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">766</td><td class="hits"></td><td class="source"> * ApplicationContext check whether applicationContext is active or not.</td></tr><tr><td class="line">767</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">768</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">769</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">770</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.isActive = function() {</td></tr><tr class="hit"><td class="line">771</td><td class="hits">1</td><td class="source">	return this.active;</td></tr><tr><td class="line">772</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">773</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">774</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">775</td><td class="hits"></td><td class="source"> * ApplicationContext getBean through beanName from applicationContext.</td></tr><tr><td class="line">776</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">777</td><td class="hits"></td><td class="source"> * @param   {String} beanName</td></tr><tr><td class="line">778</td><td class="hits"></td><td class="source"> * @return  {Object} beanObject</td></tr><tr><td class="line">779</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">780</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">781</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getBean = function(beanName) {</td></tr><tr class="hit"><td class="line">782</td><td class="hits">57</td><td class="source">	var beanFactory = this.getBeanFactory();</td></tr><tr class="hit"><td class="line">783</td><td class="hits">57</td><td class="source">	return beanFactory.getBean.apply(beanFactory, arguments);</td></tr><tr><td class="line">784</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">785</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">786</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">787</td><td class="hits"></td><td class="source"> * ApplicationContext getBean through metaObject from applicationContext.</td></tr><tr><td class="line">788</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">789</td><td class="hits"></td><td class="source"> * @param   {Object} meta metaObject</td></tr><tr><td class="line">790</td><td class="hits"></td><td class="source"> * @return  {Object} beanObject</td></tr><tr><td class="line">791</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">792</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">793</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getBeanByMeta = function(meta) {</td></tr><tr class="hit"><td class="line">794</td><td class="hits">5</td><td class="source">	var id = meta['id'];</td></tr><tr class="hit"><td class="line">795</td><td class="hits">5</td><td class="source">	if (!id) {</td></tr><tr class="hit"><td class="line">796</td><td class="hits">1</td><td class="source">		logger.error('ApplicationContext getBeanByMeta error meta no id.');</td></tr><tr class="hit"><td class="line">797</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">798</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">799</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">800</td><td class="hits">4</td><td class="source">	if (!this.getBeanDefinition(id)) {</td></tr><tr class="hit"><td class="line">801</td><td class="hits">3</td><td class="source">		this.registerBeanMeta(meta);</td></tr><tr><td class="line">802</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">803</td><td class="hits">3</td><td class="source">		this.invokeBeanFactoryPostProcessors();</td></tr><tr><td class="line">804</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">805</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">806</td><td class="hits">4</td><td class="source">	arguments[0] = id;</td></tr><tr><td class="line">807</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">808</td><td class="hits">4</td><td class="source">	return this.beanFactory.getBeanProxy.apply(this.beanFactory, arguments);</td></tr><tr><td class="line">809</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">810</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">811</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">812</td><td class="hits"></td><td class="source"> * ApplicationContext getBean through $ annotation function from applicationContext.</td></tr><tr><td class="line">813</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">814</td><td class="hits"></td><td class="source"> * @param   {Function} func $ annotation function</td></tr><tr><td class="line">815</td><td class="hits"></td><td class="source"> * @return  {Object}   beanObject</td></tr><tr><td class="line">816</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">817</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">818</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getBeanByFunc = function(func) {</td></tr><tr class="hit"><td class="line">819</td><td class="hits">370</td><td class="source">	var meta = MetaUtil.resolveFuncAnnotation(func);</td></tr><tr><td class="line">820</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">821</td><td class="hits">370</td><td class="source">	var id = meta['id'];</td></tr><tr class="hit"><td class="line">822</td><td class="hits">370</td><td class="source">	if (!id) {</td></tr><tr class="hit"><td class="line">823</td><td class="hits">1</td><td class="source">		logger.error('ApplicationContext getBeanByFunc error meta no id, add this.$id = &quot;yourId&quot; to your func.');</td></tr><tr class="hit"><td class="line">824</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">825</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">826</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">827</td><td class="hits">369</td><td class="source">	if (!this.getBeanDefinition(id)) {</td></tr><tr class="hit"><td class="line">828</td><td class="hits">356</td><td class="source">		meta['lazy'] = true;</td></tr><tr class="hit"><td class="line">829</td><td class="hits">356</td><td class="source">		this.registerBeanMeta(meta);</td></tr><tr><td class="line">830</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">831</td><td class="hits">356</td><td class="source">		this.invokeBeanFactoryPostProcessors();</td></tr><tr><td class="line">832</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">833</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">834</td><td class="hits">369</td><td class="source">	arguments[0] = id;</td></tr><tr><td class="line">835</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">836</td><td class="hits">369</td><td class="source">	return this.beanFactory.getBeanProxy.apply(this.beanFactory, arguments);</td></tr><tr><td class="line">837</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">838</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">839</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">840</td><td class="hits"></td><td class="source"> * ApplicationContext getModel through modelId.</td></tr><tr><td class="line">841</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">842</td><td class="hits"></td><td class="source"> * @param   {String}   modelId</td></tr><tr><td class="line">843</td><td class="hits"></td><td class="source"> * @return  {Object}   model</td></tr><tr><td class="line">844</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">845</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">846</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getModel = function(modelId) {</td></tr><tr class="hit"><td class="line">847</td><td class="hits">4</td><td class="source">	if (!modelId) {</td></tr><tr class="miss"><td class="line">848</td><td class="hits">0</td><td class="source">		logger.error('ApplicationContext getModel error no modelId.');</td></tr><tr class="miss"><td class="line">849</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">850</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">851</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">852</td><td class="hits">4</td><td class="source">	return this.beanFactory.getModelProxy(modelId);</td></tr><tr><td class="line">853</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">854</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">855</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">856</td><td class="hits"></td><td class="source"> * ApplicationContext getModelDefinition through modelId.</td></tr><tr><td class="line">857</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">858</td><td class="hits"></td><td class="source"> * @param   {String}   modelId</td></tr><tr><td class="line">859</td><td class="hits"></td><td class="source"> * @return  {Object}   modelDefinition</td></tr><tr><td class="line">860</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">861</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">862</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getModelDefinition = function(modelId) {</td></tr><tr class="miss"><td class="line">863</td><td class="hits">0</td><td class="source">	if (!modelId) {</td></tr><tr class="miss"><td class="line">864</td><td class="hits">0</td><td class="source">		logger.error('ApplicationContext getModelDefinition error no modelId.');</td></tr><tr class="miss"><td class="line">865</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">866</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">867</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">868</td><td class="hits">0</td><td class="source">	return this.beanFactory.getModelDefinition(modelId);</td></tr><tr><td class="line">869</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">870</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">871</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">872</td><td class="hits"></td><td class="source"> * ApplicationContext get bean contructor function.</td></tr><tr><td class="line">873</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">874</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">875</td><td class="hits"></td><td class="source"> * @return {Function} bean constructor function</td></tr><tr><td class="line">876</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">877</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">878</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getBeanFunction = function(beanName) {</td></tr><tr class="hit"><td class="line">879</td><td class="hits">1</td><td class="source">	return this.beanFactory.getBeanFunction(beanName);</td></tr><tr><td class="line">880</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">881</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">882</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">883</td><td class="hits"></td><td class="source"> * ApplicationContext extend bean.</td></tr><tr><td class="line">884</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">885</td><td class="hits"></td><td class="source"> * @param  {String}   		beanName</td></tr><tr><td class="line">886</td><td class="hits"></td><td class="source"> * @param  {String|Array}   superBeanName or superBeanName array</td></tr><tr><td class="line">887</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">888</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">889</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.extendBean = function(beanName, superBeanName) {</td></tr><tr class="miss"><td class="line">890</td><td class="hits">0</td><td class="source">	if (!this.extendBeanMap[beanName]) {</td></tr><tr class="miss"><td class="line">891</td><td class="hits">0</td><td class="source">		this.extendBeanMap[beanName] = [];</td></tr><tr><td class="line">892</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">893</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">894</td><td class="hits">0</td><td class="source">	this.extendBeanMap[beanName] = this.extendBeanMap[beanName].concat(superBeanName);</td></tr><tr><td class="line">895</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">896</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">897</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">898</td><td class="hits"></td><td class="source"> * ApplicationContext do extend beans.</td></tr><tr><td class="line">899</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">900</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">901</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">902</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.doExtendBeans = function() {</td></tr><tr class="hit"><td class="line">903</td><td class="hits">61</td><td class="source">	var extendBeanMap = this.extendBeanMap;</td></tr><tr><td class="line">904</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">905</td><td class="hits">61</td><td class="source">	for (var beanName in extendBeanMap) {</td></tr><tr class="miss"><td class="line">906</td><td class="hits">0</td><td class="source">		var superNames = extendBeanMap[beanName];</td></tr><tr><td class="line">907</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">908</td><td class="hits">0</td><td class="source">		for (var i = 0; i &lt; superNames.length; i++) {</td></tr><tr class="miss"><td class="line">909</td><td class="hits">0</td><td class="source">			var superBeanName = superNames[i];</td></tr><tr class="miss"><td class="line">910</td><td class="hits">0</td><td class="source">			this.doExtendBean(beanName, superBeanName);</td></tr><tr><td class="line">911</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">912</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">913</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">914</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">915</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">916</td><td class="hits"></td><td class="source"> * ApplicationContext do extend bean.</td></tr><tr><td class="line">917</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">918</td><td class="hits"></td><td class="source"> * @param  {String}   beanName</td></tr><tr><td class="line">919</td><td class="hits"></td><td class="source"> * @param  {String}   superBeanName</td></tr><tr><td class="line">920</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">921</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">922</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.doExtendBean = function(beanName, superBeanName) {</td></tr><tr class="miss"><td class="line">923</td><td class="hits">0</td><td class="source">	var cacheKey = beanName + '_' + superBeanName;</td></tr><tr class="miss"><td class="line">924</td><td class="hits">0</td><td class="source">	if (this.extendBeanCurMap[superBeanName]) {</td></tr><tr class="miss"><td class="line">925</td><td class="hits">0</td><td class="source">		logger.error(&quot;[bearcat.extend] error circle beanName %s extend %s is not allowed&quot;, beanName, superBeanName);</td></tr><tr class="miss"><td class="line">926</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">927</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">928</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">929</td><td class="hits">0</td><td class="source">	this.extendBeanCurMap[beanName] = true;</td></tr><tr><td class="line">930</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">931</td><td class="hits">0</td><td class="source">	if (this.extendedBeanMap[cacheKey]) {</td></tr><tr class="miss"><td class="line">932</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">933</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">934</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">935</td><td class="hits">0</td><td class="source">	var beanFunction = this.getBeanFunction(beanName);</td></tr><tr class="miss"><td class="line">936</td><td class="hits">0</td><td class="source">	if (!beanFunction) {</td></tr><tr class="miss"><td class="line">937</td><td class="hits">0</td><td class="source">		logger.error('[bearcat.extend] %s from super %s, %s null', beanName, superBeanName, beanName);</td></tr><tr class="miss"><td class="line">938</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">939</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">940</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">941</td><td class="hits">0</td><td class="source">	var superFunction = this.getBeanFunction(superBeanName);</td></tr><tr class="miss"><td class="line">942</td><td class="hits">0</td><td class="source">	if (!superFunction) {</td></tr><tr class="miss"><td class="line">943</td><td class="hits">0</td><td class="source">		logger.error('[bearcat.extend] %s from super %s, %s null', beanName, superBeanName, superBeanName);</td></tr><tr class="miss"><td class="line">944</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">945</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">946</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">947</td><td class="hits">0</td><td class="source">	var _superBeans = this.extendBeanMap[superBeanName];</td></tr><tr class="miss"><td class="line">948</td><td class="hits">0</td><td class="source">	if (_superBeans &amp;&amp; _superBeans.length) {</td></tr><tr class="miss"><td class="line">949</td><td class="hits">0</td><td class="source">		for (var i = 0; i &lt; _superBeans.length; i++) {</td></tr><tr class="miss"><td class="line">950</td><td class="hits">0</td><td class="source">			this.doExtendBean(superBeanName, _superBeans[i]);</td></tr><tr><td class="line">951</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">952</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">953</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">954</td><td class="hits">0</td><td class="source">	var _super = superFunction.prototype;</td></tr><tr class="miss"><td class="line">955</td><td class="hits">0</td><td class="source">	var props = beanFunction.prototype;</td></tr><tr class="miss"><td class="line">956</td><td class="hits">0</td><td class="source">	for (var name in _super) {</td></tr><tr class="miss"><td class="line">957</td><td class="hits">0</td><td class="source">		if (!props[name]) {</td></tr><tr class="miss"><td class="line">958</td><td class="hits">0</td><td class="source">			props[name] = _super[name];</td></tr><tr><td class="line">959</td><td class="hits"></td><td class="source">		} else {</td></tr><tr class="miss"><td class="line">960</td><td class="hits">0</td><td class="source">			if (Utils.checkFunction(props[name]) &amp;&amp; Utils.checkFunction(_super[name])) {</td></tr><tr class="miss"><td class="line">961</td><td class="hits">0</td><td class="source">				props[name] = (function(super_fn, fn) {</td></tr><tr class="miss"><td class="line">962</td><td class="hits">0</td><td class="source">					return function() {</td></tr><tr class="miss"><td class="line">963</td><td class="hits">0</td><td class="source">						var tmp = this._super;</td></tr><tr><td class="line">964</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">965</td><td class="hits">0</td><td class="source">						this._super = super_fn;</td></tr><tr><td class="line">966</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">967</td><td class="hits">0</td><td class="source">						var ret = fn.apply(this, arguments);</td></tr><tr><td class="line">968</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">969</td><td class="hits">0</td><td class="source">						this._super = tmp;</td></tr><tr><td class="line">970</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">971</td><td class="hits">0</td><td class="source">						return ret;</td></tr><tr><td class="line">972</td><td class="hits"></td><td class="source">					}</td></tr><tr><td class="line">973</td><td class="hits"></td><td class="source">				})(_super[name], props[name]);</td></tr><tr><td class="line">974</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">975</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">976</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">977</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">978</td><td class="hits">0</td><td class="source">	delete this.extendBeanCurMap[beanName];</td></tr><tr class="miss"><td class="line">979</td><td class="hits">0</td><td class="source">	this.extendedBeanMap[cacheKey] = true;</td></tr><tr><td class="line">980</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">981</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">982</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">983</td><td class="hits"></td><td class="source"> * ApplicationContext add module(bean) to IoC container through $ annotation function from applicationContext.</td></tr><tr><td class="line">984</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">985</td><td class="hits"></td><td class="source"> * @param   {Function} func $ annotation function</td></tr><tr><td class="line">986</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">987</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">988</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.module = function(func, context) {</td></tr><tr class="miss"><td class="line">989</td><td class="hits">0</td><td class="source">	var meta = MetaUtil.resolveFuncAnnotation(func);</td></tr><tr class="miss"><td class="line">990</td><td class="hits">0</td><td class="source">	var id = meta['id'];</td></tr><tr class="miss"><td class="line">991</td><td class="hits">0</td><td class="source">	if (!id) {</td></tr><tr class="miss"><td class="line">992</td><td class="hits">0</td><td class="source">		logger.error('ApplicationContext module error meta no id, add this.$id = &quot;yourId&quot; to your func.');</td></tr><tr class="miss"><td class="line">993</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">994</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">995</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">996</td><td class="hits">0</td><td class="source">	if (this.getBeanDefinition(id)) {</td></tr><tr class="miss"><td class="line">997</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">998</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">999</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1000</td><td class="hits"></td><td class="source">	// node.js env</td></tr><tr class="miss"><td class="line">1001</td><td class="hits">0</td><td class="source">	if (!Utils.checkBrowser() &amp;&amp; Utils.isNotNull(context) &amp;&amp; context['exports']) {</td></tr><tr class="miss"><td class="line">1002</td><td class="hits">0</td><td class="source">		return context['exports'] = func;</td></tr><tr><td class="line">1003</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">1004</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1005</td><td class="hits"></td><td class="source">	// browser async load depended script files</td></tr><tr class="miss"><td class="line">1006</td><td class="hits">0</td><td class="source">	if (Utils.checkBrowser()) {</td></tr><tr class="miss"><td class="line">1007</td><td class="hits">0</td><td class="source">		var loader = this.getAsyncScriptLoader();</td></tr><tr class="miss"><td class="line">1008</td><td class="hits">0</td><td class="source">		loader.module(id, meta);</td></tr><tr><td class="line">1009</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">1010</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1011</td><td class="hits"></td><td class="source">	// register current bean meta</td></tr><tr class="miss"><td class="line">1012</td><td class="hits">0</td><td class="source">	return this.registerBeanMeta(meta);</td></tr><tr><td class="line">1013</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1014</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1015</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1016</td><td class="hits"></td><td class="source"> * ApplicationContext service locator pattern define module.</td></tr><tr><td class="line">1017</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1018</td><td class="hits"></td><td class="source"> * @param   {String}   id</td></tr><tr><td class="line">1019</td><td class="hits"></td><td class="source"> * @param   {Function} factory factory function</td></tr><tr><td class="line">1020</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1021</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1022</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.define = function(id, factory, context) {</td></tr><tr><td class="line">1023</td><td class="hits"></td><td class="source">	// loader env</td></tr><tr class="miss"><td class="line">1024</td><td class="hits">0</td><td class="source">	if (process.env.LOADER_BIN &amp;&amp; Utils.isNotNull(context) &amp;&amp; context['exports']) {</td></tr><tr class="miss"><td class="line">1025</td><td class="hits">0</td><td class="source">		return context['exports'] = {</td></tr><tr><td class="line">1026</td><td class="hits"></td><td class="source">			id: id,</td></tr><tr><td class="line">1027</td><td class="hits"></td><td class="source">			func: factory</td></tr><tr><td class="line">1028</td><td class="hits"></td><td class="source">		};</td></tr><tr><td class="line">1029</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">1030</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">1031</td><td class="hits">0</td><td class="source">	return this.getModuleFactory().define(id, factory);</td></tr><tr><td class="line">1032</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1033</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1034</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1035</td><td class="hits"></td><td class="source"> * ApplicationContext service locator pattern define module.</td></tr><tr><td class="line">1036</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1037</td><td class="hits"></td><td class="source"> * @param   {String}   id</td></tr><tr><td class="line">1038</td><td class="hits"></td><td class="source"> * @param   {Function} factory factory function</td></tr><tr><td class="line">1039</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1040</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1041</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.require = function(id) {</td></tr><tr class="miss"><td class="line">1042</td><td class="hits">0</td><td class="source">	return this.getModuleFactory().require(id);</td></tr><tr><td class="line">1043</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1044</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1045</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1046</td><td class="hits"></td><td class="source"> * ApplicationContext add startup loaded bean ids.</td></tr><tr><td class="line">1047</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1048</td><td class="hits"></td><td class="source"> * @param   {Array} startup loaded bean ids</td></tr><tr><td class="line">1049</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1050</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1051</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.use = function(ids) {</td></tr><tr class="miss"><td class="line">1052</td><td class="hits">0</td><td class="source">	this.loadBeans = this.loadBeans.concat(ids);</td></tr><tr><td class="line">1053</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1054</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1055</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1056</td><td class="hits"></td><td class="source"> * ApplicationContext async load bean with bean ids.</td></tr><tr><td class="line">1057</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1058</td><td class="hits"></td><td class="source"> * @param   {Array}    loaded bean ids</td></tr><tr><td class="line">1059</td><td class="hits"></td><td class="source"> * @param   {Function} callback function</td></tr><tr><td class="line">1060</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1061</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1062</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.async = function(ids, cb) {</td></tr><tr class="miss"><td class="line">1063</td><td class="hits">0</td><td class="source">	var asyncScriptLoader = new AsyncScriptLoader();</td></tr><tr class="miss"><td class="line">1064</td><td class="hits">0</td><td class="source">	return asyncScriptLoader.load(loadBeans, cb);</td></tr><tr><td class="line">1065</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1066</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1067</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1068</td><td class="hits"></td><td class="source"> * ApplicationContext check ApplicationContext contains bean or not.</td></tr><tr><td class="line">1069</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1070</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">1071</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">1072</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1073</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1074</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.containsBean = function(beanName) {</td></tr><tr class="hit"><td class="line">1075</td><td class="hits">1</td><td class="source">	return this.getBeanFactory().containsBean(beanName);</td></tr><tr><td class="line">1076</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1077</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1078</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1079</td><td class="hits"></td><td class="source"> * ApplicationContext check bean is a singleton or not.</td></tr><tr><td class="line">1080</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1081</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">1082</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">1083</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1084</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1085</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.isSingleton = function(beanName) {</td></tr><tr class="hit"><td class="line">1086</td><td class="hits">1</td><td class="source">	return this.getBeanFactory().isSingleton(beanName);</td></tr><tr><td class="line">1087</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1088</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1089</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1090</td><td class="hits"></td><td class="source"> * ApplicationContext check bean is a prototype or not.</td></tr><tr><td class="line">1091</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1092</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">1093</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">1094</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1095</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1096</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.isPrototype = function(beanName) {</td></tr><tr class="hit"><td class="line">1097</td><td class="hits">1</td><td class="source">	return this.getBeanFactory().isPrototype(beanName);</td></tr><tr><td class="line">1098</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1099</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1100</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1101</td><td class="hits"></td><td class="source"> * ApplicationContext check ApplicationContext contains beanName beanDefinition or not.</td></tr><tr><td class="line">1102</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1103</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">1104</td><td class="hits"></td><td class="source"> * @return {Boolean}</td></tr><tr><td class="line">1105</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1106</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1107</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.containsBeanDefinition = function(beanName) {</td></tr><tr class="hit"><td class="line">1108</td><td class="hits">2</td><td class="source">	return this.getBeanFactory().containsBeanDefinition(beanName);</td></tr><tr><td class="line">1109</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1110</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1111</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1112</td><td class="hits"></td><td class="source"> * ApplicationContext check whether applicationContext is running or not.</td></tr><tr><td class="line">1113</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1114</td><td class="hits"></td><td class="source"> * @return {Boolean} true|false</td></tr><tr><td class="line">1115</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1116</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1117</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.isRunning = function() {</td></tr><tr class="hit"><td class="line">1118</td><td class="hits">1</td><td class="source">	return this.active;</td></tr><tr><td class="line">1119</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1120</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1121</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1122</td><td class="hits"></td><td class="source"> * ApplicationContext close beanFactory.</td></tr><tr><td class="line">1123</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1124</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1125</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1126</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.closeBeanFactory = function() {</td></tr><tr class="hit"><td class="line">1127</td><td class="hits">12</td><td class="source">	this.getBeanFactory().destroyBeanFactory();</td></tr><tr class="hit"><td class="line">1128</td><td class="hits">12</td><td class="source">	this.beanFactory = null;</td></tr><tr><td class="line">1129</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1130</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1131</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1132</td><td class="hits"></td><td class="source"> * ApplicationContext check whether applicationContext has beanFactory or not.</td></tr><tr><td class="line">1133</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1134</td><td class="hits"></td><td class="source"> * @return {Boolean} true|false</td></tr><tr><td class="line">1135</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1136</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1137</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.hasBeanFactory = function() {</td></tr><tr class="hit"><td class="line">1138</td><td class="hits">76</td><td class="source">	return this.beanFactory != null;</td></tr><tr><td class="line">1139</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1140</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1141</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1142</td><td class="hits"></td><td class="source"> * ApplicationContext getBeanFactory.</td></tr><tr><td class="line">1143</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1144</td><td class="hits"></td><td class="source"> * @return {Object} beanFactory</td></tr><tr><td class="line">1145</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1146</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1147</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getBeanFactory = function() {</td></tr><tr class="hit"><td class="line">1148</td><td class="hits">947</td><td class="source">	return this.beanFactory;</td></tr><tr><td class="line">1149</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1150</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">1151</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getModuleFactory = function() {</td></tr><tr class="miss"><td class="line">1152</td><td class="hits">0</td><td class="source">	if (!this.moduleFactory) {</td></tr><tr class="miss"><td class="line">1153</td><td class="hits">0</td><td class="source">		this.moduleFactory = new ModuleFactory();</td></tr><tr><td class="line">1154</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">1155</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">1156</td><td class="hits">0</td><td class="source">	return this.moduleFactory;</td></tr><tr><td class="line">1157</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1158</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1159</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1160</td><td class="hits"></td><td class="source"> * ApplicationContext createBeanFactory.</td></tr><tr><td class="line">1161</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1162</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">1163</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1164</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.createBeanFactory = function() {</td></tr><tr class="hit"><td class="line">1165</td><td class="hits">64</td><td class="source">	this.beanFactory = new BeanFactory();</td></tr><tr><td class="line">1166</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1167</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1168</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1169</td><td class="hits"></td><td class="source"> * ApplicationContext get beanDefinition.</td></tr><tr><td class="line">1170</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1171</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">1172</td><td class="hits"></td><td class="source"> * @return {Object} beanDefinition</td></tr><tr><td class="line">1173</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1174</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1175</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getBeanDefinition = function(beanName) {</td></tr><tr class="hit"><td class="line">1176</td><td class="hits">374</td><td class="source">	return this.getBeanFactory().getBeanDefinition(beanName);</td></tr><tr><td class="line">1177</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1178</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1179</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1180</td><td class="hits"></td><td class="source"> * ApplicationContext remove beanDefinition from ApplicationContext.</td></tr><tr><td class="line">1181</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1182</td><td class="hits"></td><td class="source"> * @param  {String} beanName</td></tr><tr><td class="line">1183</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1184</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1185</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.removeBeanDefinition = function(beanName) {</td></tr><tr class="hit"><td class="line">1186</td><td class="hits">1</td><td class="source">	return this.getBeanFactory().removeBeanDefinition(beanName);</td></tr><tr><td class="line">1187</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1188</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1189</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1190</td><td class="hits"></td><td class="source"> * ApplicationContext set env.</td></tr><tr><td class="line">1191</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1192</td><td class="hits"></td><td class="source"> * @param {String} env</td></tr><tr><td class="line">1193</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1194</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1195</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.setEnv = function(env) {</td></tr><tr class="hit"><td class="line">1196</td><td class="hits">62</td><td class="source">	this.env = env;</td></tr><tr><td class="line">1197</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1198</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1199</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1200</td><td class="hits"></td><td class="source"> * ApplicationContext get env.</td></tr><tr><td class="line">1201</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1202</td><td class="hits"></td><td class="source"> * @return {String} env</td></tr><tr><td class="line">1203</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1204</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1205</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getEnv = function() {</td></tr><tr class="hit"><td class="line">1206</td><td class="hits">68</td><td class="source">	return this.env;</td></tr><tr><td class="line">1207</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1208</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1209</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1210</td><td class="hits"></td><td class="source"> * ApplicationContext set config path.</td></tr><tr><td class="line">1211</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1212</td><td class="hits"></td><td class="source"> * @param {String} cpath config path</td></tr><tr><td class="line">1213</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1214</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1215</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.setConfigPath = function(cpath) {</td></tr><tr class="hit"><td class="line">1216</td><td class="hits">62</td><td class="source">	this.cpath = cpath;</td></tr><tr><td class="line">1217</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1218</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1219</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1220</td><td class="hits"></td><td class="source"> * ApplicationContext get config path.</td></tr><tr><td class="line">1221</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1222</td><td class="hits"></td><td class="source"> * @return {String} config path</td></tr><tr><td class="line">1223</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1224</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1225</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getConfigPath = function() {</td></tr><tr class="hit"><td class="line">1226</td><td class="hits">61</td><td class="source">	return this.cpath;</td></tr><tr><td class="line">1227</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1228</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1229</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1230</td><td class="hits"></td><td class="source"> * ApplicationContext set hot reload path.</td></tr><tr><td class="line">1231</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1232</td><td class="hits"></td><td class="source"> * @param {String} hpath hot reload path</td></tr><tr><td class="line">1233</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1234</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1235</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.setHotPath = function(hpath) {</td></tr><tr class="hit"><td class="line">1236</td><td class="hits">62</td><td class="source">	this.hpath = hpath;</td></tr><tr><td class="line">1237</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1238</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1239</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1240</td><td class="hits"></td><td class="source"> * ApplicationContext get hot reload path.</td></tr><tr><td class="line">1241</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1242</td><td class="hits"></td><td class="source"> * @return {String} hpath hot reload path</td></tr><tr><td class="line">1243</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1244</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1245</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getHotPath = function() {</td></tr><tr class="hit"><td class="line">1246</td><td class="hits">61</td><td class="source">	return this.hpath;</td></tr><tr><td class="line">1247</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">1248</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">1249</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">1250</td><td class="hits"></td><td class="source"> * ApplicationContext get base path.</td></tr><tr><td class="line">1251</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">1252</td><td class="hits"></td><td class="source"> * @return {String} base path</td></tr><tr><td class="line">1253</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">1254</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">1255</td><td class="hits">1</td><td class="source">ApplicationContext.prototype.getBase = function() {</td></tr><tr class="hit"><td class="line">1256</td><td class="hits">61</td><td class="source">	return this.base;</td></tr><tr><td class="line">1257</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/index.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/index.js</h2><div id="stats" class="high"><div class="percentage">93%</div><div class="sloc">15</div><div class="hits">14</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var Constraints = {};</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">if (!Utils.checkBrowser()) {</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">	var fs = require('fs');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">	var path = require('path');</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">	fs.readdirSync(__dirname).forEach(function(filename) {</td></tr><tr class="hit"><td class="line">9</td><td class="hits">7</td><td class="source">		if (!/\.js$/.test(filename)) {</td></tr><tr class="miss"><td class="line">10</td><td class="hits">0</td><td class="source">			return;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">7</td><td class="source">		if (filename === 'index.js') {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">			return;</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">6</td><td class="source">		var name = path.basename(filename, '.js');</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">6</td><td class="source">		function load() {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">366</td><td class="source">			return require(__dirname + '/' + name);</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">6</td><td class="source">		Constraints.__defineGetter__(name, load);</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">module.exports = Constraints;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/max.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/max.js</h2><div id="stats" class="low"><div class="percentage">47%</div><div class="sloc">17</div><div class="hits">8</div><div class="misses">9</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat MaxConstraint</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Util = require('util');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * MaxConstraint constructor function.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var MaxConstraint = function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">61</td><td class="source">	this.$cid = &quot;max&quot;;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">61</td><td class="source">	this.message = &quot;[MaxConstraint] key: %s value %d is bigger than the max value: %d&quot;;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">61</td><td class="source">	this.max = null;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * MaxConstraint validate function.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param   {String} key</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param   {Number} value</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @return  {Object} Error object</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">MaxConstraint.prototype.validate = function(key, value) {</td></tr><tr class="miss"><td class="line">37</td><td class="hits">0</td><td class="source">	var message = this.message;</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">	var max = this.max;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">	if (!Utils.checkNumber(max)) {</td></tr><tr class="miss"><td class="line">41</td><td class="hits">0</td><td class="source">		max = parseInt(max);</td></tr><tr class="miss"><td class="line">42</td><td class="hits">0</td><td class="source">		this.max = max;</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">45</td><td class="hits">0</td><td class="source">	if (!Utils.checkNumber(value)) {</td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">	if (value &gt; max) {</td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="source">		return new Error(Util.format(message, key, value, max));</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">module.exports = MaxConstraint;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/min.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/min.js</h2><div id="stats" class="low"><div class="percentage">47%</div><div class="sloc">17</div><div class="hits">8</div><div class="misses">9</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat MinConstraint</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Util = require('util');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * MinConstraint constructor function.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var MinConstraint = function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">61</td><td class="source">	this.$cid = &quot;min&quot;;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">61</td><td class="source">	this.message = &quot;[MinConstraint] key: %s value %d is smaller than the min value: %d&quot;;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">61</td><td class="source">	this.min = null;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * MinConstraint validate function.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param   {String} key</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param   {Number} value</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @return  {Object} Error object</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">MinConstraint.prototype.validate = function(key, value) {</td></tr><tr class="miss"><td class="line">37</td><td class="hits">0</td><td class="source">	var message = this.message;</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">	var min = this.min;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">	if (!Utils.checkNumber(min)) {</td></tr><tr class="miss"><td class="line">41</td><td class="hits">0</td><td class="source">		min = parseInt(min);</td></tr><tr class="miss"><td class="line">42</td><td class="hits">0</td><td class="source">		this.min = min;</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">45</td><td class="hits">0</td><td class="source">	if (!Utils.checkNumber(value)) {</td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">	if (value &lt; min) {</td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="source">		return new Error(Util.format(message, key, value, min));</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">module.exports = MinConstraint;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/notNull.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/notNull.js</h2><div id="stats" class="high"><div class="percentage">90%</div><div class="sloc">10</div><div class="hits">9</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat NotNullConstraint</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Util = require('util');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * NotNullConstraint constructor function.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var NotNullConstraint = function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">63</td><td class="source">	this.$cid = &quot;notNull&quot;;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">63</td><td class="source">	this.message = &quot;[NotNullConstraint] key: %s must be not null for value: %s&quot;;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * NotNullConstraint validate function.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @param   {String} key</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param   {Number} value</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @return  {Object} Error object</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">NotNullConstraint.prototype.validate = function(key, value) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">13</td><td class="source">	var message = this.message;</td></tr><tr class="hit"><td class="line">37</td><td class="hits">13</td><td class="source">	if (!Utils.isNotNull(value)) {</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">		return new Error(Util.format(message, key, value));</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">module.exports = NotNullConstraint;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/null.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/null.js</h2><div id="stats" class="medium"><div class="percentage">70%</div><div class="sloc">10</div><div class="hits">7</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat NullConstraint</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Util = require('util');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * NullConstraint constructor function.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var NullConstraint = function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">61</td><td class="source">	this.$cid = &quot;null&quot;;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">61</td><td class="source">	this.message = &quot;[NullConstraint] key: %s must be null for value: %s&quot;;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * NullConstraint validate function.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @param   {String} key</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param   {Number} value</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @return  {Object} Error object</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">NullConstraint.prototype.validate = function(key, value) {</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">	var message = this.message;</td></tr><tr class="miss"><td class="line">37</td><td class="hits">0</td><td class="source">	if (Utils.isNotNull(value)) {</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">		return new Error(Util.format(message, key, value));</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">module.exports = NullConstraint;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/pattern.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/pattern.js</h2><div id="stats" class="medium"><div class="percentage">53%</div><div class="sloc">15</div><div class="hits">8</div><div class="misses">7</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat PatternConstraint</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Util = require('util');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * PatternConstraint constructor function.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var PatternConstraint = function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">61</td><td class="source">	this.$cid = &quot;pattern&quot;;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">61</td><td class="source">	this.message = &quot;[PatternConstraint] key: %s value: %s is not matched with the pattern %s&quot;;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">61</td><td class="source">	this.regexp = null;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * PatternConstraint validate function.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @param   {String} key</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param   {Number} value</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @return  {Object} Error object</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">PatternConstraint.prototype.validate = function(key, value) {</td></tr><tr class="miss"><td class="line">37</td><td class="hits">0</td><td class="source">	var message = this.message;</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">	var regexp = this.regexp;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">	if (!Utils.checkString(regexp) || !Utils.checkString(value)) {</td></tr><tr class="miss"><td class="line">41</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">44</td><td class="hits">0</td><td class="source">	var pattern = new RegExp(regexp);</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">	if (!value.match(pattern)) {</td></tr><tr class="miss"><td class="line">47</td><td class="hits">0</td><td class="source">		return new Error(Util.format(message, key, value, regexp));</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">module.exports = PatternConstraint;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/size.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/constraints/size.js</h2><div id="stats" class="low"><div class="percentage">45%</div><div class="sloc">22</div><div class="hits">10</div><div class="misses">12</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat SizeConstraint</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Utils = require('../../util/utils');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Util = require('util');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * SizeConstraint constructor function.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var SizeConstraint = function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">61</td><td class="source">	this.$cid = &quot;size&quot;;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">61</td><td class="source">	this.maxMessage = &quot;[SizeConstraint] key: %s value: %s length bigger than the max length %d&quot;;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">61</td><td class="source">	this.minMessage = &quot;[SizeConstraint] key: %s value: %s length smaller than the min length %d&quot;;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">61</td><td class="source">	this.max = null;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">61</td><td class="source">	this.min = null;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * SizeConstraint validate function.</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @param   {String} key</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @param   {Number} value</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @return  {Object} Error object</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">SizeConstraint.prototype.validate = function(key, value) {</td></tr><tr class="miss"><td class="line">39</td><td class="hits">0</td><td class="source">	if (!Utils.checkString(value)) {</td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">43</td><td class="hits">0</td><td class="source">	var maxMessage = this.maxMessage;</td></tr><tr class="miss"><td class="line">44</td><td class="hits">0</td><td class="source">	var max = this.max;</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">	if (!Utils.checkNumber(max)) {</td></tr><tr class="miss"><td class="line">47</td><td class="hits">0</td><td class="source">		if (value.length &gt; max) {</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">			return new Error(Util.format(maxMessage, key, value, max));</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">52</td><td class="hits">0</td><td class="source">	var minMessage = this.minMessage;</td></tr><tr class="miss"><td class="line">53</td><td class="hits">0</td><td class="source">	var min = this.min;</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">55</td><td class="hits">0</td><td class="source">	if (!Utils.checkNumber(min)) {</td></tr><tr class="miss"><td class="line">56</td><td class="hits">0</td><td class="source">		if (value.length &lt; min) {</td></tr><tr class="miss"><td class="line">57</td><td class="hits">0</td><td class="source">			return new Error(Util.format(minMessage, key, value, min));</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">module.exports = SizeConstraint;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelAttribute.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelAttribute.js</h2><div id="stats" class="high"><div class="percentage">98%</div><div class="sloc">153</div><div class="hits">150</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ModelAttribute</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Constant = require('../util/constant');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Util = require('util');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * ModelAttribute constructor function.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var ModelAttribute = function() {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">67</td><td class="source">	this.ref = null;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">67</td><td class="source">	this.name = null;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">67</td><td class="source">	this.type = null;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">67</td><td class="source">	this.prefix = null;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">67</td><td class="source">	this.default = null;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">67</td><td class="source">	this.primary = false;</td></tr><tr class="hit"><td class="line">30</td><td class="hits">67</td><td class="source">	this.balance = false;</td></tr><tr class="hit"><td class="line">31</td><td class="hits">67</td><td class="source">	this.constraints = [];</td></tr><tr class="hit"><td class="line">32</td><td class="hits">67</td><td class="source">	this.expression = null;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * ModelAttribute do filter attribute value.</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @param   {String} 	attribute value</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @return  {Error}  	Error</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.filter = function(value) {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">22</td><td class="source">	if (!Utils.isNotNull(value)) {</td></tr><tr class="miss"><td class="line">44</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">22</td><td class="source">	var r = this.filterType(value);</td></tr><tr class="hit"><td class="line">48</td><td class="hits">22</td><td class="source">	if (Utils.checkModelFilterError(r)) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">5</td><td class="source">		return r;</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">17</td><td class="source">	var key = this.name;</td></tr><tr class="hit"><td class="line">53</td><td class="hits">17</td><td class="source">	var constraints = this.constraints;</td></tr><tr class="hit"><td class="line">54</td><td class="hits">17</td><td class="source">	var constraintMethod = Constant.CONSTRAINT_METHOD;</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">56</td><td class="hits">17</td><td class="source">	for (var i = 0; i &lt; constraints.length; i++) {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">17</td><td class="source">		var constraint = constraints[i];</td></tr><tr class="hit"><td class="line">58</td><td class="hits">17</td><td class="source">		if (constraint &amp;&amp; Utils.checkFunction(constraint[constraintMethod])) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">17</td><td class="source">			r = constraint[constraintMethod](key, value);</td></tr><tr class="hit"><td class="line">60</td><td class="hits">17</td><td class="source">			if (Utils.checkModelFilterError(r)) {</td></tr><tr class="hit"><td class="line">61</td><td class="hits">3</td><td class="source">				return r;</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">14</td><td class="source">	return;</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * ModelAttribute do filter attribute value type.</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * @param   {String} 	attribute value</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * @return  {Error} 	Error</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.filterType = function(value) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">23</td><td class="source">	var type = this.type;</td></tr><tr class="hit"><td class="line">78</td><td class="hits">23</td><td class="source">	if (!Utils.checkString(type)) {</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">82</td><td class="hits">22</td><td class="source">	var Type = type;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">22</td><td class="source">	var isType = Utils.isType(Type);</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">86</td><td class="hits">22</td><td class="source">	var r = isType(value);</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">22</td><td class="source">	if (r !== true) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">5</td><td class="source">		var message = 'field: %s with value: %s error, type not matched with %s';</td></tr><tr class="hit"><td class="line">90</td><td class="hits">5</td><td class="source">		return new Error(Util.format(message, this.name, value, Type));</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">17</td><td class="source">	return;</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> * ModelAttribute do parse attribute expression.</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> * @param   {String} attribute expression</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> * @param   {Object} bean factory</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.parse = function(expression, beanFactory) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">76</td><td class="source">	if (!expression) {</td></tr><tr class="hit"><td class="line">105</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">108</td><td class="hits">75</td><td class="source">	expression = expression.replace(/\s/g, &quot;&quot;);</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">75</td><td class="source">	var f = expression[0];</td></tr><tr class="hit"><td class="line">111</td><td class="hits">75</td><td class="source">	if (f !== Constant.CONSTRAINT_ANNOTATION) {</td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">115</td><td class="hits">74</td><td class="source">	expression = expression.substr(1);</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">117</td><td class="hits">74</td><td class="source">	var list = expression.split(Constant.CONSTRAINT_SPLIT); // split by ;</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">119</td><td class="hits">74</td><td class="source">	for (var i = 0; i &lt; list.length; i++) {</td></tr><tr class="hit"><td class="line">120</td><td class="hits">120</td><td class="source">		var name = &quot;&quot;;</td></tr><tr class="hit"><td class="line">121</td><td class="hits">120</td><td class="source">		var value = &quot;&quot;;</td></tr><tr class="hit"><td class="line">122</td><td class="hits">120</td><td class="source">		var index = -1;</td></tr><tr class="hit"><td class="line">123</td><td class="hits">120</td><td class="source">		var props = [];</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">125</td><td class="hits">120</td><td class="source">		var item = list[i];</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">		// continue with &quot;&quot;</td></tr><tr class="hit"><td class="line">128</td><td class="hits">120</td><td class="source">		if (!item) {</td></tr><tr class="hit"><td class="line">129</td><td class="hits">2</td><td class="source">			continue;</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">		// &quot;$primary;&quot;</td></tr><tr class="hit"><td class="line">133</td><td class="hits">118</td><td class="source">		if (item === Constant.MODEL_ATTRIBUTE_PRIMARY) {</td></tr><tr class="hit"><td class="line">134</td><td class="hits">8</td><td class="source">			this[item] = true;</td></tr><tr class="hit"><td class="line">135</td><td class="hits">8</td><td class="source">			continue;</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">		// &quot;$balance;&quot;</td></tr><tr class="hit"><td class="line">139</td><td class="hits">110</td><td class="source">		if (item === Constant.MODEL_ATTRIBUTE_BALANCE) {</td></tr><tr class="hit"><td class="line">140</td><td class="hits">2</td><td class="source">			this[item] = true;</td></tr><tr class="hit"><td class="line">141</td><td class="hits">2</td><td class="source">			continue;</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">144</td><td class="hits">108</td><td class="source">		index = item.indexOf(&quot;:&quot;);</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">		// &quot;$type:String;default:aaa&quot;</td></tr><tr class="hit"><td class="line">146</td><td class="hits">108</td><td class="source">		if (index != -1) {</td></tr><tr class="hit"><td class="line">147</td><td class="hits">80</td><td class="source">			var p = item.split(&quot;:&quot;);</td></tr><tr class="hit"><td class="line">148</td><td class="hits">80</td><td class="source">			name = p[0].toLowerCase();</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">150</td><td class="hits">80</td><td class="source">			if (p.length &gt;= 2) {</td></tr><tr class="hit"><td class="line">151</td><td class="hits">80</td><td class="source">				value = p[1];</td></tr><tr class="hit"><td class="line">152</td><td class="hits">80</td><td class="source">				if (this.checkProps(name)) {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">78</td><td class="source">					if (name === &quot;type&quot;) {</td></tr><tr class="hit"><td class="line">154</td><td class="hits">64</td><td class="source">						value = Utils.normalizeType(value);</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">					}</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">157</td><td class="hits">78</td><td class="source">					this[name] = value;</td></tr><tr class="hit"><td class="line">158</td><td class="hits">78</td><td class="source">					continue;</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">				// max:10</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">				else {</td></tr><tr class="hit"><td class="line">162</td><td class="hits">2</td><td class="source">					props.push({</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">						name: name,</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">						value: value</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">					});</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">170</td><td class="hits">30</td><td class="source">		index = item.indexOf(&quot;(&quot;);</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">172</td><td class="hits">30</td><td class="source">		if (index != -1) {</td></tr><tr class="hit"><td class="line">173</td><td class="hits">18</td><td class="source">			name = item.substr(0, index);</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">			// no prefix name</td></tr><tr class="hit"><td class="line">175</td><td class="hits">18</td><td class="source">			if (!name) {</td></tr><tr class="hit"><td class="line">176</td><td class="hits">2</td><td class="source">				continue;</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">179</td><td class="hits">16</td><td class="source">			var left = item.substr(index);</td></tr><tr class="hit"><td class="line">180</td><td class="hits">16</td><td class="source">			var len = left.length;</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">			// no this case</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">			// if (len &lt; 1) {</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">			// 	continue;</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">			// }</td></tr><tr class="hit"><td class="line">185</td><td class="hits">16</td><td class="source">			var last = left[len - 1];</td></tr><tr class="hit"><td class="line">186</td><td class="hits">16</td><td class="source">			if (last !== &quot;)&quot;) {</td></tr><tr class="hit"><td class="line">187</td><td class="hits">4</td><td class="source">				continue;</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">190</td><td class="hits">12</td><td class="source">			left = left.substr(1, len - 2);</td></tr><tr class="hit"><td class="line">191</td><td class="hits">12</td><td class="source">			var leftList = left.split(&quot;,&quot;);</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">193</td><td class="hits">12</td><td class="source">			for (var j = 0; j &lt; leftList.length; j++) {</td></tr><tr class="hit"><td class="line">194</td><td class="hits">12</td><td class="source">				var leftProp = leftList[j].split(&quot;=&quot;);</td></tr><tr class="hit"><td class="line">195</td><td class="hits">12</td><td class="source">				var leftPropLen = leftProp.length;</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">197</td><td class="hits">12</td><td class="source">				if (leftPropLen &lt; 2) {</td></tr><tr class="hit"><td class="line">198</td><td class="hits">2</td><td class="source">					continue;</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">201</td><td class="hits">10</td><td class="source">				if (!leftProp[0] || !leftProp[1]) {</td></tr><tr class="hit"><td class="line">202</td><td class="hits">2</td><td class="source">					continue;</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">205</td><td class="hits">8</td><td class="source">				props.push({</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source">					name: leftProp[0],</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">					value: leftProp[1]</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">				});</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">212</td><td class="hits">24</td><td class="source">		if (!name) {</td></tr><tr class="hit"><td class="line">213</td><td class="hits">10</td><td class="source">			name = item;</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">216</td><td class="hits">24</td><td class="source">		var constraint = beanFactory.getConstraint(name);</td></tr><tr class="hit"><td class="line">217</td><td class="hits">24</td><td class="source">		if (!constraint) {</td></tr><tr class="hit"><td class="line">218</td><td class="hits">6</td><td class="source">			continue;</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">221</td><td class="hits">18</td><td class="source">		var constraintDefinition = beanFactory.getConstraintDefinition(name);</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">223</td><td class="hits">18</td><td class="source">		var constraintExpression = constraintDefinition.getConstraint();</td></tr><tr class="hit"><td class="line">224</td><td class="hits">18</td><td class="source">		if (constraintExpression) {</td></tr><tr class="hit"><td class="line">225</td><td class="hits">8</td><td class="source">			this.parse(constraintExpression, beanFactory)</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">228</td><td class="hits">18</td><td class="source">		var propsLen = props.length;</td></tr><tr class="hit"><td class="line">229</td><td class="hits">18</td><td class="source">		if (propsLen) {</td></tr><tr class="hit"><td class="line">230</td><td class="hits">4</td><td class="source">			for (var k = 0; k &lt; propsLen; k++) {</td></tr><tr class="hit"><td class="line">231</td><td class="hits">4</td><td class="source">				var prop = props[k];</td></tr><tr class="hit"><td class="line">232</td><td class="hits">4</td><td class="source">				var propName = prop['name'];</td></tr><tr class="hit"><td class="line">233</td><td class="hits">4</td><td class="source">				var propValue = prop['value'];</td></tr><tr class="hit"><td class="line">234</td><td class="hits">4</td><td class="source">				constraint[propName] = propValue;</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">238</td><td class="hits">18</td><td class="source">		this.addConstraints(constraint);</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> * ModelAttribute set expression.</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> * @param   {String} expression</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">248</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.setExpression = function(expression) {</td></tr><tr class="hit"><td class="line">249</td><td class="hits">66</td><td class="source">	this.expression = expression;</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> * ModelAttribute get expression.</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source"> * @return   {String} expression</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">258</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.getExpression = function() {</td></tr><tr class="hit"><td class="line">259</td><td class="hits">1</td><td class="source">	return this.expression;</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> * ModelAttribute set ref.</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source"> * @param   {String} ref string.</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">268</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.setRef = function(ref) {</td></tr><tr class="miss"><td class="line">269</td><td class="hits">0</td><td class="source">	this.ref = ref;</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source"> * ModelAttribute get ref.</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source"> * @return   {String} ref string.</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">278</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.getRef = function() {</td></tr><tr class="hit"><td class="line">279</td><td class="hits">196</td><td class="source">	return this.ref;</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source"> * ModelAttribute set attribute name.</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source"> * @param   {String} attribute name.</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">288</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.setName = function(name) {</td></tr><tr class="hit"><td class="line">289</td><td class="hits">66</td><td class="source">	this.name = name;</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source"> * ModelAttribute get attribute name.</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source"> * @return   {String} attribute name.</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">298</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.getName = function() {</td></tr><tr class="hit"><td class="line">299</td><td class="hits">131</td><td class="source">	return this.name;</td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source"> * ModelAttribute set attribute type.</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source"> * @param   {String} attribute type.</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">308</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.setType = function(type) {</td></tr><tr class="hit"><td class="line">309</td><td class="hits">1</td><td class="source">	this.type = type;</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source"> * ModelAttribute get attribute type.</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source"> * @return   {String} attribute type.</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">318</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.getType = function(type) {</td></tr><tr class="hit"><td class="line">319</td><td class="hits">213</td><td class="source">	return this.type;</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source"> * ModelAttribute set attribute primary.</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source"> * @param   {Boolean} if it is the attribute primary.</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">328</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.setPrimary = function(primary) {</td></tr><tr class="hit"><td class="line">329</td><td class="hits">1</td><td class="source">	this.primary = primary;</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source"> * ModelAttribute get attribute primary.</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source"> * @return   {Boolean} attribute primary.</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">337</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">338</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.getPrimary = function() {</td></tr><tr class="hit"><td class="line">339</td><td class="hits">1</td><td class="source">	return this.primary;</td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">341</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source"> * ModelAttribute set attribute default value.</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source"> * @param   {String} attribute default value.</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">348</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.setDefault = function(defaultValue) {</td></tr><tr class="hit"><td class="line">349</td><td class="hits">1</td><td class="source">	this.default = defaultValue;</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source"> * ModelAttribute get attribute default value.</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source"> * @return   {String} attribute default value.</td></tr><tr><td class="line">356</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">358</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.getDefault = function() {</td></tr><tr class="hit"><td class="line">359</td><td class="hits">16</td><td class="source">	return this.default;</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source"> * ModelAttribute set attribute prefix.</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source"> * @param   {String} attribute prefix.</td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">368</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.setPrefix = function(prefix) {</td></tr><tr class="miss"><td class="line">369</td><td class="hits">0</td><td class="source">	this.prefix = prefix;</td></tr><tr><td class="line">370</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">373</td><td class="hits"></td><td class="source"> * ModelAttribute get attribute prefix.</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source"> * @return   {String} attribute prefix.</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">378</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.getPrefix = function() {</td></tr><tr class="hit"><td class="line">379</td><td class="hits">130</td><td class="source">	return this.prefix;</td></tr><tr><td class="line">380</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source"> * ModelAttribute check if it is a primary attribute.</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source"> * @param   {Boolean} if it is a primary attribute.</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">388</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.isPrimary = function() {</td></tr><tr class="hit"><td class="line">389</td><td class="hits">1</td><td class="source">	return this.primary;</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> * ModelAttribute check if it is a balance attribute.</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source"> * @param   {Boolean} if it is a balance attribute.</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">397</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">398</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.isBalance = function() {</td></tr><tr class="hit"><td class="line">399</td><td class="hits">66</td><td class="source">	return this.balance;</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source"> * ModelAttribute add constraint.</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source"> * @param   {Object} constraint object.</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">408</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.addConstraints = function(constraint) {</td></tr><tr class="hit"><td class="line">409</td><td class="hits">18</td><td class="source">	this.constraints.push(constraint);</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source"> * ModelAttribute check attribute properties.</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source"> * @param   {Boolean} check result.</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">418</td><td class="hits">1</td><td class="source">ModelAttribute.prototype.checkProps = function(key) {</td></tr><tr class="hit"><td class="line">419</td><td class="hits">80</td><td class="source">	var attributes = Constant.MODEL_ATTRIBUTES;</td></tr><tr class="hit"><td class="line">420</td><td class="hits">80</td><td class="source">	for (var i = 0; i &lt; attributes.length; i++) {</td></tr><tr class="hit"><td class="line">421</td><td class="hits">130</td><td class="source">		if (key === attributes[i]) {</td></tr><tr class="hit"><td class="line">422</td><td class="hits">78</td><td class="source">			return true;</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">426</td><td class="hits">2</td><td class="source">	return false;</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">429</td><td class="hits">1</td><td class="source">module.exports = ModelAttribute;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelConstraint.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelConstraint.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">17</div><div class="hits">17</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ModelConstraint</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * ModelConstraint constructor function.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var ModelConstraint = function() {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">357</td><td class="source">	this.id = null;</td></tr><tr class="hit"><td class="line">21</td><td class="hits">357</td><td class="source">	this.cid = null;</td></tr><tr class="hit"><td class="line">22</td><td class="hits">357</td><td class="source">	this.constraint = null;</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * ModelConstraint set bean id.</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * @param   {String} bean id</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">ModelConstraint.prototype.setId = function(id) {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">358</td><td class="source">	this.id = id;</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * ModelConstraint get bean id.</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @return   {String} bean id</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">ModelConstraint.prototype.getId = function() {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">18</td><td class="source">	return this.id;</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * ModelConstraint set constraint id.</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @param   {String} constraint id</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">ModelConstraint.prototype.setCid = function(cid) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">358</td><td class="source">	this.cid = cid;</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * ModelConstraint get bean id.</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * @return   {String} constraint id</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">61</td><td class="hits">1</td><td class="source">ModelConstraint.prototype.getCid = function() {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">	return this.cid;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * ModelConstraint set constraint expression.</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * @param   {String} constraint expression</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">ModelConstraint.prototype.setConstraint = function(constraint) {</td></tr><tr class="hit"><td class="line">72</td><td class="hits">358</td><td class="source">	this.constraint = constraint;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * ModelConstraint get constraint expression.</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * @return   {String} constraint expression</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">ModelConstraint.prototype.getConstraint = function() {</td></tr><tr class="hit"><td class="line">82</td><td class="hits">18</td><td class="source">	return this.constraint;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">1</td><td class="source">module.exports = ModelConstraint;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelDefinition.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelDefinition.js</h2><div id="stats" class="high"><div class="percentage">91%</div><div class="sloc">60</div><div class="hits">55</div><div class="misses">5</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ModelDefinition</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * ModelDefinition constructor function.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var ModelDefinition = function() {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">15</td><td class="source">	this.id = null;</td></tr><tr class="hit"><td class="line">23</td><td class="hits">15</td><td class="source">	this.mid = null;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">15</td><td class="source">	this.table = null;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">15</td><td class="source">	this.prefix = null;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">15</td><td class="source">	this.balance = null;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">15</td><td class="source">	this.fields = {};</td></tr><tr class="hit"><td class="line">28</td><td class="hits">15</td><td class="source">	this.refFields = [];</td></tr><tr class="hit"><td class="line">29</td><td class="hits">15</td><td class="source">	this.modelKeyMap = {};</td></tr><tr class="hit"><td class="line">30</td><td class="hits">15</td><td class="source">	this.oneToMany = false;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * ModelDefinition set bean id.</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @param   {String} bean id</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.setId = function(id) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">14</td><td class="source">	this.id = id;</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * ModelDefinition get bean id.</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @return   {String} bean id</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.getId = function() {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">3</td><td class="source">	return this.id;</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * ModelDefinition set model id.</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @param   {String} model id</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.setMid = function(mid) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">14</td><td class="source">	this.mid = mid;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * ModelDefinition get model id.</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @return   {String} model id</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.getMid = function() {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">29</td><td class="source">	return this.mid;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> * ModelDefinition set ORM table.</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * @param   {String} ORM table</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.setTable = function(table) {</td></tr><tr class="hit"><td class="line">80</td><td class="hits">14</td><td class="source">	if (!table) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">6</td><td class="source">		return;</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">8</td><td class="source">	this.table = table;</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * ModelDefinition get ORM table.</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> * @return   {String} ORM table</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.getTable = function() {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">1</td><td class="source">	return this.table;</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> * ModelDefinition set model definition prefix.</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> * @param   {String} model definition prefix</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.setPrefix = function(prefix) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">14</td><td class="source">	if (!prefix) {</td></tr><tr class="hit"><td class="line">105</td><td class="hits">8</td><td class="source">		return;</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">108</td><td class="hits">6</td><td class="source">	this.prefix = prefix;</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> * ModelDefinition get model definition prefix.</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * @return   {String} model definition prefix</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">117</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.getPrefix = function() {</td></tr><tr class="hit"><td class="line">118</td><td class="hits">28</td><td class="source">	return this.prefix;</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> * ModelDefinition set model definition balance field for ddb sharding.</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> * @param   {String} model definition balance field</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">127</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.setBalance = function(balance) {</td></tr><tr class="hit"><td class="line">128</td><td class="hits">14</td><td class="source">	if (!balance) {</td></tr><tr class="hit"><td class="line">129</td><td class="hits">12</td><td class="source">		return;</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">132</td><td class="hits">2</td><td class="source">	this.balance = balance;</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> * ModelDefinition get model definition balance field for ddb sharding.</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> * @return   {String} model definition balance field</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">141</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.getBalance = function() {</td></tr><tr class="miss"><td class="line">142</td><td class="hits">0</td><td class="source">	return this.balance;</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> * ModelDefinition set model fields.</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> * @param   {Array} model fields</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">151</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.setFields = function(fields) {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">14</td><td class="source">	if (Utils.isNotNull(fields)) {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">14</td><td class="source">		this.fields = fields;</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source"> * ModelDefinition get model fields.</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> * @return   {Array} model fields</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">163</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.getFields = function() {</td></tr><tr class="hit"><td class="line">164</td><td class="hits">34</td><td class="source">	return this.fields;</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> * ModelDefinition get model field by key.</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> * @return   {Object} model field</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">173</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.getField = function(key) {</td></tr><tr class="hit"><td class="line">174</td><td class="hits">12</td><td class="source">	return this.fields[key];</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source"> * ModelDefinition add ref field name.</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> * @param   {String} ref field name</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">183</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.addRefField = function(refField) {</td></tr><tr class="miss"><td class="line">184</td><td class="hits">0</td><td class="source">	this.refFields.push(refField);</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> * ModelDefinition set ref fields.</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> * @param   {Array} ref fields</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">193</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.setRefFields = function(refFields) {</td></tr><tr class="hit"><td class="line">194</td><td class="hits">14</td><td class="source">	if (Utils.isNotNull(refFields)) {</td></tr><tr class="hit"><td class="line">195</td><td class="hits">14</td><td class="source">		this.refFields = refFields;</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> * ModelDefinition get ref fields.</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> * @return   {Array} ref fields</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">205</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.getRefFields = function() {</td></tr><tr class="miss"><td class="line">206</td><td class="hits">0</td><td class="source">	return this.refFields;</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> * ModelDefinition set model key map used for resultSet to model object mapping.</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> * @param   {Object} model key map</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">215</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.setModelKeyMap = function(modelKeyMap) {</td></tr><tr class="hit"><td class="line">216</td><td class="hits">14</td><td class="source">	this.modelKeyMap = modelKeyMap;</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source"> * ModelDefinition get model key map used for resultSet to model object mapping.</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> * @return   {Object} model key map</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">225</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.getModelKeyMap = function() {</td></tr><tr class="miss"><td class="line">226</td><td class="hits">0</td><td class="source">	return this.modelKeyMap;</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source"> * ModelDefinition set model oneToMany relation.</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source"> * @param   {Boolean} oneToMany relation</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">235</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.setOneToMany = function(oneToMany) {</td></tr><tr class="hit"><td class="line">236</td><td class="hits">14</td><td class="source">	this.oneToMany = oneToMany;</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> * ModelDefinition check model oneToMany relation.</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source"> * @return   {Boolean} if it is oneToMany relation</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">245</td><td class="hits">1</td><td class="source">ModelDefinition.prototype.isOneToMany = function() {</td></tr><tr class="miss"><td class="line">246</td><td class="hits">0</td><td class="source">	return this.oneToMany;</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">249</td><td class="hits">1</td><td class="source">module.exports = ModelDefinition;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelFilter.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelFilter.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">31</div><div class="hits">31</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ModelFilter</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'ModelFilter');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> * ModelFilter constructor function.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var ModelFilter = function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">4</td><td class="source">	this.modelBean = null;</td></tr><tr class="hit"><td class="line">24</td><td class="hits">4</td><td class="source">	this.modelDefinition = null;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * ModelFilter set model object ref.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @param   {Object} model object ref</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">ModelFilter.prototype.setModel = function(modelBean) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">3</td><td class="source">	this.modelBean = modelBean;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * ModelFilter get model object ref.</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @return   {Object} model object ref</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">ModelFilter.prototype.getModel = function() {</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">	return this.modelBean;</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * ModelFilter set model definition.</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @param   {Object} model definition</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">ModelFilter.prototype.setModelDefinition = function(modelDefinition) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">3</td><td class="source">	this.modelDefinition = modelDefinition;</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * ModelFilter get model definition.</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @return   {Object} model definition</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">ModelFilter.prototype.getModelDefinition = function() {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">1</td><td class="source">	return this.modelDefinition;</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * ModelFilter model filter key/value attribute.</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * @param   {String} model attribute key</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @param   {String} model attribute value</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">ModelFilter.prototype.filter = function(key, value) {</td></tr><tr class="hit"><td class="line">75</td><td class="hits">15</td><td class="source">	if (Utils.checkString(key)) {</td></tr><tr class="hit"><td class="line">76</td><td class="hits">12</td><td class="source">		return this.doFilterKey(key, value);</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">79</td><td class="hits">3</td><td class="source">	return this.doFilterKeys();</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * ModelFilter do model filter key/value attribute.</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> * @param   {String} 		model attribute key</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * @param   {String} 		model attribute value</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * @return  {Boolean|Error} true|false|Error</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">91</td><td class="hits">1</td><td class="source">ModelFilter.prototype.doFilterKey = function(key, value) {</td></tr><tr class="hit"><td class="line">92</td><td class="hits">12</td><td class="source">	var field = this.modelDefinition.getField(key);</td></tr><tr class="hit"><td class="line">93</td><td class="hits">12</td><td class="source">	if (field) {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">12</td><td class="source">		return field.filter(value);</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> * ModelFilter do model filter key/value attributes.</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * @param   {String} 	model attribute key</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> * @param   {String} 	model attribute value</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * @return  {Error} 	Error</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">107</td><td class="hits">1</td><td class="source">ModelFilter.prototype.doFilterKeys = function() {</td></tr><tr class="hit"><td class="line">108</td><td class="hits">3</td><td class="source">	var fields = this.modelDefinition.getFields();</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">3</td><td class="source">	for (var key in fields) {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">10</td><td class="source">		var field = fields[key];</td></tr><tr class="hit"><td class="line">112</td><td class="hits">10</td><td class="source">		var value = this.modelBean[key];</td></tr><tr class="hit"><td class="line">113</td><td class="hits">10</td><td class="source">		var r = field.filter(value);</td></tr><tr class="hit"><td class="line">114</td><td class="hits">10</td><td class="source">		if (Utils.checkModelFilterError(r)) {</td></tr><tr class="hit"><td class="line">115</td><td class="hits">2</td><td class="source">			return r;</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">119</td><td class="hits">1</td><td class="source">	return;</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">122</td><td class="hits">1</td><td class="source">module.exports = ModelFilter;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelKeyMapResolver.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelKeyMapResolver.js</h2><div id="stats" class="high"><div class="percentage">95%</div><div class="sloc">41</div><div class="hits">39</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ModelKeyMapResolver</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'ModelKeyMapResolver');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * ModelKeyMapResolver constructor function.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var ModelKeyMapResolver = function() {</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * ModelKeyMapResolver post process beanFactory.</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * @param  {Object} beanFactory</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">ModelKeyMapResolver.prototype.postProcessBeanFactory = function(beanFactory) {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">66</td><td class="source">	this.processModelKeyMap(beanFactory);</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * ModelKeyMapResolver process model key map.</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * @param  {Object} beanFactory</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">ModelKeyMapResolver.prototype.processModelKeyMap = function(beanFactory) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">66</td><td class="source">	var models = beanFactory.getModelDefinitions();</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">66</td><td class="source">	for (var modelId in models) {</td></tr><tr class="hit"><td class="line">45</td><td class="hits">14</td><td class="source">		var modelDefinition = models[modelId];</td></tr><tr class="hit"><td class="line">46</td><td class="hits">14</td><td class="source">		var modelKeyMap = {};</td></tr><tr class="hit"><td class="line">47</td><td class="hits">14</td><td class="source">		this.processModelDefinition(beanFactory, modelDefinition, modelKeyMap, {});</td></tr><tr class="hit"><td class="line">48</td><td class="hits">14</td><td class="source">		modelDefinition.setModelKeyMap(modelKeyMap);</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * ModelKeyMapResolver post model definition.</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * @param  {Object} beanFactory</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @param  {Object} modelDefinition</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @param  {Object} modelKeyMap</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> * @param  {Object} option</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">61</td><td class="hits">1</td><td class="source">ModelKeyMapResolver.prototype.processModelDefinition = function(beanFactory, modelDefinition, modelKeyMap, option) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">28</td><td class="source">	var fields = modelDefinition.getFields();</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">64</td><td class="hits">28</td><td class="source">	var modelId = modelDefinition.getMid();</td></tr><tr class="hit"><td class="line">65</td><td class="hits">28</td><td class="source">	var prefix = modelDefinition.getPrefix();</td></tr><tr class="hit"><td class="line">66</td><td class="hits">28</td><td class="source">	var optionPrefix = option['prefix'] || prefix;</td></tr><tr class="hit"><td class="line">67</td><td class="hits">28</td><td class="source">	var parentId = option['pid'];</td></tr><tr class="hit"><td class="line">68</td><td class="hits">28</td><td class="source">	var parentType = option['ptype'];</td></tr><tr class="hit"><td class="line">69</td><td class="hits">28</td><td class="source">	var parentField = option['pfield'];</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">71</td><td class="hits">28</td><td class="source">	for (var fieldName in fields) {</td></tr><tr class="hit"><td class="line">72</td><td class="hits">130</td><td class="source">		var field = fields[fieldName];</td></tr><tr class="hit"><td class="line">73</td><td class="hits">130</td><td class="source">		var fieldName = field.getName();</td></tr><tr class="hit"><td class="line">74</td><td class="hits">130</td><td class="source">		var modelRefId = field.getRef();</td></tr><tr class="hit"><td class="line">75</td><td class="hits">130</td><td class="source">		var fieldPrefix = field.getPrefix();</td></tr><tr class="hit"><td class="line">76</td><td class="hits">130</td><td class="source">		var fieldType = field.getType();</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">78</td><td class="hits">130</td><td class="source">		var modelKey = &quot;&quot;;</td></tr><tr class="hit"><td class="line">79</td><td class="hits">130</td><td class="source">		if (optionPrefix) {</td></tr><tr class="hit"><td class="line">80</td><td class="hits">92</td><td class="source">			modelKey += optionPrefix;</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">83</td><td class="hits">130</td><td class="source">		modelKey = modelKey + fieldName;</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">130</td><td class="source">		if (modelRefId) {</td></tr><tr class="hit"><td class="line">86</td><td class="hits">14</td><td class="source">			var modelRefDefinition = beanFactory.getModelDefinition(modelRefId);</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">14</td><td class="source">			if (!modelRefDefinition) {</td></tr><tr class="miss"><td class="line">89</td><td class="hits">0</td><td class="source">				logger.warn('model field ref id %s not exsit', modelRefId);</td></tr><tr class="miss"><td class="line">90</td><td class="hits">0</td><td class="source">				continue;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">14</td><td class="source">			var option = {</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">				pid: modelId,</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">				ptype: fieldType,</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">				pfield: fieldName</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">			};</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">99</td><td class="hits">14</td><td class="source">			if (fieldPrefix) {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">4</td><td class="source">				option['prefix'] = fieldPrefix;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">103</td><td class="hits">14</td><td class="source">			this.processModelDefinition(beanFactory, modelRefDefinition, modelKeyMap, option);</td></tr><tr class="hit"><td class="line">104</td><td class="hits">14</td><td class="source">			continue;</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">107</td><td class="hits">116</td><td class="source">		modelKeyMap[modelKey] = {</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">			id: modelId,</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">			pid: parentId,</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">			ptype: parentType,</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">			pfield: parentField,</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">			fieldName: fieldName,</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">			type: fieldType</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">		};</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">module.exports = ModelKeyMapResolver;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelProxy.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/model/modelProxy.js</h2><div id="stats" class="medium"><div class="percentage">68%</div><div class="sloc">202</div><div class="hits">138</div><div class="misses">64</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ModelProxy</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'ModelProxy');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Constant = require('../util/constant');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * ModelProxy constructor function.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var ModelProxy = function() {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">4</td><td class="source">	this.model = null;</td></tr><tr class="hit"><td class="line">25</td><td class="hits">4</td><td class="source">	this.modelFilter = null;</td></tr><tr class="hit"><td class="line">26</td><td class="hits">4</td><td class="source">	this.beanFactory = null;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">4</td><td class="source">	this.beanDefinition = null;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">4</td><td class="source">	this.modelDefinition = null;</td></tr><tr class="hit"><td class="line">29</td><td class="hits">4</td><td class="source">	this.beforeNames = [];</td></tr><tr class="hit"><td class="line">30</td><td class="hits">4</td><td class="source">	this.afterNames = [];</td></tr><tr class="hit"><td class="line">31</td><td class="hits">4</td><td class="source">	this.beforeName = null;</td></tr><tr class="hit"><td class="line">32</td><td class="hits">4</td><td class="source">	this.afterName = null;</td></tr><tr class="hit"><td class="line">33</td><td class="hits">4</td><td class="source">	this.beforeFlag = false;</td></tr><tr class="hit"><td class="line">34</td><td class="hits">4</td><td class="source">	this.afterFlag = false;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * ModelProxy set key/value to model.</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @param  {String} 	key</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @param  {Object} 	value</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @return {Object} 	Error object when set value failed</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">ModelProxy.prototype.$set = function(key, value) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">12</td><td class="source">	var model = this.model;</td></tr><tr class="hit"><td class="line">47</td><td class="hits">12</td><td class="source">	this['beforeFlag'] = true; // setup before flag, enable builtin constaints by default</td></tr><tr class="hit"><td class="line">48</td><td class="hits">12</td><td class="source">	var befores = this._getFilters(Constant.MODEL_FILTER_BEFORE);</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">	// do model before filters</td></tr><tr class="hit"><td class="line">51</td><td class="hits">12</td><td class="source">	var r = this._doFilters(befores, key, value);</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">12</td><td class="source">	if (Utils.checkModelFilterError(r)) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">6</td><td class="source">		return this._result(r);</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">	//  setup value</td></tr><tr class="hit"><td class="line">58</td><td class="hits">6</td><td class="source">	model[key] = value;</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">6</td><td class="source">	var afters = this._getFilters(Constant.MODEL_FILTER_AFTER);</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">	// do model after filters</td></tr><tr class="hit"><td class="line">63</td><td class="hits">6</td><td class="source">	r = this._doFilters(afters, key, value);</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">6</td><td class="source">	if (Utils.checkModelFilterError(r)) {</td></tr><tr class="hit"><td class="line">66</td><td class="hits">2</td><td class="source">		return this._result(r);</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">69</td><td class="hits">4</td><td class="source">	return this._result(r);</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> * ModelProxy get data from model.</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> * @param  {String} key</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> * @return {Object} data value</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">ModelProxy.prototype.$get = function(key) {</td></tr><tr class="hit"><td class="line">80</td><td class="hits">10</td><td class="source">	return this.model[key];</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * ModelProxy pack data object to model.</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * @param  {Object} 	data</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> * @return {Object} 	Error object when pack data failed</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">90</td><td class="hits">1</td><td class="source">ModelProxy.prototype.$pack = function(data) {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">4</td><td class="source">	if (!Utils.checkObject(data)) {</td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">		return new Error('pack data must be Object');</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">95</td><td class="hits">3</td><td class="source">	var model = this.model;</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">3</td><td class="source">	for (var key in data) {</td></tr><tr class="hit"><td class="line">98</td><td class="hits">9</td><td class="source">		var value = data[key];</td></tr><tr class="hit"><td class="line">99</td><td class="hits">9</td><td class="source">		model[key] = value;</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">102</td><td class="hits">3</td><td class="source">	this['afterFlag'] = true;</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">	// $pack only have after filters</td></tr><tr class="hit"><td class="line">105</td><td class="hits">3</td><td class="source">	var afters = this._getFilters(Constant.MODEL_FILTER_AFTER);</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">	// do model after filters</td></tr><tr class="hit"><td class="line">108</td><td class="hits">3</td><td class="source">	var r = this._doFilters(afters);</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">3</td><td class="source">	if (Utils.checkModelFilterError(r)) {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">2</td><td class="source">		return this._result(r);</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">114</td><td class="hits">1</td><td class="source">	return this._result(r);</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> * ModelProxy pack db ResultSet data to model.</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @param  {Object} resultSet data</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> * @return {Object|Boolean} Error|true</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">124</td><td class="hits">1</td><td class="source">ModelProxy.prototype.$packResultSet = function(resultSet) {</td></tr><tr class="miss"><td class="line">125</td><td class="hits">0</td><td class="source">	if (!Utils.checkObject(resultSet)) {</td></tr><tr class="miss"><td class="line">126</td><td class="hits">0</td><td class="source">		return new Error('resultSet must be Object');</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">129</td><td class="hits">0</td><td class="source">	var beanFactory = this.beanFactory;</td></tr><tr class="miss"><td class="line">130</td><td class="hits">0</td><td class="source">	var resultModelId = this.modelDefinition.getMid();</td></tr><tr class="miss"><td class="line">131</td><td class="hits">0</td><td class="source">	var resultModel = this;</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">133</td><td class="hits">0</td><td class="source">	if (!resultModel) {</td></tr><tr class="miss"><td class="line">134</td><td class="hits">0</td><td class="source">		logger.error('packResultSet error no such result model %s', resultModelId);</td></tr><tr class="miss"><td class="line">135</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">138</td><td class="hits">0</td><td class="source">	var modelKeyMap = this.modelDefinition.getModelKeyMap();</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">140</td><td class="hits">0</td><td class="source">	var dataResult = resultSet;</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">142</td><td class="hits">0</td><td class="source">	var modelResultMap = {};</td></tr><tr class="miss"><td class="line">143</td><td class="hits">0</td><td class="source">	for (var dataKey in dataResult) {</td></tr><tr class="miss"><td class="line">144</td><td class="hits">0</td><td class="source">		var dataValue = dataResult[dataKey];</td></tr><tr class="miss"><td class="line">145</td><td class="hits">0</td><td class="source">		if (Utils.checkFunction(dataValue)) {</td></tr><tr class="miss"><td class="line">146</td><td class="hits">0</td><td class="source">			continue;</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">149</td><td class="hits">0</td><td class="source">		var modelMap = modelKeyMap[dataKey];</td></tr><tr class="miss"><td class="line">150</td><td class="hits">0</td><td class="source">		if (!modelMap) {</td></tr><tr class="miss"><td class="line">151</td><td class="hits">0</td><td class="source">			logger.warn('packResultSet resultSet key %s does not match any model attribute', dataKey);</td></tr><tr class="miss"><td class="line">152</td><td class="hits">0</td><td class="source">			continue;</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">155</td><td class="hits">0</td><td class="source">		var modelId = modelMap['id'];</td></tr><tr class="miss"><td class="line">156</td><td class="hits">0</td><td class="source">		var fieldName = modelMap['fieldName'];</td></tr><tr class="miss"><td class="line">157</td><td class="hits">0</td><td class="source">		var fieldType = modelMap['type'];</td></tr><tr class="miss"><td class="line">158</td><td class="hits">0</td><td class="source">		var pid = modelMap['pid'] || modelId;</td></tr><tr class="miss"><td class="line">159</td><td class="hits">0</td><td class="source">		var pfield = modelMap['pfield'] || fieldName;</td></tr><tr class="miss"><td class="line">160</td><td class="hits">0</td><td class="source">		var ptype = modelMap['ptype'];</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">162</td><td class="hits">0</td><td class="source">		var model;</td></tr><tr class="miss"><td class="line">163</td><td class="hits">0</td><td class="source">		if (Utils.checkTypeArray(ptype) || Utils.checkTypeObject(ptype)) {</td></tr><tr class="miss"><td class="line">164</td><td class="hits">0</td><td class="source">			var modelResultMapKey = pid + &quot;_&quot; + pfield;</td></tr><tr class="miss"><td class="line">165</td><td class="hits">0</td><td class="source">			model = modelResultMap[modelResultMapKey];</td></tr><tr class="miss"><td class="line">166</td><td class="hits">0</td><td class="source">			if (!model) {</td></tr><tr class="miss"><td class="line">167</td><td class="hits">0</td><td class="source">				model = beanFactory.getModelProxy(modelId);</td></tr><tr class="miss"><td class="line">168</td><td class="hits">0</td><td class="source">				modelResultMap[modelResultMapKey] = model; // ref model object</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">		} else {</td></tr><tr class="miss"><td class="line">171</td><td class="hits">0</td><td class="source">			model = this;</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">174</td><td class="hits">0</td><td class="source">		var r = model.$before().$set(fieldName, dataValue); // set data, do filter</td></tr><tr class="miss"><td class="line">175</td><td class="hits">0</td><td class="source">		if (Utils.checkModelFilterError(r)) {</td></tr><tr class="miss"><td class="line">176</td><td class="hits">0</td><td class="source">			return r;</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">180</td><td class="hits">0</td><td class="source">	this._doPackResultSet(resultModel, modelResultMap);</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> * ModelProxy set before filter to model.</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> * filter can be String which is the name of the filter method in the model</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> * or can be Array which contains the filter methods in order</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> * @param  {String|Array} before filter</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">191</td><td class="hits">1</td><td class="source">ModelProxy.prototype.$before = function(before) {</td></tr><tr class="hit"><td class="line">192</td><td class="hits">10</td><td class="source">	return this._filter(Constant.MODEL_FILTER_BEFORE, before);</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> * ModelProxy set after filter to model.</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> * filter can be String which is the name of the filter method in the model</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source"> * or can be Array which contains the filter methods in order</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> * @param  {String|Array} after filter</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">203</td><td class="hits">1</td><td class="source">ModelProxy.prototype.$after = function(after) {</td></tr><tr class="hit"><td class="line">204</td><td class="hits">7</td><td class="source">	return this._filter(Constant.MODEL_FILTER_AFTER, after);</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">207</td><td class="hits">1</td><td class="source">ModelProxy.prototype.$clone = function() {</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> * ModelProxy  model proxy init.</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">216</td><td class="hits">1</td><td class="source">ModelProxy.prototype._modelInit = function() {</td></tr><tr class="hit"><td class="line">217</td><td class="hits">4</td><td class="source">	var beanDefinition = this.beanDefinition;</td></tr><tr class="hit"><td class="line">218</td><td class="hits">4</td><td class="source">	if (!beanDefinition) {</td></tr><tr class="hit"><td class="line">219</td><td class="hits">1</td><td class="source">		logger.error('init error no beanDefinition.');</td></tr><tr class="hit"><td class="line">220</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">223</td><td class="hits">3</td><td class="source">	var self = this;</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">225</td><td class="hits">3</td><td class="source">	var func = beanDefinition.getFunc();</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">227</td><td class="hits">3</td><td class="source">	if (Utils.checkFunction(func)) {</td></tr><tr class="hit"><td class="line">228</td><td class="hits">3</td><td class="source">		var proto = func.prototype;</td></tr><tr class="hit"><td class="line">229</td><td class="hits">3</td><td class="source">		for (interface in proto) {</td></tr><tr class="hit"><td class="line">230</td><td class="hits">11</td><td class="source">			if (Utils.checkFunction(proto[interface])) {</td></tr><tr class="hit"><td class="line">231</td><td class="hits">11</td><td class="source">				(function(method) {</td></tr><tr class="hit"><td class="line">232</td><td class="hits">11</td><td class="source">					if (checkFuncName(method)) {</td></tr><tr class="hit"><td class="line">233</td><td class="hits">1</td><td class="source">						logger.error('init error proxy method interface %j the same as ModelProxy, rename this name to another.', method)</td></tr><tr class="hit"><td class="line">234</td><td class="hits">1</td><td class="source">						return;</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">					};</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">237</td><td class="hits">10</td><td class="source">					self[method] = function() {</td></tr><tr class="hit"><td class="line">238</td><td class="hits">1</td><td class="source">						return self._modelInvoke(method, arguments);</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">					};</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">				})(interface);</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> * ModelProxy model proxy invoke methods.</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> * @param  {String} invoke method name</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source"> * @param  {Array}  invoke arguments</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> * @return {Object} invoke result</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">254</td><td class="hits">1</td><td class="source">ModelProxy.prototype._modelInvoke = function(method, args) {</td></tr><tr class="hit"><td class="line">255</td><td class="hits">14</td><td class="source">	var targetModel = this.model;</td></tr><tr class="hit"><td class="line">256</td><td class="hits">14</td><td class="source">	if (Utils.checkFunction(targetModel[method])) {</td></tr><tr class="hit"><td class="line">257</td><td class="hits">13</td><td class="source">		return targetModel[method].apply(targetModel, args);</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="hit"><td class="line">259</td><td class="hits">1</td><td class="source">		logger.error('invoke error with %s %j', method, args);</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source"> * ModelProxy do pack db ResultSet data to model.</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> * @param  {Object} resultSet data</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source"> * @return {Object|Boolean} Error|true</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">270</td><td class="hits">1</td><td class="source">ModelProxy.prototype._doPackResultSet = function(resultModel, modelResultMap) {</td></tr><tr class="miss"><td class="line">271</td><td class="hits">0</td><td class="source">	var resultModelFields = resultModel.modelDefinition.getFields();</td></tr><tr class="miss"><td class="line">272</td><td class="hits">0</td><td class="source">	var resultModelId = resultModel.modelDefinition.getMid();</td></tr><tr class="miss"><td class="line">273</td><td class="hits">0</td><td class="source">	var beanFactory = this.beanFactory;</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">275</td><td class="hits">0</td><td class="source">	for (var resultFieldKey in resultModelFields) {</td></tr><tr class="miss"><td class="line">276</td><td class="hits">0</td><td class="source">		var resultField = resultModelFields[resultFieldKey];</td></tr><tr class="miss"><td class="line">277</td><td class="hits">0</td><td class="source">		var resultFieldRef = resultField.getRef();</td></tr><tr class="miss"><td class="line">278</td><td class="hits">0</td><td class="source">		var resultFieldType = resultField.getType();</td></tr><tr class="miss"><td class="line">279</td><td class="hits">0</td><td class="source">		var key = resultModelId + &quot;_&quot; + resultFieldKey;</td></tr><tr class="miss"><td class="line">280</td><td class="hits">0</td><td class="source">		var value = modelResultMap[key];</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">282</td><td class="hits">0</td><td class="source">		if (!Utils.isNotNull(value) &amp;&amp; resultFieldRef) {</td></tr><tr class="miss"><td class="line">283</td><td class="hits">0</td><td class="source">			var refModel = beanFactory.getModelProxy(resultFieldRef);</td></tr><tr class="miss"><td class="line">284</td><td class="hits">0</td><td class="source">			if (refModel) {</td></tr><tr class="miss"><td class="line">285</td><td class="hits">0</td><td class="source">				this._doPackResultSet(refModel, modelResultMap);</td></tr><tr class="miss"><td class="line">286</td><td class="hits">0</td><td class="source">				value = refModel;</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">290</td><td class="hits">0</td><td class="source">		if (!Utils.isNotNull(value)) {</td></tr><tr class="miss"><td class="line">291</td><td class="hits">0</td><td class="source">			continue;</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">293</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">294</td><td class="hits">0</td><td class="source">		var oneToMany = false;</td></tr><tr class="miss"><td class="line">295</td><td class="hits">0</td><td class="source">		if (Utils.checkTypeArray(resultFieldType)) {</td></tr><tr class="miss"><td class="line">296</td><td class="hits">0</td><td class="source">			oneToMany = true;</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">299</td><td class="hits">0</td><td class="source">		if (oneToMany) {</td></tr><tr class="miss"><td class="line">300</td><td class="hits">0</td><td class="source">			var resultFieldValue = resultModel.$get(resultFieldKey);</td></tr><tr class="miss"><td class="line">301</td><td class="hits">0</td><td class="source">			if (!Utils.checkArray(resultFieldValue)) {</td></tr><tr class="miss"><td class="line">302</td><td class="hits">0</td><td class="source">				resultFieldValue = [];</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">305</td><td class="hits">0</td><td class="source">			resultFieldValue.push(value);</td></tr><tr class="miss"><td class="line">306</td><td class="hits">0</td><td class="source">			resultModel['model'][resultFieldKey] = resultFieldValue;</td></tr><tr class="miss"><td class="line">307</td><td class="hits">0</td><td class="source">			continue;</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">310</td><td class="hits">0</td><td class="source">		resultModel.$set(resultFieldKey, value);</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source"> * ModelProxy do set filter to model.</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> * @param  {String}       filter type</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source"> * @param  {String|Array} filter</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">321</td><td class="hits">1</td><td class="source">ModelProxy.prototype._filter = function(type, filter) {</td></tr><tr class="hit"><td class="line">322</td><td class="hits">18</td><td class="source">	if (type !== Constant.MODEL_FILTER_BEFORE &amp;&amp; type !== Constant.MODEL_FILTER_AFTER) {</td></tr><tr class="hit"><td class="line">323</td><td class="hits">1</td><td class="source">		logger.warn('unknow model filter type %s', type);</td></tr><tr class="hit"><td class="line">324</td><td class="hits">1</td><td class="source">		return this;</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">327</td><td class="hits">17</td><td class="source">	this[type + 'Flag'] = true;</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">329</td><td class="hits">17</td><td class="source">	if (Utils.checkString(filter)) {</td></tr><tr class="hit"><td class="line">330</td><td class="hits">4</td><td class="source">		this[type + 'Name'] = filter;</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">333</td><td class="hits">17</td><td class="source">	if (Utils.checkArray(filter)) {</td></tr><tr class="hit"><td class="line">334</td><td class="hits">7</td><td class="source">		this[type + 'Names'] = filter;</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">337</td><td class="hits">17</td><td class="source">	return this;</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">341</td><td class="hits"></td><td class="source"> * ModelProxy get filters by type.</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source"> * @param  {String} filter type</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source"> * @param  {Array} 	filters</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">347</td><td class="hits">1</td><td class="source">ModelProxy.prototype._getFilters = function(type) {</td></tr><tr class="hit"><td class="line">348</td><td class="hits">22</td><td class="source">	if (type !== Constant.MODEL_FILTER_BEFORE &amp;&amp; type !== Constant.MODEL_FILTER_AFTER) {</td></tr><tr class="hit"><td class="line">349</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">352</td><td class="hits">21</td><td class="source">	var filters = [];</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source">	// before filter</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source">	// before + after filter only do the builtin filter once</td></tr><tr class="hit"><td class="line">356</td><td class="hits">21</td><td class="source">	if (type === Constant.MODEL_FILTER_BEFORE ||</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source">		(type === Constant.MODEL_FILTER_AFTER &amp;&amp; !this.beforeFlag)) {</td></tr><tr class="hit"><td class="line">358</td><td class="hits">15</td><td class="source">		if (this[type + 'Flag']) {</td></tr><tr class="hit"><td class="line">359</td><td class="hits">15</td><td class="source">			filters.push({</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source">				type: Constant.FILTER_BUILTIN,</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source">				method: Constant.FILTER_BUILTIN_METHOD // &quot;filter&quot;</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source">			});</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">366</td><td class="hits">21</td><td class="source">	var filterName = this[type + 'Name'];</td></tr><tr class="hit"><td class="line">367</td><td class="hits">21</td><td class="source">	if (filterName) {</td></tr><tr class="hit"><td class="line">368</td><td class="hits">4</td><td class="source">		var filterArray = this._modelInvoke(filterName);</td></tr><tr class="hit"><td class="line">369</td><td class="hits">4</td><td class="source">		if (Utils.checkArray(filterArray)) {</td></tr><tr class="hit"><td class="line">370</td><td class="hits">4</td><td class="source">			for (var i = 0; i &lt; filterArray.length; i++) {</td></tr><tr class="hit"><td class="line">371</td><td class="hits">4</td><td class="source">				filters.push({</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source">					type: Constant.FILTER_MODEL,</td></tr><tr><td class="line">373</td><td class="hits"></td><td class="source">					method: filterArray[i]</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source">				});</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">378</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">379</td><td class="hits">21</td><td class="source">	var filterNames = this[type + 'Names'];</td></tr><tr class="hit"><td class="line">380</td><td class="hits">21</td><td class="source">	for (var j = 0; j &lt; filterNames.length; j++) {</td></tr><tr class="hit"><td class="line">381</td><td class="hits">7</td><td class="source">		filters.push({</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">			type: Constant.FILTER_MODEL,</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source">			method: filterNames[j]</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source">		});</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">387</td><td class="hits">21</td><td class="source">	return filters;</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source"> * ModelProxy do filters with key value.</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> * @param  {Array}  filters</td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source"> * @param  {String} key</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source"> * @param  {Object} value</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source"> * @return {Error}  Error object</td></tr><tr><td class="line">397</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">399</td><td class="hits">1</td><td class="source">ModelProxy.prototype._doFilters = function(filters, key, value) {</td></tr><tr class="hit"><td class="line">400</td><td class="hits">21</td><td class="source">	if (!filters || !filters.length) {</td></tr><tr class="hit"><td class="line">401</td><td class="hits">2</td><td class="source">		return;</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">404</td><td class="hits">19</td><td class="source">	var r;</td></tr><tr class="hit"><td class="line">405</td><td class="hits">19</td><td class="source">	for (var i = 0; i &lt; filters.length; i++) {</td></tr><tr class="hit"><td class="line">406</td><td class="hits">23</td><td class="source">		var filter = filters[i];</td></tr><tr class="hit"><td class="line">407</td><td class="hits">23</td><td class="source">		var type = filter['type'];</td></tr><tr class="hit"><td class="line">408</td><td class="hits">23</td><td class="source">		var method = filter['method'];</td></tr><tr class="hit"><td class="line">409</td><td class="hits">23</td><td class="source">		if (type === Constant.FILTER_BUILTIN) {</td></tr><tr class="hit"><td class="line">410</td><td class="hits">15</td><td class="source">			r = this.modelFilter[method](key, value);</td></tr><tr class="hit"><td class="line">411</td><td class="hits">15</td><td class="source">			if (Utils.checkModelFilterError(r)) {</td></tr><tr class="hit"><td class="line">412</td><td class="hits">8</td><td class="source">				return r;</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">416</td><td class="hits">15</td><td class="source">		if (type === Constant.FILTER_MODEL) {</td></tr><tr class="hit"><td class="line">417</td><td class="hits">8</td><td class="source">			var args = [];</td></tr><tr class="hit"><td class="line">418</td><td class="hits">16</td><td class="source">			if (Utils.isNotNull(key)) args.push(key);</td></tr><tr class="hit"><td class="line">419</td><td class="hits">16</td><td class="source">			if (Utils.isNotNull(value)) args.push(value);</td></tr><tr class="hit"><td class="line">420</td><td class="hits">8</td><td class="source">			r = this._modelInvoke(method, args); // just call the filter method</td></tr><tr class="hit"><td class="line">421</td><td class="hits">8</td><td class="source">			if (Utils.checkModelFilterError(r)) {</td></tr><tr class="hit"><td class="line">422</td><td class="hits">2</td><td class="source">				return r;</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">427</td><td class="hits">9</td><td class="source">	return;</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source"> * ModelProxy reset result.</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">433</td><td class="hits"></td><td class="source"> * @param  {Object}  result</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source"> * @return {Object}  result</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">437</td><td class="hits">1</td><td class="source">ModelProxy.prototype._result = function(r) {</td></tr><tr class="hit"><td class="line">438</td><td class="hits">15</td><td class="source">	this._reset(Constant.MODEL_FILTER_BEFORE);</td></tr><tr class="hit"><td class="line">439</td><td class="hits">15</td><td class="source">	this._reset(Constant.MODEL_FILTER_AFTER);</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">441</td><td class="hits">15</td><td class="source">	return r;</td></tr><tr><td class="line">442</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">443</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source"> * ModelProxy reset filter.</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source"> * @param  {String}  filter type</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">450</td><td class="hits">1</td><td class="source">ModelProxy.prototype._reset = function(type) {</td></tr><tr class="hit"><td class="line">451</td><td class="hits">31</td><td class="source">	if (type !== Constant.MODEL_FILTER_BEFORE &amp;&amp; type !== Constant.MODEL_FILTER_AFTER) {</td></tr><tr class="hit"><td class="line">452</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">455</td><td class="hits">30</td><td class="source">	this[type + 'Flag'] = false;</td></tr><tr class="hit"><td class="line">456</td><td class="hits">30</td><td class="source">	this[type + 'Name'] = null;</td></tr><tr class="hit"><td class="line">457</td><td class="hits">30</td><td class="source">	this[type + 'Names'] = [];</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source"> * ModelProxy toJSON.</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">465</td><td class="hits">1</td><td class="source">ModelProxy.prototype.toJSON = function() {</td></tr><tr class="hit"><td class="line">466</td><td class="hits">1</td><td class="source">	return this.model;</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">468</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">469</td><td class="hits">1</td><td class="source">var names = [&quot;_modelInit&quot;, &quot;_modelInvoke&quot;, &quot;$set&quot;, &quot;$pack&quot;, &quot;$packResultSet&quot;,</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source">	&quot;_doPackResultSet&quot;, &quot;$get&quot;, &quot;$before&quot;, &quot;$after&quot;, &quot;_filter&quot;, &quot;$clone&quot;,</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source">	&quot;_getFilters&quot;, &quot;_doFilters&quot;, &quot;_result&quot;, &quot;_reset&quot;, &quot;toJSON&quot;</td></tr><tr><td class="line">472</td><td class="hits"></td><td class="source">];</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">474</td><td class="hits">1</td><td class="source">var checkFuncName = function(name) {</td></tr><tr class="hit"><td class="line">475</td><td class="hits">11</td><td class="source">	for (var i = 0; i &lt; names.length; i++) {</td></tr><tr class="hit"><td class="line">476</td><td class="hits">161</td><td class="source">		if (name === names[i]) {</td></tr><tr class="hit"><td class="line">477</td><td class="hits">1</td><td class="source">			return true;</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">481</td><td class="hits">10</td><td class="source">	return false;</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">483</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">484</td><td class="hits">1</td><td class="source">module.exports = ModelProxy;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/asyncScriptLoader.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/asyncScriptLoader.js</h2><div id="stats" class="low"><div class="percentage">29%</div><div class="sloc">67</div><div class="hits">20</div><div class="misses">47</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat AsyncScriptLoader</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'AsyncScriptLoader');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var BeanModule = require('../beans/support/beanModule');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Path = require('../util/requireUtil').requirePath();</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var ScriptUtil = require('../util/scriptUtil');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var cid = 1;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var Root;</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">(function() {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">	Root = this;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">}());</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * AsyncScriptLoader constructor function.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">var AsyncScriptLoader = function() {</td></tr><tr class="miss"><td class="line">32</td><td class="hits">0</td><td class="source">	this.cacheModules = {};</td></tr><tr class="miss"><td class="line">33</td><td class="hits">0</td><td class="source">	this.loaderDir = null;</td></tr><tr class="miss"><td class="line">34</td><td class="hits">0</td><td class="source">	this.applicationContext = null;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> * AsyncScriptLoader get loaded beans list.</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @return  {Array}  loaded beans</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">AsyncScriptLoader.prototype.getLoadBeans = function() {</td></tr><tr class="miss"><td class="line">44</td><td class="hits">0</td><td class="source">	return this.loadBeans;</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * AsyncScriptLoader load beans asynchronously.</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @param  {Array}     loaded beans ids</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @param  {Function}  callback function</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">AsyncScriptLoader.prototype.load = function(ids, cb) {</td></tr><tr class="miss"><td class="line">55</td><td class="hits">0</td><td class="source">	this.loaderDir = ScriptUtil.getLoaderDir();</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">57</td><td class="hits">0</td><td class="source">	var uri = this.loaderDir + '_load_' + cid++;</td></tr><tr class="miss"><td class="line">58</td><td class="hits">0</td><td class="source">	var mod = this.get(uri, ids);</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">60</td><td class="hits">0</td><td class="source">	mod.addEntry(mod);</td></tr><tr class="miss"><td class="line">61</td><td class="hits">0</td><td class="source">	mod.setRemain(1);</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">63</td><td class="hits">0</td><td class="source">	mod.callback = function() {</td></tr><tr class="miss"><td class="line">64</td><td class="hits">0</td><td class="source">		if (Utils.checkFunction(cb)) {</td></tr><tr class="miss"><td class="line">65</td><td class="hits">0</td><td class="source">			cb();</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">68</td><td class="hits">0</td><td class="source">		delete mod.callback</td></tr><tr class="miss"><td class="line">69</td><td class="hits">0</td><td class="source">		delete mod.history</td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">		delete mod.remain</td></tr><tr class="miss"><td class="line">71</td><td class="hits">0</td><td class="source">		delete mod.entries;</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">74</td><td class="hits">0</td><td class="source">	mod.load();</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> * AsyncScriptLoader save load script with uri meta.</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @param  {String}  uri</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @param  {Object}  bean meta</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">84</td><td class="hits">1</td><td class="source">AsyncScriptLoader.prototype.save = function(uri, meta) {</td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">	var mod = this.get(uri)</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">	// Do NOT override already saved modules</td></tr><tr class="miss"><td class="line">88</td><td class="hits">0</td><td class="source">	if (mod.status &lt; BeanModule.STATUS.SAVED) {</td></tr><tr class="miss"><td class="line">89</td><td class="hits">0</td><td class="source">		mod.id = meta.id || uri</td></tr><tr class="miss"><td class="line">90</td><td class="hits">0</td><td class="source">		mod.dependencies = meta.deps || []</td></tr><tr class="miss"><td class="line">91</td><td class="hits">0</td><td class="source">		mod.factory = meta.factory</td></tr><tr class="miss"><td class="line">92</td><td class="hits">0</td><td class="source">		mod.status = BeanModule.STATUS.SAVED</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> * AsyncScriptLoader register script with id, meta.</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> * @param  {String}  id</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> * @param  {Object}  bean meta</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">AsyncScriptLoader.prototype.module = function(id, beanMeta) {</td></tr><tr class="miss"><td class="line">104</td><td class="hits">0</td><td class="source">	var deps = this.resolveDeps(beanMeta);</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">106</td><td class="hits">0</td><td class="source">	var meta = {</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">		id: id,</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">		uri: this.resolve(id),</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">		deps: deps</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">	};</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">112</td><td class="hits">0</td><td class="source">	meta.uri ? this.save(meta.uri, meta) :</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">		// Save information for &quot;saving&quot; work in the script onload event</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">		BeanModule.anonymousMeta = meta;</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> * AsyncScriptLoader resolve uri path with refUri.</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source"> * @param  {String}  id</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> * @param  {String}  refUri</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> * @return {String}  resolved path</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">125</td><td class="hits">1</td><td class="source">AsyncScriptLoader.prototype.resolve = function(id, refUri) {</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">	// id path map</td></tr><tr class="miss"><td class="line">127</td><td class="hits">0</td><td class="source">	var path = this.getPathById(id);</td></tr><tr class="miss"><td class="line">128</td><td class="hits">0</td><td class="source">	if (!path) {</td></tr><tr class="miss"><td class="line">129</td><td class="hits">0</td><td class="source">		path = id;</td></tr><tr class="miss"><td class="line">130</td><td class="hits">0</td><td class="source">		logger.warn('id: ' + id + ' can not be resolved, try run bearcat generate or use bearcat.module to register it');</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">133</td><td class="hits">0</td><td class="source">	return path;</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> * AsyncScriptLoader resolve deps through bean meta.</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> * @param  {Object}  bean meta</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source"> * @param  {Array}   resolved deps</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">143</td><td class="hits">1</td><td class="source">AsyncScriptLoader.prototype.resolveDeps = function(beanMeta) {</td></tr><tr class="miss"><td class="line">144</td><td class="hits">0</td><td class="source">	var propsOn = beanMeta.props;</td></tr><tr class="miss"><td class="line">145</td><td class="hits">0</td><td class="source">	if (!Utils.isNotNull(propsOn) || !propsOn) {</td></tr><tr class="miss"><td class="line">146</td><td class="hits">0</td><td class="source">		return;</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">149</td><td class="hits">0</td><td class="source">	var deps = [];</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">151</td><td class="hits">0</td><td class="source">	for (var i = 0; i &lt; propsOn.length; i++) {</td></tr><tr class="miss"><td class="line">152</td><td class="hits">0</td><td class="source">		var prop = propsOn[i];</td></tr><tr class="miss"><td class="line">153</td><td class="hits">0</td><td class="source">		var ref = prop['ref'];</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">155</td><td class="hits">0</td><td class="source">		if (ref) {</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">			// do not load already registered beans</td></tr><tr class="miss"><td class="line">157</td><td class="hits">0</td><td class="source">			if (this.applicationContext.getBeanDefinition(ref)) {</td></tr><tr class="miss"><td class="line">158</td><td class="hits">0</td><td class="source">				continue;</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">			}</td></tr><tr class="miss"><td class="line">160</td><td class="hits">0</td><td class="source">			deps.push(ref);</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">164</td><td class="hits">0</td><td class="source">	return deps;</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> * AsyncScriptLoader get bean path through bean id.</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> * @param  {String}  id</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> * @return {String}  bean path</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">174</td><td class="hits">1</td><td class="source">AsyncScriptLoader.prototype.getPathById = function(id) {</td></tr><tr class="miss"><td class="line">175</td><td class="hits">0</td><td class="source">	if (Root.__bearcatData__ &amp;&amp; Root.__bearcatData__.idPaths) {</td></tr><tr class="miss"><td class="line">176</td><td class="hits">0</td><td class="source">		return Root.__bearcatData__.idPaths[id];</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> * AsyncScriptLoader get script from cache or new.</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> * @param  {String}  uri</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> * @param  {Array}   deps id</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> * @return {Object}  module</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">188</td><td class="hits">1</td><td class="source">AsyncScriptLoader.prototype.get = function(uri, deps) {</td></tr><tr class="miss"><td class="line">189</td><td class="hits">0</td><td class="source">	return this.cacheModules[uri] || (this.cacheModules[uri] = new BeanModule(uri, deps, this));</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> * AsyncScriptLoader set applicationContext reference.</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> * @param  {Object}  applicationContext</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">198</td><td class="hits">1</td><td class="source">AsyncScriptLoader.prototype.setApplicationContext = function(applicationContext) {</td></tr><tr class="miss"><td class="line">199</td><td class="hits">0</td><td class="source">	this.applicationContext = applicationContext;</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">202</td><td class="hits">1</td><td class="source">module.exports = AsyncScriptLoader;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/bootStrapLoader.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/bootStrapLoader.js</h2><div id="stats" class="medium"><div class="percentage">50%</div><div class="sloc">6</div><div class="hits">3</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat BootStrapLoader</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> * BootStrapLoader constructor function.</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var BootStrapLoader = function() {</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * BootStrapLoader load script files.</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * @param  {Array}     bootstrap idPaths</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">BootStrapLoader.prototype.load = function(idPaths) {</td></tr><tr class="miss"><td class="line">30</td><td class="hits">0</td><td class="source">	for (var id in idPaths) {</td></tr><tr class="miss"><td class="line">31</td><td class="hits">0</td><td class="source">		var idPath = idPaths[id];</td></tr><tr class="miss"><td class="line">32</td><td class="hits">0</td><td class="source">		require(idPath);</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">module.exports = BootStrapLoader;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/configLoader.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/configLoader.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">68</div><div class="hits">68</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ConfigLoader</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'ConfigLoader');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var RequireUtil = require('../util/requireUtil');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var MetaUtil = require('../util/metaUtil');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var Constant = require('../util/constant');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var MetaLoader = require('./metaLoader');</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var Path = RequireUtil.requirePath();</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * ConfigLoader constructor function.</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">var ConfigLoader = function() {}</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">module.exports = ConfigLoader;</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * ConfigLoader get meta loader.</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @return  {Object} meta loader</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">ConfigLoader.prototype.getMetaLoader = function() {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">63</td><td class="source">	return new MetaLoader();</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * ConfigLoader get meta objects from context path.</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @param   {String} cpath context path</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> * @return  {Object} meta objects</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">ConfigLoader.prototype.getResources = function(cpath) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">63</td><td class="source">	var scanPaths = [];</td></tr><tr class="hit"><td class="line">50</td><td class="hits">63</td><td class="source">	var metaObjects = {};</td></tr><tr class="hit"><td class="line">51</td><td class="hits">63</td><td class="source">	var metaLoader = this.getMetaLoader();</td></tr><tr class="hit"><td class="line">52</td><td class="hits">63</td><td class="source">	this.getRecursiveScanPath(cpath, scanPaths, metaObjects);</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">63</td><td class="source">	for (var beanName in metaObjects) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">48</td><td class="source">		metaLoader.setMetaObject(beanName, metaObjects[beanName]);</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">63</td><td class="source">	for (var i = 0; i &lt; scanPaths.length; i++) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">52</td><td class="source">		metaLoader.load(scanPaths[i]);</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">62</td><td class="hits">63</td><td class="source">	return metaLoader.getMetaObjects();</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * ConfigLoader get recursive scan paths and metaObjects in context.json.</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * @param   {String} cpath context path</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> * @param   {Array}  scanPaths scan paths</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> * @param   {Object} metaObjects</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">ConfigLoader.prototype.getRecursiveScanPath = function(cpath, scanPaths, metaObjects) {</td></tr><tr class="hit"><td class="line">74</td><td class="hits">69</td><td class="source">	var context = Utils.myRequire(cpath);</td></tr><tr class="hit"><td class="line">75</td><td class="hits">69</td><td class="source">	if (!context) {</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">79</td><td class="hits">68</td><td class="source">	var scan = context.scan;</td></tr><tr class="hit"><td class="line">80</td><td class="hits">68</td><td class="source">	var beans = context.beans;</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">	// var browser = context.browser;</td></tr><tr class="hit"><td class="line">82</td><td class="hits">68</td><td class="source">	var imports = context.imports;</td></tr><tr class="hit"><td class="line">83</td><td class="hits">68</td><td class="source">	var namespace = context.namespace;</td></tr><tr class="hit"><td class="line">84</td><td class="hits">68</td><td class="source">	var dependencies = context.dependencies;</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">86</td><td class="hits">68</td><td class="source">	var dpath = Path.dirname(cpath);</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">	// if (Utils.checkString(browser)) {</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">	// 	return this.getRecursiveScanPath(dpath + '/' + browser, scanPaths, metaObjects);</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">	// } else if (Utils.checkArray(browser)) {</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">	// 	for (var i = 0; i &lt; browser.length; i++) {</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">	// 		this.getRecursiveScanPath(dpath + '/' + browser[i], scanPaths, metaObjects);</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">	// 	}</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">	// 	return;</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">	// }</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">68</td><td class="source">	for (var dependency in dependencies) {</td></tr><tr class="hit"><td class="line">98</td><td class="hits">2</td><td class="source">		this.getRecursiveScanPath(dpath + '/node_modules/' + dependency + '/context.json', scanPaths, metaObjects);</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">101</td><td class="hits">68</td><td class="source">	if (Utils.checkArray(imports)) {</td></tr><tr class="hit"><td class="line">102</td><td class="hits">2</td><td class="source">		for (var j = 0; j &lt; imports.length; j++) {</td></tr><tr class="hit"><td class="line">103</td><td class="hits">4</td><td class="source">			this.getRecursiveScanPath(dpath + '/' + imports[j], scanPaths, metaObjects);</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">	// context.json defined bean metadatas</td></tr><tr class="hit"><td class="line">108</td><td class="hits">68</td><td class="source">	if (beans) {</td></tr><tr class="hit"><td class="line">109</td><td class="hits">17</td><td class="source">		for (var i = 0; i &lt; beans.length; i++) {</td></tr><tr class="hit"><td class="line">110</td><td class="hits">49</td><td class="source">			var bean = beans[i];</td></tr><tr class="hit"><td class="line">111</td><td class="hits">49</td><td class="source">			var beanName = bean['id'];</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">113</td><td class="hits">49</td><td class="source">			if (namespace) {</td></tr><tr class="hit"><td class="line">114</td><td class="hits">2</td><td class="source">				beanName = namespace + Constant.NAMESPACE_SEPERATOR + beanName;</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">			// var loadpath = this.loadedContextBeans[beanName];</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">			// if (beanName &amp;&amp; loadpath) {</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">			// 	logger.warn(&quot;bean %j defined in %j has already defined in %j, please check your configuration metadata files&quot;, beanName, cpath, loadpath);</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">			// 	continue;</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">			// }</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">123</td><td class="hits">49</td><td class="source">			var beanObject = null;</td></tr><tr class="hit"><td class="line">124</td><td class="hits">49</td><td class="source">			var funcPath = &quot;&quot;;</td></tr><tr class="hit"><td class="line">125</td><td class="hits">49</td><td class="source">			if (Utils.checkString(bean['func'])) {</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">				// beans from require, may be cached by require when you do with the same context.json</td></tr><tr class="hit"><td class="line">127</td><td class="hits">13</td><td class="source">				funcPath = Utils.getLoadPath(bean['func'], cpath);</td></tr><tr class="hit"><td class="line">128</td><td class="hits">13</td><td class="source">				beanObject = Utils.myRequire(funcPath);</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">131</td><td class="hits">49</td><td class="source">			if (beanObject) {</td></tr><tr class="hit"><td class="line">132</td><td class="hits">13</td><td class="source">				if (Utils.checkFunction(beanObject)) {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">11</td><td class="source">					bean['func'] = beanObject;</td></tr><tr class="hit"><td class="line">134</td><td class="hits">2</td><td class="source">				} else if (Utils.checkObject(beanObject)) {</td></tr><tr class="hit"><td class="line">135</td><td class="hits">2</td><td class="source">					if (beanObject['id'] &amp;&amp; beanObject['id'] === beanName) {</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">						// meta defined in js file override context.json</td></tr><tr class="hit"><td class="line">137</td><td class="hits">1</td><td class="source">						bean = MetaUtil.mergeMeta(beanObject, bean);</td></tr><tr class="hit"><td class="line">138</td><td class="hits">1</td><td class="source">						bean['ftype'] = 'object';</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">					} else {</td></tr><tr class="hit"><td class="line">140</td><td class="hits">1</td><td class="source">						logger.error('meta defined in file %j %j mismatch with that defined in context %j', funcPath, beanObject, bean);</td></tr><tr class="hit"><td class="line">141</td><td class="hits">1</td><td class="source">						continue;</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">					}</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">146</td><td class="hits">48</td><td class="source">			if (beanName) {</td></tr><tr class="hit"><td class="line">147</td><td class="hits">48</td><td class="source">				var originMeta = metaObjects[beanName];</td></tr><tr class="hit"><td class="line">148</td><td class="hits">48</td><td class="source">				metaObjects[beanName] = MetaUtil.mergeMeta(bean, originMeta);</td></tr><tr class="hit"><td class="line">149</td><td class="hits">48</td><td class="source">				if (funcPath) {</td></tr><tr class="hit"><td class="line">150</td><td class="hits">12</td><td class="source">					bean['fpath'] = Path.resolve(process.cwd(), funcPath);</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">156</td><td class="hits">68</td><td class="source">	if (Utils.checkString(scan)) {</td></tr><tr class="hit"><td class="line">157</td><td class="hits">50</td><td class="source">		var scanPath = Utils.getLoadPath2(scan, cpath);</td></tr><tr class="hit"><td class="line">158</td><td class="hits">50</td><td class="source">		scanPaths.push(scanPath);</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">161</td><td class="hits">68</td><td class="source">	if (Utils.checkArray(scan)) {</td></tr><tr class="hit"><td class="line">162</td><td class="hits">1</td><td class="source">		for (var i = 0; i &lt; scan.length; i++) {</td></tr><tr class="hit"><td class="line">163</td><td class="hits">2</td><td class="source">			var scanPath = Utils.getLoadPath2(scan[i], cpath);</td></tr><tr class="hit"><td class="line">164</td><td class="hits">2</td><td class="source">			scanPaths.push(scanPath);</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/metaLoader.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/metaLoader.js</h2><div id="stats" class="high"><div class="percentage">96%</div><div class="sloc">62</div><div class="hits">60</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat MetaLoader</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'MetaLoader');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var FileUtil = require('../util/fileUtil');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var MetaUtil = require('../util/metaUtil');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var Constant = require('../util/constant');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var path = require('path');</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * MetaLoader constructor function.</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">var MetaLoader = function() {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">64</td><td class="source">	this.metaObjects = {};</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">module.exports = MetaLoader;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * MetaLoader load metaObjects from meta path.</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @param   {String} mpath</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> * @return  {Object} meta objects</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">MetaLoader.prototype.load = function(mpath) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">54</td><td class="source">	if (!mpath) {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">		logger.error('load path should not be empty.');</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">53</td><td class="source">	mpath = FileUtil.realpathSync(mpath);</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">53</td><td class="source">	if (!Utils.isDir(mpath)) {</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">		logger.error('path should be directory.');</td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">52</td><td class="source">	this.loadPath(this.metaObjects, mpath);</td></tr><tr class="hit"><td class="line">53</td><td class="hits">52</td><td class="source">	return this.metaObjects;</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * MetaLoader set metaObject to beanName.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @param   {String} beanName</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @param   {Object} metaObject</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">MetaLoader.prototype.setMetaObject = function(beanName, metaObject) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">48</td><td class="source">	var originMeta = this.metaObjects[beanName];</td></tr><tr class="hit"><td class="line">65</td><td class="hits">48</td><td class="source">	this.metaObjects[beanName] = MetaUtil.mergeMeta(metaObject, originMeta);</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> * MetaLoader get metaObjects.</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> * @return   {Object} metaObjects</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">MetaLoader.prototype.getMetaObjects = function() {</td></tr><tr class="hit"><td class="line">75</td><td class="hits">63</td><td class="source">	return this.metaObjects;</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * MetaLoader load file, require file.</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @return   {Object} fp file meta</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">84</td><td class="hits">1</td><td class="source">MetaLoader.prototype.loadFile = function(fp) {</td></tr><tr class="hit"><td class="line">85</td><td class="hits">144</td><td class="source">	var m = Utils.myRequire(fp);</td></tr><tr class="hit"><td class="line">86</td><td class="hits">144</td><td class="source">	if (process.env.BEARCAT_ANNOTATION !== 'off' &amp;&amp; Utils.checkFunction(m)) {</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">		// meta may be $ annotations in function</td></tr><tr class="hit"><td class="line">88</td><td class="hits">129</td><td class="source">		return MetaUtil.resolveFuncAnnotation(m, fp);</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">91</td><td class="hits">15</td><td class="source">	if (!Utils.checkObject(m)) {</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">		// meta must be object	</td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">96</td><td class="hits">14</td><td class="source">	if (!m || !m.id || !m.func) {</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">		// id, func must have</td></tr><tr class="hit"><td class="line">98</td><td class="hits">3</td><td class="source">		return;</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">101</td><td class="hits">11</td><td class="source">	if (fp) {</td></tr><tr class="hit"><td class="line">102</td><td class="hits">11</td><td class="source">		m['ftype'] = 'object';</td></tr><tr class="hit"><td class="line">103</td><td class="hits">11</td><td class="source">		m['fpath'] = fp;</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">106</td><td class="hits">11</td><td class="source">	return m;</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> * MetaLoader load meta from path recursively.</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> * @param    {Object} meta metaObjects</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> * @param    {String} path</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * @return   {Object} metaObjects</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">117</td><td class="hits">1</td><td class="source">MetaLoader.prototype.loadPath = function(meta, path) {</td></tr><tr class="hit"><td class="line">118</td><td class="hits">60</td><td class="source">	var files = FileUtil.readdirSync(path);</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">120</td><td class="hits">60</td><td class="source">	if (path.charAt(path.length - 1) !== '/') {</td></tr><tr class="hit"><td class="line">121</td><td class="hits">60</td><td class="source">		path += '/';</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">124</td><td class="hits">60</td><td class="source">	var fp, fn, m;</td></tr><tr class="hit"><td class="line">125</td><td class="hits">60</td><td class="source">	for (var i = 0, l = files.length; i &lt; l; i++) {</td></tr><tr class="hit"><td class="line">126</td><td class="hits">156</td><td class="source">		fn = files[i];</td></tr><tr class="hit"><td class="line">127</td><td class="hits">156</td><td class="source">		fp = path + fn;</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">129</td><td class="hits">156</td><td class="source">		if (Utils.isDir(fp)) {</td></tr><tr class="hit"><td class="line">130</td><td class="hits">8</td><td class="source">			this.loadPath(meta, fp);</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">133</td><td class="hits">156</td><td class="source">		if (!Utils.isFile(fp) || !Utils.checkFileType(fn, '.js')) {</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">			// only load js file type</td></tr><tr class="hit"><td class="line">135</td><td class="hits">12</td><td class="source">			continue;</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">138</td><td class="hits">144</td><td class="source">		m = this.loadFile(fp);</td></tr><tr class="hit"><td class="line">139</td><td class="hits">144</td><td class="source">		if (!m) {</td></tr><tr class="hit"><td class="line">140</td><td class="hits">6</td><td class="source">			continue;</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">		// id by default is the file name</td></tr><tr class="hit"><td class="line">144</td><td class="hits">138</td><td class="source">		var id = Utils.getFileName(fn, '.js'.length);</td></tr><tr class="hit"><td class="line">145</td><td class="hits">138</td><td class="source">		if (m.id) {</td></tr><tr class="hit"><td class="line">146</td><td class="hits">133</td><td class="source">			id = m.id;</td></tr><tr class="hit"><td class="line">147</td><td class="hits">5</td><td class="source">		} else if (m.mid) {</td></tr><tr class="miss"><td class="line">148</td><td class="hits">0</td><td class="source">			id = m.mid + Constant.BEAN_SPECIAL_MODEL;</td></tr><tr class="hit"><td class="line">149</td><td class="hits">5</td><td class="source">		} else if (m.cid) {</td></tr><tr class="miss"><td class="line">150</td><td class="hits">0</td><td class="source">			id = m.cid + Constant.BEAN_SPECIAL_CONSTRAINT;</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">		} else {</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">			// ignore</td></tr><tr class="hit"><td class="line">153</td><td class="hits">5</td><td class="source">			continue;</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">156</td><td class="hits">133</td><td class="source">		var originMeta = meta[id];</td></tr><tr class="hit"><td class="line">157</td><td class="hits">133</td><td class="source">		meta[id] = MetaUtil.mergeMeta(m, originMeta);</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">160</td><td class="hits">60</td><td class="source">	return meta;</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/propertiesLoader.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/propertiesLoader.js</h2><div id="stats" class="high"><div class="percentage">96%</div><div class="sloc">32</div><div class="hits">31</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat PropertiesLoader</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'PropertiesLoader');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var FileUtil = require('../util/fileUtil');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Utils = require('../util/utils');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * PropertiesLoader constructor function.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var PropertiesLoader = function() {</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">module.exports = PropertiesLoader;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * PropertiesLoader load properties from load path with env.</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @param    {String} lpath load path</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> * @param    {String} env environment</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> * @return   {Object} properties</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">PropertiesLoader.prototype.loadProperties = function(lpath, env) {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">66</td><td class="source">	var meta = {};</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">40</td><td class="hits">66</td><td class="source">	this.loadDir(meta, lpath, true);</td></tr><tr class="hit"><td class="line">41</td><td class="hits">66</td><td class="source">	this.loadDir(meta, lpath + '/' + env);</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">66</td><td class="source">	return meta;</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> * PropertiesLoader load properties from directory.</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @param    {Object}  meta properties</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @param    {String}  lpath load path</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @param    {Boolean} lflag if not load subdirectory or not, true not</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">PropertiesLoader.prototype.loadDir = function(meta, lpath, lflag) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">134</td><td class="source">	if (!FileUtil.existsSync(lpath)) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">129</td><td class="source">		return;</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">59</td><td class="hits">5</td><td class="source">	if (!Utils.isDir(lpath)) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">4</td><td class="source">	var files = FileUtil.readdirSync(lpath);</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">4</td><td class="source">	if (lpath.charAt(lpath.length - 1) !== '/') {</td></tr><tr class="hit"><td class="line">66</td><td class="hits">4</td><td class="source">		lpath += '/';</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">69</td><td class="hits">4</td><td class="source">	var fp, fn, m;</td></tr><tr class="hit"><td class="line">70</td><td class="hits">4</td><td class="source">	for (var i = 0, l = files.length; i &lt; l; i++) {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">12</td><td class="source">		fn = files[i];</td></tr><tr class="hit"><td class="line">72</td><td class="hits">12</td><td class="source">		fp = lpath + fn;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">74</td><td class="hits">12</td><td class="source">		if (!lflag &amp;&amp; Utils.isDir(fp)) {</td></tr><tr class="miss"><td class="line">75</td><td class="hits">0</td><td class="source">			this.loadDir(meta, fp);</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">78</td><td class="hits">12</td><td class="source">		if (!Utils.isFile(fp) || !Utils.checkFileType(fp, 'json')) {</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">			// only load json properties files</td></tr><tr class="hit"><td class="line">80</td><td class="hits">7</td><td class="source">			continue;</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">83</td><td class="hits">5</td><td class="source">		m = Utils.myRequire(fp);</td></tr><tr class="hit"><td class="line">84</td><td class="hits">5</td><td class="source">		if (!Utils.isNotNull(m) || !Utils.checkObject(m)) {</td></tr><tr class="hit"><td class="line">85</td><td class="hits">1</td><td class="source">			continue;</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">4</td><td class="source">		for (var key in m) {</td></tr><tr class="hit"><td class="line">89</td><td class="hits">18</td><td class="source">			if (Utils.isNotNull(m[key])) {</td></tr><tr class="hit"><td class="line">90</td><td class="hits">18</td><td class="source">				meta[key] = m[key];</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/resourceLoader.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/resource/resourceLoader.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">17</div><div class="hits">17</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ResourceLoader</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var ConfigLoader = require('./configLoader');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> * ResourceLoader constructor function.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var ResourceLoader = function() {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">62</td><td class="source">	this.loadPathMap = {};</td></tr><tr class="hit"><td class="line">23</td><td class="hits">62</td><td class="source">	this.loadPaths = [];</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">module.exports = ResourceLoader;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * ResourceLoader get config loader.</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @return  {Object} config loader</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">ResourceLoader.prototype.getConfigLoader = function() {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">62</td><td class="source">	var configLoader = new ConfigLoader();</td></tr><tr class="hit"><td class="line">36</td><td class="hits">62</td><td class="source">	return configLoader;</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * ResourceLoader add context load path.</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @param  {String} cpath context load path</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">ResourceLoader.prototype.addLoadPath = function(cpath) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">62</td><td class="source">	this.loadPaths.push(cpath);</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * ResourceLoader load metaObjects from context path.</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @param   {String} cpath context load path</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> * @return  {Object} metaObjects</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source">ResourceLoader.prototype.load = function(cpath) {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">63</td><td class="source">	if (this.loadPathMap[cpath]) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">		return this.loadPathMap[cpath];</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">61</td><td class="hits">62</td><td class="source">	var metaObjects = this.getConfigLoader().getResources(cpath);</td></tr><tr class="hit"><td class="line">62</td><td class="hits">62</td><td class="source">	this.loadPathMap[cpath] = metaObjects;</td></tr><tr class="hit"><td class="line">63</td><td class="hits">62</td><td class="source">	this.addLoadPath(cpath);</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">62</td><td class="source">	return metaObjects;</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/aopUtil.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/aopUtil.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">38</div><div class="hits">38</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat AopUtil</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Advisor = require('../aop/advisor');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Aspect = require('../aop/aspect');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Utils = require('./utils');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var AopUtil = {};</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * AopUtil build aspects from metaList and beanDefinition.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @param   {Array}  metaList</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @param   {Object} beanDefinition</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @param   {Array}  aspects</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">AopUtil.buildAspect = function(metaList, beanDefinition) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">21</td><td class="source">	var aspect = new Aspect();</td></tr><tr class="hit"><td class="line">29</td><td class="hits">21</td><td class="source">	var beanName = beanDefinition.getBeanName();</td></tr><tr class="hit"><td class="line">30</td><td class="hits">21</td><td class="source">	aspect.setBeanDefinition(beanDefinition);</td></tr><tr class="hit"><td class="line">31</td><td class="hits">21</td><td class="source">	aspect.setBeanName(beanName);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">21</td><td class="source">	for (var i = 0; i &lt; metaList.length; i++) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">181</td><td class="source">		var meta = metaList[i];</td></tr><tr class="hit"><td class="line">35</td><td class="hits">181</td><td class="source">		var pointcut = meta['pointcut'];</td></tr><tr class="hit"><td class="line">36</td><td class="hits">181</td><td class="source">		var advice = meta['advice'];</td></tr><tr class="hit"><td class="line">37</td><td class="hits">181</td><td class="source">		var order = meta['order'];</td></tr><tr class="hit"><td class="line">38</td><td class="hits">181</td><td class="source">		var runtime = meta['runtime'] || false;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">40</td><td class="hits">181</td><td class="source">		if (!pointcut || !advice) {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">			continue;</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">180</td><td class="source">		var advisor = new Advisor();</td></tr><tr class="hit"><td class="line">45</td><td class="hits">180</td><td class="source">		advisor.setPointcut(pointcut);</td></tr><tr class="hit"><td class="line">46</td><td class="hits">180</td><td class="source">		advisor.setAdvice(advice);</td></tr><tr class="hit"><td class="line">47</td><td class="hits">180</td><td class="source">		advisor.setBeanName(beanName);</td></tr><tr class="hit"><td class="line">48</td><td class="hits">180</td><td class="source">		advisor.setOrder(order);</td></tr><tr class="hit"><td class="line">49</td><td class="hits">180</td><td class="source">		advisor.setRuntime(runtime);</td></tr><tr class="hit"><td class="line">50</td><td class="hits">180</td><td class="source">		advisor.parse();</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">180</td><td class="source">		aspect.addAdvisor(advisor);</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">55</td><td class="hits">21</td><td class="source">	return aspect;</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * AopUtil reflect methods from object.</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @param    {Object} object</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @return   {Array}  method names</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">65</td><td class="hits">1</td><td class="source">AopUtil.getMethodsFromObject = function(object) {</td></tr><tr class="hit"><td class="line">66</td><td class="hits">380</td><td class="source">	var proto = object;</td></tr><tr class="hit"><td class="line">67</td><td class="hits">380</td><td class="source">	var methods = [];</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">69</td><td class="hits">380</td><td class="source">	for (var key in proto) {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">2470</td><td class="source">		var method = proto[key];</td></tr><tr class="hit"><td class="line">71</td><td class="hits">2470</td><td class="source">		if (Utils.checkFunction(method)) {</td></tr><tr class="hit"><td class="line">72</td><td class="hits">2280</td><td class="source">			methods.push(key);</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">76</td><td class="hits">380</td><td class="source">	return methods;</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * AopUtil sort advisors by order.</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> * @param    {Array} advisors</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> * @return   {Array} sorted advisors</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">AopUtil.sortAdvisorsByOrder = function(advisors) {</td></tr><tr class="hit"><td class="line">87</td><td class="hits">119</td><td class="source">	advisors.sort(Utils.compareByOrder);</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">89</td><td class="hits">119</td><td class="source">	return advisors;</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">module.exports = AopUtil;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/beanUtil.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/beanUtil.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">50</div><div class="hits">50</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat BeanUtils</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var BeanWrapper = require('../beans/support/beanWrapper');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Utils = require('./utils');</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var BeanUtils = {};</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * BeanUtil build beanWrapper from meta settings.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @param    {Array}  list meta settings</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @return   {Array}  beanWrappers</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">BeanUtils.buildBeanWrapper = function(list) {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1617</td><td class="source">	var r = [];</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">29</td><td class="hits">1617</td><td class="source">	if (!Utils.checkArray(list)) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">2</td><td class="source">		return r;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">1615</td><td class="source">	for (var i = 0; i &lt; list.length; i++) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">74</td><td class="source">		var w = list[i];</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">74</td><td class="source">		var bWrapper = new BeanWrapper();</td></tr><tr class="hit"><td class="line">37</td><td class="hits">74</td><td class="source">		if (w.name) {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">72</td><td class="source">			bWrapper.setName(w.name);</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">74</td><td class="source">		if (w.type) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">8</td><td class="source">			bWrapper.setType(w.type);</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">74</td><td class="source">		if (w.value) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">22</td><td class="source">			bWrapper.setValue(w.value);</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">74</td><td class="source">		if (w.ref) {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">41</td><td class="source">			bWrapper.setRef(w.ref);</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">74</td><td class="source">		bWrapper.setRole();</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">55</td><td class="hits">74</td><td class="source">		r.push(bWrapper);</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">1615</td><td class="source">	return r;</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * BeanUtils getBeanSettingsMap.</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * @param    {Array}   list beanWrappers</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> * @return   {Object}  beanWrapper map</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">BeanUtils.getBeanSettingsMap = function(list) {</td></tr><tr class="hit"><td class="line">69</td><td class="hits">88</td><td class="source">	var r = {};</td></tr><tr class="hit"><td class="line">70</td><td class="hits">88</td><td class="source">	if (!Utils.checkArray(list)) {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">2</td><td class="source">		return r;</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">74</td><td class="hits">86</td><td class="source">	for (var i = 0; i &lt; list.length; i++) {</td></tr><tr class="hit"><td class="line">75</td><td class="hits">83</td><td class="source">		var w = list[i];</td></tr><tr class="hit"><td class="line">76</td><td class="hits">83</td><td class="source">		var name = w.getName();</td></tr><tr class="hit"><td class="line">77</td><td class="hits">83</td><td class="source">		if (!name) {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">1</td><td class="source">			continue;</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">		}</td></tr><tr class="hit"><td class="line">80</td><td class="hits">82</td><td class="source">		r[name] = w;</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">83</td><td class="hits">86</td><td class="source">	return r;</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> * BeanUtils getBeanSettingsArray.</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> * @param   {Object}  map beanWrapper map</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> * @return  {Array}   beanWrappers</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">BeanUtils.getBeanSettingsArray = function(map) {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">44</td><td class="source">	var r = [];</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">96</td><td class="hits">44</td><td class="source">	if (!Utils.isNotNull(map)) {</td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">		return r;</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">100</td><td class="hits">43</td><td class="source">	for (var name in map) {</td></tr><tr class="hit"><td class="line">101</td><td class="hits">71</td><td class="source">		r.push(map[name]);</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">104</td><td class="hits">43</td><td class="source">	return r;</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * BeanUtils sortBeanDefinitions.</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> * @param    {Array}  beanDefinitions</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> * @return   {Array}  beanFactory sorted beanDefinitions</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">114</td><td class="hits">1</td><td class="source">BeanUtils.sortBeanDefinitions = function(beanDefinitions, beanFactory) {</td></tr><tr class="hit"><td class="line">115</td><td class="hits">61</td><td class="source">	var r = [];</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">117</td><td class="hits">61</td><td class="source">	for (var beanName in beanDefinitions) {</td></tr><tr class="hit"><td class="line">118</td><td class="hits">541</td><td class="source">		var beanDefinition = beanDefinitions[beanName];</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">120</td><td class="hits">541</td><td class="source">		if (beanDefinition.isSingleton() &amp;&amp; !beanDefinition.isLazyInit() &amp;&amp; !beanDefinition.isAbstract()) {</td></tr><tr class="hit"><td class="line">121</td><td class="hits">149</td><td class="source">			if (beanDefinition.hasParentBean()) {</td></tr><tr class="hit"><td class="line">122</td><td class="hits">2</td><td class="source">				beanDefinition = beanFactory.setParentBean(beanDefinition.getBeanName());</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">125</td><td class="hits">149</td><td class="source">			r.push(beanDefinition);</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">129</td><td class="hits">61</td><td class="source">	r.sort(Utils.compareBeans);</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">131</td><td class="hits">61</td><td class="source">	return r;</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">134</td><td class="hits">1</td><td class="source">module.exports = BeanUtils;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/constant.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/constant.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat Constant</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">	SCOPE_DEFAULT: &quot;singleton&quot;,</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">	SCOPE_SINGLETON: &quot;singleton&quot;,</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">	SCOPE_PROTOTYPE: &quot;prototype&quot;,</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">	DEPENDS_ARGS: &quot;args&quot;,</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">	DEPENDS_PROPS: &quot;props&quot;,</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">	SETTINGS_ARGS_ON: &quot;argsOn&quot;,</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">	SETTINGS_PROPS_ON: &quot;propsOn&quot;,</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">	SETTINGS_FACTORY_ARGS_ON: &quot;factoryArgsOn&quot;,</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">	DEPEND_TYPE_BEAN: &quot;d_bean&quot;,</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">	DEPEND_TYPE_VALUE: &quot;d_value&quot;,</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">	DEPEND_TYPE_VAR: &quot;d_var&quot;,</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">	DEPEND_TYPE_ERROR: &quot;d_error&quot;,</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">	PROPS_DEFAULT: [],</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">	ARGS_DEFAULT: [],</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">	ASYNC_INIT_DEFAULT: false,</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">	LAZY_INIT_DEFAULT: false,</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">	ABSTRACT_DEFAULT: false,</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">	INIT_CB_DEFAULT: function() {},</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">	AOP_ADVICE_BEFORE: &quot;before&quot;,</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">	AOP_ADVICE_AFTER: &quot;after&quot;,</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">	AOP_ADVICE_AROUND: &quot;around&quot;,</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">	PROXY_DEFAULT: true,</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">	DEFAULT_ENV: &quot;dev&quot;,</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">	LOGPATH: &quot;log4js.json&quot;,</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">	NAMESPACE_SEPERATOR: &quot;:&quot;,</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">	FUNC_ARGS_REGEXP: /function.*?\((.*?)\)\s*\{/,</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">	FUNC_PROPS_REGEXP: /\s*this\.\$\w+\s*=(.|\s)*?;/g,</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">	FUNC_PROPS_REGEXP_ATTR: /\s*this\.\w+\s*=\s*[\&quot;\']\$(.|\s)*?[\&quot;\'];/g,</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">	FUNC_COMMENT_LINE: /\/\/.*?\n/g,</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">	FUNC_COMMENT_STAR: /\/\*(.|\s)*?\*\//g,</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">	FUNC_ANNOTATION: &quot;$&quot;,</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">	PROTO_FUNC_PROPS_REGEXP: /\w+\s*\$\w+\s*=(.|\s)*?;/g,</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">	META_PROPS: [&quot;id&quot;, &quot;order&quot;, &quot;init&quot;, &quot;destroy&quot;, &quot;factoryBean&quot;,</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">		&quot;factoryMethod&quot;, &quot;scope&quot;, &quot;async&quot;, &quot;abstract&quot;, &quot;parent&quot;,</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">		&quot;lazy&quot;, &quot;factoryArgs&quot;, &quot;proxy&quot;, &quot;aop&quot;, &quot;mid&quot;, &quot;table&quot;,</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">		&quot;cid&quot;, &quot;constraint&quot;, &quot;prefix&quot;</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">	],</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">	AOP_META_PROPS: [&quot;pointcut&quot;, &quot;advice&quot;, &quot;order&quot;, &quot;runtime&quot;],</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">	META_AOP: &quot;aop&quot;,</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">	META_ID: &quot;id&quot;,</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">	META_AOP_ADVICE: &quot;advice&quot;,</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">	FILTER_BUILTIN: &quot;builtin&quot;,</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">	FILTER_MODEL: &quot;model&quot;,</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">	FILTER_BUILTIN_METHOD: &quot;filter&quot;,</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">	CONSTRAINT_ANNOTATION: &quot;$&quot;,</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">	CONSTRAINT_SPLIT: &quot;;&quot;,</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">	CONSTRAINT_METHOD: &quot;validate&quot;,</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">	MODEL_ATTRIBUTES: [&quot;type&quot;, &quot;primary&quot;, &quot;default&quot;, &quot;ref&quot;, &quot;prefix&quot;],</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">	MODEL_ATTRIBUTE_PRIMARY: &quot;primary&quot;,</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">	MODEL_ATTRIBUTE_BALANCE: &quot;balance&quot;,</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">	MODEL_ATTRIBUTE_TYPE_ARRAY: &quot;Array&quot;,</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">	MODEL_ATTRIBUTE_TYPE_OBJECT: &quot;Object&quot;,</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">	MODEL_FILTER_BEFORE: 'before',</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">	MODEL_FILTER_AFTER: 'after',</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">	BEAN_SPECIAL_MODEL: &quot;_$model&quot;,</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">	BEAN_SPECIAL_CONSTRAINT: &quot;_$constraint&quot;,</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">	TYPE_NUMBER: &quot;Number&quot;,</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">	DEFINE_GETTER_PREFIX: &quot;__&quot;</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/fileUtil.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/fileUtil.js</h2><div id="stats" class="high"><div class="percentage">90%</div><div class="sloc">11</div><div class="hits">10</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat FileUtil</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var fs = require('fs');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var FileUtil = {};</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * FileUtil existsSync.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">FileUtil.existsSync = function() {</td></tr><tr class="miss"><td class="line">24</td><td class="hits">0</td><td class="source">	return false;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * FileUtil watch shim.</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">FileUtil.watch = function() {</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * FileUtil realpathSync shim.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">FileUtil.realpathSync = function() {</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * FileUtil readdirSync shim.</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">50</td><td class="hits">1</td><td class="source">FileUtil.readdirSync = function() {</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">if (fs) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">	for (var method in fs) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">84</td><td class="source">		FileUtil[method] = fs[method];</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">module.exports = FileUtil;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/metaUtil.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/metaUtil.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">195</div><div class="hits">184</div><div class="misses">11</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat MetaUtil</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('Bearcat', 'MetaUtil');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var RequireUtil = require('./requireUtil');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Constant = require('./constant');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var Os = RequireUtil.requireOs();</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var Utils = require('./utils');</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">var EOL = Os.EOL;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var MetaUtil = {</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">	metaCache: {}</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * MetaUtil merge metaObject with originMeta.</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> * @param   {Object} meta metaObject</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @param   {Object} originMeta origin metaObject</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * @param   {Object} merged metaObjects</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">MetaUtil.mergeMeta = function(meta, originMeta) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">230</td><td class="source">	if (!originMeta) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">228</td><td class="source">		return meta;</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">2</td><td class="source">	for (var key in meta) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">7</td><td class="source">		originMeta[key] = meta[key];</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">2</td><td class="source">	return originMeta;</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> * MetaUtil resolve function annotation like $id, $scope, $car etc.</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> * @param  {Function} func function annotation</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> * @param  {String}   func function file path</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * @param  {Boolean}  force resolve func annotation</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> * @return {Object}   metaObject resolved metaObject</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">MetaUtil.resolveFuncAnnotation = function(func, fp, force) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">516</td><td class="source">	var funcString = func.toString();</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">516</td><td class="source">	if (process.env.LOADER_BIN === 'on') {</td></tr><tr class="miss"><td class="line">58</td><td class="hits">0</td><td class="source">		force = true;</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">61</td><td class="hits">516</td><td class="source">	if (this.metaCache[funcString] &amp;&amp; !force) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">2</td><td class="source">		return this.metaCache[funcString];</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">514</td><td class="source">	var funcArgsString = funcString.match(Constant.FUNC_ARGS_REGEXP);</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">67</td><td class="hits">514</td><td class="source">	if (funcArgsString) {</td></tr><tr class="hit"><td class="line">68</td><td class="hits">514</td><td class="source">		funcArgsString = funcArgsString[1];</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">		funcArgsString = &quot;&quot;;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">514</td><td class="source">	var funcArgs = [];</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">75</td><td class="hits">514</td><td class="source">	if (funcArgsString) {</td></tr><tr class="hit"><td class="line">76</td><td class="hits">13</td><td class="source">		funcArgs = funcArgsString.split(',');</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">79</td><td class="hits">514</td><td class="source">	var meta = {};</td></tr><tr class="hit"><td class="line">80</td><td class="hits">514</td><td class="source">	var props = [];</td></tr><tr class="hit"><td class="line">81</td><td class="hits">514</td><td class="source">	var args = [];</td></tr><tr class="hit"><td class="line">82</td><td class="hits">514</td><td class="source">	var attributes = [];</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">514</td><td class="source">	var funcProps = null;</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">86</td><td class="hits">514</td><td class="source">	if (funcArgs.length || process.env.BEARCAT_FUNCTION_STRING) {</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">		// if constructor function have arguments or setup BEARCAT_FUNCTION_STRING flag</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">		// use funcString to resolve $ props</td></tr><tr class="hit"><td class="line">89</td><td class="hits">13</td><td class="source">		funcString = MetaUtil.resolveFuncComment(funcString);</td></tr><tr class="hit"><td class="line">90</td><td class="hits">13</td><td class="source">		funcProps = MetaUtil.resolvePropsFromFuncString(funcString, funcArgsString);</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">	} else {</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">		// use new to resolve $ props directly to support dynamic $ prefix attributes</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">		// try catch the error, when dependency is not ready when started</td></tr><tr class="hit"><td class="line">94</td><td class="hits">501</td><td class="source">		try {</td></tr><tr class="hit"><td class="line">95</td><td class="hits">501</td><td class="source">			funcProps = new func();</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">		} catch (e) {</td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">			return;</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">101</td><td class="hits">513</td><td class="source">	for (var funcKey in funcProps) {</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">		// prototype attribute must be prefixed with $, other attributes will be ignored </td></tr><tr class="hit"><td class="line">103</td><td class="hits">2126</td><td class="source">		if (!funcProps.hasOwnProperty(funcKey) &amp;&amp; !MetaUtil.checkFuncAnnotation(funcKey)) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">672</td><td class="source">			continue;</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">107</td><td class="hits">1454</td><td class="source">		var value = funcProps[funcKey];</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">		// ignore function value</td></tr><tr class="hit"><td class="line">110</td><td class="hits">1454</td><td class="source">		if (Utils.checkFunction(value)) {</td></tr><tr class="miss"><td class="line">111</td><td class="hits">0</td><td class="source">			continue;</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">114</td><td class="hits">1454</td><td class="source">		if (MetaUtil.checkFuncAnnotation(funcKey)) {</td></tr><tr class="hit"><td class="line">115</td><td class="hits">631</td><td class="source">			var key = funcKey.substr(1);</td></tr><tr class="hit"><td class="line">116</td><td class="hits">631</td><td class="source">			if (MetaUtil.checkInMetaProps(funcKey)) {</td></tr><tr class="hit"><td class="line">117</td><td class="hits">580</td><td class="source">				if (key === Constant.META_AOP &amp;&amp; funcProps[funcKey] === true) {</td></tr><tr class="hit"><td class="line">118</td><td class="hits">13</td><td class="source">					meta[key] = this.resolvePrototypeAnnotation(func);</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">				} else {</td></tr><tr class="hit"><td class="line">120</td><td class="hits">567</td><td class="source">					if (key === Constant.META_ID) {</td></tr><tr class="hit"><td class="line">121</td><td class="hits">115</td><td class="source">						if (MetaUtil.checkInMetaProps(value, true)) {</td></tr><tr class="hit"><td class="line">122</td><td class="hits">1</td><td class="source">							logger.warn('bean id value must not use bearcat special bean attributes: %s', value);</td></tr><tr class="hit"><td class="line">123</td><td class="hits">1</td><td class="source">							return;</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">						}</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">					}</td></tr><tr class="hit"><td class="line">126</td><td class="hits">566</td><td class="source">					meta[key] = value;</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">			} else {</td></tr><tr class="hit"><td class="line">129</td><td class="hits">51</td><td class="source">				if (!MetaUtil.checkInFuncArgs(funcKey, funcArgs)) {</td></tr><tr class="hit"><td class="line">130</td><td class="hits">42</td><td class="source">					if (MetaUtil.checkFuncPropsValue(funcKey)) {</td></tr><tr class="hit"><td class="line">131</td><td class="hits">10</td><td class="source">						props.push({</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">							name: funcKey,</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">							value: value</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">						});</td></tr><tr class="hit"><td class="line">135</td><td class="hits">32</td><td class="source">					} else if (MetaUtil.checkFuncPropsType(funcKey)) {</td></tr><tr class="hit"><td class="line">136</td><td class="hits">2</td><td class="source">						props.push({</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">							name: funcKey,</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">							type: value</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">						});</td></tr><tr class="hit"><td class="line">140</td><td class="hits">30</td><td class="source">					} else if (MetaUtil.checkFuncPropsNamespace(funcKey)) {</td></tr><tr class="hit"><td class="line">141</td><td class="hits">1</td><td class="source">						props.push({</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">							name: funcKey,</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">							ref: value</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">						});</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">					} else {</td></tr><tr class="hit"><td class="line">146</td><td class="hits">29</td><td class="source">						props.push({</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">							name: funcKey,</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">							ref: key</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">						});</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">					}</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">			}</td></tr><tr class="hit"><td class="line">153</td><td class="hits">630</td><td class="source">			continue;</td></tr><tr class="hit"><td class="line">154</td><td class="hits">823</td><td class="source">		} else if (MetaUtil.checkFuncPropsConfigValue(value)) {</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">			// this.num = &quot;${car.num}&quot;; placeholder</td></tr><tr class="hit"><td class="line">156</td><td class="hits">5</td><td class="source">			props.push({</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">				name: funcKey,</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">				value: value</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">			});</td></tr><tr class="hit"><td class="line">160</td><td class="hits">818</td><td class="source">		} else if (MetaUtil.checkFuncValueAnnotation(value)) {</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">			// this.num = &quot;$type:Number&quot;; model attribute</td></tr><tr class="hit"><td class="line">162</td><td class="hits">66</td><td class="source">			attributes.push({</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">				name: funcKey,</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">				value: value</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">			});</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">169</td><td class="hits">512</td><td class="source">	delete funcProps;</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">171</td><td class="hits">512</td><td class="source">	if (props.length) {</td></tr><tr class="hit"><td class="line">172</td><td class="hits">31</td><td class="source">		meta['props'] = props;</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">175</td><td class="hits">512</td><td class="source">	for (var i = 0; i &lt; funcArgs.length; i++) {</td></tr><tr class="hit"><td class="line">176</td><td class="hits">15</td><td class="source">		var funcArg = funcArgs[i].trim();</td></tr><tr class="hit"><td class="line">177</td><td class="hits">15</td><td class="source">		if (!funcArg) {</td></tr><tr class="miss"><td class="line">178</td><td class="hits">0</td><td class="source">			continue;</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">181</td><td class="hits">15</td><td class="source">		var key = funcArg.substr(1);</td></tr><tr class="hit"><td class="line">182</td><td class="hits">15</td><td class="source">		if (MetaUtil.checkFuncAnnotation(funcArg)) {</td></tr><tr class="hit"><td class="line">183</td><td class="hits">9</td><td class="source">			args.push({</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">				name: funcArg,</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">				ref: key</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">			});</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">		} else {</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">			// not start with $, treat it as a type injection</td></tr><tr class="hit"><td class="line">189</td><td class="hits">6</td><td class="source">			args.push({</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">				name: funcArg,</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">				type: &quot;Object&quot;</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">			});</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">196</td><td class="hits">512</td><td class="source">	if (args.length) {</td></tr><tr class="hit"><td class="line">197</td><td class="hits">13</td><td class="source">		meta['args'] = args;</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">200</td><td class="hits">512</td><td class="source">	if (attributes.length) {</td></tr><tr class="hit"><td class="line">201</td><td class="hits">14</td><td class="source">		meta['attributes'] = attributes;</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">204</td><td class="hits">512</td><td class="source">	meta['func'] = func;</td></tr><tr class="hit"><td class="line">205</td><td class="hits">512</td><td class="source">	if (fp) {</td></tr><tr class="hit"><td class="line">206</td><td class="hits">126</td><td class="source">		meta['fpath'] = require('path').resolve(process.cwd(), fp);</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">209</td><td class="hits">512</td><td class="source">	var id = meta.id;</td></tr><tr class="hit"><td class="line">210</td><td class="hits">512</td><td class="source">	if (meta.id) {</td></tr><tr class="hit"><td class="line">211</td><td class="hits">113</td><td class="source">		id = meta.id;</td></tr><tr class="hit"><td class="line">212</td><td class="hits">399</td><td class="source">	} else if (meta.mid) {</td></tr><tr class="hit"><td class="line">213</td><td class="hits">14</td><td class="source">		id = meta.mid + Constant.BEAN_SPECIAL_MODEL;</td></tr><tr class="hit"><td class="line">214</td><td class="hits">385</td><td class="source">	} else if (meta.cid) {</td></tr><tr class="hit"><td class="line">215</td><td class="hits">370</td><td class="source">		id = meta.cid + Constant.BEAN_SPECIAL_CONSTRAINT;</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">	} else {</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">		// must have id</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">220</td><td class="hits">512</td><td class="source">	if (id) {</td></tr><tr class="hit"><td class="line">221</td><td class="hits">497</td><td class="source">		meta['id'] = id;</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">224</td><td class="hits">512</td><td class="source">	this.metaCache[funcString] = meta;</td></tr><tr class="hit"><td class="line">225</td><td class="hits">512</td><td class="source">	return meta;</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> * MetaUtil props from function string.</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source"> * @param  {String}     function string</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source"> * @return {Object}     resolved props object</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">235</td><td class="hits">1</td><td class="source">MetaUtil.resolvePropsFromFuncString = function(funcString, funcArgsString) {</td></tr><tr class="hit"><td class="line">236</td><td class="hits">13</td><td class="source">	var funcPropsArray = funcString.match(Constant.FUNC_PROPS_REGEXP);</td></tr><tr class="hit"><td class="line">237</td><td class="hits">13</td><td class="source">	var funcPropsAttrArray = funcString.match(Constant.FUNC_PROPS_REGEXP_ATTR);</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">239</td><td class="hits">13</td><td class="source">	var t = &quot;var FuncProps = function(&quot; + funcArgsString + &quot;) {&quot; + EOL;</td></tr><tr class="hit"><td class="line">240</td><td class="hits">13</td><td class="source">	if (funcPropsArray &amp;&amp; Utils.checkArray(funcPropsArray)) {</td></tr><tr class="hit"><td class="line">241</td><td class="hits">12</td><td class="source">		for (var i = 0; i &lt; funcPropsArray.length; i++) {</td></tr><tr class="hit"><td class="line">242</td><td class="hits">35</td><td class="source">			t += (funcPropsArray[i] + EOL);</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">246</td><td class="hits">13</td><td class="source">	if (funcPropsAttrArray &amp;&amp; Utils.checkArray(funcPropsAttrArray)) {</td></tr><tr class="miss"><td class="line">247</td><td class="hits">0</td><td class="source">		for (var i = 0; i &lt; funcPropsAttrArray.length; i++) {</td></tr><tr class="miss"><td class="line">248</td><td class="hits">0</td><td class="source">			t += (funcPropsAttrArray[i] + EOL);</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">252</td><td class="hits">13</td><td class="source">	t += &quot;}&quot;;</td></tr><tr><td class="line">253</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">254</td><td class="hits">13</td><td class="source">	var funcProps = MetaUtil.getEvalFuncProps(t);</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">256</td><td class="hits">13</td><td class="source">	return funcProps;</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">260</td><td class="hits"></td><td class="source"> * MetaUtil resolve prototype annotation.</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source"> * @param  {Function}   func function</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> * @return {Object}     resolved meta object</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">266</td><td class="hits">1</td><td class="source">MetaUtil.resolvePrototypeAnnotation = function(func) {</td></tr><tr class="hit"><td class="line">267</td><td class="hits">13</td><td class="source">	var proto = func.prototype;</td></tr><tr class="hit"><td class="line">268</td><td class="hits">13</td><td class="source">	var meta = [];</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">270</td><td class="hits">13</td><td class="source">	for (var funcName in proto) {</td></tr><tr class="hit"><td class="line">271</td><td class="hits">96</td><td class="source">		var protoFunc = proto[funcName];</td></tr><tr class="hit"><td class="line">272</td><td class="hits">96</td><td class="source">		if (Utils.checkFunction(protoFunc)) {</td></tr><tr class="hit"><td class="line">273</td><td class="hits">96</td><td class="source">			var funcString = protoFunc.toString();</td></tr><tr class="hit"><td class="line">274</td><td class="hits">96</td><td class="source">			funcString = MetaUtil.resolveFuncComment(funcString);</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">276</td><td class="hits">96</td><td class="source">			var funcPropsArray = funcString.match(Constant.PROTO_FUNC_PROPS_REGEXP);</td></tr><tr class="hit"><td class="line">277</td><td class="hits">96</td><td class="source">			var t = &quot;&quot;;</td></tr><tr class="hit"><td class="line">278</td><td class="hits">96</td><td class="source">			if (funcPropsArray &amp;&amp; Utils.checkArray(funcPropsArray)) {</td></tr><tr class="hit"><td class="line">279</td><td class="hits">95</td><td class="source">				t = &quot;var FuncMetaProps = function() {&quot; + EOL;</td></tr><tr class="hit"><td class="line">280</td><td class="hits">95</td><td class="source">				for (var i = 0; i &lt; funcPropsArray.length; i++) {</td></tr><tr class="hit"><td class="line">281</td><td class="hits">138</td><td class="source">					t += (funcPropsArray[i].replace(/var\s*/, &quot;this.&quot;) + EOL);</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">				}</td></tr><tr class="hit"><td class="line">283</td><td class="hits">95</td><td class="source">				t += &quot;}&quot;;</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">286</td><td class="hits">96</td><td class="source">			var funcProps = MetaUtil.getEvalFuncMetaProps(t);</td></tr><tr class="hit"><td class="line">287</td><td class="hits">96</td><td class="source">			var aop = {};</td></tr><tr class="hit"><td class="line">288</td><td class="hits">96</td><td class="source">			var flag = false;</td></tr><tr class="hit"><td class="line">289</td><td class="hits">96</td><td class="source">			aop[Constant.META_AOP_ADVICE] = funcName;</td></tr><tr class="hit"><td class="line">290</td><td class="hits">96</td><td class="source">			for (var funcKey in funcProps) {</td></tr><tr class="hit"><td class="line">291</td><td class="hits">138</td><td class="source">				if (this.checkInAOPMetaProps(funcKey)) {</td></tr><tr class="hit"><td class="line">292</td><td class="hits">137</td><td class="source">					var key = funcKey.substr(1);</td></tr><tr class="hit"><td class="line">293</td><td class="hits">137</td><td class="source">					var value = funcProps[funcKey];</td></tr><tr class="hit"><td class="line">294</td><td class="hits">137</td><td class="source">					aop[key] = value;</td></tr><tr class="hit"><td class="line">295</td><td class="hits">137</td><td class="source">					flag = true;</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source">				}</td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">299</td><td class="hits">96</td><td class="source">			if (flag) {</td></tr><tr class="hit"><td class="line">300</td><td class="hits">94</td><td class="source">				meta.push(aop);</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">302</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">305</td><td class="hits">13</td><td class="source">	return meta;</td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source"> * MetaUtil resolve function comments.</td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source"> * @param  {String}   t function string</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source"> * @return {String}   resolved function string</td></tr><tr><td class="line">313</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">315</td><td class="hits">1</td><td class="source">MetaUtil.resolveFuncComment = function(funcString) {</td></tr><tr class="hit"><td class="line">316</td><td class="hits">109</td><td class="source">	funcString = funcString.replace(Constant.FUNC_COMMENT_LINE, &quot;&quot;)</td></tr><tr class="hit"><td class="line">317</td><td class="hits">109</td><td class="source">	funcString = funcString.replace(Constant.FUNC_COMMENT_STAR, &quot;&quot;);</td></tr><tr class="hit"><td class="line">318</td><td class="hits">109</td><td class="source">	return funcString;</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source"> * MetaUtil get eval function props.</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">324</td><td class="hits"></td><td class="source"> * @param  {String}   t function string</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source"> * @return {Object}   eval object result</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">328</td><td class="hits">1</td><td class="source">MetaUtil.getEvalFuncProps = function(t) {</td></tr><tr class="hit"><td class="line">329</td><td class="hits">13</td><td class="source">	if (!t) {</td></tr><tr class="miss"><td class="line">330</td><td class="hits">0</td><td class="source">		return {};</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">333</td><td class="hits">13</td><td class="source">	try {</td></tr><tr class="hit"><td class="line">334</td><td class="hits">13</td><td class="source">		eval(t);</td></tr><tr class="hit"><td class="line">335</td><td class="hits">13</td><td class="source">		return new FuncProps();</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source">	} catch (err) {</td></tr><tr class="miss"><td class="line">337</td><td class="hits">0</td><td class="source">		logger.error(&quot;resolveFuncAnnotation error: &quot; + err.stack);</td></tr><tr class="miss"><td class="line">338</td><td class="hits">0</td><td class="source">		return {};</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">341</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source"> * MetaUtil get eval function props.</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source"> * @param  {String}   t function string</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source"> * @return {Object}   eval object result</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">349</td><td class="hits">1</td><td class="source">MetaUtil.getEvalFuncMetaProps = function(t) {</td></tr><tr class="hit"><td class="line">350</td><td class="hits">96</td><td class="source">	if (!t) {</td></tr><tr class="hit"><td class="line">351</td><td class="hits">1</td><td class="source">		return {};</td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">353</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">354</td><td class="hits">95</td><td class="source">	try {</td></tr><tr class="hit"><td class="line">355</td><td class="hits">95</td><td class="source">		eval(t);</td></tr><tr class="hit"><td class="line">356</td><td class="hits">95</td><td class="source">		return new FuncMetaProps();</td></tr><tr><td class="line">357</td><td class="hits"></td><td class="source">	} catch (err) {</td></tr><tr class="miss"><td class="line">358</td><td class="hits">0</td><td class="source">		logger.error(&quot;resolvePrototypeAnnotation error: &quot; + err.stack);</td></tr><tr class="miss"><td class="line">359</td><td class="hits">0</td><td class="source">		return {};</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source"> * MetaUtil check funcKey in metaProps.</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source"> * @param  {String}   funcKey function key</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">370</td><td class="hits">1</td><td class="source">MetaUtil.checkInMetaProps = function(funcKey, flag) {</td></tr><tr class="hit"><td class="line">371</td><td class="hits">746</td><td class="source">	var META_PROPS = Constant.META_PROPS;</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">373</td><td class="hits">746</td><td class="source">	var prefix = &quot;&quot;;</td></tr><tr class="hit"><td class="line">374</td><td class="hits">746</td><td class="source">	if (!flag) {</td></tr><tr class="hit"><td class="line">375</td><td class="hits">631</td><td class="source">		prefix = Constant.FUNC_ANNOTATION;</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">378</td><td class="hits">746</td><td class="source">	for (var i = 0; i &lt; META_PROPS.length; i++) {</td></tr><tr class="hit"><td class="line">379</td><td class="hits">10613</td><td class="source">		if (prefix + META_PROPS[i] === funcKey) {</td></tr><tr class="hit"><td class="line">380</td><td class="hits">581</td><td class="source">			return true;</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">384</td><td class="hits">165</td><td class="source">	return false;</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> * MetaUtil check funcKey in aopMetaProps.</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source"> * @param  {String}   funcKey function key</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">394</td><td class="hits">1</td><td class="source">MetaUtil.checkInAOPMetaProps = function(funcKey) {</td></tr><tr class="hit"><td class="line">395</td><td class="hits">138</td><td class="source">	var META_PROPS = Constant.AOP_META_PROPS;</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">397</td><td class="hits">138</td><td class="source">	for (var i = 0; i &lt; META_PROPS.length; i++) {</td></tr><tr class="hit"><td class="line">398</td><td class="hits">247</td><td class="source">		if (Constant.FUNC_ANNOTATION + META_PROPS[i] === funcKey) {</td></tr><tr class="hit"><td class="line">399</td><td class="hits">137</td><td class="source">			return true;</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">403</td><td class="hits">1</td><td class="source">	return false;</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source"> * MetaUtil check funcKey in function args.</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source"> * @param  {String}   funcKey function key</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source"> * @param  {Array}    function args</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">414</td><td class="hits">1</td><td class="source">MetaUtil.checkInFuncArgs = function(funcKey, funcArgs) {</td></tr><tr class="hit"><td class="line">415</td><td class="hits">51</td><td class="source">	for (var i = 0; i &lt; funcArgs.length; i++) {</td></tr><tr class="hit"><td class="line">416</td><td class="hits">23</td><td class="source">		if (funcKey === funcArgs[i]) {</td></tr><tr class="hit"><td class="line">417</td><td class="hits">9</td><td class="source">			return true;</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">421</td><td class="hits">42</td><td class="source">	return false;</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source"> * MetaUtil check function annotation.</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source"> * @param  {String}   funcKey function key</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">431</td><td class="hits">1</td><td class="source">MetaUtil.checkFuncAnnotation = function(funcKey) {</td></tr><tr class="hit"><td class="line">432</td><td class="hits">2639</td><td class="source">	return funcKey.match(/^\$/);</td></tr><tr><td class="line">433</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">434</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source"> * MetaUtil check funcValue annotation.</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">438</td><td class="hits"></td><td class="source"> * @param  {String}   funcValue function value</td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">442</td><td class="hits">1</td><td class="source">MetaUtil.checkFuncValueAnnotation = function(funcValue) {</td></tr><tr class="hit"><td class="line">443</td><td class="hits">818</td><td class="source">	if (!Utils.checkString(funcValue)) {</td></tr><tr class="hit"><td class="line">444</td><td class="hits">321</td><td class="source">		return false;</td></tr><tr><td class="line">445</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">447</td><td class="hits">497</td><td class="source">	return this.checkFuncAnnotation(funcValue);</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">451</td><td class="hits"></td><td class="source"> * MetaUtil check function props value.</td></tr><tr><td class="line">452</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source"> * @param  {String}   funcKey function key</td></tr><tr><td class="line">454</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">456</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">457</td><td class="hits">1</td><td class="source">MetaUtil.checkFuncPropsValue = function(funcKey) {</td></tr><tr class="hit"><td class="line">458</td><td class="hits">42</td><td class="source">	return funcKey.match(/^\$V/);</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source"> * MetaUtil check function props type.</td></tr><tr><td class="line">463</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source"> * @param  {String}   funcKey function key</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">468</td><td class="hits">1</td><td class="source">MetaUtil.checkFuncPropsType = function(funcKey) {</td></tr><tr class="hit"><td class="line">469</td><td class="hits">32</td><td class="source">	return funcKey.match(/^\$T/);</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">472</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">473</td><td class="hits"></td><td class="source"> * MetaUtil check function props namespace.</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source"> * @param  {String}   funcKey function key</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">477</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">479</td><td class="hits">1</td><td class="source">MetaUtil.checkFuncPropsNamespace = function(funcKey) {</td></tr><tr class="hit"><td class="line">480</td><td class="hits">30</td><td class="source">	return funcKey.match(/^\$N/);</td></tr><tr><td class="line">481</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">483</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">484</td><td class="hits"></td><td class="source"> * MetaUtil check function props config value.</td></tr><tr><td class="line">485</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">486</td><td class="hits"></td><td class="source"> * @param  {String}   value</td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">490</td><td class="hits">1</td><td class="source">MetaUtil.checkFuncPropsConfigValue = function(value) {</td></tr><tr class="hit"><td class="line">491</td><td class="hits">823</td><td class="source">	if (!Utils.checkString(value)) {</td></tr><tr class="hit"><td class="line">492</td><td class="hits">321</td><td class="source">		return;</td></tr><tr><td class="line">493</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">494</td><td class="hits">502</td><td class="source">	return value.match(/^\$\{.*?\}$/);</td></tr><tr><td class="line">495</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">496</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">497</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">498</td><td class="hits"></td><td class="source"> * MetaUtil clean up meta cache.</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">500</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">502</td><td class="hits">1</td><td class="source">MetaUtil.cleanUp = function() {</td></tr><tr class="hit"><td class="line">503</td><td class="hits">74</td><td class="source">	this.metaCache = {};</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">505</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">506</td><td class="hits">1</td><td class="source">module.exports = MetaUtil;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/modelUtil.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/modelUtil.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">30</div><div class="hits">30</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ModelUtils</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var ModelAttribute = require('../model/modelAttribute');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Constant = require('./constant');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Utils = require('./utils');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var ModelUtil = {};</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * ModelUtil build model attribute.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @param   {Array}  model meta attributes.</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @param   {Object} beanFactory.</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @return  {Object} modelAttributes.</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">ModelUtil.buildModelAttribute = function(attributes, beanFactory) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">15</td><td class="source">	if (!Utils.checkArray(attributes)) {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">		return {};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">32</td><td class="hits">14</td><td class="source">	var r = {};</td></tr><tr class="hit"><td class="line">33</td><td class="hits">14</td><td class="source">	var fields = {};</td></tr><tr class="hit"><td class="line">34</td><td class="hits">14</td><td class="source">	var refFields = [];</td></tr><tr class="hit"><td class="line">35</td><td class="hits">14</td><td class="source">	var oneToMany = false;</td></tr><tr class="hit"><td class="line">36</td><td class="hits">14</td><td class="source">	var balance = &quot;&quot;;</td></tr><tr class="hit"><td class="line">37</td><td class="hits">14</td><td class="source">	for (var i = 0; i &lt; attributes.length; i++) {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">66</td><td class="source">		var attribute = attributes[i];</td></tr><tr class="hit"><td class="line">39</td><td class="hits">66</td><td class="source">		var name = attribute['name'];</td></tr><tr class="hit"><td class="line">40</td><td class="hits">66</td><td class="source">		var value = attribute['value'];</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">66</td><td class="source">		var modelAttribute = new ModelAttribute();</td></tr><tr class="hit"><td class="line">43</td><td class="hits">66</td><td class="source">		modelAttribute.setName(name);</td></tr><tr class="hit"><td class="line">44</td><td class="hits">66</td><td class="source">		modelAttribute.setExpression(value);</td></tr><tr class="hit"><td class="line">45</td><td class="hits">66</td><td class="source">		modelAttribute.parse(value, beanFactory);</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">47</td><td class="hits">66</td><td class="source">		fields[name] = modelAttribute;</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">66</td><td class="source">		if (modelAttribute.getRef()) {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">10</td><td class="source">			refFields.push(name);</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">66</td><td class="source">		var type = modelAttribute.getType();</td></tr><tr class="hit"><td class="line">54</td><td class="hits">66</td><td class="source">		if (Utils.checkTypeArray(type)) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">2</td><td class="source">			oneToMany = true;</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">66</td><td class="source">		if (modelAttribute.isBalance()) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">2</td><td class="source">			balance = name;</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">14</td><td class="source">	return {</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">		fields: fields,</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">		balance: balance,</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">		refFields: refFields,</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">		oneToMany: oneToMany</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">	};</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">module.exports = ModelUtil;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/requestUtil.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/requestUtil.js</h2><div id="stats" class="terrible"><div class="percentage">17%</div><div class="sloc">47</div><div class="hits">8</div><div class="misses">39</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat RequestUtil load async script</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * modified from seajs util-request.js</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;, http://seajs.org</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Utils = require('./utils');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var RequestUtil = {};</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var currentlyAddingScript;</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> * RequestUtil request script file from url.</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @param  {String}   url</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @param  {Function} callback function</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> * @param  {String}   charset code</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @param  {Boolean}  crossorigin or not</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">RequestUtil.request = function(url, callback, charset, crossorigin) {</td></tr><tr class="miss"><td class="line">29</td><td class="hits">0</td><td class="source">	if (Utils.checkWebWorker()) {</td></tr><tr class="miss"><td class="line">30</td><td class="hits">0</td><td class="source">		return this.requestFromWebWorker(url, callback, charset, crossorigin);</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="miss"><td class="line">32</td><td class="hits">0</td><td class="source">		return this.requestFromAsyncScript(url, callback, charset, crossorigin);</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> * RequestUtil request script file from web worker.</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * @param  {String}   url</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * @param  {Function} callback function</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * @param  {String}   charset code</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @param  {Boolean}  crossorigin or not</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">RequestUtil.requestFromWebWorker = function(url, callback, charset, crossorigin) {</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">	// Load with importScripts</td></tr><tr class="miss"><td class="line">47</td><td class="hits">0</td><td class="source">	var error;</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">	try {</td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">		importScripts(url);</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">	} catch (e) {</td></tr><tr class="miss"><td class="line">51</td><td class="hits">0</td><td class="source">		error = e;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">	}</td></tr><tr class="miss"><td class="line">53</td><td class="hits">0</td><td class="source">	callback(error);</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * RequestUtil request script file from async &lt;script&gt; tag.</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source"> * @param  {String}   url</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> * @param  {Function} callback function</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> * @param  {String}   charset code</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> * @param  {Boolean}  crossorigin or not</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">65</td><td class="hits">1</td><td class="source">RequestUtil.requestFromAsyncScript = function(url, callback, charset, crossorigin) {</td></tr><tr class="miss"><td class="line">66</td><td class="hits">0</td><td class="source">	var doc = document;</td></tr><tr class="miss"><td class="line">67</td><td class="hits">0</td><td class="source">	var head = doc.head || doc.getElementsByTagName(&quot;head&quot;)[0] || doc.documentElement;</td></tr><tr class="miss"><td class="line">68</td><td class="hits">0</td><td class="source">	var baseElement = head.getElementsByTagName(&quot;base&quot;)[0];</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">	var node = doc.createElement(&quot;script&quot;);</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">72</td><td class="hits">0</td><td class="source">	if (charset) {</td></tr><tr class="miss"><td class="line">73</td><td class="hits">0</td><td class="source">		var cs = Utils.checkFunction(charset) ? charset(url) : charset;</td></tr><tr class="miss"><td class="line">74</td><td class="hits">0</td><td class="source">		if (cs) {</td></tr><tr class="miss"><td class="line">75</td><td class="hits">0</td><td class="source">			node.charset = cs;</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">	// crossorigin default value is `false`.</td></tr><tr class="miss"><td class="line">80</td><td class="hits">0</td><td class="source">	var cors = Utils.checkFunction(crossorigin) ? crossorigin(url) : crossorigin;</td></tr><tr class="miss"><td class="line">81</td><td class="hits">0</td><td class="source">	if (cors !== false) {</td></tr><tr class="miss"><td class="line">82</td><td class="hits">0</td><td class="source">		node.crossorigin = cors;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">	this.addOnload(head, node, callback, url);</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">87</td><td class="hits">0</td><td class="source">	node.async = true;</td></tr><tr class="miss"><td class="line">88</td><td class="hits">0</td><td class="source">	node.src = url;</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">	// For some cache cases in IE 6-8, the script executes IMMEDIATELY after</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">	// the end of the insert execution, so use `currentlyAddingScript` to</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">	// hold current node, for deriving url in `define` call</td></tr><tr class="miss"><td class="line">93</td><td class="hits">0</td><td class="source">	currentlyAddingScript = node;</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">	// ref: #185 &amp; http://dev.jquery.com/ticket/2709</td></tr><tr class="miss"><td class="line">96</td><td class="hits">0</td><td class="source">	baseElement ?</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">		head.insertBefore(node, baseElement) :</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">		head.appendChild(node);</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">100</td><td class="hits">0</td><td class="source">	currentlyAddingScript = null;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> * RequestUtil request script file from url.</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * @param  {Object}   head node</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @param  {Object}   node</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> * @param  {Function} callback function</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> * @param  {String}   url</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> * @api private</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">RequestUtil.addOnload = function(head, node, callback, url) {</td></tr><tr class="miss"><td class="line">113</td><td class="hits">0</td><td class="source">	var supportOnload = &quot;onload&quot; in node;</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">115</td><td class="hits">0</td><td class="source">	if (supportOnload) {</td></tr><tr class="miss"><td class="line">116</td><td class="hits">0</td><td class="source">		node.onload = onload</td></tr><tr class="miss"><td class="line">117</td><td class="hits">0</td><td class="source">		node.onerror = function() {</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">			// TODO</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">			// emit(&quot;error&quot;, {</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">			// 	uri: url,</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">			// 	node: node</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">			// })</td></tr><tr class="miss"><td class="line">123</td><td class="hits">0</td><td class="source">			onload(true)</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="miss"><td class="line">126</td><td class="hits">0</td><td class="source">		node.onreadystatechange = function() {</td></tr><tr class="miss"><td class="line">127</td><td class="hits">0</td><td class="source">			if (/loaded|complete/.test(node.readyState)) {</td></tr><tr class="miss"><td class="line">128</td><td class="hits">0</td><td class="source">				onload()</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">133</td><td class="hits">0</td><td class="source">	function onload(error) {</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">		// Ensure only run once and handle memory leak in IE</td></tr><tr class="miss"><td class="line">135</td><td class="hits">0</td><td class="source">		node.onload = node.onerror = node.onreadystatechange = null</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">		// Remove the script to reduce memory leak</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">		// if (!data.debug) {</td></tr><tr class="miss"><td class="line">139</td><td class="hits">0</td><td class="source">		if (!false) {</td></tr><tr class="miss"><td class="line">140</td><td class="hits">0</td><td class="source">			head.removeChild(node)</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">		// Dereference the node</td></tr><tr class="miss"><td class="line">144</td><td class="hits">0</td><td class="source">		node = null</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">146</td><td class="hits">0</td><td class="source">		callback(error)</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">150</td><td class="hits">1</td><td class="source">module.exports = RequestUtil;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/requireUtil.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/requireUtil.js</h2><div id="stats" class="high"><div class="percentage">82%</div><div class="sloc">23</div><div class="hits">19</div><div class="misses">4</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat RequireUtils</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var ShimBuiltins = require('../../shim/builtins');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var RequireUtils = {};</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var Root;</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">(function() {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">	Root = this;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">}());</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">if (!Root.process) {</td></tr><tr class="miss"><td class="line">23</td><td class="hits">0</td><td class="source">	Root.process = ShimBuiltins.process;</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * RequireUtils require os shim.</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">RequireUtils.requireOs = function() {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">	var os = require('os');</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">	if (os) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">		return os;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">		return ShimBuiltins.os;</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> * RequireUtils require path shim.</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">45</td><td class="hits">1</td><td class="source">RequireUtils.requirePath = function() {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">4</td><td class="source">	var path = require('path');</td></tr><tr class="hit"><td class="line">47</td><td class="hits">4</td><td class="source">	if (path) {</td></tr><tr class="hit"><td class="line">48</td><td class="hits">4</td><td class="source">		return path;</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="source">		return ShimBuiltins.path;</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * RequireUtils require util shim.</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">RequireUtils.requireUtil = function() {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">2</td><td class="source">	var util = require('util');</td></tr><tr class="hit"><td class="line">61</td><td class="hits">2</td><td class="source">	if (util) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">2</td><td class="source">		return util;</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="miss"><td class="line">64</td><td class="hits">0</td><td class="source">		return ShimBuiltins.util;</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">module.exports = RequireUtils;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/scriptUtil.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/scriptUtil.js</h2><div id="stats" class="terrible"><div class="percentage">6%</div><div class="sloc">113</div><div class="hits">7</div><div class="misses">106</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ScriptUtil</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * modified from seajs util-path.js</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * The utilities for operating path such as id, uri</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;, http://seajs.org</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var ScriptUtil = {};</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var DIRNAME_RE = /[^?#]*\//</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var DOT_RE = /\/\.\//g</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">var DOUBLE_DOT_RE = /\/[^/]+\/\.\.\//</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var MULTI_SLASH_RE = /([^:/])\/+\//g</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * ScriptUtil get current loader directory.</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">ScriptUtil.getLoaderDir = function() {</td></tr><tr class="miss"><td class="line">30</td><td class="hits">0</td><td class="source">  if (typeof location === 'undefined') {</td></tr><tr class="miss"><td class="line">31</td><td class="hits">0</td><td class="source">    location = {};</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  // Extract the directory portion of a path</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  // dirname(&quot;a/b/c.js?t=123#xx/zz&quot;) ==&gt; &quot;a/b/&quot;</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  // ref: http://jsperf.com/regex-vs-split/2</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">  function dirname(path) {</td></tr><tr class="miss"><td class="line">37</td><td class="hits">0</td><td class="source">    return path.match(DIRNAME_RE)[0]</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  // Canonicalize a path</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  // realpath(&quot;http://test.com/a//./b/../c&quot;) ==&gt; &quot;http://test.com/a/c&quot;</td></tr><tr class="miss"><td class="line">42</td><td class="hits">0</td><td class="source">  function realpath(path) {</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    // /a/b/./c/./d ==&gt; /a/b/c/d</td></tr><tr class="miss"><td class="line">44</td><td class="hits">0</td><td class="source">    path = path.replace(DOT_RE, &quot;/&quot;)</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    /*</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">      @author wh1100717</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">      a//b/c ==&gt; a/b/c</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">      a///b/////c ==&gt; a/b/c</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">      DOUBLE_DOT_RE matches a/b/c//../d path correctly only if replace // with / first</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    */</td></tr><tr class="miss"><td class="line">52</td><td class="hits">0</td><td class="source">    path = path.replace(MULTI_SLASH_RE, &quot;$1/&quot;)</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">    // a/b/c/../../d  ==&gt;  a/b/../d  ==&gt;  a/d</td></tr><tr class="miss"><td class="line">55</td><td class="hits">0</td><td class="source">    while (path.match(DOUBLE_DOT_RE)) {</td></tr><tr class="miss"><td class="line">56</td><td class="hits">0</td><td class="source">      path = path.replace(DOUBLE_DOT_RE, &quot;/&quot;)</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">59</td><td class="hits">0</td><td class="source">    return path</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  // Normalize an id</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  // normalize(&quot;path/to/a&quot;) ==&gt; &quot;path/to/a.js&quot;</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  // NOTICE: substring is faster than negative slice and RegExp</td></tr><tr class="miss"><td class="line">65</td><td class="hits">0</td><td class="source">  function normalize(path) {</td></tr><tr class="miss"><td class="line">66</td><td class="hits">0</td><td class="source">    var last = path.length - 1</td></tr><tr class="miss"><td class="line">67</td><td class="hits">0</td><td class="source">    var lastC = path.charCodeAt(last)</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">    // If the uri ends with `#`, just return it without '#'</td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">    if (lastC === 35 /* &quot;#&quot; */ ) {</td></tr><tr class="miss"><td class="line">71</td><td class="hits">0</td><td class="source">      return path.substring(0, last)</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">74</td><td class="hits">0</td><td class="source">    return (path.substring(last - 2) === &quot;.js&quot; ||</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">      path.indexOf(&quot;?&quot;) &gt; 0 ||</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">      lastC === 47 /* &quot;/&quot; */ ) ? path : path + &quot;.js&quot;</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">80</td><td class="hits">0</td><td class="source">  var PATHS_RE = /^([^/:]+)(\/.+)$/</td></tr><tr class="miss"><td class="line">81</td><td class="hits">0</td><td class="source">  var VARS_RE = /{([^{]+)}/g</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">83</td><td class="hits">0</td><td class="source">  function parseAlias(id) {</td></tr><tr class="miss"><td class="line">84</td><td class="hits">0</td><td class="source">    var alias = data.alias</td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">    return alias &amp;&amp; isString(alias[id]) ? alias[id] : id</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">88</td><td class="hits">0</td><td class="source">  function parsePaths(id) {</td></tr><tr class="miss"><td class="line">89</td><td class="hits">0</td><td class="source">    var paths = data.paths</td></tr><tr class="miss"><td class="line">90</td><td class="hits">0</td><td class="source">    var m</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">92</td><td class="hits">0</td><td class="source">    if (paths &amp;&amp; (m = id.match(PATHS_RE)) &amp;&amp; isString(paths[m[1]])) {</td></tr><tr class="miss"><td class="line">93</td><td class="hits">0</td><td class="source">      id = paths[m[1]] + m[2]</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">96</td><td class="hits">0</td><td class="source">    return id</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">  function parseVars(id) {</td></tr><tr class="miss"><td class="line">100</td><td class="hits">0</td><td class="source">    var vars = data.vars</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">102</td><td class="hits">0</td><td class="source">    if (vars &amp;&amp; id.indexOf(&quot;{&quot;) &gt; -1) {</td></tr><tr class="miss"><td class="line">103</td><td class="hits">0</td><td class="source">      id = id.replace(VARS_RE, function(m, key) {</td></tr><tr class="miss"><td class="line">104</td><td class="hits">0</td><td class="source">        return isString(vars[key]) ? vars[key] : m</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">      })</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">108</td><td class="hits">0</td><td class="source">    return id</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">111</td><td class="hits">0</td><td class="source">  function parseMap(uri) {</td></tr><tr class="miss"><td class="line">112</td><td class="hits">0</td><td class="source">    var map = data.map</td></tr><tr class="miss"><td class="line">113</td><td class="hits">0</td><td class="source">    var ret = uri</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">115</td><td class="hits">0</td><td class="source">    if (map) {</td></tr><tr class="miss"><td class="line">116</td><td class="hits">0</td><td class="source">      for (var i = 0, len = map.length; i &lt; len; i++) {</td></tr><tr class="miss"><td class="line">117</td><td class="hits">0</td><td class="source">        var rule = map[i]</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">119</td><td class="hits">0</td><td class="source">        ret = isFunction(rule) ?</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">          (rule(uri) || uri) :</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">          uri.replace(rule[0], rule[1])</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">        // Only apply the first matched rule</td></tr><tr class="miss"><td class="line">124</td><td class="hits">0</td><td class="source">        if (ret !== uri) break</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">128</td><td class="hits">0</td><td class="source">    return ret</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">132</td><td class="hits">0</td><td class="source">  var ABSOLUTE_RE = /^\/\/.|:\//</td></tr><tr class="miss"><td class="line">133</td><td class="hits">0</td><td class="source">  var ROOT_DIR_RE = /^.*?\/\/.*?\//</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">135</td><td class="hits">0</td><td class="source">  function addBase(id, refUri) {</td></tr><tr class="miss"><td class="line">136</td><td class="hits">0</td><td class="source">    var ret</td></tr><tr class="miss"><td class="line">137</td><td class="hits">0</td><td class="source">    var first = id.charCodeAt(0)</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">    // Absolute</td></tr><tr class="miss"><td class="line">140</td><td class="hits">0</td><td class="source">    if (ABSOLUTE_RE.test(id)) {</td></tr><tr class="miss"><td class="line">141</td><td class="hits">0</td><td class="source">      ret = id</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">    // Relative</td></tr><tr class="miss"><td class="line">144</td><td class="hits">0</td><td class="source">    else if (first === 46 /* &quot;.&quot; */ ) {</td></tr><tr class="miss"><td class="line">145</td><td class="hits">0</td><td class="source">      ret = (refUri ? dirname(refUri) : data.cwd) + id</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">    // Root</td></tr><tr class="miss"><td class="line">148</td><td class="hits">0</td><td class="source">    else if (first === 47 /* &quot;/&quot; */ ) {</td></tr><tr class="miss"><td class="line">149</td><td class="hits">0</td><td class="source">      var m = data.cwd.match(ROOT_DIR_RE)</td></tr><tr class="miss"><td class="line">150</td><td class="hits">0</td><td class="source">      ret = m ? m[0] + id.substring(1) : id</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">    // Top-level</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">    else {</td></tr><tr class="miss"><td class="line">154</td><td class="hits">0</td><td class="source">      ret = data.base + id</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">    // Add default protocol when uri begins with &quot;//&quot;</td></tr><tr class="miss"><td class="line">158</td><td class="hits">0</td><td class="source">    if (ret.indexOf(&quot;//&quot;) === 0) {</td></tr><tr class="miss"><td class="line">159</td><td class="hits">0</td><td class="source">      ret = location.protocol + ret</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">162</td><td class="hits">0</td><td class="source">    return realpath(ret)</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">165</td><td class="hits">0</td><td class="source">  function id2Uri(id, refUri) {</td></tr><tr class="miss"><td class="line">166</td><td class="hits">0</td><td class="source">    if (!id) return &quot;&quot;</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">168</td><td class="hits">0</td><td class="source">    id = parseAlias(id)</td></tr><tr class="miss"><td class="line">169</td><td class="hits">0</td><td class="source">    id = parsePaths(id)</td></tr><tr class="miss"><td class="line">170</td><td class="hits">0</td><td class="source">    id = parseAlias(id)</td></tr><tr class="miss"><td class="line">171</td><td class="hits">0</td><td class="source">    id = parseVars(id)</td></tr><tr class="miss"><td class="line">172</td><td class="hits">0</td><td class="source">    id = parseAlias(id)</td></tr><tr class="miss"><td class="line">173</td><td class="hits">0</td><td class="source">    id = normalize(id)</td></tr><tr class="miss"><td class="line">174</td><td class="hits">0</td><td class="source">    id = parseAlias(id)</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">176</td><td class="hits">0</td><td class="source">    var uri = addBase(id, refUri)</td></tr><tr class="miss"><td class="line">177</td><td class="hits">0</td><td class="source">    uri = parseAlias(uri)</td></tr><tr class="miss"><td class="line">178</td><td class="hits">0</td><td class="source">    uri = parseMap(uri)</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">180</td><td class="hits">0</td><td class="source">    return uri</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">  // For Developers</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">  // seajs.resolve = id2Uri;</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">  // Check environment</td></tr><tr class="miss"><td class="line">187</td><td class="hits">0</td><td class="source">  var isWebWorker = typeof window === 'undefined' &amp;&amp; typeof importScripts !== 'undefined' &amp;&amp; isFunction(importScripts);</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">  // Ignore about:xxx and blob:xxx</td></tr><tr class="miss"><td class="line">190</td><td class="hits">0</td><td class="source">  var IGNORE_LOCATION_RE = /^(about|blob):/;</td></tr><tr class="miss"><td class="line">191</td><td class="hits">0</td><td class="source">  var loaderDir;</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">  // Sea.js's full path</td></tr><tr class="miss"><td class="line">193</td><td class="hits">0</td><td class="source">  var loaderPath;</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">  // Location is read-only from web worker, should be ok though</td></tr><tr class="miss"><td class="line">195</td><td class="hits">0</td><td class="source">  var cwd = (!location.href || IGNORE_LOCATION_RE.test(location.href)) ? '' : dirname(location.href);</td></tr><tr><td class="line">196</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">197</td><td class="hits">0</td><td class="source">  if (isWebWorker) {</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">    // Web worker doesn't create DOM object when loading scripts</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">    // Get sea.js's path by stack trace.</td></tr><tr class="miss"><td class="line">200</td><td class="hits">0</td><td class="source">    var stack;</td></tr><tr class="miss"><td class="line">201</td><td class="hits">0</td><td class="source">    try {</td></tr><tr class="miss"><td class="line">202</td><td class="hits">0</td><td class="source">      var up = new Error();</td></tr><tr class="miss"><td class="line">203</td><td class="hits">0</td><td class="source">      throw up;</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">    } catch (e) {</td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">      // IE won't set Error.stack until thrown</td></tr><tr class="miss"><td class="line">206</td><td class="hits">0</td><td class="source">      stack = e.stack.split('\n');</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">    // First line is 'Error'</td></tr><tr class="miss"><td class="line">209</td><td class="hits">0</td><td class="source">    stack.shift();</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">211</td><td class="hits">0</td><td class="source">    var m;</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">    // Try match `url:row:col` from stack trace line. Known formats:</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source">    // Chrome:  '    at http://localhost:8000/script/sea-worker-debug.js:294:25'</td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">    // FireFox: '@http://localhost:8000/script/sea-worker-debug.js:1082:1'</td></tr><tr><td class="line">215</td><td class="hits"></td><td class="source">    // IE11:    '   at Anonymous function (http://localhost:8000/script/sea-worker-debug.js:295:5)'</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">    // Don't care about older browsers since web worker is an HTML5 feature</td></tr><tr class="miss"><td class="line">217</td><td class="hits">0</td><td class="source">    var TRACE_RE = /.*?((?:http|https|file)(?::\/{2}[\w]+)(?:[\/|\.]?)(?:[^\s&quot;]*)).*?/i</td></tr><tr><td class="line">218</td><td class="hits"></td><td class="source">      // Try match `url` (Note: in IE there will be a tailing ')')</td></tr><tr class="miss"><td class="line">219</td><td class="hits">0</td><td class="source">    var URL_RE = /(.*?):\d+:\d+\)?$/;</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">    // Find url of from stack trace.</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">    // Cannot simply read the first one because sometimes we will get:</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source">    // Error</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">    //  at Error (native) &lt;- Here's your problem</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">    //  at http://localhost:8000/_site/dist/sea.js:2:4334 &lt;- What we want</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">    //  at http://localhost:8000/_site/dist/sea.js:2:8386</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source">    //  at http://localhost:8000/_site/tests/specs/web-worker/worker.js:3:1</td></tr><tr class="miss"><td class="line">227</td><td class="hits">0</td><td class="source">    while (stack.length &gt; 0) {</td></tr><tr class="miss"><td class="line">228</td><td class="hits">0</td><td class="source">      var top = stack.shift();</td></tr><tr class="miss"><td class="line">229</td><td class="hits">0</td><td class="source">      m = TRACE_RE.exec(top);</td></tr><tr class="miss"><td class="line">230</td><td class="hits">0</td><td class="source">      if (m != null) {</td></tr><tr class="miss"><td class="line">231</td><td class="hits">0</td><td class="source">        break;</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">234</td><td class="hits">0</td><td class="source">    var url;</td></tr><tr class="miss"><td class="line">235</td><td class="hits">0</td><td class="source">    if (m != null) {</td></tr><tr><td class="line">236</td><td class="hits"></td><td class="source">      // Remove line number and column number</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">      // No need to check, can't be wrong at this point</td></tr><tr class="miss"><td class="line">238</td><td class="hits">0</td><td class="source">      var url = URL_RE.exec(m[1])[1];</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">    // Set</td></tr><tr class="miss"><td class="line">241</td><td class="hits">0</td><td class="source">    loaderPath = url</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">      // Set loaderDir</td></tr><tr class="miss"><td class="line">243</td><td class="hits">0</td><td class="source">    loaderDir = dirname(url || cwd);</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">    // This happens with inline worker.</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source">    // When entrance script's location.href is a blob url,</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source">    // cwd will not be available.</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">    // Fall back to loaderDir.</td></tr><tr class="miss"><td class="line">248</td><td class="hits">0</td><td class="source">    if (cwd === '') {</td></tr><tr class="miss"><td class="line">249</td><td class="hits">0</td><td class="source">      cwd = loaderDir;</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="miss"><td class="line">252</td><td class="hits">0</td><td class="source">    var doc = document</td></tr><tr class="miss"><td class="line">253</td><td class="hits">0</td><td class="source">    var scripts = doc.scripts</td></tr><tr><td class="line">254</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source">    // Recommend to add `seajsnode` id for the `sea.js` script element</td></tr><tr class="miss"><td class="line">256</td><td class="hits">0</td><td class="source">    var loaderScript = doc.getElementById(&quot;seajsnode&quot;) ||</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">      scripts[scripts.length - 1]</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">259</td><td class="hits">0</td><td class="source">    function getScriptAbsoluteSrc(node) {</td></tr><tr class="miss"><td class="line">260</td><td class="hits">0</td><td class="source">      return node.hasAttribute ? // non-IE6/7</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">        node.src :</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">        // see http://msdn.microsoft.com/en-us/library/ms536429(VS.85).aspx</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source">        node.getAttribute(&quot;src&quot;, 4)</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">    }</td></tr><tr class="miss"><td class="line">265</td><td class="hits">0</td><td class="source">    loaderPath = getScriptAbsoluteSrc(loaderScript)</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source">      // When `sea.js` is inline, set loaderDir to current working directory</td></tr><tr class="miss"><td class="line">267</td><td class="hits">0</td><td class="source">    loaderDir = dirname(loaderPath || cwd)</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">270</td><td class="hits">0</td><td class="source">  return loaderDir;</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">273</td><td class="hits">1</td><td class="source">module.exports = ScriptUtil;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/utils.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/utils.js</h2><div id="stats" class="high"><div class="percentage">97%</div><div class="sloc">144</div><div class="hits">141</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat Utils</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var logger = require('pomelo-logger').getLogger('bearcat', 'Utils');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var RequireUtil = require('./requireUtil');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var Constant = require('./constant');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var FileUtil = require('./fileUtil');</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">var Path = RequireUtil.requirePath();</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">var Utils = {};</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * Utils normalize type</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> * @param  {String}   type</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> * @return {String}   normalized type</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">Utils.normalizeType = function(type) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">130</td><td class="source">	if (!Utils.checkString(type)) {</td></tr><tr class="hit"><td class="line">31</td><td class="hits">2</td><td class="source">		return;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">128</td><td class="source">	type = type.toLowerCase();</td></tr><tr class="hit"><td class="line">35</td><td class="hits">128</td><td class="source">	var Type = type[0].toUpperCase() + type.substr(1);</td></tr><tr class="hit"><td class="line">36</td><td class="hits">128</td><td class="source">	return Type;</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * Utils check type array</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> * @param  {String}    type</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> * @return {Boolean}   true|false</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">Utils.checkTypeArray = function(type) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">66</td><td class="source">	var type = this.normalizeType(type);</td></tr><tr class="hit"><td class="line">48</td><td class="hits">66</td><td class="source">	return type === Constant.MODEL_ATTRIBUTE_TYPE_ARRAY;</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> * Utils check type object</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source"> * @param  {String}    type</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> * @return {Boolean}   true|false</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">Utils.checkTypeObject = function(type) {</td></tr><tr class="miss"><td class="line">59</td><td class="hits">0</td><td class="source">	var type = this.normalizeType(type);</td></tr><tr class="miss"><td class="line">60</td><td class="hits">0</td><td class="source">	return type === Constant.MODEL_ATTRIBUTE_TYPE_OBJECT;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * Utils check type</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> * @param  {String}   type</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * @return {Function} high order function</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">Utils.isType = function(type) {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">27</td><td class="source">	return function(obj) {</td></tr><tr class="hit"><td class="line">72</td><td class="hits">10500</td><td class="source">		return {}.toString.call(obj) == &quot;[object &quot; + type + &quot;]&quot;;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> * Utils check array</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source"> * @param  {Array}   array</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * @return {Boolean} true|false</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">Utils.checkArray = Array.isArray || Utils.isType(&quot;Array&quot;);</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source"> * Utils check number</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> * @param  {Number}  number</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> * @return {Boolean} true|false</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">Utils.checkNumber = Utils.isType(&quot;Number&quot;);</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> * Utils check function</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> * @param  {Function}   func function</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> * @return {Boolean}    true|false</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">101</td><td class="hits">1</td><td class="source">Utils.checkFunction = Utils.isType(&quot;Function&quot;);</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source"> * Utils check object</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> * @param  {Object}   obj object</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">109</td><td class="hits">1</td><td class="source">Utils.checkObject = Utils.isType(&quot;Object&quot;);</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> * Utils check string</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> * @param  {String}   string</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">Utils.checkString = Utils.isType(&quot;String&quot;);</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> * Utils check boolean</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> * @param  {Object}   obj object</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">127</td><td class="hits">1</td><td class="source">Utils.checkBoolean = Utils.isType(&quot;Boolean&quot;);</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> * Utils check object not empty</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> * @param  {Object}   obj object</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">136</td><td class="hits">1</td><td class="source">Utils.checkObjectEmpty = function(obj) {</td></tr><tr class="hit"><td class="line">137</td><td class="hits">66</td><td class="source">	var flag = true;</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">139</td><td class="hits">66</td><td class="source">	for (var key in obj) {</td></tr><tr class="hit"><td class="line">140</td><td class="hits">18</td><td class="source">		flag = false;</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">143</td><td class="hits">66</td><td class="source">	return flag;</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> * Utils check type</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> * @param  {String}   type</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">153</td><td class="hits">1</td><td class="source">Utils.checkType = function(type) {</td></tr><tr class="hit"><td class="line">154</td><td class="hits">17</td><td class="source">	if (type === 'Object')</td></tr><tr class="hit"><td class="line">155</td><td class="hits">8</td><td class="source">		return true;</td></tr><tr class="hit"><td class="line">156</td><td class="hits">9</td><td class="source">	if (type === 'Number')</td></tr><tr class="hit"><td class="line">157</td><td class="hits">2</td><td class="source">		return true;</td></tr><tr class="hit"><td class="line">158</td><td class="hits">7</td><td class="source">	if (type === 'Array')</td></tr><tr class="hit"><td class="line">159</td><td class="hits">1</td><td class="source">		return true;</td></tr><tr class="hit"><td class="line">160</td><td class="hits">6</td><td class="source">	if (type === 'Boolean')</td></tr><tr class="hit"><td class="line">161</td><td class="hits">1</td><td class="source">		return true;</td></tr><tr class="hit"><td class="line">162</td><td class="hits">5</td><td class="source">	if (type === 'Function')</td></tr><tr class="hit"><td class="line">163</td><td class="hits">1</td><td class="source">		return true;</td></tr><tr class="hit"><td class="line">164</td><td class="hits">4</td><td class="source">	if (type === 'String')</td></tr><tr class="hit"><td class="line">165</td><td class="hits">1</td><td class="source">		return true;</td></tr><tr class="hit"><td class="line">166</td><td class="hits">3</td><td class="source">	return false;</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> * Utils check is not null</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> * @param  {Object}   value</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">176</td><td class="hits">1</td><td class="source">Utils.isNotNull = function(value) {</td></tr><tr class="hit"><td class="line">177</td><td class="hits">12190</td><td class="source">	if (typeof value !== 'undefined' &amp;&amp; value !== null)</td></tr><tr class="hit"><td class="line">178</td><td class="hits">5134</td><td class="source">		return true;</td></tr><tr class="hit"><td class="line">179</td><td class="hits">7056</td><td class="source">	return false;</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source"> * Utils myRequire require handle error</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source"> * @param  {String}   cpath require path</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> * @return {Object}   require result</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">189</td><td class="hits">1</td><td class="source">Utils.myRequire = function(cpath) {</td></tr><tr class="hit"><td class="line">190</td><td class="hits">234</td><td class="source">	if (!Utils.checkString(cpath)) {</td></tr><tr class="hit"><td class="line">191</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">194</td><td class="hits">233</td><td class="source">	var context = null;</td></tr><tr class="hit"><td class="line">195</td><td class="hits">233</td><td class="source">	try {</td></tr><tr class="hit"><td class="line">196</td><td class="hits">233</td><td class="source">		context = require(cpath);</td></tr><tr class="hit"><td class="line">197</td><td class="hits">231</td><td class="source">		return context;</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">	} catch (err) {</td></tr><tr class="hit"><td class="line">199</td><td class="hits">2</td><td class="source">		logger.error('myRequire error %s', err.stack);</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source">		// logger.debug('myRequire error file pid %d %s %s', process.pid, cpath, FileUtil.readFileSync(cpath).toString());</td></tr><tr class="hit"><td class="line">201</td><td class="hits">2</td><td class="source">		return context;</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">205</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source"> * Utils myRequireHot require handle error</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> * @param  {String}   cpath require path</td></tr><tr><td class="line">209</td><td class="hits"></td><td class="source"> * @return {Object}   require result</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">212</td><td class="hits">1</td><td class="source">Utils.myRequireHot = function(cpath) {</td></tr><tr class="hit"><td class="line">213</td><td class="hits">3</td><td class="source">	var context = null;</td></tr><tr class="hit"><td class="line">214</td><td class="hits">3</td><td class="source">	try {</td></tr><tr class="hit"><td class="line">215</td><td class="hits">3</td><td class="source">		context = Utils.requireUncached(cpath);</td></tr><tr class="hit"><td class="line">216</td><td class="hits">2</td><td class="source">		return context;</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source">	} catch (err) {</td></tr><tr class="hit"><td class="line">218</td><td class="hits">1</td><td class="source">		logger.error('myRequireHot error %s', err.stack);</td></tr><tr><td class="line">219</td><td class="hits"></td><td class="source">		// logger.debug('myRequireHot error file pid %d %s %s', process.pid, cpath, FileUtil.readFileSync(cpath).toString());</td></tr><tr class="hit"><td class="line">220</td><td class="hits">1</td><td class="source">		return context;</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source"> * Utils get load path</td></tr><tr><td class="line">226</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">227</td><td class="hits"></td><td class="source"> * @param  {String}   spath scan path</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source"> * @param  {String}   cpath context path</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> * @return {String}   load path</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">232</td><td class="hits">1</td><td class="source">Utils.getLoadPath = function(spath, cpath) {</td></tr><tr class="hit"><td class="line">233</td><td class="hits">15</td><td class="source">	if (!Utils.checkString(spath)) {</td></tr><tr class="hit"><td class="line">234</td><td class="hits">1</td><td class="source">		return null;</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">236</td><td class="hits">14</td><td class="source">	spath = spath.replace(/\./g, &quot;/&quot;);</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">238</td><td class="hits">14</td><td class="source">	cpath = require.resolve(cpath);</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">240</td><td class="hits">14</td><td class="source">	var dpath = Path.dirname(cpath);</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">242</td><td class="hits">14</td><td class="source">	return dpath + &quot;/&quot; + spath;</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source"> * Utils get load path</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">248</td><td class="hits"></td><td class="source"> * @param  {String}   spath scan path</td></tr><tr><td class="line">249</td><td class="hits"></td><td class="source"> * @param  {String}   cpath context path</td></tr><tr><td class="line">250</td><td class="hits"></td><td class="source"> * @return {String}   load path</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">253</td><td class="hits">1</td><td class="source">Utils.getLoadPath2 = function(spath, cpath) {</td></tr><tr class="hit"><td class="line">254</td><td class="hits">53</td><td class="source">	if (!Utils.checkString(spath)) {</td></tr><tr class="hit"><td class="line">255</td><td class="hits">1</td><td class="source">		return null;</td></tr><tr><td class="line">256</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">258</td><td class="hits">52</td><td class="source">	cpath = require.resolve(cpath);</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">260</td><td class="hits">52</td><td class="source">	var dpath = Path.dirname(cpath);</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">262</td><td class="hits">52</td><td class="source">	var rpath = Path.resolve(dpath, spath);</td></tr><tr class="hit"><td class="line">263</td><td class="hits">52</td><td class="source">	return rpath;</td></tr><tr><td class="line">264</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">267</td><td class="hits"></td><td class="source"> * Utils require new</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source"> * @param  {String}   module require module</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source"> * @return {object}   require result</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">273</td><td class="hits">1</td><td class="source">Utils.requireUncached = function(module) {</td></tr><tr class="hit"><td class="line">274</td><td class="hits">4</td><td class="source">	if (!Utils.checkString(module)) {</td></tr><tr class="hit"><td class="line">275</td><td class="hits">1</td><td class="source">		return;</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">278</td><td class="hits">3</td><td class="source">	var modulePath = require.resolve(module);</td></tr><tr class="hit"><td class="line">279</td><td class="hits">2</td><td class="source">	if (require.cache[modulePath]) {</td></tr><tr class="hit"><td class="line">280</td><td class="hits">2</td><td class="source">		delete require.cache[modulePath];</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">283</td><td class="hits">2</td><td class="source">	return require(modulePath)</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">285</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">287</td><td class="hits"></td><td class="source"> * Utils Check file suffix</td></tr><tr><td class="line">288</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">289</td><td class="hits"></td><td class="source"> * @param {String} fn file name</td></tr><tr><td class="line">290</td><td class="hits"></td><td class="source"> * @param {String} suffix suffix string, such as .js, etc.</td></tr><tr><td class="line">291</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">292</td><td class="hits">1</td><td class="source">Utils.checkFileType = function(fn, suffix) {</td></tr><tr class="hit"><td class="line">293</td><td class="hits">159</td><td class="source">	if (suffix.charAt(0) !== '.') {</td></tr><tr class="hit"><td class="line">294</td><td class="hits">9</td><td class="source">		suffix = '.' + suffix;</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">297</td><td class="hits">159</td><td class="source">	if (fn.length &lt;= suffix.length) {</td></tr><tr class="hit"><td class="line">298</td><td class="hits">1</td><td class="source">		return false;</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">301</td><td class="hits">158</td><td class="source">	var str = fn.substring(fn.length - suffix.length).toLowerCase();</td></tr><tr class="hit"><td class="line">302</td><td class="hits">158</td><td class="source">	suffix = suffix.toLowerCase();</td></tr><tr class="hit"><td class="line">303</td><td class="hits">158</td><td class="source">	return str === suffix;</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">306</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">307</td><td class="hits"></td><td class="source"> * Utils Check isFile</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source"> * @param  {String}  path </td></tr><tr><td class="line">310</td><td class="hits"></td><td class="source"> * @return {Boolean} true|false.</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">312</td><td class="hits">1</td><td class="source">Utils.isFile = function(path) {</td></tr><tr class="hit"><td class="line">313</td><td class="hits">172</td><td class="source">	if (FileUtil.existsSync(path)) {</td></tr><tr class="hit"><td class="line">314</td><td class="hits">172</td><td class="source">		return FileUtil.statSync(path).isFile();</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source"> * Utils Check isDir</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source"> * @param  {String}  path </td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source"> * @return {Boolean} true|false.</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">324</td><td class="hits">1</td><td class="source">Utils.isDir = function(path) {</td></tr><tr class="hit"><td class="line">325</td><td class="hits">220</td><td class="source">	if (FileUtil.existsSync(path)) {</td></tr><tr class="hit"><td class="line">326</td><td class="hits">220</td><td class="source">		return FileUtil.statSync(path).isDirectory();</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">328</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">331</td><td class="hits"></td><td class="source"> * Utils get file name</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source"> * @param  {String}  fp </td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source"> * @param  {Number}  suffixLength</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source"> * @return {String}  file name</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">337</td><td class="hits">1</td><td class="source">Utils.getFileName = function(fp, suffixLength) {</td></tr><tr class="hit"><td class="line">338</td><td class="hits">142</td><td class="source">	var fn = Path.basename(fp);</td></tr><tr class="hit"><td class="line">339</td><td class="hits">142</td><td class="source">	if (fn.length &gt; suffixLength) {</td></tr><tr class="hit"><td class="line">340</td><td class="hits">141</td><td class="source">		return fn.substring(0, fn.length - suffixLength);</td></tr><tr><td class="line">341</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">343</td><td class="hits">1</td><td class="source">	return fn;</td></tr><tr><td class="line">344</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source"> * Utils compare by order</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source"> * @param  {Object}  a</td></tr><tr><td class="line">350</td><td class="hits"></td><td class="source"> * @param  {Object}  b</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source"> * @return {Number}  </td></tr><tr><td class="line">352</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">353</td><td class="hits">1</td><td class="source">Utils.compareByOrder = function(a, b) {</td></tr><tr class="hit"><td class="line">354</td><td class="hits">591</td><td class="source">	if (!a.getOrder())</td></tr><tr class="hit"><td class="line">355</td><td class="hits">420</td><td class="source">		return 1;</td></tr><tr class="hit"><td class="line">356</td><td class="hits">171</td><td class="source">	if (!b.getOrder())</td></tr><tr class="hit"><td class="line">357</td><td class="hits">145</td><td class="source">		return -1;</td></tr><tr class="hit"><td class="line">358</td><td class="hits">26</td><td class="source">	return a.getOrder() - b.getOrder();</td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">362</td><td class="hits"></td><td class="source"> * Utils compare beans, aspect first, order low first</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source"> * @param  {Object}  a</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source"> * @param  {Object}  b</td></tr><tr><td class="line">366</td><td class="hits"></td><td class="source"> * @return {Number}  </td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">368</td><td class="hits">1</td><td class="source">Utils.compareBeans = function(a, b) {</td></tr><tr class="hit"><td class="line">369</td><td class="hits">170</td><td class="source">	if (a.isAspect()) {</td></tr><tr class="hit"><td class="line">370</td><td class="hits">31</td><td class="source">		return -1;</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">373</td><td class="hits">139</td><td class="source">	if (b.isAspect()) {</td></tr><tr class="hit"><td class="line">374</td><td class="hits">30</td><td class="source">		return 1;</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">376</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">377</td><td class="hits">109</td><td class="source">	if (!a.getOrder())</td></tr><tr class="hit"><td class="line">378</td><td class="hits">100</td><td class="source">		return 1;</td></tr><tr class="hit"><td class="line">379</td><td class="hits">9</td><td class="source">	if (!b.getOrder())</td></tr><tr class="hit"><td class="line">380</td><td class="hits">2</td><td class="source">		return -1;</td></tr><tr class="hit"><td class="line">381</td><td class="hits">7</td><td class="source">	return a.getOrder() - b.getOrder();</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">385</td><td class="hits"></td><td class="source"> * Utils parseArgs</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source"> * @param  {Array}  args</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source"> * @return {Object} argsMap </td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">390</td><td class="hits">1</td><td class="source">Utils.parseArgs = function(args) {</td></tr><tr class="hit"><td class="line">391</td><td class="hits">63</td><td class="source">	var argsMap = {};</td></tr><tr class="hit"><td class="line">392</td><td class="hits">63</td><td class="source">	var mainPos = 1;</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">394</td><td class="hits">63</td><td class="source">	argsMap.main = args[mainPos];</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">396</td><td class="hits">63</td><td class="source">	for (var i = (mainPos + 1); i &lt; args.length; i++) {</td></tr><tr class="hit"><td class="line">397</td><td class="hits">2</td><td class="source">		var arg = args[i];</td></tr><tr class="hit"><td class="line">398</td><td class="hits">2</td><td class="source">		var sep = arg.indexOf('=');</td></tr><tr class="hit"><td class="line">399</td><td class="hits">2</td><td class="source">		var key = arg.slice(0, sep);</td></tr><tr class="hit"><td class="line">400</td><td class="hits">2</td><td class="source">		var value = arg.slice(sep + 1);</td></tr><tr class="hit"><td class="line">401</td><td class="hits">2</td><td class="source">		argsMap[key] = value;</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">404</td><td class="hits">63</td><td class="source">	return argsMap;</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> * Utils check browser</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">412</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">413</td><td class="hits">1</td><td class="source">Utils.checkBrowser = function() {</td></tr><tr class="hit"><td class="line">414</td><td class="hits">130</td><td class="source">	return typeof window !== 'undefined';</td></tr><tr><td class="line">415</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">416</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source"> * Utils check web worker</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">420</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">421</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">423</td><td class="hits">1</td><td class="source">Utils.checkWebWorker = function() {</td></tr><tr class="hit"><td class="line">424</td><td class="hits">1</td><td class="source">	return this.checkBrowser() &amp;&amp; typeof importScripts !== 'undefined' &amp;&amp; this.checkFunction(importScripts);</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">426</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> * Utils check model filter error</td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">430</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">431</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">433</td><td class="hits">1</td><td class="source">Utils.checkModelFilterError = function(r) {</td></tr><tr class="hit"><td class="line">434</td><td class="hits">93</td><td class="source">	return r !== true &amp;&amp; this.isNotNull(r);</td></tr><tr><td class="line">435</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">438</td><td class="hits"></td><td class="source"> * Utils check cocos2d-js jsb env</td></tr><tr><td class="line">439</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source"> * @return {Boolean}  true|false</td></tr><tr><td class="line">441</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">442</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">443</td><td class="hits">1</td><td class="source">Utils.checkCocos2dJsb = function() {</td></tr><tr class="hit"><td class="line">444</td><td class="hits">67</td><td class="source">	if (typeof cc !== 'undefined' &amp;&amp; cc &amp;&amp; cc.sys &amp;&amp; cc.sys.isNative) {</td></tr><tr class="miss"><td class="line">445</td><td class="hits">0</td><td class="source">		return true;</td></tr><tr><td class="line">446</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">448</td><td class="hits">67</td><td class="source">	return false;</td></tr><tr><td class="line">449</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">450</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">451</td><td class="hits">1</td><td class="source">module.exports = Utils;</td></tr></tbody></table></div><div class="file"><h2 id="/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/validatorUtil.js">/home/fantasyni/projects/pomelo-projects/bearcat/lib/util/validatorUtil.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">56</div><div class="hits">56</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/*!</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * .______    _______     ___      .______       ______     ___   .__________.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * (   _  )  (   ____)   /   \     (   _  )     (      )   /   \  (          )</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |__     /  ^  \    |  |_)  )   |  ,----'  /  ^  \ `---|  |---`</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * |   _  &lt;  |   __)   /  /_\  \   |      )    |  |      /  /_\  \    |  |</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * |  |_)  ) |  |____ /  _____  \  |  |)  ----.|  `----./  _____  \   |  |</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * (______)  (_______/__/     \__\ ( _| `.____) (______)__/     \__\  |__|</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> * Bearcat ValidatorUtil</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> * Copyright(c) 2015 fantasyni &lt;fantasyni@163.com&gt;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> * MIT Licensed</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var Constant = require('./constant');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var Utils = require('./utils');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var ValidatorUtil = {};</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> * ValidatorUtil validate metaObject.</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> *</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> * @param    {Object}   	   metaObject</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> * @return   {Boolean|Error}  true|error object</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> * @api public</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">ValidatorUtil.metaValidator = function(metaObject) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">554</td><td class="source">	var id = metaObject.id;</td></tr><tr class="hit"><td class="line">27</td><td class="hits">554</td><td class="source">	var mid = metaObject.mid;</td></tr><tr class="hit"><td class="line">28</td><td class="hits">554</td><td class="source">	var cid = metaObject.cid;</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">30</td><td class="hits">554</td><td class="source">	if (!id &amp;&amp; !mid &amp;&amp; !cid)</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">		return new Error('one of id, mid, cid must be exist');</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">553</td><td class="source">	if (Utils.isNotNull(id) &amp;&amp; !Utils.checkString(id))</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">		return new Error('id must be String');</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">552</td><td class="source">	if (Utils.isNotNull(mid) &amp;&amp; !Utils.checkString(mid))</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">		return new Error('mid must be String');</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">551</td><td class="source">	if (Utils.isNotNull(cid) &amp;&amp; !Utils.checkString(cid))</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">		return new Error('cid must be String');</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">550</td><td class="source">	var func = metaObject.func;</td></tr><tr class="hit"><td class="line">43</td><td class="hits">550</td><td class="source">	if (!Utils.isNotNull(func) || !Utils.checkFunction(func))</td></tr><tr class="hit"><td class="line">44</td><td class="hits">2</td><td class="source">		return new Error('func must be Function');</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">548</td><td class="source">	var table = metaObject.table;</td></tr><tr class="hit"><td class="line">47</td><td class="hits">548</td><td class="source">	if (Utils.isNotNull(table) &amp;&amp; !Utils.checkString(table)) {</td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">		return new Error('table must be String');</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">51</td><td class="hits">547</td><td class="source">	var message = metaObject.message;</td></tr><tr class="hit"><td class="line">52</td><td class="hits">547</td><td class="source">	if (Utils.isNotNull(message) &amp;&amp; !Utils.checkString(message)) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">1</td><td class="source">		return new Error('message must be String');</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">56</td><td class="hits">546</td><td class="source">	var constraint = metaObject.constraint;</td></tr><tr class="hit"><td class="line">57</td><td class="hits">546</td><td class="source">	if (Utils.isNotNull(constraint) &amp;&amp; !Utils.checkString(constraint)) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">		return new Error('constraint must be String');</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">61</td><td class="hits">545</td><td class="source">	var order = metaObject.order;</td></tr><tr class="hit"><td class="line">62</td><td class="hits">545</td><td class="source">	if (Utils.isNotNull(order) &amp;&amp; !Utils.checkNumber(order))</td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">		return new Error('order must be Number');</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">65</td><td class="hits">544</td><td class="source">	var parentName = metaObject.parent;</td></tr><tr class="hit"><td class="line">66</td><td class="hits">544</td><td class="source">	if (Utils.isNotNull(parentName) &amp;&amp; !Utils.checkString(parentName))</td></tr><tr class="hit"><td class="line">67</td><td class="hits">1</td><td class="source">		return new Error('parent must be String');</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">69</td><td class="hits">543</td><td class="source">	var initMethodName = metaObject.init;</td></tr><tr class="hit"><td class="line">70</td><td class="hits">543</td><td class="source">	if (Utils.isNotNull(initMethodName) &amp;&amp; !Utils.checkString(initMethodName))</td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">		return new Error('init must be String');</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">542</td><td class="source">	var destroyMethodName = metaObject.destroy;</td></tr><tr class="hit"><td class="line">74</td><td class="hits">542</td><td class="source">	if (Utils.isNotNull(destroyMethodName) &amp;&amp; !Utils.checkString(destroyMethodName))</td></tr><tr class="hit"><td class="line">75</td><td class="hits">1</td><td class="source">		return new Error('destroy must be String');</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">77</td><td class="hits">541</td><td class="source">	var factoryBeanName = metaObject.factoryBean;</td></tr><tr class="hit"><td class="line">78</td><td class="hits">541</td><td class="source">	if (Utils.isNotNull(factoryBeanName) &amp;&amp; !Utils.checkString(factoryBeanName))</td></tr><tr class="hit"><td class="line">79</td><td class="hits">1</td><td class="source">		return new Error('factoryBean must be String');</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">81</td><td class="hits">540</td><td class="source">	var factoryMethodName = metaObject.factoryMethod;</td></tr><tr class="hit"><td class="line">82</td><td class="hits">540</td><td class="source">	if (Utils.isNotNull(factoryMethodName) &amp;&amp; !Utils.checkString(factoryMethodName))</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">		return new Error('factoryMethodName must be String');</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">85</td><td class="hits">539</td><td class="source">	var scope = metaObject.scope || Constant.SCOPE_DEFAULT;</td></tr><tr class="hit"><td class="line">86</td><td class="hits">539</td><td class="source">	if (scope &amp;&amp; scope !== Constant.SCOPE_SINGLETON &amp;&amp; scope !== Constant.SCOPE_PROTOTYPE)</td></tr><tr class="hit"><td class="line">87</td><td class="hits">1</td><td class="source">		return new Error('scope must be singleton or prototype');</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">89</td><td class="hits">538</td><td class="source">	var asyncInit = metaObject.async || Constant.ASYNC_INIT_DEFAULT;</td></tr><tr class="hit"><td class="line">90</td><td class="hits">538</td><td class="source">	if (Utils.isNotNull(asyncInit) &amp;&amp; !Utils.checkBoolean(asyncInit))</td></tr><tr class="hit"><td class="line">91</td><td class="hits">1</td><td class="source">		return new Error('async must be Boolean');</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">93</td><td class="hits">537</td><td class="source">	var lazyInit = metaObject.lazy || Constant.LAZY_INIT_DEFAULT;</td></tr><tr class="hit"><td class="line">94</td><td class="hits">537</td><td class="source">	if (Utils.isNotNull(lazyInit) &amp;&amp; !Utils.checkBoolean(lazyInit))</td></tr><tr class="hit"><td class="line">95</td><td class="hits">1</td><td class="source">		return new Error('lazy must be Boolean');</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">97</td><td class="hits">536</td><td class="source">	return true;</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">module.exports = ValidatorUtil;</td></tr></tbody></table></div></div></div></body></html>